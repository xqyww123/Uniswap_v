<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‚Äπlibrary/system/Phi_Working_Mode.ML‚Ä∫</title>
</head>


<body>
<div class="head">
<h1>File ‚Äπlibrary/system/Phi_Working_Mode.ML‚Ä∫</h1>
</div>

<pre class="source"><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>PHI_WORKING_MODE</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>working_mode</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
  </span><span>name</span><span class="main"><span>:</span></span><span> </span><span>string</span><span class="main"><span>,</span></span><span>
  </span><span>is_on_going_construction</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
  </span><span>spec_of</span><span>  </span><span class="main"><span>:</span></span><span>  </span><span>term</span><span> </span><span class="comment1"><span>(*on-going construction assertion*)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span>  </span><span>term</span><span> </span><span class="comment1"><span>(*the BI assertion*)</span></span><span class="main"><span>,</span></span><span>
  </span><span>spec_of_c</span><span class="main"><span>:</span></span><span> </span><span>cterm</span><span> </span><span class="comment1"><span>(*on-going construction assertion*)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>cterm</span><span class="main"><span>,</span></span><span>
  </span><span>initialize_sequent</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.state</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> * </span><span class="entity"><span>Proof.state</span></span><span class="main"><span>,</span></span><span>
  </span><span>inhabited_rule</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  </span><span>transformation_rule</span><span> </span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  </span><span>view_shift_rule</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
  </span><span>cast</span><span class="main"><span>:</span></span><span> </span><span>cterm</span><span> </span><span class="comment1"><span>(*desired*)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> * </span><span>thm</span><span> </span><span class="comment1"><span>(*sequent*)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> * </span><span>thm</span><span class="main"><span>,</span></span><span>
  </span><span>cast_exception</span><span class="main"><span>:</span></span><span> </span><span>cterm</span><span> </span><span class="comment1"><span>(*desired*)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> * </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> * </span><span>thm</span><span class="main"><span>,</span></span><span>
  </span><span>vcg_before_assembling</span><span class="main"><span>:</span></span><span> </span><span>cterm</span><span> </span><span class="comment1"><span>(*goal*)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> * </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> * </span><span>thm</span><span class="main"><span>,</span></span><span>
  </span><span>introduce_existence</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>typ</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> * </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> * </span><span>thm</span><span class="main"><span>,</span></span><span>
  </span><span>introduce_existence_in_assembling</span><span class="main"><span>:</span></span><span>
      </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>typ</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> * </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> * </span><span>thm</span><span>
</span><span class="main"><span>}</span></span><span>
</span><span class="comment1"><span>(*
cast operation: transform to the desired assertion.
If successful, it results in ‚ÄπùóàùñªùóÖùóÇùóÄùñ∫ùóçùóÇùóàùóá P ‚üπ Result‚Ä∫
which always has a leading obligation P no matter whether it is trivially true.
cast exception is the version for casting an exception assertion.
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> procedure </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>working_mode</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> view_shift </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>working_mode</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> implication </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>working_mode</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> initialize_sequent_procedure </span><span class="main"><span>:</span></span><span> </span><span>cterm</span><span> </span><span class="comment1"><span>(*argument*)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> * </span><span>thm</span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> register </span><span class="main"><span>:</span></span><span>  </span><span class="entity"><span>working_mode</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>Context.generic</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>Context.generic</span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> get_by_name  </span><span class="main"><span>:</span></span><span> </span><span>Context.generic</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>working_mode</span></span><span> </span><span>option</span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> get_by_name1 </span><span class="main"><span>:</span></span><span> </span><span>Context.generic</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>working_mode</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> set  </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>working_mode</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mode  </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>working_mode</span></span><span> </span><span>option</span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mode1 </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>working_mode</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> cast </span><span class="main"><span>:</span></span><span> </span><span>cterm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> * </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> * </span><span>thm</span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> cast_exception </span><span class="main"><span>:</span></span><span> </span><span>cterm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> * </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> * </span><span>thm</span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> infer_working_mode_of_sequent </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>context_state</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>working_mode</span></span><span> * </span><span class="entity"><span>context_state</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Phi_Working_Mode</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>PHI_WORKING_MODE</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>working_mode</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
  </span><span>name</span><span class="main"><span>:</span></span><span> </span><span>string</span><span class="main"><span>,</span></span><span>
  </span><span>is_on_going_construction</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
  </span><span>spec_of</span><span>  </span><span class="main"><span>:</span></span><span>  </span><span>term</span><span> </span><span class="comment1"><span>(*on-going construction assertion*)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span>  </span><span>term</span><span class="main"><span>,</span></span><span>
  </span><span>spec_of_c</span><span class="main"><span>:</span></span><span> </span><span>cterm</span><span> </span><span class="comment1"><span>(*on-going construction assertion*)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>cterm</span><span class="main"><span>,</span></span><span>
  </span><span>inhabited_rule</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  </span><span>initialize_sequent</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.state</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> * </span><span class="entity"><span>Proof.state</span></span><span class="main"><span>,</span></span><span>
  </span><span>transformation_rule</span><span> </span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  </span><span>view_shift_rule</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
  </span><span>cast</span><span class="main"><span>:</span></span><span> </span><span>cterm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> * </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> * </span><span>thm</span><span class="main"><span>,</span></span><span>
  </span><span>cast_exception</span><span class="main"><span>:</span></span><span> </span><span>cterm</span><span> </span><span class="comment1"><span>(*desired*)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> * </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> * </span><span>thm</span><span class="main"><span>,</span></span><span>
  </span><span>vcg_before_assembling</span><span class="main"><span>:</span></span><span> </span><span>cterm</span><span> </span><span class="comment1"><span>(*goal*)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> * </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> * </span><span>thm</span><span class="main"><span>,</span></span><span>
  </span><span>introduce_existence</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>typ</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> * </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> * </span><span>thm</span><span class="main"><span>,</span></span><span>
  </span><span>introduce_existence_in_assembling</span><span class="main"><span>:</span></span><span>
      </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>typ</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> * </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> * </span><span>thm</span><span>
</span><span class="main"><span>}</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Data</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Generic_Data</span><span class="main"><span>(</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>working_mode</span></span><span> </span><span>Symtab.table</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>empty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Symtab.empty</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>merge</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Symtab.merge</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>true</span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>get_by_name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Symtab.lookup</span><span> </span><span>o</span><span> </span><span>Data.get</span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>get_by_name1</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>get_by_name</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>name</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>X</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>X</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"No such registered mode: "</span></span><span>^</span><span class="entity"><span>name</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>register</span></span><span> </span><span class="entity"><span>wms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Data.map</span><span> </span><span class="main"><span>(</span></span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>wm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Symtab.update_new</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>name</span><span> </span><span class="entity"><span>wm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>wms</span></span><span class="main"><span>)</span></span><span>

</span><span class="comment1"><span>(* Set / Get Mode *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Mode</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Data</span><span class="main"><span>(</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>working_mode</span></span><span> </span><span>option</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>init</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>K</span><span> </span><span>NONE</span><span>
</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Mode.put</span><span> </span><span>o</span><span> </span><span>SOME</span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Mode.get</span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mode1</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Mode.get</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                   </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>x</span></span><span>
                    </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"No working mode has been set in this context."</span></span><span class="main"><span>)</span></span><span>


</span><span class="comment1"><span>(** Auxiliaries **)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>generic_initialize_sequent</span></span><span> </span><span class="entity"><span>gen</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Facts.lookup</span><span> </span><span class="main"><span>(</span></span><span>Context.Proof</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proof.context_of</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="main"><span>(</span></span><span>Proof_Context.facts_of</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proof.context_of</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"local.œÜùóÇùóáùóÇùóçùóÇùñ∫ùóÖ"</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>{</span></span><span>thms</span><span class="main"><span>=</span></span><span class="main"><span>[</span></span><span class="entity"><span>X</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>dynamic</span><span class="main"><span>=</span></span><span>false</span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.transfer'</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proof.context_of</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>gen</span></span><span> </span><span class="entity"><span>s</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>default_initialize_sequent</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>generic_initialize_sequent</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"BUG #q23c5nu9["</span></span><span class="main"><span>)</span></span><span>

</span><span class="comment1"><span>(* Cast *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>generic_cast</span></span><span> </span><span class="entity"><span>rule</span></span><span> </span><span class="entity"><span>place</span></span><span> </span><span class="entity"><span>desired_nu</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
   </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Phi_Reasoner.info_print</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"reasoning cast..."</span></span><span> </span><span>^</span><span> </span><span>Position.here</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>‚åÇ</span></span></span></span><span class="main"><span>)</span></span><span>
   </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sequent'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>Phi_Reasoner.reason</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sequent</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>rule</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>ret</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>ret</span></span><span>
             </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>Phi_Error.CastFail</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>place</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>desired_nu</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span>
   </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.prop_of</span><span> </span><span class="entity"><span>sequent'</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const</span><span class="hidden">&gt;</span></span></span><span>‚Äπ</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span>‚Ä∫</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
               </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const</span><span class="hidden">&gt;</span></span></span><span>‚Äπ</span><span>Pure.imp</span><span>‚Ä∫</span></span><span>
                    </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const</span><span class="hidden">&gt;</span></span></span><span>‚Äπ</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span>‚Ä∫</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‚Äπ</span><a class="entity_ref" href="../../../../../../Phi_Logic_Programming_Reasoner.Phi_Logic_Programming_Reasoner.html#Phi_Logic_Programming_Reasoner.Proof_Obligation|const"><span>Proof_Obligation</span></a><span>‚Ä∫</span></span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                    </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const</span><span class="hidden">&gt;</span></span></span><span>‚Äπ</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span>‚Ä∫</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
               </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>Phi_Error.CastFail</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>place</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>desired_nu</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt'</span></span><span class="main"><span>,</span></span><span class="entity"><span>sequent'</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>cannot_cast_exception</span></span><span> </span><span class="entity"><span>sequent</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>THM</span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"cannot cast the exception of the sequent"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>sequent</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>bad_sequent</span></span><span> </span><span class="entity"><span>sequent</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>THM</span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Unrecognizable form of sequent."</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>sequent</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>collect</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.fold_aterms</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span>Free</span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>insert</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>I</span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>I</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>introduce_ex_ToA</span></span><span> </span><span class="entity"><span>extract</span></span><span> </span><span class="entity"><span>rule0</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
   </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>idx</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.maxidx_of</span><span> </span><span class="entity"><span>sequent</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span>
   </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rule</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.incr_indexes</span><span> </span><span class="entity"><span>idx</span></span><span> </span><span class="entity"><span>rule0</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>generalize</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>sequent</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>Phi_Syntax.dest_ToA_Construction</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.concl_of</span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>S</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>sequent</span></span><span> </span><span>RS</span><span> </span><span>Drule.infer_instantiate</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                              </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"S"</span></span><span class="main"><span>,</span></span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>absfree</span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>extract</span></span><span> </span><span class="entity"><span>S</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>rule</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>fold_rev</span><span> </span><span class="entity"><span>generalize</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>sequent</span></span><span> </span><span>|&gt;</span><span> </span><span>pair</span><span> </span><span class="entity"><span>ctxt</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>introduce_existence_cc</span></span><span> </span><span class="entity"><span>extract</span></span><span> </span><span class="entity"><span>rule0</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>can</span><span> </span><span class="entity"><span>Phi_Syntax.dest_CurrentConstruction</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.concl_of</span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
     </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>idx</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.maxidx_of</span><span> </span><span class="entity"><span>sequent</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span>
     </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rule</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.incr_indexes</span><span> </span><span class="entity"><span>idx</span></span><span> </span><span class="entity"><span>rule0</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>generalize</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>sequent</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>Phi_Syntax.dest_PendingConstruction</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.concl_of</span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="entity"><span>E</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>sequent</span></span><span> </span><span>RS</span><span> </span><span>Drule.infer_instantiate</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                                    </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"S"</span></span><span class="main"><span>,</span></span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>absfree</span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>extract</span></span><span> </span><span class="entity"><span>E</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>rule</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>fold_rev</span><span> </span><span class="entity"><span>generalize</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>sequent</span></span><span> </span><span>|&gt;</span><span> </span><span>pair</span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>can</span><span> </span><span class="entity"><span>Phi_Syntax.dest_PendingConstruction</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.prop_of</span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
     </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="entity"><span>Q</span></span><span class="main"><span>,</span></span><span class="entity"><span>E</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Phi_Syntax.dest_PendingConstruction</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.prop_of</span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span>
     </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bad_Q</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>collect</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>Q</span></span><span>
     </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bad_E</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>collect</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>E</span></span><span>
     </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>idx</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.maxidx_of</span><span> </span><span class="entity"><span>sequent</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span>
     </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rule_Q</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.incr_indexes</span><span> </span><span class="entity"><span>idx</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../Calculus_of_Programming.html#Calculus_of_Programming.introduce_Ex_pending|fact"><span>introduce_Ex_pending</span></a><span class="antiquote"><span>}</span></span></span></span><span>
     </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rule_E</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.incr_indexes</span><span> </span><span class="entity"><span>idx</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../Calculus_of_Programming.html#Calculus_of_Programming.introduce_Ex_pending_E|fact"><span>introduce_Ex_pending_E</span></a><span class="antiquote"><span>}</span></span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>generalize_Q</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>sequent</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>Phi_Syntax.dest_PendingConstruction</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.prop_of</span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="entity"><span>Q</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>sequent</span></span><span> </span><span>RS</span><span>
               </span><span>Drule.infer_instantiate</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Q"</span></span><span class="main"><span>,</span></span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>absfree</span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>Q</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>rule_Q</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>generalize_E</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>sequent</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>Phi_Syntax.dest_PendingConstruction</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.prop_of</span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="entity"><span>E</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>sequent</span></span><span> </span><span>RS</span><span>
               </span><span>Drule.infer_instantiate</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"E"</span></span><span class="main"><span>,</span></span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>absfree</span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>E</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>rule_E</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>fold_rev</span><span> </span><span class="entity"><span>generalize_E</span></span><span> </span><span class="entity"><span>bad_E</span></span><span> </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span class="entity"><span>generalize_Q</span></span><span> </span><span class="entity"><span>bad_Q</span></span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>pair</span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>bad_sequent</span></span><span> </span><span class="entity"><span>sequent</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>cast</span></span><span> </span><span class="entity"><span>desired</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>cast</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mode1</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>desired</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>cast_exception</span></span><span> </span><span class="entity"><span>desired</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>cast_exception</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mode1</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>desired</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>vcg_by_cast</span></span><span> </span><span class="entity"><span>destination</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>
     </span><span> </span><span class="entity"><span>Phi_Reasoner.info_pretty</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span>
        </span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>"casting to the destined post-condition "</span></span><span class="main"><span>,</span></span><span>
        </span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>destination</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>Pretty.block</span><span> </span><span class="main"><span>(</span></span><span>Pretty.here</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>‚åÇ</span></span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
     </span><span> </span><span class="entity"><span>cast</span></span><span> </span><span class="entity"><span>destination</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>)</span></span><span>

</span><span class="comment1"><span>(* Working Modes *)</span></span><span>

</span><span class="comment1"><span>(** Procedure Mode **)</span></span><span>


</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>finish_proc</span></span><span> </span><span class="entity"><span>hyp</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Phi_Syntax</span><span>
   </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="entity"><span>s'</span></span><span class="main"><span>,</span></span><span class="entity"><span>H'</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_CurrentConstruction_c</span></span><span> </span><span class="entity"><span>hyp</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
   </span><span> </span><span class="entity"><span>sequent</span></span><span>
      </span><span>|&gt;</span><span> </span><span>Thm.implies_intr</span><span> </span><span class="entity"><span>hyp</span></span><span>
      </span><span>|&gt;</span><span> </span><span>Thm.forall_intr</span><span> </span><span class="entity"><span>H'</span></span><span>
      </span><span>|&gt;</span><span> </span><span>Thm.forall_intr</span><span> </span><span class="entity"><span>s'</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>th</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>th</span></span><span> </span><span>COMP</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../Calculus_of_Programming.html#Calculus_of_Programming.\&lt;phi&gt;reassemble_proc_final|fact"><span>œÜreassemble_proc_final</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>initialize_sequent_procedure</span></span><span> </span><span class="entity"><span>arg</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Phi_Syntax</span><span>
   </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>blk_name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>RR</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_fixes</span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"ùîñ"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"‚Ñú"</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
   </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>stat_var</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>blk_name</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‚Äπ</span><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.resource|type"><span>resource</span></a><span>‚Ä∫</span></span></span><span class="main"><span>)</span></span><span>
   </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.declare_constraints</span><span> </span><span class="entity"><span>stat_var</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
   </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>init</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‚Äπ</span><a class="entity_ref" href="../../../../../../Calculus_of_Programming.html#Calculus_of_Programming.CurrentConstruction|const"><span>CurrentConstruction</span></a><span>‚Ä∫</span></span><span class="main"><span>,</span></span><span>
                      </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‚Äπ</span><a class="entity_ref" href="../../../../../../Phi_Logic_Programming_Reasoner.Phi_Logic_Programming_Reasoner.html#Phi_Logic_Programming_Reasoner.mode|type"><span>mode</span></a><span>‚Ä∫</span></span></span><span>
                  </span><span>--&gt;</span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>stat_var</span></span><span>
                  </span><span>--&gt;</span><span> </span><span>dummyT</span><span>
                  </span><span>--&gt;</span><span> </span><span>Thm.typ_of_cterm</span><span> </span><span class="entity"><span>arg</span></span><span>
                  </span><span>--&gt;</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‚Äπ</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span>‚Ä∫</span></span></span><span class="main"><span>)</span></span><span>
               </span><span>$</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const</span><span class="hidden">&gt;</span></span></span><span>‚Äπ</span><a class="entity_ref" href="../../../../../../Calculus_of_Programming.html#Calculus_of_Programming.programming_mode|const"><span>programming_mode</span></a><span>‚Ä∫</span></span><span>
               </span><span>$</span><span> </span><span class="entity"><span>stat_var</span></span><span>
               </span><span>$</span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>RR</span></span><span class="main"><span>,</span></span><span> </span><span>dummyT</span><span class="main"><span>)</span></span><span>
   </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>init</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Syntax.check_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>init</span></span><span class="main"><span>)</span></span><span>
   </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>init</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.apply</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>cterm</span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span>Thm.apply</span><span> </span><span class="entity"><span>init</span></span><span> </span><span class="entity"><span>arg</span></span><span class="main"><span>)</span></span><span>
   </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>init</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Assumption.add_assms</span><span>
          </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>hyp</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>finish_proc</span></span><span> </span><span class="entity"><span>hyp</span></span><span> </span><span>o</span><span> </span><span>pair</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>I</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>init</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
   </span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span class="entity"><span>init</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>cast</span></span><span> </span><span class="entity"><span>desired</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
   </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>idx</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>+</span><span> </span><span>Thm.maxidx_of_cterm</span><span> </span><span class="entity"><span>desired</span></span><span>
   </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rule</span></span><span> </span><span class="main"><span>=</span></span><span>
     </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>can</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Phi_Syntax.dest_CurrentConstruction</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.concl_of</span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../../Calculus_of_Programming.html#Calculus_of_Programming._\&lt;phi&gt;cast_internal_rule_|fact"><span>_œÜcast_internal_rule_</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../../Calculus_of_Programming.html#Calculus_of_Programming._\&lt;phi&gt;cast_internal_rule_&apos;|fact"><span>_œÜcast_internal_rule_'</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Thm.incr_indexes</span><span> </span><span class="entity"><span>idx</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Drule.infer_instantiate</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"T'"</span></span><span class="main"><span>,</span></span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>desired</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>generic_cast</span></span><span> </span><span class="entity"><span>rule</span></span><span> </span><span class="inner_quoted"><span>"post-condition of the sequent"</span></span><span> </span><span class="entity"><span>desired</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>cast_exception</span></span><span> </span><span class="entity"><span>desired</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
   </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>idx</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>+</span><span> </span><span>Thm.maxidx_of_cterm</span><span> </span><span class="entity"><span>desired</span></span><span>
   </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rule</span></span><span> </span><span class="main"><span>=</span></span><span>
     </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>can</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Phi_Syntax.dest_PendingConstruction</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.concl_of</span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../../Calculus_of_Programming.html#Calculus_of_Programming._\&lt;phi&gt;cast_exception_rule_|fact"><span>_œÜcast_exception_rule_</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>cannot_cast_exception</span></span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Thm.incr_indexes</span><span> </span><span class="entity"><span>idx</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Drule.infer_instantiate</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"E'"</span></span><span class="main"><span>,</span></span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>desired</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>generic_cast</span></span><span> </span><span class="entity"><span>rule</span></span><span> </span><span class="inner_quoted"><span>"post-condition of the sequent"</span></span><span> </span><span class="entity"><span>desired</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>vcg_before_assembling</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
   </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sequent'</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>can</span><span> </span><span class="entity"><span>Phi_Syntax.dest_CurrentConstruction</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.concl_of</span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
       </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ins</span></span><span class="main"><span>,</span></span><span class="entity"><span>current_nu</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>4</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Phi_Syntax.dest_CurrentConstruction_c</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.cprop_of</span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                 </span><span>|&gt;</span><span> </span><span>Thm.term_of</span><span>
                 </span><span>|&gt;</span><span> </span><span class="entity"><span>Procedure_Syntax.package_values</span></span><span> </span><span class="inner_quoted"><span>"ùóãùñæùóç"</span></span><span>
                              </span><span class="main"><span>(</span></span><span>TVar</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"ret"</span></span><span class="main"><span>,</span></span><span> </span><span>Thm.maxidx_of</span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">sort</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‚Äπ</span><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.VALs|class"><span>VALs</span></a><span>‚Ä∫</span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>true</span><span> </span><span>NONE</span><span>
                 </span><span>|&gt;</span><span> </span><span>apply2</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
       </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>idx_delt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>+</span><span> </span><span>Int.max</span><span> </span><span class="main"><span>(</span></span><span>Thm.maxidx_of_cterm</span><span> </span><span class="entity"><span>ins</span></span><span class="main"><span>,</span></span><span> </span><span>Thm.maxidx_of_cterm</span><span> </span><span class="entity"><span>current_nu</span></span><span class="main"><span>)</span></span><span>
       </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>return_rule</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../Calculus_of_Programming.html#Calculus_of_Programming.\&lt;phi&gt;return|fact"><span>œÜreturn</span></a><span class="antiquote"><span>}</span></span></span></span><span>
                       </span><span>|&gt;</span><span> </span><span>Thm.incr_indexes</span><span> </span><span class="entity"><span>idx_delt</span></span><span>
                       </span><span>|&gt;</span><span> </span><span>Drule.infer_instantiate</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                              </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"T"</span></span><span class="main"><span>,</span></span><span class="entity"><span>idx_delt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>current_nu</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"ret"</span></span><span class="main"><span>,</span></span><span class="entity"><span>idx_delt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>ins</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sequent</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>return_rule</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>rule_by_tactic</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                  </span><span class="main"><span>(</span></span><span>SOLVED'</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Simplifier.simp_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>sequent</span></span><span>
   </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>desired_nu</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>4</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Phi_Syntax.dest_PendingConstruction_c</span></span><span> </span><span class="entity"><span>goal</span></span><span class="main"><span>)</span></span><span>
   </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>desired_arg_T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.typ_of_cterm</span><span> </span><span class="entity"><span>desired_nu</span></span><span> </span><span>|&gt;</span><span> </span><span>Term.domain_type</span><span>
                          </span><span>|&gt;</span><span> </span><span class="entity"><span>Phi_Syntax.dest_sem_value_T</span></span><span>
   </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>current_phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>4</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Phi_Syntax.dest_PendingConstruction_c</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.cprop_of</span><span> </span><span class="entity"><span>sequent'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
   </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>current_arg_T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.typ_of_cterm</span><span> </span><span class="entity"><span>current_phi</span></span><span> </span><span>|&gt;</span><span> </span><span>Term.domain_type</span><span>
                          </span><span>|&gt;</span><span> </span><span class="entity"><span>Phi_Syntax.dest_sem_value_T</span></span><span>
   </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sequent''</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>can</span><span> </span><span class="main"><span>(</span></span><span>Pattern.unify_types</span><span> </span><span class="main"><span>(</span></span><span>Context.Proof</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
                                                </span><span class="main"><span>(</span></span><span class="entity"><span>current_arg_T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>desired_arg_T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>Envir.init</span><span>
                    </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>sequent'</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>can</span><span> </span><span class="main"><span>(</span></span><span>Pattern.unify_types</span><span> </span><span class="main"><span>(</span></span><span>Context.Proof</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
                              </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_prodT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>current_arg_T</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>typ</span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../../../../../../../HOL/HOL/Product_Type.html#Product_Type.unit|type"><span>unit</span></a></span><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>desired_arg_T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                              </span><span>Envir.init</span><span>
                    </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>sequent'</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../../Calculus_of_Programming.html#Calculus_of_Programming.\&lt;phi&gt;return_additional_unit|fact"><span>œÜreturn_additional_unit</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Current block expects returning "</span></span><span>^</span><span>
                            </span><span>Syntax.string_of_typ</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>desired_arg_T</span></span><span>^</span><span>
                            </span><span class="inner_quoted"><span>" but it actually returns "</span></span><span>^</span><span>
                            </span><span>Syntax.string_of_typ</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>current_arg_T</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span class="entity"><span>sequent''</span></span><span class="main"><span>)</span></span><span>
  </span><span>|&gt;</span><span> </span><span class="entity"><span>vcg_by_cast</span></span><span> </span><span class="entity"><span>desired_nu</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>procedure</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>working_mode</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>
    </span><span>name</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‚Äπ</span><a class="entity_ref" href="../../../../../../IDE_CP_Core.html#IDE_CP_Core.working_mode_procedure|const"><span>working_mode_procedure</span></a><span>‚Ä∫</span></span><span class="main"><span>,</span></span><span>
    </span><span>is_on_going_construction</span><span> </span><span class="main"><span>=</span></span><span> </span><span>can</span><span> </span><span class="entity"><span>Phi_Syntax.dest_CurrentConstruction</span></span><span class="main"><span>,</span></span><span>
    </span><span>spec_of</span><span>   </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>4</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Phi_Syntax.dest_CurrentConstruction</span></span><span class="main"><span>,</span></span><span>
    </span><span>spec_of_c</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>4</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Phi_Syntax.dest_CurrentConstruction_c</span></span><span class="main"><span>,</span></span><span>
</span><span class="comment1"><span>(*    target_spec = SOME o target_spec,
    target_spec_c = SOME oo target_spec_c,
    exception_spec = exception_spec,
    exception_spec_c = exception_spec_c, *)</span></span><span>
    </span><span>inhabited_rule</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../Calculus_of_Programming.html#Calculus_of_Programming.CurrentConstruction_Inhabited_rule|fact"><span>CurrentConstruction_Inhabited_rule</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
    </span><span>initialize_sequent</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>default_initialize_sequent</span></span><span class="main"><span>,</span></span><span>
    </span><span>transformation_rule</span><span>  </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../Calculus_of_Programming.html#Calculus_of_Programming.\&lt;phi&gt;apply_implication|fact"><span>œÜapply_implication</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
    </span><span>view_shift_rule</span><span> </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../Calculus_of_Programming.html#Calculus_of_Programming.\&lt;phi&gt;apply_view_shift|fact"><span>œÜapply_view_shift</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
    </span><span>cast</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>cast</span></span><span class="main"><span>,</span></span><span>
    </span><span>cast_exception</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>cast_exception</span></span><span class="main"><span>,</span></span><span>
    </span><span>vcg_before_assembling</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>vcg_before_assembling</span></span><span class="main"><span>,</span></span><span>
    </span><span>introduce_existence</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>introduce_existence_cc</span></span><span> </span><span>I</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../Calculus_of_Programming.html#Calculus_of_Programming.introduce_Ex|fact"><span>introduce_Ex</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
    </span><span>introduce_existence_in_assembling</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>introduce_existence_cc</span></span><span> </span><span>I</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../Calculus_of_Programming.html#Calculus_of_Programming.introduce_Ex|fact"><span>introduce_Ex</span></a><span class="antiquote"><span>}</span></span></span></span><span>
</span><span class="main"><span>}</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>


</span><span class="comment1"><span>(** View Shift **)</span></span><span>


</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>view_shift</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>working_mode</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
</span><span class="comment1"><span>(* MAY NOT REMOVE
  fun finish_view_shift hyp (_,sequent) =
    let open Phi_Syntax
      val (_,s',H',_) = dest_CurrentConstruction_c hyp
    in
      sequent
        |&gt; Thm.implies_intr hyp
        |&gt; Thm.forall_intr H'
        |&gt; Thm.forall_intr s'
        |&gt; (fn th =&gt; th COMP @{thm œÜmake_view_shift})
    end

  fun start_view_shift arg ctxt =
    let open Phi_Syntax
      val ([blk_name, RR],ctxt) = Variable.add_fixes ["ùîô", "‚Ñú"] ctxt
      val stat_var = Free (blk_name, <span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span>‚Äπresource‚Ä∫)
      val ctxt = Variable.declare_constraints stat_var ctxt
      val init = Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‚ÄπCurrentConstruction‚Ä∫,
                        <span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span>‚Äπmode‚Ä∫
                    --&gt; fastype_of stat_var
                    --&gt; dummyT
                    --&gt; Thm.typ_of_cterm arg
                    --&gt; <span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span>‚Äπbool‚Ä∫)
                 $ <span class="hidden">\&lt;^</span><span class="control">const</span><span class="hidden">&gt;</span>‚Äπview_shift_mode‚Ä∫
                 $ stat_var
                 $ Free (RR, dummyT)
      val init = Thm.cterm_of ctxt (Syntax.check_term ctxt init)
      val init = Thm.apply @{cterm Trueprop} (Thm.apply init arg)
      val ([init],ctxt) = Assumption.add_assms
            (fn _ =&gt; fn [hyp] =&gt; (finish_view_shift hyp o pair ctxt, I)) [init] ctxt
    in
      (ctxt,init)
    end *)</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
</span><span class="main"><span>{</span></span><span>
    </span><span>name</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‚Äπ</span><a class="entity_ref" href="../../../../../../IDE_CP_Core.html#IDE_CP_Core.working_mode_view_shift|const"><span>working_mode_view_shift</span></a><span>‚Ä∫</span></span><span class="main"><span>,</span></span><span>
    </span><span>is_on_going_construction</span><span> </span><span class="main"><span>=</span></span><span> </span><span>can</span><span> </span><span class="entity"><span>Phi_Syntax.dest_CurrentConstruction</span></span><span class="main"><span>,</span></span><span>
    </span><span>spec_of</span><span>   </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>4</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Phi_Syntax.dest_CurrentConstruction</span></span><span class="main"><span>,</span></span><span>
    </span><span>spec_of_c</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>4</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Phi_Syntax.dest_CurrentConstruction_c</span></span><span class="main"><span>,</span></span><span>
</span><span class="comment1"><span>(*    target_spec = SOME o target_spec,
    target_spec_c = SOME oo target_spec_c,
    exception_spec = K NONE,
    exception_spec_c = K (K NONE), *)</span></span><span>
    </span><span>inhabited_rule</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../Calculus_of_Programming.html#Calculus_of_Programming.CurrentConstruction_Inhabited_rule|fact"><span>CurrentConstruction_Inhabited_rule</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
    </span><span>initialize_sequent</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>default_initialize_sequent</span></span><span class="main"><span>,</span></span><span>
    </span><span>transformation_rule</span><span>  </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../Calculus_of_Programming.html#Calculus_of_Programming.\&lt;phi&gt;apply_implication|fact"><span>œÜapply_implication</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
    </span><span>view_shift_rule</span><span> </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../Calculus_of_Programming.html#Calculus_of_Programming.\&lt;phi&gt;apply_view_shift|fact"><span>œÜapply_view_shift</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
    </span><span>cast</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>desired</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
       </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>idx</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>+</span><span> </span><span>Thm.maxidx_of_cterm</span><span> </span><span class="entity"><span>desired</span></span><span>
       </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rule</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../../Calculus_of_Programming.html#Calculus_of_Programming._\&lt;phi&gt;cast_internal_rule_|fact"><span>_œÜcast_internal_rule_</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span>
          </span><span>|&gt;</span><span> </span><span>Thm.incr_indexes</span><span> </span><span class="entity"><span>idx</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Drule.infer_instantiate</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"T'"</span></span><span class="main"><span>,</span></span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>desired</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
       </span><span> </span><span class="entity"><span>generic_cast</span></span><span> </span><span class="entity"><span>rule</span></span><span> </span><span class="inner_quoted"><span>"sequent"</span></span><span> </span><span class="entity"><span>desired</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
    </span><span>cast_exception</span><span> </span><span class="main"><span>=</span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cannot_cast_exception</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
    </span><span>vcg_before_assembling</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="entity"><span>vcg_by_cast</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span class="inner_numeral"><span>4</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Phi_Syntax.dest_CurrentConstruction_c</span></span><span> </span><span class="entity"><span>goal</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
    </span><span>introduce_existence</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>introduce_existence_cc</span></span><span> </span><span>I</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../Calculus_of_Programming.html#Calculus_of_Programming.introduce_Ex|fact"><span>introduce_Ex</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
    </span><span>introduce_existence_in_assembling</span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>introduce_existence_cc</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‚Äπ</span><a class="entity_ref" href="../../../../../../Phi_BI.html#Phi_BI.Subjection|const"><span>Subjection</span></a><span>‚Ä∫</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>X</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>X</span></span><span>
                               </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"bad form of the finalizing sequent"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                             </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../Calculus_of_Programming.html#Calculus_of_Programming.introduce_Ex_subj|fact"><span>introduce_Ex_subj</span></a><span class="antiquote"><span>}</span></span></span></span><span>
</span><span class="main"><span>}</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="comment1"><span>(** Implication **)</span></span><span>


</span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>
</span><span class="comment1"><span>(* MAY NOT REMOVE
  fun finish_implication hyp (_,sequent) =
    let val (s,_) = Phi_Syntax.dest_ToA_Construction_c hyp
    in sequent
        |&gt; Thm.implies_intr hyp
        |&gt; Thm.forall_intr s
        |&gt; (fn th =&gt; th COMP @{thm œÜmake_implication})
    end

  fun start_implication arg ctxt =
    let open Phi_Syntax
      val ([blk_name],ctxt) = Variable.add_fixes ["‚Ñ≠"] ctxt
      val Type (<span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span>‚Äπset‚Ä∫, [T]) = Thm.typ_of_cterm arg
      val stat_var = Free (blk_name, T)
      val ctxt = Variable.declare_constraints stat_var ctxt
      val init = Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‚ÄπToA_Construction‚Ä∫, dummyT) $ stat_var
      val init = Thm.cterm_of ctxt (Syntax.check_term ctxt init)
      val init = Thm.apply @{cterm Trueprop} (Thm.apply init arg)
      val ([init],ctxt) = Assumption.add_assms
            (fn _ =&gt; fn [hyp] =&gt; (finish_implication hyp o pair ctxt, I)) [init] ctxt
    in
      (ctxt,init)
    end *)</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>implication</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>working_mode</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
    </span><span>name</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‚Äπ</span><a class="entity_ref" href="../../../../../../IDE_CP_Core.html#IDE_CP_Core.working_mode_implication|const"><span>working_mode_implication</span></a><span>‚Ä∫</span></span><span class="main"><span>,</span></span><span>
    </span><span>is_on_going_construction</span><span> </span><span class="main"><span>=</span></span><span> </span><span>can</span><span> </span><span class="entity"><span>Phi_Syntax.dest_ToA_Construction</span></span><span class="main"><span>,</span></span><span>
    </span><span>spec_of</span><span>   </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Phi_Syntax.dest_ToA_Construction</span></span><span class="main"><span>,</span></span><span>
    </span><span>spec_of_c</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Phi_Syntax.dest_ToA_Construction_c</span></span><span class="main"><span>,</span></span><span>
    </span><span>inhabited_rule</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../Calculus_of_Programming.html#Calculus_of_Programming.ToA_Construction_Inhabited_rule|fact"><span>ToA_Construction_Inhabited_rule</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
    </span><span>initialize_sequent</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>default_initialize_sequent</span></span><span class="main"><span>,</span></span><span>
    </span><span>transformation_rule</span><span>  </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../Calculus_of_Programming.html#Calculus_of_Programming.\&lt;phi&gt;apply_implication_impl|fact"><span>œÜapply_implication_impl</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
    </span><span>view_shift_rule</span><span> </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span>
    </span><span>cast</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>desired</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
       </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>idx</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>+</span><span> </span><span>Thm.maxidx_of_cterm</span><span> </span><span class="entity"><span>desired</span></span><span>
       </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rule</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../../Calculus_of_Programming.html#Calculus_of_Programming._\&lt;phi&gt;cast_implication_|fact"><span>_œÜcast_implication_</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span>
          </span><span>|&gt;</span><span> </span><span>Thm.incr_indexes</span><span> </span><span class="entity"><span>idx</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Drule.infer_instantiate</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"T"</span></span><span class="main"><span>,</span></span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>desired</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
       </span><span> </span><span class="entity"><span>generic_cast</span></span><span> </span><span class="entity"><span>rule</span></span><span> </span><span class="inner_quoted"><span>"sequent"</span></span><span> </span><span class="entity"><span>desired</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
    </span><span>cast_exception</span><span> </span><span class="main"><span>=</span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cannot_cast_exception</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
    </span><span>vcg_before_assembling</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="entity"><span>vcg_by_cast</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Phi_Syntax.dest_ToA_Construction_c</span></span><span> </span><span class="entity"><span>goal</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
    </span><span>introduce_existence</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>introduce_ex_ToA</span></span><span> </span><span>I</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../Calculus_of_Programming.html#Calculus_of_Programming.introduce_Ex_ToA|fact"><span>introduce_Ex_ToA</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
    </span><span>introduce_existence_in_assembling</span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>introduce_ex_ToA</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‚Äπ</span><a class="entity_ref" href="../../../../../../Phi_BI.html#Phi_BI.Subjection|const"><span>Subjection</span></a><span>‚Ä∫</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>X</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>X</span></span><span>
                           </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"bad form of the finalizing sequent"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                         </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../Calculus_of_Programming.html#Calculus_of_Programming.introduce_Ex_ToA_subj|fact"><span>introduce_Ex_ToA_subj</span></a><span class="antiquote"><span>}</span></span></span></span><span>
</span><span class="main"><span>}</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Theory.setup</span><span> </span><span class="main"><span>(</span></span><span>Context.theory_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>register</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>procedure</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>view_shift</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>implication</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>



</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>infer_working_mode_of_sequent</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Phi_Reasoner.info_pretty</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Pretty.chunks</span><span> </span><span class="main"><span>[</span></span><span>
                </span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>"Inferring the working mode for the sequent:"</span></span><span class="main"><span>,</span></span><span>
                </span><span>Thm.pretty_thm</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>sequent</span></span><span>
            </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
     </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sequent'</span></span><span class="main"><span>,</span></span><span class="entity"><span>ctxt'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>Phi_Reasoner.reason</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../IDE_CP_Core.html#IDE_CP_Core.reason_programming|fact"><span>reason_programming</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span>
              </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>X</span></span><span class="main"><span>,</span></span><span class="entity"><span>TH</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TH</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>)</span></span><span>
                   </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="main"><span>(</span></span><span>Pretty.string_of</span><span> </span><span class="main"><span>(</span></span><span>Pretty.chunks</span><span> </span><span class="main"><span>[</span></span><span>
                        </span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>"Don't know how to make by programming:"</span></span><span class="main"><span>,</span></span><span>
                        </span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Phi_Help.leading_antecedent'</span></span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span>
                       </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
     </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.major_prem_of</span><span> </span><span class="entity"><span>sequent'</span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‚Äπ</span><span>Pure.term</span><span>‚Ä∫</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>N</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>
                      </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>get_by_name1</span></span><span> </span><span class="main"><span>(</span></span><span>Context.Proof</span><span> </span><span class="entity"><span>ctxt'</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>N</span></span><span>
                  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>X</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Phi_Reasoner.error</span></span><span> </span><span class="main"><span>(</span></span><span>Pretty.string_of</span><span> </span><span class="main"><span>(</span></span><span>Pretty.chunks</span><span> </span><span class="main"><span>[</span></span><span>
                          </span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>"Bad mode constant:"</span></span><span class="main"><span>,</span></span><span>
                          </span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt'</span></span><span> </span><span class="entity"><span>X</span></span><span>
                      </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
     </span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sequent''</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>Drule.termI</span><span> </span><span>RS</span><span> </span><span class="entity"><span>sequent'</span></span><span class="main"><span>)</span></span><span>
                   </span><span>|&gt;</span><span> </span><span>Raw_Simplifier.norm_hhf_protect</span><span> </span><span class="entity"><span>ctxt'</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mode</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sequent''</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>


</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span></pre>
</body>

</html>