<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory Uniswap_SwapMath</title>
</head>


<body>
<div class="head">
<h1>Theory Uniswap_SwapMath</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command"><span>theory</span></span></span><span> </span><a href="Uniswap_SwapMath.html"><span>Uniswap_SwapMath</span></a><span>
  </span><span class="keyword2"><span class="keyword"><span>imports</span></span></span><span> </span><a href="Uniswap_SqrtPriceMath.html"><span>Uniswap_SqrtPriceMath</span></a><span> </span><a href="Uniswap_Tick_Math.html"><span>Uniswap_Tick_Math</span></a><span> </span><a href="Uniswap_Tick.html"><span>Uniswap_Tick</span></a><span>
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>declare</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><a class="entity_ref" href="../Phi_System/USER_HOME/Current/phi-system/Phi_System/library/system/processor.ML.html#IDE_CP_Core.\&lt;phi&gt;trace_processing|attribute"><span class="operator"><span>φtrace_processing</span></span></a><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Uniswap_SwapMath.reserve_change_in_a_step_def|fact"><span class="entity_def" id="Uniswap_SwapMath.reserve_change_in_a_step_def|thm"><span class="entity_def" id="Uniswap_SwapMath.reserve_change_in_a_step_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Uniswap_SwapMath.reserve_change_in_a_step|const"><span>reserve_change_in_a_step</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span>›</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="free"><span>reserve_change_in_a_step</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>price0</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>price1</span></span></span></span><span>
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>price0</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>price1</span></span></span></span><span> </span><span class="comment1"><span>― ‹</span><span>reserve change in token0</span><span>›</span></span><span class="main"><span>,</span></span><span>
       </span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>price1</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>price0</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="comment1"><span>― ‹</span><span>reserve change in token1</span><span>›</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.reserve_change_in_a_tick_0|fact"><span class="entity_def" id="Uniswap_SwapMath.reserve_change_in_a_tick_0|thm"><span>reserve_change_in_a_tick_0</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change_in_a_step|const"><span>reserve_change_in_a_step</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change_in_a_step_def|fact"><span>reserve_change_in_a_step_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/HOL-Library.Product_Plus.html#Product_Plus.zero_prod_def|fact"><span>zero_prod_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.reserve_change_in_a_tick_sum|fact"><span class="entity_def" id="Uniswap_SwapMath.reserve_change_in_a_tick_sum|thm"><span>reserve_change_in_a_tick_sum</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><span class="free"><span>price0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>price1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>price1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>price2</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change_in_a_step|const"><span>reserve_change_in_a_step</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>price0</span></span><span> </span><span class="free"><span>price1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change_in_a_step|const"><span>reserve_change_in_a_step</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>price1</span></span><span> </span><span class="free"><span>price2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change_in_a_step|const"><span>reserve_change_in_a_step</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>price0</span></span><span> </span><span class="free"><span>price2</span></span><span> </span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change_in_a_step_def|fact"><span>reserve_change_in_a_step_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.ring_class.right_diff_distrib|fact"><span>right_diff_distrib</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.reserve_change_in_a_tick_sum_rev|fact"><span class="entity_def" id="Uniswap_SwapMath.reserve_change_in_a_tick_sum_rev|thm"><span>reserve_change_in_a_tick_sum_rev</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><span class="free"><span>price2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>price1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>price1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>price0</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change_in_a_step|const"><span>reserve_change_in_a_step</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>price0</span></span><span> </span><span class="free"><span>price1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change_in_a_step|const"><span>reserve_change_in_a_step</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>price1</span></span><span> </span><span class="free"><span>price2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change_in_a_step|const"><span>reserve_change_in_a_step</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>price0</span></span><span> </span><span class="free"><span>price2</span></span><span> </span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change_in_a_step_def|fact"><span>reserve_change_in_a_step_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.ring_class.right_diff_distrib|fact"><span>right_diff_distrib</span></a><span class="main"><span>)</span></span><span>



</span><span class="keyword1"><span class="command"><span>consts</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.fee_rate|const"><span>fee_rate</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a></span><span> </span><span class="comment1"><span>― ‹</span><span>We model the fee rate by a constant now</span><span>›</span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="Uniswap_SwapMath.fee_rate_range|fact"><span class="entity_def" id="Uniswap_SwapMath.fee_rate_def|fact"><span class="entity_def" id="Uniswap_SwapMath.fee_rate_range|thm"><span class="entity_def" id="Uniswap_SwapMath.fee_rate_def|thm"><span class="entity_def" id="Uniswap_SwapMath.fee_rate_def|axiom"><span>specification</span></span></span></span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="quoted"><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_rate|const"><span>fee_rate</span></a></span><span class="main"><span>)</span></span><span>
  fee_rate_range</span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_rate|const"><span>fee_rate</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_rate|const"><span>fee_rate</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.dense_order_class.dense|fact"><span>dense</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Uniswap_SwapMath.fee_rate&apos;_def|fact"><span class="entity_def" id="Uniswap_SwapMath.fee_rate&apos;_def|thm"><span class="entity_def" id="Uniswap_SwapMath.fee_rate&apos;_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="free"><span class="entity_def" id="Uniswap_SwapMath.fee_rate&apos;|const"><span>fee_rate'</span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_rate|const"><span>fee_rate</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_rate|const"><span>fee_rate</span></a><span class="main"><span>)</span></span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.fee_rate&apos;_GT_0|fact"><span class="entity_def" id="Uniswap_SwapMath.fee_rate&apos;_GT_0|thm"><span>fee_rate'_GT_0</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_rate&apos;|const"><span>fee_rate'</span></a><span>›</span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_rate&apos;_def|fact"><span>fee_rate'_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Uniswap_SwapMath.fee_growth_in_a_tick_def|fact"><span class="entity_def" id="Uniswap_SwapMath.fee_growth_in_a_tick_def|thm"><span class="entity_def" id="Uniswap_SwapMath.fee_growth_in_a_tick_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Uniswap_SwapMath.fee_growth_in_a_tick|const"><span>fee_growth_in_a_tick</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="Uniswap_Common.html#Uniswap_Common.liquiditys|type"><span>liquiditys</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span class="main"><span>)</span></span><span>›</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="free"><span>fee_growth_in_a_tick</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>zeroForOne</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>factor</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>price0</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>price1</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span>
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span class="main"><span>:=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span>
            </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>zeroForOne</span></span></span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span class="free"><span class="bound"><span class="entity"><span>price0</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span class="free"><span class="bound"><span class="entity"><span>price1</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>factor</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>price1</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>price0</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>factor</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
  </span><span class="comment1"><span>― ‹</span><span>fee growth in token0, fee growth in token1</span><span>›</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.fee_growth_in_a_tick_0|fact"><span class="entity_def" id="Uniswap_SwapMath.fee_growth_in_a_tick_0|thm"><span>fee_growth_in_a_tick_0</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_in_a_tick|const"><span>fee_growth_in_a_tick</span></a><span> </span><span class="free"><span>zeroForOne</span></span><span> </span><span class="free"><span>factor</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_in_a_tick_def|fact"><span>fee_growth_in_a_tick_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/HOL-Library.Product_Plus.html#Product_Plus.zero_prod_def|fact"><span>zero_prod_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.fun_eq_iff|fact"><span>fun_eq_iff</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.fee_growth_in_a_tick_add|fact"><span class="entity_def" id="Uniswap_SwapMath.fee_growth_in_a_tick_add|thm"><span>fee_growth_in_a_tick_add</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><span class="free"><span>price0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>price1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>price1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>price2</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_in_a_tick|const"><span>fee_growth_in_a_tick</span></a><span> </span><span class="free"><span>zeroForOne</span></span><span> </span><span class="free"><span>factor</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="free"><span>price0</span></span><span> </span><span class="free"><span>price1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_in_a_tick|const"><span>fee_growth_in_a_tick</span></a><span> </span><span class="free"><span>zeroForOne</span></span><span> </span><span class="free"><span>factor</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="free"><span>price1</span></span><span> </span><span class="free"><span>price2</span></span><span>
        </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_in_a_tick|const"><span>fee_growth_in_a_tick</span></a><span> </span><span class="free"><span>zeroForOne</span></span><span> </span><span class="free"><span>factor</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="free"><span>price0</span></span><span> </span><span class="free"><span>price2</span></span><span> </span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_in_a_tick_def|fact"><span>fee_growth_in_a_tick_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.ring_class.right_diff_distrib|fact"><span>right_diff_distrib</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.fun_eq_iff|fact"><span>fun_eq_iff</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/Phi_Algebras.Algebras.html#Algebras.plus_fun_def|fact"><span>plus_fun_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.division_ring_class.diff_divide_distrib|fact"><span>diff_divide_distrib</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.ring_class.left_diff_distrib|fact"><span>left_diff_distrib</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/HOL-Library.Product_Plus.html#Product_Plus.zero_prod_def|fact"><span>zero_prod_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.gSum_fee_growth_in_a_tick|fact"><span class="entity_def" id="Uniswap_SwapMath.gSum_fee_growth_in_a_tick|thm"><span>gSum_fee_growth_in_a_tick</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.MIN_PRICE|const"><span>MIN_PRICE</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>pr0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>pr0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>pr1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>pr1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.MAX_PRICE|const"><span>MAX_PRICE</span></a><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_Tick.html#Uniswap_Tick.gSum|const"><span>gSum</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_in_a_tick|const"><span>fee_growth_in_a_tick</span></a><span> </span><span class="free"><span>zeroForOne</span></span><span> </span><span class="free"><span>factor</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="free"><span>pr0</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>pr0</span></span><span> </span><span class="free"><span>pr1</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="free"><span>pr0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>)</span></span><span>
           </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="free"><span>zeroForOne</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="main"><span>(</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span class="free"><span>pr0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span class="free"><span>pr1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="free"><span>factor</span></span><span> </span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>pr1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span>pr0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="free"><span>factor</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_in_a_tick_def|fact"><span>fee_growth_in_a_tick_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/Phi_Algebras.Algebras.html#Algebras.zero_fun_def|fact"><span>zero_fun_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/HOL-Library.Product_Plus.html#Product_Plus.zero_prod_def|fact"><span>zero_prod_def</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.force|method"><span class="operator"><span>force</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of_L0|fact"><span>price_of_L0</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of_smono|fact"><span>price_of_smono</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of_tick|fact"><span>price_of_tick</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.linorder_linear|fact"><span>linorder_linear</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.linorder_not_le|fact"><span>linorder_not_le</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of_L0|fact"><span>price_of_L0</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|fact"><span>tick_of_price</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price_LE_mono|fact"><span>tick_of_price_LE_mono</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Int.html#Int.zle_diff1_eq|fact"><span>zle_diff1_eq</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.dual_order.strict_iff_not|fact"><span>dual_order.strict_iff_not</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.linorder_le_cases|fact"><span>linorder_le_cases</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of_L0|fact"><span>price_of_L0</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|fact"><span>tick_of_price</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price_LE_mono|fact"><span>tick_of_price_LE_mono</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Int.html#Int.zle_diff1_eq|fact"><span>zle_diff1_eq</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/HOL-Library.Product_Plus.html#Product_Plus.zero_prod_def|fact"><span>zero_prod_def</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.force|method"><span class="operator"><span>force</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> best</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.less_MAX_PRICE_less_MAX_TICK|fact"><span>less_MAX_PRICE_less_MAX_TICK</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of_L0|fact"><span>price_of_L0</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/HOL-Library.Product_Plus.html#Product_Plus.zero_prod_def|fact"><span>zero_prod_def</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.force|method"><span class="operator"><span>force</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> ccfv_SIG</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.less_MAX_PRICE_less_MAX_TICK|fact"><span>less_MAX_PRICE_less_MAX_TICK</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of_L0|fact"><span>price_of_L0</span></a><span class="main"><span>)</span></span><span>


</span><span class="keyword1"><span class="command"><span class="entity_def" id="Uniswap_SwapMath.Const_Interval_def|fact"><span class="entity_def" id="Uniswap_SwapMath.Const_Interval_def|thm"><span class="entity_def" id="Uniswap_SwapMath.Const_Interval_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Uniswap_SwapMath.Const_Interval|const"><span>Const_Interval</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span>›</span></span></span><span> </span><span class="comment1"><span>― ‹</span><span>left close, right open</span><span>›</span></span><span>
      </span><span class="comment1"><span>― ‹</span><span>An interval where the liquidity is constant</span><span>›</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="free"><span>Const_Interval</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>l</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>u</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>l</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>u</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>k</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>l</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>u</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>l</span></span></span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.Const_Interval_LE|fact"><span class="entity_def" id="Uniswap_SwapMath.Const_Interval_LE|thm"><span>Const_Interval_LE</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval|const"><span>Const_Interval</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>u</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_def|fact"><span>Const_Interval_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.Const_Interval_eq_lower|fact"><span class="entity_def" id="Uniswap_SwapMath.Const_Interval_eq_lower|thm"><span>Const_Interval_eq_lower</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval|const"><span>Const_Interval</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_def|fact"><span>Const_Interval_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.Const_Interval_triangle|fact"><span class="entity_def" id="Uniswap_SwapMath.Const_Interval_triangle|thm"><span>Const_Interval_triangle</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval|const"><span>Const_Interval</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval|const"><span>Const_Interval</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval|const"><span>Const_Interval</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="free"><span>u</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> del_insts</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_def|fact"><span>Const_Interval_def</span></a><span class="main"><span>)</span></span><span>


</span><span class="keyword1"><span class="command"><span class="entity_def" id="Uniswap_SwapMath.Is_partition.simps|fact"><span class="entity_def" id="Uniswap_SwapMath.Is_partition_def|fact"><span class="entity_def" id="Uniswap_SwapMath.Is_partition.simps(2)|thm"><span class="entity_def" id="Uniswap_SwapMath.Is_partition.simps(1)|thm"><span class="entity_def" id="Uniswap_SwapMath.Is_partition_def|thm"><span class="entity_def" id="Uniswap_SwapMath.Is_partition_def|axiom"><span>primrec</span></span></span></span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span>›</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="free"><span>Is_partition</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>l</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>u</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval|const"><span>Const_Interval</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>l</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>u</span></span></span></span><span>›</span></span></span><span> </span><span class="main"><span>|</span></span><span>
        </span><span class="quoted"><span class="quoted"><span>‹</span><span class="free"><span>Is_partition</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>l</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>u</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span class="free"><span class="bound"><span class="entity"><span>r</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval|const"><span>Const_Interval</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>l</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>Is_partition</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>u</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>r</span></span></span></span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Uniswap_SwapMath.KeyPoint_def|fact"><span class="entity_def" id="Uniswap_SwapMath.KeyPoint_def|thm"><span class="entity_def" id="Uniswap_SwapMath.KeyPoint_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Uniswap_SwapMath.KeyPoint|const"><span>KeyPoint</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="free"><span>KeyPoint</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>l</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>k</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval|const"><span>Const_Interval</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>l</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>k</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>l</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>k</span></span></span></span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Uniswap_SwapMath.Is_key_partition.simps|fact"><span class="entity_def" id="Uniswap_SwapMath.Is_key_partition_def|fact"><span class="entity_def" id="Uniswap_SwapMath.Is_key_partition.simps(2)|thm"><span class="entity_def" id="Uniswap_SwapMath.Is_key_partition.simps(1)|thm"><span class="entity_def" id="Uniswap_SwapMath.Is_key_partition_def|thm"><span class="entity_def" id="Uniswap_SwapMath.Is_key_partition_def|axiom"><span>primrec</span></span></span></span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Uniswap_SwapMath.Is_key_partition|const"><span>Is_key_partition</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span>›</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="free"><span>Is_key_partition</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>l</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>u</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval|const"><span>Const_Interval</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>l</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>u</span></span></span></span><span>›</span></span></span><span> </span><span class="main"><span>|</span></span><span>
        </span><span class="quoted"><span class="quoted"><span>‹</span><span class="free"><span>Is_key_partition</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>l</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>u</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span class="free"><span class="bound"><span class="entity"><span>r</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval|const"><span>Const_Interval</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>l</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint|const"><span>KeyPoint</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>l</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>u</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>Is_key_partition</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>u</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>r</span></span></span></span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.KeyPoint_exist|fact"><span class="entity_def" id="Uniswap_SwapMath.KeyPoint_exist|thm"><span>KeyPoint_exist</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="free"><span>ps</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval|const"><span>Const_Interval</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>Ex</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint|const"><span>KeyPoint</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="free"><span>ps</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> del_insts</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_def|fact"><span>Const_Interval_def</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint_def|fact"><span>KeyPoint_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.xx1|fact"><span class="entity_def" id="Uniswap_SwapMath.xx1|thm"><span>xx1</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>u'</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval|const"><span>Const_Interval</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval|const"><span>Const_Interval</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u'</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Meson/meson_tactic.ML.html#Meson.meson|method"><span class="operator"><span>meson</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_def|fact"><span>Const_Interval_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.dual_order.strict_trans1|fact"><span>dual_order.strict_trans1</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.KeyPoint_uniq|fact"><span class="entity_def" id="Uniswap_SwapMath.KeyPoint_uniq|thm"><span>KeyPoint_uniq</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint|const"><span>KeyPoint</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>k1</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint|const"><span>KeyPoint</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>k2</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>k1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>k2</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint_def|fact"><span>KeyPoint_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_eq_lower|fact"><span>Const_Interval_eq_lower</span></a><span class="main"><span>)</span></span><span> 

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.KeyPoint_uniq&apos;|fact"><span class="entity_def" id="Uniswap_SwapMath.KeyPoint_uniq&apos;|thm"><span>KeyPoint_uniq'</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval|const"><span>Const_Interval</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l1</span></span><span> </span><span class="free"><span>l2</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint|const"><span>KeyPoint</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l1</span></span><span> </span><span class="free"><span>k1</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint|const"><span>KeyPoint</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l2</span></span><span> </span><span class="free"><span>k2</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>k1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>k2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.disj|const"><span>∨</span></a></span><span> </span><span class="free"><span>k1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>l2</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> ccfv_threshold</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_eq_lower|fact"><span>Const_Interval_eq_lower</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint_def|fact"><span>KeyPoint_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.KeyPoint_max|fact"><span class="entity_def" id="Uniswap_SwapMath.KeyPoint_max|thm"><span>KeyPoint_max</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval|const"><span>Const_Interval</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint|const"><span>KeyPoint</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>k</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> ccfv_threshold</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_eq_lower|fact"><span>Const_Interval_eq_lower</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint_def|fact"><span>KeyPoint_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.Const_Interval_key_point|fact"><span class="entity_def" id="Uniswap_SwapMath.Const_Interval_key_point|thm"><span>Const_Interval_key_point</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval|const"><span>Const_Interval</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint|const"><span>KeyPoint</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval|const"><span>Const_Interval</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="free"><span>k</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> best</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_def|fact"><span>Const_Interval_def</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint_def|fact"><span>KeyPoint_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.KeyPoint_in_partition|fact"><span class="entity_def" id="Uniswap_SwapMath.KeyPoint_in_partition|thm"><span>KeyPoint_in_partition</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval|const"><span>Const_Interval</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="free"><span>ps</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint|const"><span>KeyPoint</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>k</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.member|const"><span>List.member</span></a><span> </span><span class="free"><span>ps</span></span><span> </span><span class="free"><span>k</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="free"><span>ps</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint_def|fact"><span>KeyPoint_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> best</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_def|fact"><span>Const_Interval_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.member_rec|fact"><span>member_rec</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>



</span><span class="comment1"><span>(</span><span>*</span><span> lemma Is_partition_last[simp]:
  ‹ Is_partition f l ps2
⟹ Is_partition f l (ps2 @ [u]) ⟷ Const_Interval f (last ps2) u›
  by (induct ps2 arbitrary: l; simp) </span><span>*</span><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.Is_partition_imp_LE|fact"><span class="entity_def" id="Uniswap_SwapMath.Is_partition_imp_LE|thm"><span>Is_partition_imp_LE</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>low</span></span><span> </span><span class="free"><span>up</span></span><span> </span><span class="free"><span>ps</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>low</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>up</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="free"><span>ps</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>low</span></span></span><span> </span><span class="quoted"><span class="free"><span>up</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.order_trans|fact"><span>order_trans</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.Is_partition_cat|fact"><span class="entity_def" id="Uniswap_SwapMath.Is_partition_cat|thm"><span>Is_partition_cat</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="free"><span>ps1</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="free"><span>ps2</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>ps1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span> </span><span class="main"><span>[</span></span><span class="free"><span>m</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span> </span><span class="free"><span>ps2</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="free"><span>ps1</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>ps2</span></span></span><span> </span><span class="quoted"><span class="free"><span>m</span></span></span><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.Is_partition_ordered_chain|fact"><span class="entity_def" id="Uniswap_SwapMath.Is_partition_ordered_chain|thm"><span>Is_partition_ordered_chain</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="free"><span>ps</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>∀</span></span><span class="bound"><span class="bound"><span>i</span></span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>ps</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>ps</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="free"><span>ps</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_def|fact"><span>Const_Interval_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.less_Suc_eq_0_disj|fact"><span>less_Suc_eq_0_disj</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.fastforce|method"><span class="operator"><span>fastforce</span></span></a><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.Is_partition_le_last|fact"><span class="entity_def" id="Uniswap_SwapMath.Is_partition_le_last|thm"><span>Is_partition_le_last</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="free"><span>ps</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>u</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="free"><span>ps</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_def|fact"><span>Const_Interval_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.order_trans|fact"><span>order_trans</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>


</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.Is_partition_split|fact"><span class="entity_def" id="Uniswap_SwapMath.Is_partition_split|thm"><span>Is_partition_split</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="free"><span>ps</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.member|const"><span>List.member</span></a><span> </span><span class="free"><span>ps</span></span><span> </span><span class="free"><span>k</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>∃</span></a></span><span class="bound"><span>ps1</span></span><span> </span><span class="bound"><span>ps2</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>.</span></a></span><span> </span><span class="free"><span>ps</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="bound"><span>ps1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span> </span><span class="main"><span>[</span></span><span class="free"><span>k</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span> </span><span class="bound"><span>ps2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="bound"><span>ps1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="bound"><span>ps2</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="free"><span>ps</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.member_rec|fact"><span>member_rec</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.force|method"><span class="operator"><span>force</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> best</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition.simps|fact"><span>Is_partition.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition.simps|fact"><span>Is_partition.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.append_eq_Cons_conv|fact"><span>append_eq_Cons_conv</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.member_rec|fact"><span>member_rec</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.Is_partition_exists_up|fact"><span class="entity_def" id="Uniswap_SwapMath.Is_partition_exists_up|thm"><span>Is_partition_exists_up</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>Ex</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>m</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval|const"><span>Const_Interval</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="free"><span>u</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>Ex</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition.simps|fact"><span>Is_partition.simps</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_cat|fact"><span>Is_partition_cat</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.Is_partition_exists|fact"><span class="entity_def" id="Uniswap_SwapMath.Is_partition_exists|thm"><span>Is_partition_exists</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>Ex</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="free"><span>u</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval|const"><span>Const_Interval</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>Ex</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition.simps|fact"><span>Is_partition.simps</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.Is_key_partition_implies_Is_partition|fact"><span class="entity_def" id="Uniswap_SwapMath.Is_key_partition_implies_Is_partition|thm"><span>Is_key_partition_implies_Is_partition</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition|const"><span>Is_key_partition</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="free"><span>ps</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="free"><span>ps</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="free"><span>ps</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.Key_partition_exists|fact"><span class="entity_def" id="Uniswap_SwapMath.Key_partition_exists|thm"><span>Key_partition_exists</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="free"><span>ps</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>Ex</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition|const"><span>Is_key_partition</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="free"><span>ps</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition.simps|fact"><span>Is_key_partition.simps</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> a ps l</span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint|const"><span>KeyPoint</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="skolem"><span>l</span></span><span> </span><span class="skolem"><span>a</span></span><span>›</span></span></span><span class="main"><span>)</span></span><span>
     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition.simps|fact"><span>Is_key_partition.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition.simps|fact"><span>Is_key_partition.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.less_eq_real_def|fact"><span>less_eq_real_def</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval|const"><span>Const_Interval</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="skolem"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span>›</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition.simps|fact"><span>Is_key_partition.simps</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>premises</span></span></span><span> </span><span class="entity_def" id="offset_7746..7751">prems</span><span>
    </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
      </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_7775..7777">t1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="skolem"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span> </span><span class="skolem"><span>ps</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_7746..7751"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>kl</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_7853..7855">kl</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint|const"><span>KeyPoint</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="skolem"><span>l</span></span><span> </span><span class="skolem"><span>kl</span></span><span>›</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint_exist|fact"><span>KeyPoint_exist</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_7746..7751"><span>prems</span></a><span class="main"><span>(</span></span><span>4</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_7775..7777"><span>t1</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>ps'</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_7944..7947">ps'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition|const"><span>Is_key_partition</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="skolem"><span>ps'</span></span><span>›</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_7746..7751"><span>prems</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_7746..7751"><span>prems</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="skolem"><span>ps'</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>Nil</span><span>
      </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
        </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> del_insts</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition.simps|fact"><span>Is_key_partition.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint_def|fact"><span>KeyPoint_def</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint_max|fact"><span>KeyPoint_max</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_7853..7855"><span>kl</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_7746..7751"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_7746..7751"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_7944..7947"><span>ps'</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_7775..7777"><span>t1</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.xx1|fact"><span>xx1</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
      </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span>Cons</span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="skolem"><span>list</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
        </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_key_point|fact"><span>Const_Interval_key_point</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition.simps|fact"><span>Is_key_partition.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint_def|fact"><span>KeyPoint_def</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint_uniq|fact"><span>KeyPoint_uniq</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_7853..7855"><span>kl</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_7746..7751"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_7746..7751"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_7944..7947"><span>ps'</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.Key_partition_uniq|fact"><span class="entity_def" id="Uniswap_SwapMath.Key_partition_uniq|thm"><span>Key_partition_uniq</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition|const"><span>Is_key_partition</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="free"><span>ps1</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition|const"><span>Is_key_partition</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="free"><span>ps2</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>ps1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>ps2</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="free"><span>ps1</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>ps2</span></span></span><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span> </span><span class="quoted"><span class="free"><span>u</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition.simps|fact"><span>Is_key_partition.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint_max|fact"><span>KeyPoint_max</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.linorder_not_le|fact"><span>linorder_not_le</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.neq_Nil_conv|fact"><span>neq_Nil_conv</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct_tacs.ML.html#HOL.case_tac|method"><span class="operator"><span>case_tac</span></span></a><span> </span><span class="quoted"><span class="improper"><span>ps2</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Meson/meson_tactic.ML.html#Meson.meson|method"><span class="operator"><span>meson</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint_max|fact"><span>KeyPoint_max</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.less_le_not_le|fact"><span>less_le_not_le</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint_uniq|fact"><span>KeyPoint_uniq</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.Key_partition_split|fact"><span class="entity_def" id="Uniswap_SwapMath.Key_partition_split|thm"><span>Key_partition_split</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition|const"><span>Is_key_partition</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="free"><span>ps</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.member|const"><span>List.member</span></a><span> </span><span class="free"><span>ps</span></span><span> </span><span class="free"><span>k</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>∃</span></a></span><span class="bound"><span>ps1</span></span><span> </span><span class="bound"><span>ps2</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>.</span></a></span><span> </span><span class="free"><span>ps</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="bound"><span>ps1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span> </span><span class="main"><span>[</span></span><span class="free"><span>k</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span> </span><span class="bound"><span>ps2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition|const"><span>Is_key_partition</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="bound"><span>ps1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition|const"><span>Is_key_partition</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="bound"><span>ps2</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="free"><span>ps</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.member_rec|fact"><span>member_rec</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.force|method"><span class="operator"><span>force</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.member_rec|fact"><span>member_rec</span></a><span class="main"><span>)</span></span><span>
   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition.simps|fact"><span>Is_key_partition.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.append.left_neutral|fact"><span>append.left_neutral</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>premises</span></span></span><span> </span><span class="entity_def" id="offset_9128..9133">prems</span><span> </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> a ps l</span><span> </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
    </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>ps1</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>ps2</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_9178..9182">ps12</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="skolem"><span>ps</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="skolem"><span>ps1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span> </span><span class="skolem"><span>ps2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition|const"><span>Is_key_partition</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="skolem"><span>ps1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition|const"><span>Is_key_partition</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="skolem"><span>ps2</span></span><span>›</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_9128..9133"><span>prems</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_9128..9133"><span>prems</span></a><span class="main"><span>(</span></span><span>5</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Presburger.html#Presburger.presburger|method"><span class="operator"><span>presburger</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_9316..9318">t1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition|const"><span>Is_key_partition</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="skolem"><span>l</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span> </span><span class="skolem"><span>ps1</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition.simps|fact"><span>Is_key_partition.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint_def|fact"><span>KeyPoint_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.append.append_Nil|fact"><span>append_Nil</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.order_class.dual_order.order_iff_strict|fact"><span>dual_order.order_iff_strict</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.dual_order.strict_trans1|fact"><span>dual_order.strict_trans1</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.inject|fact"><span>list.inject</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.neq_Nil_conv|fact"><span>neq_Nil_conv</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_9128..9133"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_9128..9133"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>5</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_9178..9182"><span>ps12</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.append.append_Cons|fact"><span>append_Cons</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_9178..9182"><span>ps12</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_9316..9318"><span>t1</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>

</span><span class="comment1"><span>(</span><span>*</span><span>
lemma
  ‹ Is_partition f l u ps
⟹ Is_key_partition f l u kps
⟹ length kps ≤ length ps›
  apply (induct kps arbitrary: ps l; simp) </span><span>*</span><span>)</span></span><span>



</span><span class="keyword1"><span class="command"><span class="entity_def" id="Uniswap_SwapMath.partition_integral.simps|fact"><span class="entity_def" id="Uniswap_SwapMath.partition_integral_def|fact"><span class="entity_def" id="Uniswap_SwapMath.partition_integral.simps(2)|thm"><span class="entity_def" id="Uniswap_SwapMath.partition_integral.simps(1)|thm"><span class="entity_def" id="Uniswap_SwapMath.partition_integral_def|thm"><span class="entity_def" id="Uniswap_SwapMath.partition_integral_def|axiom"><span>primrec</span></span></span></span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Uniswap_SwapMath.partition_integral|const"><span>partition_integral</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>(</span></span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.monoid_add|class"><span>monoid_add</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span>›</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="free"><span>partition_integral</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>low</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>up</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>low</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>low</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>up</span></span></span></span><span>›</span></span></span><span> </span><span class="main"><span>|</span></span><span>
        </span><span class="quoted"><span class="quoted"><span>‹</span><span class="free"><span>partition_integral</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>low</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>up</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span class="free"><span class="bound"><span class="entity"><span>l</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>low</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>low</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="free"><span>partition_integral</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>h</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>up</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>l</span></span></span></span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Uniswap_SwapMath.Is_linear_sum_def|fact"><span class="entity_def" id="Uniswap_SwapMath.Is_linear_sum_def|thm"><span class="entity_def" id="Uniswap_SwapMath.Is_linear_sum_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Uniswap_SwapMath.Is_linear_sum|const"><span>Is_linear_sum</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="free"><span>Is_linear_sum</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>⟷</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>C</span></span><span> </span><span class="bound"><span>l</span></span><span> </span><span class="bound"><span>m</span></span><span> </span><span class="bound"><span>u</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="bound"><span>m</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="bound"><span>m</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="bound"><span>u</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span> </span><span class="bound"><span>C</span></span><span> </span><span class="bound"><span>l</span></span><span> </span><span class="bound"><span>m</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span> </span><span class="bound"><span>C</span></span><span> </span><span class="bound"><span>m</span></span><span> </span><span class="bound"><span>u</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span> </span><span class="bound"><span>C</span></span><span> </span><span class="bound"><span>l</span></span><span> </span><span class="bound"><span>u</span></span><span class="main"><span>)</span></span><span>
                              </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span>  </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>C</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>S</span></span></span></span><span> </span><span class="bound"><span>C</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>)</span></span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.partition_intergral_add|fact"><span class="entity_def" id="Uniswap_SwapMath.partition_intergral_add|thm"><span>partition_intergral_add</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="free"><span>A</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="free"><span>B</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_integral|const"><span>partition_integral</span></a><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_integral|const"><span>partition_integral</span></a><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="free"><span>B</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_integral|const"><span>partition_integral</span></a><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span class="main"><span>[</span></span><span class="free"><span>m</span></span><span class="main"><span>]</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span class="free"><span>B</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="free"><span>A</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.semigroup_add_class.add.assoc|fact"><span>add.assoc</span></a><span class="main"><span>)</span></span><span>
  

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.partition_intergral_const|fact"><span class="entity_def" id="Uniswap_SwapMath.partition_intergral_const|thm"><span>partition_intergral_const</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_linear_sum|const"><span>Is_linear_sum</span></a><span> </span><span class="free"><span>S</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval|const"><span>Const_Interval</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="free"><span>A</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_integral|const"><span>partition_integral</span></a><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>L</span></span><span> </span><span class="free"><span>l</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_linear_sum_def|fact"><span>Is_linear_sum_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="free"><span>A</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_def|fact"><span>Const_Interval_def</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span class="main"><span>)</span></span><span>



</span><span class="comment1"><span>(</span><span>*</span><span>
lemma Is_partition_expand:
  ‹Is_partition L l u (a # list) ⟷ 
      list = [] ∧ a = u ∧ Const_Interval L l u ∨ Is_partition L a u list ∧ Const_Interval L l a›
  unfolding Is_partition_def
  by auto

lemma Is_partition_not_nil:
  ‹¬ Is_partition L l u []›
  unfolding Is_partition_def by simp 

term List.member

lemma
  ‹¬ Const_Interval L l u ⟹ ∃k. ∀A B. Is_partition L l u A ∧ Is_partition L l u B ⟶ k≠u ∧ List.member A k ∧ List.member B k ›
  by (metis Is_partition_def in_set_member last_in_set)

lemma
  ‹ Is_partition L l u (A1 @ A2)
⟹ A1 ≠ []
⟹ Is_partition L l (last A1) A1 ∧ Is_partition L (last A1) u A2›
  apply (induct )

lemma
  ‹ Is_partition L l u A
⟹ List.member A m
⟹ (∃A1 A2. A1 @ A2 = A ∧ Is_partition L l m A1 ∧ Is_partition L m u A2)›
  

lemma
  ‹(∀k. ∃A B. Is_partition L l u A ∧ Is_partition L l u B ∧ ¬ (List.member A k ∧ List.member B k))
    ⟹ Const_Interval L l u›
  apply clarsimp
  by (metis Is_partition_def in_set_member last_in_set)
</span><span>*</span><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.Partition_always_exists|fact"><span class="entity_def" id="Uniswap_SwapMath.Partition_always_exists|thm"><span>Partition_always_exists</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>Ex</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>L</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>premises</span></span></span><span> </span><span class="entity_def" id="offset_11801..11806">prems</span><span> </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_11824..11826">x1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="free"><span>u</span></span><span>›</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_11801..11806"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_11801..11806"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price_LE_mono|fact"><span>tick_of_price_LE_mono</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>l'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="bound"><span>l'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="bound"><span>l'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="bound"><span>l'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>∃</span></a></span><span class="bound"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>.</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>∘</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span class="main"><span>)</span></span><span> </span><span class="bound"><span>l'</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quasi_keyword"><span>rule</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Int.html#Int.int_le_induct|fact"><span>int_le_induct</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_11824..11826"><span>x1</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
       </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.clarify|method"><span class="operator"><span>clarify</span></span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> l'</span><span>
         </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.exI|fact"><span>exI</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Phi_System/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> x</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>[</span></span><span class="free"><span>u</span></span><span class="main"><span>]</span></span><span>›</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_def|fact"><span>Is_partition_def</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_def|fact"><span>Const_Interval_def</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> best</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price_LE_mono|fact"><span>tick_of_price_LE_mono</span></a><span class="main"><span>)</span></span><span>
       </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.clarify|method"><span class="operator"><span>clarify</span></span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>premises</span></span></span><span> </span><span class="entity_def" id="offset_12305..12310">prems</span><span> </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> i l'</span><span> </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
        </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>A</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span>A</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>∘</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of|const"><span>price_of</span></a><span> </span><span class="skolem"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="skolem"><span>A</span></span><span>›</span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.order_class.dual_order.order_iff_strict|fact"><span>dual_order.order_iff_strict</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.linorder_class.nle_le|fact"><span>nle_le</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.order_trans|fact"><span>order_trans</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_12305..12310"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_12305..12310"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_12305..12310"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_12305..12310"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>4</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of_L0|fact"><span>price_of_L0</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of_smono|fact"><span>price_of_smono</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of_tick|fact"><span>price_of_tick</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|fact"><span>tick_of_price</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_12578..12579">B</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval|const"><span>Const_Interval</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>∘</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>l'</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of|const"><span>price_of</span></a><span> </span><span class="skolem"><span>i</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_def|fact"><span>Const_Interval_def</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
          </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.group_add_class.diff_add_cancel|fact"><span>diff_add_cancel</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.order_class.dual_order.order_iff_strict|fact"><span>dual_order.order_iff_strict</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.dual_order.strict_iff_not|fact"><span>dual_order.strict_iff_not</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.dual_order.strict_trans2|fact"><span>dual_order.strict_trans2</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.linorder_linear|fact"><span>linorder_linear</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_12305..12310"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_12305..12310"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>5</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of_mono|fact"><span>price_of_mono</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of_tick|fact"><span>price_of_tick</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price_LE_mono|fact"><span>tick_of_price_LE_mono</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Int.html#Int.zle_diff1_eq|fact"><span>zle_diff1_eq</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Meson/meson_tactic.ML.html#Meson.meson|method"><span class="operator"><span>meson</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_12578..12579"><span>B</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition.simps|fact"><span>Is_partition.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>⋀</span></span><span class="bound"><span>thesis</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>⋀</span></span><span class="bound"><span>A</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>∘</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of|const"><span>price_of</span></a><span> </span><span class="skolem"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="bound"><span>thesis</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="bound"><span>thesis</span></span><span>›</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_11801..11806"><span>prems</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_11801..11806"><span>prems</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.Partition_always_exists&apos;|fact"><span class="entity_def" id="Uniswap_SwapMath.Partition_always_exists&apos;|thm"><span>Partition_always_exists'</span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Partition_always_exists|fact"><span>Partition_always_exists</span></a><span class="main"><span>[</span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Phi_System/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> L</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.id|const"><span>id</span></a></span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>simplified</span></span><span class="main"><span>]</span></span><span>


</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.partition_intergral_irrelavent_with_parition|fact"><span class="entity_def" id="Uniswap_SwapMath.partition_intergral_irrelavent_with_parition|thm"><span>partition_intergral_irrelavent_with_parition</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_linear_sum|const"><span>Is_linear_sum</span></a><span> </span><span class="free"><span>S</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="free"><span>A</span></span><span>
</span><span class="main"><span>⟹</span></span><span>  </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_integral|const"><span>partition_integral</span></a><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_integral|const"><span>partition_integral</span></a><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.Eps|const"><span>Eps</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition|const"><span>Is_key_partition</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_linear_sum_def|fact"><span>Is_linear_sum_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="free"><span>A</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition.simps|fact"><span>Is_key_partition.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Key_partition_uniq|fact"><span>Key_partition_uniq</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_integral.simps|fact"><span>partition_integral.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.someI_ex|fact"><span>someI_ex</span></a><span class="main"><span>)</span></span><span>
    
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> a A l</span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval|const"><span>Const_Interval</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="skolem"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span>›</span></span></span><span class="main"><span>)</span></span><span>
       </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> best</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_eq_lower|fact"><span>Const_Interval_eq_lower</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_triangle|fact"><span>Const_Interval_triangle</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition.simps|fact"><span>Is_key_partition.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Key_partition_uniq|fact"><span>Key_partition_uniq</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_integral.simps|fact"><span>partition_integral.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.someI_ex|fact"><span>someI_ex</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.clarify|method"><span class="operator"><span>clarify</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>premises</span></span></span><span> </span><span class="entity_def" id="offset_13882..13887">prems</span><span> </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
        </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_13909..13911">t1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="skolem"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span> </span><span class="skolem"><span>A</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_13882..13887"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>5</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_13882..13887"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>6</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_13998..14000">t2</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition|const"><span>Is_key_partition</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="skolem"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.Eps|const"><span>Eps</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition|const"><span>Is_key_partition</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="skolem"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Key_partition_exists|fact"><span>Key_partition_exists</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_13909..13911"><span>t1</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/SMT.html#SMT.verit_sko_ex&apos;|fact"><span>verit_sko_ex'</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>kl</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_14141..14143">kl</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint|const"><span>KeyPoint</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="skolem"><span>l</span></span><span> </span><span class="skolem"><span>kl</span></span><span>›</span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint_exist|fact"><span>KeyPoint_exist</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_13882..13887"><span>prems</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_13909..13911"><span>t1</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
        </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_14228..14234">t_l_kl</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval|const"><span>Const_Interval</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="skolem"><span>l</span></span><span> </span><span class="skolem"><span>kl</span></span><span>›</span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint_def|fact"><span>KeyPoint_def</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_14141..14143"><span>kl</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
        </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_14314..14316">t3</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="../../HOL/HOL/List.html#List.member|const"><span>List.member</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.Eps|const"><span>Eps</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition|const"><span>Is_key_partition</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="skolem"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>kl</span></span><span>›</span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition_implies_Is_partition|fact"><span>Is_key_partition_implies_Is_partition</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint_in_partition|fact"><span>KeyPoint_in_partition</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_14141..14143"><span>kl</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_13882..13887"><span>prems</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_13998..14000"><span>t2</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
        </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>ps1</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>ps2</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_14495..14499">ps12</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.Eps|const"><span>Eps</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition|const"><span>Is_key_partition</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="skolem"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="skolem"><span>ps1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span> </span><span class="main"><span>[</span></span><span class="skolem"><span>kl</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span> </span><span class="skolem"><span>ps2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition|const"><span>Is_key_partition</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="skolem"><span>l</span></span><span> </span><span class="skolem"><span>kl</span></span><span> </span><span class="skolem"><span>ps1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition|const"><span>Is_key_partition</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="skolem"><span>kl</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="skolem"><span>ps2</span></span><span>›</span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Key_partition_split|fact"><span>Key_partition_split</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_13998..14000"><span>t2</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_14314..14316"><span>t3</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
        </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_14675..14688">ps12_integral</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_integral|const"><span>partition_integral</span></a><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="skolem"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.Eps|const"><span>Eps</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition|const"><span>Is_key_partition</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="skolem"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_integral|const"><span>partition_integral</span></a><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="skolem"><span>l</span></span><span> </span><span class="skolem"><span>kl</span></span><span> </span><span class="skolem"><span>ps1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_integral|const"><span>partition_integral</span></a><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="skolem"><span>kl</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="skolem"><span>ps2</span></span><span>›</span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>no_types</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition.simps|fact"><span>Is_key_partition.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Key_partition_uniq|fact"><span>Key_partition_uniq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.append.append_Cons|fact"><span>append_Cons</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.append.append_Nil|fact"><span>append_Nil</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_integral.simps|fact"><span>partition_integral.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_integral.simps|fact"><span>partition_integral.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_14495..14499"><span>ps12</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_14228..14234"><span>t_l_kl</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_15015..15027">ps1_integral</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_integral|const"><span>partition_integral</span></a><span> </span><span class="free"><span>S</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="skolem"><span>l</span></span><span> </span><span class="skolem"><span>kl</span></span><span> </span><span class="skolem"><span>ps1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>S</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>L</span></span><span> </span><span class="skolem"><span>l</span></span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>l</span></span><span> </span><span class="skolem"><span>kl</span></span><span>›</span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition.simps|fact"><span>Is_key_partition.simps</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Key_partition_uniq|fact"><span>Key_partition_uniq</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_integral.simps|fact"><span>partition_integral.simps</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_14495..14499"><span>ps12</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_14228..14234"><span>t_l_kl</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>

        </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint|const"><span>KeyPoint</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="skolem"><span>kl</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.disj|const"><span>∨</span></a></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="skolem"><span>kl</span></span><span>›</span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_key_point|fact"><span>Const_Interval_key_point</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint_def|fact"><span>KeyPoint_def</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint_uniq|fact"><span>KeyPoint_uniq</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_14141..14143"><span>kl</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_13882..13887"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>5</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword1"><span class="command"><span>consider</span></span></span><span> </span><span class="main"><span>(</span></span><span>a</span><span class="main"><span>)</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="skolem"><span>kl</span></span><span>›</span></span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>b</span><span class="main"><span>)</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint|const"><span>KeyPoint</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="skolem"><span>kl</span></span><span>›</span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
        </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span>
          </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>a</span><span>
          </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
            </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Key_partition_uniq|fact"><span>Key_partition_uniq</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_14495..14499"><span>ps12</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_14675..14688"><span>ps12_integral</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_15015..15027"><span>ps1_integral</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.someI|fact"><span>someI</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
          </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>b</span><span>
          </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
            </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_eq_lower|fact"><span>Const_Interval_eq_lower</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.Eps_cong|fact"><span>Eps_cong</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition.simps|fact"><span>Is_key_partition.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.KeyPoint_def|fact"><span>KeyPoint_def</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Key_partition_uniq|fact"><span>Key_partition_uniq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.semigroup_add_class.add.assoc|fact"><span>add.assoc</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_integral.simps|fact"><span>partition_integral.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_13882..13887"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_13882..13887"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_13882..13887"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>5</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_14495..14499"><span>ps12</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_13909..13911"><span>t1</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_13998..14000"><span>t2</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_14228..14234"><span>t_l_kl</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.xx1|fact"><span>xx1</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>


</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.reserve_change_Is_linear_sum|fact"><span class="entity_def" id="Uniswap_SwapMath.reserve_change_Is_linear_sum|thm"><span>reserve_change_Is_linear_sum</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_linear_sum|const"><span>Is_linear_sum</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change_in_a_step|const"><span>reserve_change_in_a_step</span></a><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_linear_sum_def|fact"><span>Is_linear_sum_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change_in_a_tick_0|fact"><span>reserve_change_in_a_tick_0</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change_in_a_tick_sum|fact"><span>reserve_change_in_a_tick_sum</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Presburger.html#Presburger.presburger|method"><span class="operator"><span>presburger</span></span></a><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Uniswap_SwapMath.reserve_change&apos;_def|fact"><span class="entity_def" id="Uniswap_SwapMath.reserve_change&apos;_def|thm"><span class="entity_def" id="Uniswap_SwapMath.reserve_change&apos;_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Uniswap_SwapMath.reserve_change&apos;|const"><span>reserve_change'</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="free"><span>reserve_change'</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>lower</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>upper</span></span></span></span><span>
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_integral|const"><span>partition_integral</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change_in_a_step|const"><span>reserve_change_in_a_step</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>lower</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>upper</span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.Eps|const"><span>Eps</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition|const"><span>Is_key_partition</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>lower</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>upper</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span class="free"><span class="entity_def" id="Uniswap_SwapMath.reserve_change|const"><span>reserve_change</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>zeroForOne</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>pr0</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>pr1</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span>
    </span><span class="main"><span>(</span></span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>zeroForOne</span></span></span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change&apos;|const"><span>reserve_change'</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>pr1</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>pr0</span></span></span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change&apos;|const"><span>reserve_change'</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>pr0</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>pr1</span></span></span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.reserve_change_irrelavent_with_partition|fact"><span class="entity_def" id="Uniswap_SwapMath.reserve_change_irrelavent_with_partition|thm"><span>reserve_change_irrelavent_with_partition</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>L</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="free"><span>ps</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_integral|const"><span>partition_integral</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change_in_a_step|const"><span>reserve_change_in_a_step</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>L</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="free"><span>ps</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change&apos;|const"><span>reserve_change'</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change&apos;_def|fact"><span>reserve_change'_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_intergral_irrelavent_with_parition|fact"><span>partition_intergral_irrelavent_with_parition</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change_Is_linear_sum|fact"><span>reserve_change_Is_linear_sum</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Uniswap_SwapMath.fee_growth&apos;_def|fact"><span class="entity_def" id="Uniswap_SwapMath.fee_growth&apos;_def|thm"><span class="entity_def" id="Uniswap_SwapMath.fee_growth&apos;_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Uniswap_SwapMath.fee_growth&apos;|const"><span>fee_growth'</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="free"><span>fee_growth'</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>zeroForOne</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>factor</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>l</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>u</span></span></span></span><span>
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_integral|const"><span>partition_integral</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_in_a_tick|const"><span>fee_growth_in_a_tick</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>zeroForOne</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>factor</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>l</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>u</span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.Eps|const"><span>Eps</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition|const"><span>Is_key_partition</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>l</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>u</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="entity"><span class="entity_def" id="Uniswap_SwapMath.fee_growth|const"><span>fee_growth</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="free"><span>fee_growth</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>zeroForOne</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>factor</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>pr0</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>pr1</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span>
    </span><span class="main"><span>(</span></span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>zeroForOne</span></span></span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth&apos;|const"><span>fee_growth'</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>factor</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>pr1</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>pr0</span></span></span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth&apos;|const"><span>fee_growth'</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>factor</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>pr0</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>pr1</span></span></span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.fee_growth_Is_linear_sum|fact"><span class="entity_def" id="Uniswap_SwapMath.fee_growth_Is_linear_sum|thm"><span>fee_growth_Is_linear_sum</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_linear_sum|const"><span>Is_linear_sum</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_in_a_tick|const"><span>fee_growth_in_a_tick</span></a><span> </span><span class="free"><span>zeroForOne</span></span><span> </span><span class="free"><span>factor</span></span><span> </span><span class="free"><span>L</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_linear_sum_def|fact"><span>Is_linear_sum_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_in_a_tick_0|fact"><span>fee_growth_in_a_tick_0</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_in_a_tick_add|fact"><span>fee_growth_in_a_tick_add</span></a><span class="main"><span>)</span></span><span>
  
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.growth_irrelavent_with_partition|fact"><span class="entity_def" id="Uniswap_SwapMath.growth_irrelavent_with_partition|thm"><span>growth_irrelavent_with_partition</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="free"><span>ps</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_integral|const"><span>partition_integral</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_in_a_tick|const"><span>fee_growth_in_a_tick</span></a><span> </span><span class="free"><span>zeroForOne</span></span><span> </span><span class="free"><span>factor</span></span><span> </span><span class="free"><span>L</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="free"><span>ps</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth&apos;|const"><span>fee_growth'</span></a><span> </span><span class="free"><span>zeroForOne</span></span><span> </span><span class="free"><span>factor</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth&apos;_def|fact"><span>fee_growth'_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_Is_linear_sum|fact"><span>fee_growth_Is_linear_sum</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_intergral_irrelavent_with_parition|fact"><span>partition_intergral_irrelavent_with_parition</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.Const_Interval_x_x|fact"><span class="entity_def" id="Uniswap_SwapMath.Const_Interval_x_x|thm"><span>Const_Interval_x_x</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval|const"><span>Const_Interval</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>∘</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="free"><span>x</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_def|fact"><span>Const_Interval_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.force|method"><span class="operator"><span>force</span></span></a><span>

</span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.Const_Interval_x_x&apos;|fact"><span class="entity_def" id="Uniswap_SwapMath.Const_Interval_x_x&apos;|thm"><span>Const_Interval_x_x'</span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_x_x|fact"><span>Const_Interval_x_x</span></a><span class="main"><span>[</span></span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Phi_System/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a></span></span><span> L</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.id|const"><span>id</span></a></span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>simplified</span></span><span class="main"><span>]</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.Is_partition_x_x|fact"><span class="entity_def" id="Uniswap_SwapMath.Is_partition_x_x|thm"><span>Is_partition_x_x</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>L</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_x_x|fact"><span>Const_Interval_x_x</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.reserve_change_0|fact"><span class="entity_def" id="Uniswap_SwapMath.reserve_change_0|thm"><span>reserve_change_0</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change&apos;|const"><span>reserve_change'</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>no_types</span><span class="main"><span class="main"><span>,</span></span></span><span> lifting</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_x_x|fact"><span>Const_Interval_x_x</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition.simps|fact"><span>Is_key_partition.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Key_partition_uniq|fact"><span>Key_partition_uniq</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_integral.simps|fact"><span>partition_integral.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change&apos;_def|fact"><span>reserve_change'_def</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change_in_a_tick_0|fact"><span>reserve_change_in_a_tick_0</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.someI_ex|fact"><span>someI_ex</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.fee_growth_0|fact"><span class="entity_def" id="Uniswap_SwapMath.fee_growth_0|thm"><span>fee_growth_0</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth&apos;|const"><span>fee_growth'</span></a><span> </span><span class="free"><span>zeroForOne</span></span><span> </span><span class="free"><span>factor</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_x_x&apos;|fact"><span>Const_Interval_x_x'</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition.simps|fact"><span>Is_key_partition.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition_implies_Is_partition|fact"><span>Is_key_partition_implies_Is_partition</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_in_a_tick_0|fact"><span>fee_growth_in_a_tick_0</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.growth_irrelavent_with_partition|fact"><span>growth_irrelavent_with_partition</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_integral.simps|fact"><span>partition_integral.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
  

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.reserve_change_add_left|fact"><span class="entity_def" id="Uniswap_SwapMath.reserve_change_add_left|thm"><span>reserve_change_add_left</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>u</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval|const"><span>Const_Interval</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>L</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>m</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change&apos;|const"><span>reserve_change'</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change_in_a_step|const"><span>reserve_change_in_a_step</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>L</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="free"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change&apos;|const"><span>reserve_change'</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>premises</span></span></span><span> </span><span class="entity_def" id="offset_18632..18637">prems</span><span> </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_18655..18657">t1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>Ex</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>L</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="free"><span>u</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Meson/meson_tactic.ML.html#Meson.meson|method"><span class="operator"><span>meson</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_def|fact"><span>Const_Interval_def</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Partition_always_exists|fact"><span>Partition_always_exists</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.dual_order.strict_trans1|fact"><span>dual_order.strict_trans1</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_18632..18637"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_18632..18637"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> ccfv_threshold</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition.simps|fact"><span>Is_partition.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.ab_semigroup_add_class.add.commute|fact"><span>add.commute</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp_apply|fact"><span>comp_apply</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_integral.simps|fact"><span>partition_integral.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_18632..18637"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change_irrelavent_with_partition|fact"><span>reserve_change_irrelavent_with_partition</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_18655..18657"><span>t1</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.reserve_change_add_right|fact"><span class="entity_def" id="Uniswap_SwapMath.reserve_change_add_right|thm"><span>reserve_change_add_right</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>m</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval|const"><span>Const_Interval</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>L</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="free"><span>u</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change&apos;|const"><span>reserve_change'</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change_in_a_step|const"><span>reserve_change_in_a_step</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>L</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="free"><span>m</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change&apos;|const"><span>reserve_change'</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>premises</span></span></span><span> </span><span class="entity_def" id="offset_19209..19214">prems</span><span> </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_19232..19234">t1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>Ex</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>L</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>m</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Partition_always_exists|fact"><span>Partition_always_exists</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_19209..19214"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_19343..19345">t2</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition|const"><span>Is_key_partition</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>L</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.Eps|const"><span>Eps</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition|const"><span>Is_key_partition</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>L</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>m</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Key_partition_exists|fact"><span>Key_partition_exists</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_19232..19234"><span>t1</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/SMT.html#SMT.verit_sko_ex&apos;|fact"><span>verit_sko_ex'</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_19503..19505">t3</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>L</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.Eps|const"><span>Eps</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition|const"><span>Is_key_partition</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>L</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>m</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.append|const"><span>@</span></a></span><span> </span><span class="main"><span>[</span></span><span class="free"><span>m</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition_implies_Is_partition|fact"><span>Is_key_partition_implies_Is_partition</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition.simps|fact"><span>Is_partition.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_cat|fact"><span>Is_partition_cat</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.append.append_Cons|fact"><span>append_Cons</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.append.append_Nil|fact"><span>append_Nil</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_19209..19214"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_19343..19345"><span>t2</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change&apos;_def|fact"><span>reserve_change'_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>mono_tags</span><span class="main"><span class="main"><span>,</span></span></span><span> lifting</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_key_partition_implies_Is_partition|fact"><span>Is_key_partition_implies_Is_partition</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition.simps|fact"><span>Is_partition.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.append.right_neutral|fact"><span>append.right_neutral</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp_apply|fact"><span>comp_apply</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_intergral_add|fact"><span>partition_intergral_add</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_intergral_const|fact"><span>partition_intergral_const</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_19209..19214"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change_Is_linear_sum|fact"><span>reserve_change_Is_linear_sum</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change&apos;_def|fact"><span>reserve_change'_def</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change_irrelavent_with_partition|fact"><span>reserve_change_irrelavent_with_partition</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_19343..19345"><span>t2</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_19503..19505"><span>t3</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>


</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.reserve_change&apos;_LE_0|fact"><span class="entity_def" id="Uniswap_SwapMath.reserve_change&apos;_LE_0|thm"><span>reserve_change'_LE_0</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>u</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>k</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="bound"><span>k</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change&apos;|const"><span>reserve_change'</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>premises</span></span></span><span> </span><span class="entity_def" id="offset_20188..20193">prems</span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>k</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="bound"><span>k</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⟹</span></span><span>
    </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>∘</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="skolem"><span>ps</span></span><span> </span><span class="main"><span>⟹</span></span><span>
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_integral|const"><span>partition_integral</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change_in_a_step|const"><span>reserve_change_in_a_step</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>∘</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="skolem"><span>ps</span></span><span>›</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> </span><span class="skolem"><span>ps</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="skolem"><span>ps</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change_in_a_step_def|fact"><span>reserve_change_in_a_step_def</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/HOL-Library.Product_Plus.html#Product_Plus.zero_prod_def|fact"><span>zero_prod_def</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/Phi_Algebras.Algebras.html#Algebras.less_eq_prod_def|fact"><span>less_eq_prod_def</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.frac_le|fact"><span>frac_le</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_def|fact"><span>Const_Interval_def</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_le_last|fact"><span>Is_partition_le_last</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.frac_le|fact"><span>frac_le</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change&apos;_def|fact"><span>reserve_change'_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Partition_always_exists|fact"><span>Partition_always_exists</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_20188..20193"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_20188..20193"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change&apos;_def|fact"><span>reserve_change'_def</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change_irrelavent_with_partition|fact"><span>reserve_change_irrelavent_with_partition</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.reserve_change&apos;_LE_0&apos;|fact"><span class="entity_def" id="Uniswap_SwapMath.reserve_change&apos;_LE_0&apos;|thm"><span>reserve_change'_LE_0'</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>u</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>k</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="bound"><span>k</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change&apos;|const"><span>reserve_change'</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.snd|const"><span>snd</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change&apos;|const"><span>reserve_change'</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/HOL-Library.Product_Plus.html#Product_Plus.fst_zero|fact"><span>fst_zero</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/Phi_Algebras.Algebras.html#Algebras.less_eq_prod|fact"><span>less_eq_prod</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change&apos;_LE_0|fact"><span>reserve_change'_LE_0</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/HOL-Library.Product_Plus.html#Product_Plus.snd_zero|fact"><span>snd_zero</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.fee_growth_is_0_when_not_zeroForOne|fact"><span class="entity_def" id="Uniswap_SwapMath.fee_growth_is_0_when_not_zeroForOne|thm"><span>fee_growth_is_0_when_not_zeroForOne</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>u</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_Tick.html#Uniswap_Tick.global_fee0_growth|const"><span>global_fee0_growth</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth&apos;|const"><span>fee_growth'</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_rate&apos;|const"><span>fee_rate'</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>premises</span></span></span><span> </span><span class="entity_def" id="offset_21097..21102">prems</span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>u</span></span><span>
     </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="skolem"><span>ps</span></span><span>
     </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_Tick.html#Uniswap_Tick.global_fee0_growth|const"><span>global_fee0_growth</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_integral|const"><span>partition_integral</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_in_a_tick|const"><span>fee_growth_in_a_tick</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_rate&apos;|const"><span>fee_rate'</span></a><span> </span><span class="free"><span>L</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="skolem"><span>ps</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span>›</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> </span><span class="skolem"><span>ps</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="skolem"><span>ps</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_in_a_tick_def|fact"><span>fee_growth_in_a_tick_def</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/Phi_Algebras.Algebras.html#Algebras.zero_fun_def|fact"><span>zero_fun_def</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Meson/meson_tactic.ML.html#Meson.meson|method"><span class="operator"><span>meson</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.dual_order.strict_trans1|fact"><span>dual_order.strict_trans1</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Partition_always_exists&apos;|fact"><span>Partition_always_exists'</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.growth_irrelavent_with_partition|fact"><span>growth_irrelavent_with_partition</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_21097..21102"><span>prems</span></a><span class="main"><span>)</span></span><span> 
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.fee_growth_is_0_when_zeroForOne|fact"><span class="entity_def" id="Uniswap_SwapMath.fee_growth_is_0_when_zeroForOne|thm"><span>fee_growth_is_0_when_zeroForOne</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>u</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_Tick.html#Uniswap_Tick.global_fee1_growth|const"><span>global_fee1_growth</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth&apos;|const"><span>fee_growth'</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_rate&apos;|const"><span>fee_rate'</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>premises</span></span></span><span> </span><span class="entity_def" id="offset_21706..21711">prems</span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>u</span></span><span>
     </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="skolem"><span>ps</span></span><span>
     </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_Tick.html#Uniswap_Tick.global_fee1_growth|const"><span>global_fee1_growth</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_integral|const"><span>partition_integral</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_in_a_tick|const"><span>fee_growth_in_a_tick</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_rate&apos;|const"><span>fee_rate'</span></a><span> </span><span class="free"><span>L</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="skolem"><span>ps</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span>›</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> </span><span class="skolem"><span>ps</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="skolem"><span>ps</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_in_a_tick_def|fact"><span>fee_growth_in_a_tick_def</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/Phi_Algebras.Algebras.html#Algebras.zero_fun_def|fact"><span>zero_fun_def</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Meson/meson_tactic.ML.html#Meson.meson|method"><span class="operator"><span>meson</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.dual_order.strict_trans1|fact"><span>dual_order.strict_trans1</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Partition_always_exists&apos;|fact"><span>Partition_always_exists'</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.growth_irrelavent_with_partition|fact"><span>growth_irrelavent_with_partition</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_21706..21711"><span>prems</span></a><span class="main"><span>)</span></span><span> 
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>


</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.fee_growth_add_left|fact"><span class="entity_def" id="Uniswap_SwapMath.fee_growth_add_left|thm"><span>fee_growth_add_left</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>u</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth&apos;|const"><span>fee_growth'</span></a><span> </span><span class="free"><span>zeroForOne</span></span><span> </span><span class="free"><span>factor</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth&apos;|const"><span>fee_growth'</span></a><span> </span><span class="free"><span>zeroForOne</span></span><span> </span><span class="free"><span>factor</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="free"><span>u</span></span><span>
        </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth&apos;|const"><span>fee_growth'</span></a><span> </span><span class="free"><span>zeroForOne</span></span><span> </span><span class="free"><span>factor</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth&apos;_def|fact"><span>fee_growth'_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> ccfv_threshold</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_cat|fact"><span>Is_partition_cat</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Partition_always_exists&apos;|fact"><span>Partition_always_exists'</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_Is_linear_sum|fact"><span>fee_growth_Is_linear_sum</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_intergral_add|fact"><span>partition_intergral_add</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_intergral_irrelavent_with_parition|fact"><span>partition_intergral_irrelavent_with_parition</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.fee_growth_add_left_in_a_tick|fact"><span class="entity_def" id="Uniswap_SwapMath.fee_growth_add_left_in_a_tick|thm"><span>fee_growth_add_left_in_a_tick</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>u</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval|const"><span>Const_Interval</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>m</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_in_a_tick|const"><span>fee_growth_in_a_tick</span></a><span> </span><span class="free"><span>zeroForOne</span></span><span> </span><span class="free"><span>factor</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="free"><span>l</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth&apos;|const"><span>fee_growth'</span></a><span> </span><span class="free"><span>zeroForOne</span></span><span> </span><span class="free"><span>factor</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="free"><span>u</span></span><span>
        </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth&apos;|const"><span>fee_growth'</span></a><span> </span><span class="free"><span>zeroForOne</span></span><span> </span><span class="free"><span>factor</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>mono_tags</span><span class="main"><span class="main"><span>,</span></span></span><span> opaque_lifting</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition.simps|fact"><span>Is_partition.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_add_left|fact"><span>fee_growth_add_left</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.growth_irrelavent_with_partition|fact"><span>growth_irrelavent_with_partition</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_integral.simps|fact"><span>partition_integral.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.fee_growth_add_right|fact"><span class="entity_def" id="Uniswap_SwapMath.fee_growth_add_right|thm"><span>fee_growth_add_right</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>u</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth&apos;|const"><span>fee_growth'</span></a><span> </span><span class="free"><span>zeroForOne</span></span><span> </span><span class="free"><span>factor</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth&apos;|const"><span>fee_growth'</span></a><span> </span><span class="free"><span>zeroForOne</span></span><span> </span><span class="free"><span>factor</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="free"><span>u</span></span><span>
        </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth&apos;|const"><span>fee_growth'</span></a><span> </span><span class="free"><span>zeroForOne</span></span><span> </span><span class="free"><span>factor</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_add_left|fact"><span>fee_growth_add_left</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth&apos;_def|fact"><span>fee_growth'_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>


</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.fee_growth_add_right_in_a_tick|fact"><span class="entity_def" id="Uniswap_SwapMath.fee_growth_add_right_in_a_tick|thm"><span>fee_growth_add_right_in_a_tick</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>m</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval|const"><span>Const_Interval</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="free"><span>m</span></span><span> </span><span class="free"><span>u</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth&apos;|const"><span>fee_growth'</span></a><span> </span><span class="free"><span>zeroForOne</span></span><span> </span><span class="free"><span>factor</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_in_a_tick|const"><span>fee_growth_in_a_tick</span></a><span> </span><span class="free"><span>zeroForOne</span></span><span> </span><span class="free"><span>factor</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="free"><span>m</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="free"><span>u</span></span><span>
        </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth&apos;|const"><span>fee_growth'</span></a><span> </span><span class="free"><span>zeroForOne</span></span><span> </span><span class="free"><span>factor</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>mono_tags</span><span class="main"><span class="main"><span>,</span></span></span><span> lifting</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition.simps|fact"><span>Is_partition.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_add_right|fact"><span>fee_growth_add_right</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.growth_irrelavent_with_partition|fact"><span>growth_irrelavent_with_partition</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_integral.simps|fact"><span>partition_integral.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.gSum_fee_growth_eq_0|fact"><span class="entity_def" id="Uniswap_SwapMath.gSum_fee_growth_eq_0|thm"><span>gSum_fee_growth_eq_0</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.MIN_PRICE|const"><span>MIN_PRICE</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>pr0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>pr0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>pr1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>pr1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.MAX_PRICE|const"><span>MAX_PRICE</span></a><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>k</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="free"><span>pr0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>pr1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="bound"><span>k</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_Tick.html#Uniswap_Tick.gSum|const"><span>gSum</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth&apos;|const"><span>fee_growth'</span></a><span> </span><span class="free"><span>zeroForOne</span></span><span> </span><span class="free"><span>factor</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>pr0</span></span><span> </span><span class="free"><span>pr1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>premises</span></span></span><span> </span><span class="entity_def" id="offset_23789..23794">prems</span><span> </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.MIN_PRICE|const"><span>MIN_PRICE</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>pr0</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="free"><span>pr0</span></span><span> </span><span class="free"><span>pr1</span></span><span> </span><span class="skolem"><span>ps</span></span><span>
    </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>k</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="free"><span>pr0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>pr1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="bound"><span>k</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_Tick.html#Uniswap_Tick.gSum|const"><span>gSum</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_integral|const"><span>partition_integral</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_in_a_tick|const"><span>fee_growth_in_a_tick</span></a><span> </span><span class="free"><span>zeroForOne</span></span><span> </span><span class="free"><span>factor</span></span><span> </span><span class="free"><span>L</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="free"><span>pr0</span></span><span> </span><span class="free"><span>pr1</span></span><span> </span><span class="skolem"><span>ps</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>)</span></span><span>›</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> </span><span class="skolem"><span>ps</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="skolem"><span>ps</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>pr0</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/HOL-Library.Product_Plus.html#Product_Plus.zero_prod_def|fact"><span>zero_prod_def</span></a><span class="main"><span>)</span></span><span>
       </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_in_a_tick_0|fact"><span>fee_growth_in_a_tick_0</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.gSum_fee_growth_in_a_tick|fact"><span>gSum_fee_growth_in_a_tick</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.less_eq_real_def|fact"><span>less_eq_real_def</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_23789..23794"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/Phi_Algebras.Algebras.html#Algebras.zero_fun|fact"><span>zero_fun</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/HOL-Library.Product_Plus.html#Product_Plus.plus_prod_def|fact"><span>plus_prod_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.cancel_comm_monoid_add_class.add_cancel_right_right|fact"><span>add_cancel_right_right</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_in_a_tick_0|fact"><span>fee_growth_in_a_tick_0</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.gSum_fee_growth_in_a_tick|fact"><span>gSum_fee_growth_in_a_tick</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_23789..23794"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups_Big.html#Groups_Big.comm_monoid_add_class.sum.neutral|fact"><span>sum.neutral</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/Phi_Algebras.Algebras.html#Algebras.zero_fun|fact"><span>zero_fun</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/HOL-Library.Product_Plus.html#Product_Plus.zero_prod_def|fact"><span>zero_prod_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Partition_always_exists&apos;|fact"><span>Partition_always_exists'</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.dual_order.strict_trans1|fact"><span>dual_order.strict_trans1</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.growth_irrelavent_with_partition|fact"><span>growth_irrelavent_with_partition</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_23789..23794"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_23789..23794"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of_L0|fact"><span>price_of_L0</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.gSum_fee_growth|fact"><span class="entity_def" id="Uniswap_SwapMath.gSum_fee_growth|thm"><span>gSum_fee_growth</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.MIN_PRICE|const"><span>MIN_PRICE</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>pr0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>pr0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>pr1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>pr1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.MAX_PRICE|const"><span>MAX_PRICE</span></a><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>k</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="free"><span>pr0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>pr1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="bound"><span>k</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_Tick.html#Uniswap_Tick.gSum|const"><span>gSum</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth&apos;|const"><span>fee_growth'</span></a><span> </span><span class="free"><span>zeroForOne</span></span><span> </span><span class="free"><span>factor</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>pr0</span></span><span> </span><span class="free"><span>pr1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="free"><span>zeroForOne</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="main"><span>(</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span class="free"><span>pr0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span class="free"><span>pr1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="free"><span>factor</span></span><span> </span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>pr1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span>pr0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="free"><span>factor</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth&apos;_def|fact"><span>fee_growth'_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>premises</span></span></span><span> </span><span class="entity_def" id="offset_24915..24920">prems</span><span> </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.MIN_PRICE|const"><span>MIN_PRICE</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>pr0</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="free"><span>pr0</span></span><span> </span><span class="free"><span>pr1</span></span><span> </span><span class="skolem"><span>ps</span></span><span>
    </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>k</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="free"><span>pr0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>pr1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="bound"><span>k</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_Tick.html#Uniswap_Tick.gSum|const"><span>gSum</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_integral|const"><span>partition_integral</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_in_a_tick|const"><span>fee_growth_in_a_tick</span></a><span> </span><span class="free"><span>zeroForOne</span></span><span> </span><span class="free"><span>factor</span></span><span> </span><span class="free"><span>L</span></span><span class="main"><span>)</span></span><span>  </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="free"><span>pr0</span></span><span> </span><span class="free"><span>pr1</span></span><span> </span><span class="skolem"><span>ps</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="free"><span>zeroForOne</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="main"><span>(</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span class="free"><span>pr0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span class="free"><span>pr1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="free"><span>factor</span></span><span> </span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>pr1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span>pr0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="free"><span>factor</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> </span><span class="skolem"><span>ps</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="skolem"><span>ps</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>pr0</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
       </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_24915..24920"><span>prems</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.fastforce|method"><span class="operator"><span>fastforce</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> best</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/HOL-Library.Product_Plus.html#Product_Plus.add_Pair|fact"><span>add_Pair</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.gSum_fee_growth_in_a_tick|fact"><span>gSum_fee_growth_in_a_tick</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.ring_class.left_diff_distrib|fact"><span>left_diff_distrib</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_24915..24920"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> del_insts</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/HOL-Library.Product_Plus.html#Product_Plus.add_Pair|fact"><span>add_Pair</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.gSum_fee_growth_in_a_tick|fact"><span>gSum_fee_growth_in_a_tick</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.ring_class.left_diff_distrib|fact"><span>left_diff_distrib</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_24915..24920"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Partition_always_exists&apos;|fact"><span>Partition_always_exists'</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth&apos;_def|fact"><span>fee_growth'_def</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.growth_irrelavent_with_partition|fact"><span>growth_irrelavent_with_partition</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Lattices.html#Lattices.linorder_class.less_max_iff_disj|fact"><span>less_max_iff_disj</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Lattices.html#Lattices.linorder_class.max.order_iff|fact"><span>max.order_iff</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_24915..24920"><span>prems</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of_L0|fact"><span>price_of_L0</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.fee_growth_eq_0|fact"><span class="entity_def" id="Uniswap_SwapMath.fee_growth_eq_0|thm"><span>fee_growth_eq_0</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.MIN_PRICE|const"><span>MIN_PRICE</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>pr0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>pr0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>pr1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>pr1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.MAX_PRICE|const"><span>MAX_PRICE</span></a><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="free"><span>pr0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.disj|const"><span>∨</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="free"><span>pr1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.disj|const"><span>∨</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>pr1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of|const"><span>price_of</span></a><span> </span><span class="free"><span>k</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth&apos;|const"><span>fee_growth'</span></a><span> </span><span class="free"><span>zeroForOne</span></span><span> </span><span class="free"><span>factor</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>pr0</span></span><span> </span><span class="free"><span>pr1</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>premises</span></span></span><span> </span><span class="entity_def" id="offset_26060..26065">prems</span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.MIN_PRICE|const"><span>MIN_PRICE</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>pr0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>pr0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>pr1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>pr1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.MAX_PRICE|const"><span>MAX_PRICE</span></a><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="free"><span>pr0</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.disj|const"><span>∨</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="free"><span>pr1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.disj|const"><span>∨</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>pr1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of|const"><span>price_of</span></a><span> </span><span class="free"><span>k</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="free"><span>pr0</span></span><span> </span><span class="free"><span>pr1</span></span><span> </span><span class="skolem"><span>ps</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_integral|const"><span>partition_integral</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_in_a_tick|const"><span>fee_growth_in_a_tick</span></a><span> </span><span class="free"><span>zeroForOne</span></span><span> </span><span class="free"><span>factor</span></span><span> </span><span class="free"><span>L</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="free"><span>pr0</span></span><span> </span><span class="free"><span>pr1</span></span><span> </span><span class="skolem"><span>ps</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> </span><span class="skolem"><span>ps</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="skolem"><span>ps</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>pr0</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_in_a_tick_def|fact"><span>fee_growth_in_a_tick_def</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/HOL-Library.Product_Plus.html#Product_Plus.zero_prod_def|fact"><span>zero_prod_def</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Meson/meson_tactic.ML.html#Meson.meson|method"><span class="operator"><span>meson</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.dual_order.strict_trans1|fact"><span>dual_order.strict_trans1</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.less_le_not_le|fact"><span>less_le_not_le</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of_L0|fact"><span>price_of_L0</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price_LE_mono|fact"><span>tick_of_price_LE_mono</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> best</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of_L0|fact"><span>price_of_L0</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price_LE_mono|fact"><span>tick_of_price_LE_mono</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Meson/meson_tactic.ML.html#Meson.meson|method"><span class="operator"><span>meson</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.dual_order.strict_trans1|fact"><span>dual_order.strict_trans1</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.order_antisym_conv|fact"><span>order_antisym_conv</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of_L0|fact"><span>price_of_L0</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of_tick|fact"><span>price_of_tick</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Meson/meson_tactic.ML.html#Meson.meson|method"><span class="operator"><span>meson</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.dual_order.strict_trans1|fact"><span>dual_order.strict_trans1</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.order_antisym_conv|fact"><span>order_antisym_conv</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of_L0|fact"><span>price_of_L0</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of_tick|fact"><span>price_of_tick</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>z3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.add_0|fact"><span>add_0</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.fun_upd_other|fact"><span>fun_upd_other</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/Phi_Algebras.Algebras.html#Algebras.plus_fun_def|fact"><span>plus_fun_def</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of_L0|fact"><span>price_of_L0</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price_LE_mono|fact"><span>tick_of_price_LE_mono</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>z3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.add_0|fact"><span>add_0</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.fun_upd_other|fact"><span>fun_upd_other</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/Phi_Algebras.Algebras.html#Algebras.plus_fun_def|fact"><span>plus_fun_def</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of_L0|fact"><span>price_of_L0</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price_LE_mono|fact"><span>tick_of_price_LE_mono</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>no_types</span><span class="main"><span class="main"><span>,</span></span></span><span> opaque_lifting</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_def|fact"><span>Const_Interval_def</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_le_last|fact"><span>Is_partition_le_last</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.comm_monoid_add_class.add_0|fact"><span>comm_monoid_add_class.add_0</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/Phi_Algebras.Algebras.html#Algebras.fun_updt_0_0|fact"><span>fun_updt_0_0</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.order_less_le_trans|fact"><span>order_less_le_trans</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.order_trans|fact"><span>order_trans</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of_L0|fact"><span>price_of_L0</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price_LE_mono|fact"><span>tick_of_price_LE_mono</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/HOL-Library.Product_Plus.html#Product_Plus.zero_prod_def|fact"><span>zero_prod_def</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>z3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.add_0|fact"><span>add_0</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.fun_upd_other|fact"><span>fun_upd_other</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/Phi_Algebras.Algebras.html#Algebras.plus_fun_def|fact"><span>plus_fun_def</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of_L0|fact"><span>price_of_L0</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price_LE_mono|fact"><span>tick_of_price_LE_mono</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.add_0|fact"><span>add_0</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/Phi_Algebras.Algebras.html#Algebras.fun_updt_0_0|fact"><span>fun_updt_0_0</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/HOL-Library.Product_Plus.html#Product_Plus.zero_prod_def|fact"><span>zero_prod_def</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>no_types</span><span class="main"><span class="main"><span>,</span></span></span><span> opaque_lifting</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.monoid_add_class.add.right_neutral|fact"><span>add.right_neutral</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.dual_order.strict_trans2|fact"><span>dual_order.strict_trans2</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.fun_upd_other|fact"><span>fun_upd_other</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/Phi_Algebras.Algebras.html#Algebras.plus_fun_def|fact"><span>plus_fun_def</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of_L0|fact"><span>price_of_L0</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price_LE_mono|fact"><span>tick_of_price_LE_mono</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/SMT.html#SMT.verit_comp_simplify1|fact"><span>verit_comp_simplify1</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/Phi_Algebras.Algebras.html#Algebras.zero_fun|fact"><span>zero_fun</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/HOL-Library.Product_Plus.html#Product_Plus.zero_prod_def|fact"><span>zero_prod_def</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.add_0|fact"><span>add_0</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/Phi_Algebras.Algebras.html#Algebras.fun_updt_0_0|fact"><span>fun_updt_0_0</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/HOL-Library.Product_Plus.html#Product_Plus.zero_prod_def|fact"><span>zero_prod_def</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>no_types</span><span class="main"><span class="main"><span>,</span></span></span><span> opaque_lifting</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.add_0|fact"><span>add_0</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.dual_order.strict_trans2|fact"><span>dual_order.strict_trans2</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.fun_upd_other|fact"><span>fun_upd_other</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/Phi_Algebras.Algebras.html#Algebras.plus_fun_def|fact"><span>plus_fun_def</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of_L0|fact"><span>price_of_L0</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price_LE_mono|fact"><span>tick_of_price_LE_mono</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/SMT.html#SMT.verit_comp_simplify1|fact"><span>verit_comp_simplify1</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>no_types</span><span class="main"><span class="main"><span>,</span></span></span><span> opaque_lifting</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_def|fact"><span>Const_Interval_def</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.comm_monoid_add_class.add_0|fact"><span>comm_monoid_add_class.add_0</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.dual_order.trans|fact"><span>dual_order.trans</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/Phi_Algebras.Algebras.html#Algebras.fun_updt_0_0|fact"><span>fun_updt_0_0</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/HOL-Library.Product_Plus.html#Product_Plus.zero_prod_def|fact"><span>zero_prod_def</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>z3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.ab_semigroup_add_class.add.commute|fact"><span>add.commute</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.monoid_add_class.add.right_neutral|fact"><span>add.right_neutral</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_in_a_tick_0|fact"><span>fee_growth_in_a_tick_0</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_in_a_tick_def|fact"><span>fee_growth_in_a_tick_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.fun_upd_other|fact"><span>fun_upd_other</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/Phi_Algebras.Algebras.html#Algebras.plus_fun_def|fact"><span>plus_fun_def</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of_L0|fact"><span>price_of_L0</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of_tick|fact"><span>price_of_tick</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.add_0|fact"><span>add_0</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/Phi_Algebras.Algebras.html#Algebras.fun_updt_0_0|fact"><span>fun_updt_0_0</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/HOL-Library.Product_Plus.html#Product_Plus.zero_prod_def|fact"><span>zero_prod_def</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>z3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.monoid_add_class.add.right_neutral|fact"><span>add.right_neutral</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.fun_upd_other|fact"><span>fun_upd_other</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.fun_upd_same|fact"><span>fun_upd_same</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.linordered_ring_strict_class.mult_less_0_iff|fact"><span>mult_less_0_iff</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/Phi_Algebras.Algebras.html#Algebras.plus_fun_def|fact"><span>plus_fun_def</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of_L0|fact"><span>price_of_L0</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of_tick|fact"><span>price_of_tick</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/Phi_Algebras.Algebras.html#Algebras.zero_fun|fact"><span>zero_fun</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.linordered_ring_strict_class.zero_less_mult_iff|fact"><span>zero_less_mult_iff</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/HOL-Library.Product_Plus.html#Product_Plus.zero_prod_def|fact"><span>zero_prod_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth&apos;_def|fact"><span>fee_growth'_def</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/HOL-Library.Product_Plus.html#Product_Plus.zero_prod_def|fact"><span>zero_prod_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Partition_always_exists&apos;|fact"><span>Partition_always_exists'</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.order_class.dual_order.order_iff_strict|fact"><span>dual_order.order_iff_strict</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.dual_order.strict_trans|fact"><span>dual_order.strict_trans</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth&apos;_def|fact"><span>fee_growth'_def</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.growth_irrelavent_with_partition|fact"><span>growth_irrelavent_with_partition</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_26060..26065"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_26060..26065"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of_L0|fact"><span>price_of_L0</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.fee_growth_always_ge_0|fact"><span class="entity_def" id="Uniswap_SwapMath.fee_growth_always_ge_0|thm"><span>fee_growth_always_ge_0</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>u</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>factor</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth&apos;|const"><span>fee_growth'</span></a><span> </span><span class="free"><span>zeroForOne</span></span><span> </span><span class="free"><span>factor</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="free"><span>k</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth&apos;_def|fact"><span>fee_growth'_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>premises</span></span></span><span> </span><span class="entity_def" id="offset_29013..29018">prems</span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>u</span></span><span>
    </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition|const"><span>Is_partition</span></a><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="skolem"><span>ps</span></span><span>
    </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.partition_integral|const"><span>partition_integral</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_in_a_tick|const"><span>fee_growth_in_a_tick</span></a><span> </span><span class="free"><span>zeroForOne</span></span><span> </span><span class="free"><span>factor</span></span><span> </span><span class="free"><span>L</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.tick_of_price|const"><span>tick_of_price</span></a><span> </span><span class="free"><span>l</span></span><span> </span><span class="free"><span>u</span></span><span> </span><span class="skolem"><span>ps</span></span><span> </span><span class="free"><span>k</span></span><span>›</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> </span><span class="skolem"><span>ps</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.induct|method"><span class="operator"><span>induct</span></span></a><span> </span><span class="quoted"><span class="skolem"><span>ps</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>l</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth_in_a_tick_def|fact"><span>fee_growth_in_a_tick_def</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/HOL-Library.Product_Plus.html#Product_Plus.zero_prod_def|fact"><span>zero_prod_def</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/Phi_Algebras.Algebras.html#Algebras.plus_fun|fact"><span>plus_fun</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/Phi_Algebras.Algebras.html#Algebras.less_eq_prod_def|fact"><span>less_eq_prod_def</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.frac_le|fact"><span>frac_le</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_29013..29018"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_29013..29018"><span>prems</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.force|method"><span class="operator"><span>force</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> best</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.add_0|fact"><span>add_0</span></a><span> </span><a class="entity_ref" href="../Phi_Semantics_Framework/HOL-Library.Product_Plus.html#Product_Plus.zero_prod_def|fact"><span>zero_prod_def</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Meson/meson_tactic.ML.html#Meson.meson|method"><span class="operator"><span>meson</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.dual_order.strict_trans1|fact"><span>dual_order.strict_trans1</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Meson/meson_tactic.ML.html#Meson.meson|method"><span class="operator"><span>meson</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.dual_order.strict_trans1|fact"><span>dual_order.strict_trans1</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Meson/meson_tactic.ML.html#Meson.meson|method"><span class="operator"><span>meson</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.dual_order.strict_trans1|fact"><span>dual_order.strict_trans1</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_def|fact"><span>Const_Interval_def</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_le_last|fact"><span>Is_partition_le_last</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.frac_le|fact"><span>frac_le</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_29013..29018"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Meson/meson_tactic.ML.html#Meson.meson|method"><span class="operator"><span>meson</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.dual_order.strict_trans1|fact"><span>dual_order.strict_trans1</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Meson/meson_tactic.ML.html#Meson.meson|method"><span class="operator"><span>meson</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.dual_order.strict_trans1|fact"><span>dual_order.strict_trans1</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Meson/meson_tactic.ML.html#Meson.meson|method"><span class="operator"><span>meson</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.dual_order.strict_trans1|fact"><span>dual_order.strict_trans1</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Meson/meson_tactic.ML.html#Meson.meson|method"><span class="operator"><span>meson</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.dual_order.strict_trans1|fact"><span>dual_order.strict_trans1</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Meson/meson_tactic.ML.html#Meson.meson|method"><span class="operator"><span>meson</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.dual_order.strict_trans1|fact"><span>dual_order.strict_trans1</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Meson/meson_tactic.ML.html#Meson.meson|method"><span class="operator"><span>meson</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.dual_order.strict_trans1|fact"><span>dual_order.strict_trans1</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Meson/meson_tactic.ML.html#Meson.meson|method"><span class="operator"><span>meson</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.dual_order.strict_trans1|fact"><span>dual_order.strict_trans1</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Meson/meson_tactic.ML.html#Meson.meson|method"><span class="operator"><span>meson</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.dual_order.strict_trans1|fact"><span>dual_order.strict_trans1</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_def|fact"><span>Const_Interval_def</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_le_last|fact"><span>Is_partition_le_last</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_29013..29018"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Meson/meson_tactic.ML.html#Meson.meson|method"><span class="operator"><span>meson</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.dual_order.strict_trans1|fact"><span>dual_order.strict_trans1</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Meson/meson_tactic.ML.html#Meson.meson|method"><span class="operator"><span>meson</span></span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Const_Interval_LE|fact"><span>Const_Interval_LE</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Is_partition_imp_LE|fact"><span>Is_partition_imp_LE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.dual_order.strict_trans1|fact"><span>dual_order.strict_trans1</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.Partition_always_exists&apos;|fact"><span>Partition_always_exists'</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.fee_growth&apos;_def|fact"><span>fee_growth'_def</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.growth_irrelavent_with_partition|fact"><span>growth_irrelavent_with_partition</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_29013..29018"><span>prems</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.fastforce|method"><span class="operator"><span>fastforce</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>


</span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="entity"><span class="entity_def" id="Uniswap_SwapMath.XAND|const"><span>XAND</span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>infixr</span></span></span><span> </span><span class="quoted"><span>"</span><span class="keyword1"><span>XAND</span></span><span>"</span></span><span> 35</span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="keyword1"><span class="free"><span>XAND</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>B</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>B</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.disj|const"><span>∨</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>B</span></span></span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Uniswap_SwapMath.swap_step_def|fact"><span class="entity_def" id="Uniswap_SwapMath.swap_step_def|thm"><span class="entity_def" id="Uniswap_SwapMath.swap_step_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Uniswap_SwapMath.swap_step|const"><span>swap_step</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a><span>›</span></span></span><span>
  </span><span class="comment1"><span>― ‹</span><span>As described in the white paper.
</span><span>      Again we don't consider precision, so the specification can be simple and the difference
</span><span>        between exactIn and exactOut disappears.
</span><span>      The module of precision analysis will be designed after completing the φ-system kernel
</span><span>        and Solidity semantics.</span><span>›</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="free"><span>swap_step</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>price</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>price_target</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>amount_remain</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>γ</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span>
    </span><span class="keyword1"><span>let</span></span><span> </span><span class="bound"><span>zeroForOne</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>price</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater_eq|const"><span>&gt;=</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>price_target</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>;</span></span><span> </span><span class="comment1"><span>― ‹</span><span>whether using token0 to buy token1</span><span>›</span></span><span>
        </span><span class="bound"><span>exactIn</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>amount_remain</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater_eq|const"><span>≥</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><span>;</span></span><span>
        </span><span class="bound"><span>amount_remain'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="bound"><span>exactIn</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>amount_remain</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>γ</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>amount_remain</span></span></span></span><span> </span><span class="main"><span>;</span></span><span>
        </span><span class="bound"><span>max_amount</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="bound"><span>zeroForOne</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.XAND|const"><span>XAND</span></a></span><span> </span><span class="bound"><span>exactIn</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>price_target</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>price</span></span></span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>price_target</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>price</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>;</span></span><span>
        </span><span class="bound"><span>Δamount</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="bound"><span>exactIn</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.min|const"><span>min</span></a><span> </span><span class="bound"><span>amount_remain'</span></span><span> </span><span class="bound"><span>max_amount</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.max|const"><span>max</span></a><span> </span><span class="bound"><span>amount_remain'</span></span><span> </span><span class="bound"><span>max_amount</span></span><span> </span><span class="main"><span>;</span></span><span>
        </span><span class="bound"><span>next_price</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>price_target</span></span></span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="bound"><span>zeroForOne</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.XAND|const"><span>XAND</span></a></span><span> </span><span class="bound"><span>exactIn</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>price</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="bound"><span>Δamount</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>price</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="bound"><span>Δamount</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="main"><span>;</span></span><span>
        </span><span class="bound"><span>amountIn</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="bound"><span>zeroForOne</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="bound"><span>next_price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>price</span></span></span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>next_price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>price</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>;</span></span><span>
          </span><span class="comment1"><span>― ‹</span><span>L / price is the reserve amount of token0, and L * price is that of token 1</span><span>›</span></span><span>
        </span><span class="bound"><span>amountOut</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="bound"><span>zeroForOne</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>price</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="bound"><span>next_price</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>price</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>L</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="bound"><span>next_price</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>;</span></span><span>
        </span><span class="bound"><span>feeAmout</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="bound"><span>amountIn</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>γ</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>γ</span></span></span></span><span class="main"><span>)</span></span><span>
     </span><span class="keyword1"><span>in</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>next_price</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>amountIn</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>amountOut</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>feeAmout</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>)</span></span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.swap_step_reserve_change_zeroForOne|fact"><span class="entity_def" id="Uniswap_SwapMath.swap_step_reserve_change_zeroForOne|thm"><span>swap_step_reserve_change_zeroForOne</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><span class="main"><span>(</span></span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater_eq|const"><span>&gt;=</span></a></span><span> </span><span class="free"><span>price_target</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>next_price</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountIn</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountOut</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>feeAmout</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step|const"><span>swap_step</span></a><span> </span><span class="free"><span>price</span></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>amount_remain</span></span><span> </span><span class="free"><span>γ</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>amountIn</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountOut</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change_in_a_step|const"><span>reserve_change_in_a_step</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>next_price</span></span><span> </span><span class="free"><span>price</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change_in_a_step_def|fact"><span>reserve_change_in_a_step_def</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step_def|fact"><span>swap_step_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.min_def|fact"><span>min_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let_def|fact"><span>Let_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.max_def|fact"><span>max_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.swap_step_fee_amout|fact"><span class="entity_def" id="Uniswap_SwapMath.swap_step_fee_amout|thm"><span>swap_step_fee_amout</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><span class="main"><span>(</span></span><span class="free"><span>next_price</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountIn</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountOut</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>feeAmout</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step|const"><span>swap_step</span></a><span> </span><span class="free"><span>price</span></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>amount_remain</span></span><span> </span><span class="free"><span>γ</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>amountIn</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="free"><span>γ</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span>γ</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>feeAmout</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step_def|fact"><span>swap_step_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let_def|fact"><span>Let_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.swap_step_reserve_change_not_zeroForOne|fact"><span class="entity_def" id="Uniswap_SwapMath.swap_step_reserve_change_not_zeroForOne|thm"><span>swap_step_reserve_change_not_zeroForOne</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater_eq|const"><span>&gt;=</span></a></span><span> </span><span class="free"><span>price_target</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>next_price</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountIn</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountOut</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>feeAmout</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step|const"><span>swap_step</span></a><span> </span><span class="free"><span>price</span></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>amount_remain</span></span><span> </span><span class="free"><span>γ</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>amountOut</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountIn</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change_in_a_step|const"><span>reserve_change_in_a_step</span></a><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="free"><span>next_price</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.reserve_change_in_a_step_def|fact"><span>reserve_change_in_a_step_def</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step_def|fact"><span>swap_step_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.min_def|fact"><span>min_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let_def|fact"><span>Let_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.max_def|fact"><span>max_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.swap_step_zero_liquidity|fact"><span class="entity_def" id="Uniswap_SwapMath.swap_step_zero_liquidity|thm"><span>swap_step_zero_liquidity</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>(</span></span><span class="free"><span>next_price</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountIn</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountOut</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>feeAmout</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step|const"><span>swap_step</span></a><span> </span><span class="free"><span>price</span></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="free"><span>amount_remain</span></span><span> </span><span class="free"><span>γ</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>next_price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>price_target</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step_def|fact"><span>swap_step_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let_def|fact"><span>Let_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="comment1"><span>(</span><span>*</span><span> In swap_step, amount_remain cannot be zero </span><span>*</span><span>)</span></span><span>

</span><span class="comment1"><span>(</span><span>*</span><span> lemma
  ‹ 0 &lt; price1 ∧ 0 &lt; price_target ∧ 0 &lt; price_target0 ∧ 0 ≤ L ∧ 0 &lt; γ ∧ γ &lt; 1
⟹ remain0 ≥ 0
⟹ price_target0 ≤ price0 ∧ price_target ≤ price_target0
⟹ (price1, amt_in1, amt_out1, fee1) = swap_step price0 price_target0 L remain0 γ
⟹ (price2, amt_in2, amt_out2, fee2) = swap_step price1 price_target L (remain0 - (amt_in1 + fee1)) γ
⟹ (price3, amt_in3, amt_out3, fee3) = swap_step price0 price_target L remain0 γ
⟹ price3 = price2 ∧ amt_in1 + amt_in2 = amt_in3 ∧ amt_out1 + amt_out2 = amt_out3 ∧ fee1 + fee2 = fee3›
  unfolding swap_step_def apply (auto simp add: min_def max_def)
     apply (cases ‹L = 0›)
      apply (simp add: Let_def)
apply (simp add: Let_def)
</span><span>*</span><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>declare</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/lin_arith.ML.html#Fields.linarith_split_limit|attribute"><span class="operator"><span>linarith_split_limit</span></span></a><span> </span><span class="main"><span class="main"><span>=</span></span></span><span> 30</span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.swap_step_fee_Le_0|fact"><span class="entity_def" id="Uniswap_SwapMath.swap_step_fee_Le_0|thm"><span>swap_step_fee_Le_0</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>feePips</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>feePips</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>next_price</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountIn</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountOut</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>feeAmout</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step|const"><span>swap_step</span></a><span> </span><span class="free"><span>price</span></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>amount_remain</span></span><span> </span><span class="free"><span>feePips</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>feeAmout</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step_def|fact"><span>swap_step_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let_def|fact"><span>Let_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> ccfv_SIG</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.divide_nonpos_pos|fact"><span>divide_nonpos_pos</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.frac_le|fact"><span>frac_le</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.ab_semigroup_mult_class.mult.commute|fact"><span>mult.commute</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.linordered_ring_strict_class.mult_less_0_iff|fact"><span>mult_less_0_iff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.pos_divide_le_eq|fact"><span>pos_divide_le_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.times_divide_eq_left|fact"><span>times_divide_eq_left</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> del_insts</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.divide_cancel_left|fact"><span>divide_cancel_left</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.divide_divide_eq_right|fact"><span>divide_divide_eq_right</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.divide_nonneg_pos|fact"><span>divide_nonneg_pos</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.divide_pos_pos|fact"><span>divide_pos_pos</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.division_ring_class.eq_divide_imp|fact"><span>eq_divide_imp</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.frac_le|fact"><span>frac_le</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.less_eq_real_def|fact"><span>less_eq_real_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.linordered_ring_strict_class.mult_less_0_iff|fact"><span>mult_less_0_iff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.ordered_semiring_0_class.mult_nonneg_nonneg|fact"><span>mult_nonneg_nonneg</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.nonzero_mult_divide_mult_cancel_left2|fact"><span>nonzero_mult_divide_mult_cancel_left2</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.nonzero_mult_divide_mult_cancel_right|fact"><span>nonzero_mult_divide_mult_cancel_right</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.nonzero_mult_divide_mult_cancel_right2|fact"><span>nonzero_mult_divide_mult_cancel_right2</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.linorder_class.not_less_iff_gr_or_eq|fact"><span>not_less_iff_gr_or_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.linordered_ring_strict_class.zero_less_mult_iff|fact"><span>zero_less_mult_iff</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.frac_le|fact"><span>frac_le</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.price_inequaty|fact"><span class="entity_def" id="Uniswap_SwapMath.price_inequaty|thm"><span>price_inequaty</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>delta</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="free"><span>delta</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>price</span></span><span>›</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> del_insts</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.divide_cancel_right|fact"><span>divide_cancel_right</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.divide_pos_pos|fact"><span>divide_pos_pos</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.semidom_divide_class.nonzero_mult_div_cancel_left|fact"><span>nonzero_mult_div_cancel_left</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.pos_divide_le_eq|fact"><span>pos_divide_le_eq</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.price_inequaty&apos;|fact"><span class="entity_def" id="Uniswap_SwapMath.price_inequaty&apos;|thm"><span>price_inequaty'</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>delta</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="free"><span>delta</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>price</span></span><span>›</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.divide_divide_eq_right|fact"><span>divide_divide_eq_right</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.semidom_divide_class.nonzero_mult_div_cancel_left|fact"><span>nonzero_mult_div_cancel_left</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.price_inequaty|fact"><span>price_inequaty</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.price_inequaty2|fact"><span class="entity_def" id="Uniswap_SwapMath.price_inequaty2|thm"><span>price_inequaty2</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="free"><span>delta</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>delta</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="free"><span>delta</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.ab_semigroup_mult_class.mult.commute|fact"><span>mult.commute</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.pos_divide_le_eq|fact"><span>pos_divide_le_eq</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.price_inequaty2&apos;|fact"><span class="entity_def" id="Uniswap_SwapMath.price_inequaty2&apos;|thm"><span>price_inequaty2'</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="free"><span>delta</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>delta</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="free"><span>delta</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../HOL/HOL/Real.html#Real.real|type"><span>real</span></a></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Transcendental.html#Transcendental.ln_div|fact"><span>ln_div</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Transcendental.html#Transcendental.ln_le_cancel_iff|fact"><span>ln_le_cancel_iff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.zero_less_divide_iff|fact"><span>zero_less_divide_iff</span></a><span class="main"><span>)</span></span><span>
  

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.swap_step_next_price_Le|fact"><span class="entity_def" id="Uniswap_SwapMath.swap_step_next_price_Le|thm"><span>swap_step_next_price_Le</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>min_price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>min_price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>min_price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>feePips</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>feePips</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>amount_remain</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>next_price</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountIn</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountOut</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>feeAmout</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step|const"><span>swap_step</span></a><span> </span><span class="free"><span>price</span></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>amount_remain</span></span><span> </span><span class="free"><span>feePips</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>min_price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>next_price</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step_def|fact"><span>swap_step_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let_def|fact"><span>Let_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater_eq|const"><span>&gt;=</span></a></span><span> </span><span class="free"><span>price_target</span></span><span>›</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.min_def|fact"><span>min_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.max_def|fact"><span>max_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> ccfv_SIG</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.divide_divide_eq_right|fact"><span>divide_divide_eq_right</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.semiring_no_zero_divisors_class.mult_eq_0_iff|fact"><span>mult_eq_0_iff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.semidom_divide_class.nonzero_mult_div_cancel_left|fact"><span>nonzero_mult_div_cancel_left</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.times_divide_eq_left|fact"><span>times_divide_eq_left</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.linordered_ring_strict_class.zero_less_mult_iff|fact"><span>zero_less_mult_iff</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>premises</span></span></span><span> </span><span class="entity_def" id="offset_36288..36293">prems</span><span> </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_36311..36313">t1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>amount_remain</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span>feePips</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_36288..36293"><span>prems</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_36288..36293"><span>prems</span></a><span class="main"><span>(</span></span><span>11</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_36288..36293"><span>prems</span></a><span class="main"><span>(</span></span><span>14</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.fastforce|method"><span class="operator"><span>fastforce</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span>thm</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_36288..36293"><span>prems</span></a><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_36428..36430">t2</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="free"><span>amount_remain</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span>feePips</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="free"><span>price_target</span></span><span>›</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_36288..36293"><span>prems</span></a><span class="main"><span>(</span></span><span>12</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.force|method"><span class="operator"><span>force</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_36535..36537">t3</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="free"><span>amount_remain</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span>feePips</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> best</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.divide_nonneg_nonneg|fact"><span>divide_nonneg_nonneg</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_36288..36293"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_36288..36293"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_36288..36293"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>6</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_36288..36293"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>9</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_36311..36313"><span>t1</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_36685..36687">t4</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="free"><span>price_target</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="free"><span>amount_remain</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span>feePips</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>no_types</span><span class="main"><span class="main"><span>,</span></span></span><span> opaque_lifting</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.divide_pos_pos|fact"><span>divide_pos_pos</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.linorder_linear|fact"><span>linorder_linear</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.linorder_not_less|fact"><span>linorder_not_less</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.ab_semigroup_mult_class.mult.commute|fact"><span>mult.commute</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.order_class.order_antisym|fact"><span>order_antisym</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.order_less_le_trans|fact"><span>order_less_le_trans</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.pos_le_divide_eq|fact"><span>pos_le_divide_eq</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_36288..36293"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>15</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_36288..36293"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>9</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_36428..36430"><span>t2</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_36535..36537"><span>t3</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_36288..36293"><span>prems</span></a><span class="main"><span>(</span></span><span>6</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_36685..36687"><span>t4</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.fastforce|method"><span class="operator"><span>fastforce</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> ccfv_threshold</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.ab_semigroup_mult_class.mult.commute|fact"><span>mult.commute</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.pos_divide_le_eq|fact"><span>pos_divide_le_eq</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> best</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.frac_less2|fact"><span>frac_less2</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.ordered_semiring_0_class.split_mult_neg_le|fact"><span>split_mult_neg_le</span></a><span class="main"><span>)</span></span><span>
     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.divide_pos_pos|fact"><span>divide_pos_pos</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.linordered_semiring_strict_class.mult_pos_pos|fact"><span>mult_pos_pos</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> ccfv_threshold</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.price_inequaty2|fact"><span>price_inequaty2</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.zero_less_divide_iff|fact"><span>zero_less_divide_iff</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> ccfv_threshold</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.divide_pos_pos|fact"><span>divide_pos_pos</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.linordered_semiring_strict_class.mult_pos_pos|fact"><span>mult_pos_pos</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> del_insts</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.linordered_ring_strict_class.mult_less_0_iff|fact"><span>mult_less_0_iff</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.swap_step_next_price_Le_MIN_PRICE|fact"><span class="entity_def" id="Uniswap_SwapMath.swap_step_next_price_Le_MIN_PRICE|thm"><span>swap_step_next_price_Le_MIN_PRICE</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.MIN_PRICE|const"><span>MIN_PRICE</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.MIN_PRICE|const"><span>MIN_PRICE</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>feePips</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>feePips</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>amount_remain</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>next_price</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountIn</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountOut</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>feeAmout</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step|const"><span>swap_step</span></a><span> </span><span class="free"><span>price</span></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>amount_remain</span></span><span> </span><span class="free"><span>feePips</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.MIN_PRICE|const"><span>MIN_PRICE</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>next_price</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.price_of_L0|fact"><span>price_of_L0</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step_next_price_Le|fact"><span>swap_step_next_price_Le</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.swap_step_next_price_Gt|fact"><span class="entity_def" id="Uniswap_SwapMath.swap_step_next_price_Gt|thm"><span>swap_step_next_price_Gt</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>feePips</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>feePips</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>max_price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>max_price</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>amount_remain</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>next_price</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountIn</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountOut</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>feeAmout</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step|const"><span>swap_step</span></a><span> </span><span class="free"><span>price</span></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>amount_remain</span></span><span> </span><span class="free"><span>feePips</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>next_price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>max_price</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step_def|fact"><span>swap_step_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let_def|fact"><span>Let_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater_eq|const"><span>&gt;=</span></a></span><span> </span><span class="free"><span>price_target</span></span><span>›</span></span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.min_def|fact"><span>min_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.max_def|fact"><span>max_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> del_insts</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.ordered_semiring_0_class.mult_nonneg_nonpos|fact"><span>mult_nonneg_nonpos</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> del_insts</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.linordered_semiring_strict_class.mult_pos_pos|fact"><span>mult_pos_pos</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.price_inequaty|fact"><span>price_inequaty</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> best</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.divide_neg_pos|fact"><span>divide_neg_pos</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> del_insts</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.divide_neg_pos|fact"><span>divide_neg_pos</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> best</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.frac_le|fact"><span>frac_le</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.ab_semigroup_add_class.add.commute|fact"><span>add.commute</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.ordered_ab_group_add_class.diff_less_eq|fact"><span>diff_less_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.divide_divide_eq_right|fact"><span>divide_divide_eq_right</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.frac_less2|fact"><span>frac_less2</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.linorder_class.leI|fact"><span>leI</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.semidom_divide_class.nonzero_mult_div_cancel_left|fact"><span>nonzero_mult_div_cancel_left</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.linorder_class.not_less_iff_gr_or_eq|fact"><span>not_less_iff_gr_or_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.order_le_less_trans|fact"><span>order_le_less_trans</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> best</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.semidom_divide_class.nonzero_mult_div_cancel_left|fact"><span>nonzero_mult_div_cancel_left</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.pos_divide_le_eq|fact"><span>pos_divide_le_eq</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> ccfv_SIG</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.linordered_ring_strict_class.mult_less_0_iff|fact"><span>mult_less_0_iff</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.swap_step_next_price_Gt_MAX|fact"><span class="entity_def" id="Uniswap_SwapMath.swap_step_next_price_Gt_MAX|thm"><span>swap_step_next_price_Gt_MAX</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>feePips</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>feePips</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.MAX_PRICE|const"><span>MAX_PRICE</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.MAX_PRICE|const"><span>MAX_PRICE</span></a><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>amount_remain</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>next_price</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountIn</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountOut</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>feeAmout</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step|const"><span>swap_step</span></a><span> </span><span class="free"><span>price</span></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>amount_remain</span></span><span> </span><span class="free"><span>feePips</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>next_price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="Uniswap_Tick_Math.html#Uniswap_Tick_Math.MAX_PRICE|const"><span>MAX_PRICE</span></a><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step_next_price_Gt|fact"><span>swap_step_next_price_Gt</span></a><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.swap_step_next_price_Le_0|fact"><span class="entity_def" id="Uniswap_SwapMath.swap_step_next_price_Le_0|thm"><span>swap_step_next_price_Le_0</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>feePips</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>feePips</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>next_price</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountIn</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountOut</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>feeAmout</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step|const"><span>swap_step</span></a><span> </span><span class="free"><span>price</span></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>amount_remain</span></span><span> </span><span class="free"><span>feePips</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>next_price</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step_def|fact"><span>swap_step_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let_def|fact"><span>Let_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> best</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.divide_pos_pos|fact"><span>divide_pos_pos</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.ordered_semiring_0_class.mult_nonneg_nonneg|fact"><span>mult_nonneg_nonneg</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.ordered_semiring_0_class.mult_nonneg_nonneg|fact"><span>mult_nonneg_nonneg</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.zero_le_divide_iff|fact"><span>zero_le_divide_iff</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.divide_pos_pos|fact"><span>divide_pos_pos</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> ccfv_SIG</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.semidom_divide_class.nonzero_mult_div_cancel_left|fact"><span>nonzero_mult_div_cancel_left</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.pos_divide_le_eq|fact"><span>pos_divide_le_eq</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.swap_step_next_price_LE_price|fact"><span class="entity_def" id="Uniswap_SwapMath.swap_step_next_price_LE_price|thm"><span>swap_step_next_price_LE_price</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>feePips</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>feePips</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>price</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>next_price</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountIn</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountOut</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>feeAmout</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step|const"><span>swap_step</span></a><span> </span><span class="free"><span>price</span></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>amount_remain</span></span><span> </span><span class="free"><span>feePips</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>next_price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>price</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step_def|fact"><span>swap_step_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let_def|fact"><span>Let_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.min_def|fact"><span>min_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.max_def|fact"><span>max_def</span></a><span class="main"><span>)</span></span><span>
     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.divide_divide_eq_right|fact"><span>divide_divide_eq_right</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.semidom_divide_class.nonzero_mult_div_cancel_left|fact"><span>nonzero_mult_div_cancel_left</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.linordered_ring_strict_class.zero_le_mult_iff|fact"><span>zero_le_mult_iff</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>premises</span></span></span><span> </span><span class="entity_def" id="offset_39872..39877">prems</span><span> </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>x1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>amount_remain</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span>feePips</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_39872..39877"><span>prems</span></a><span class="main"><span>(</span></span><span>12</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_39872..39877"><span>prems</span></a><span class="main"><span>(</span></span><span>9</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> del_insts</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.divide_eq_0_iff|fact"><span>divide_eq_0_iff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.ab_semigroup_mult_class.mult.commute|fact"><span>mult.commute</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.pos_divide_le_eq|fact"><span>pos_divide_le_eq</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_39872..39877"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_39872..39877"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_39872..39877"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>5</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.division_ring_class.minus_divide_left|fact"><span>minus_divide_left</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.ab_semigroup_mult_class.mult.commute|fact"><span>mult.commute</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.semiring_no_zero_divisors_class.mult_eq_0_iff|fact"><span>mult_eq_0_iff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.linordered_semiring_strict_class.mult_pos_pos|fact"><span>mult_pos_pos</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.pos_less_minus_divide_eq|fact"><span>pos_less_minus_divide_eq</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.divide_nonpos_pos|fact"><span>divide_nonpos_pos</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.swap_step_price_target_LE_next_price|fact"><span class="entity_def" id="Uniswap_SwapMath.swap_step_price_target_LE_next_price|thm"><span>swap_step_price_target_LE_next_price</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>feePips</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>feePips</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>price</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>next_price</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountIn</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountOut</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>feeAmout</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step|const"><span>swap_step</span></a><span> </span><span class="free"><span>price</span></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>amount_remain</span></span><span> </span><span class="free"><span>feePips</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>next_price</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step_def|fact"><span>swap_step_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let_def|fact"><span>Let_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.min_def|fact"><span>min_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.max_def|fact"><span>max_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.divide_divide_eq_right|fact"><span>divide_divide_eq_right</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.semidom_divide_class.nonzero_mult_div_cancel_left|fact"><span>nonzero_mult_div_cancel_left</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.linordered_ring_strict_class.zero_le_mult_iff|fact"><span>zero_le_mult_iff</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>premises</span></span></span><span> </span><span class="entity_def" id="offset_40700..40705">prems</span><span> </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>t1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>amount_remain</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span>feePips</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_40700..40705"><span>prems</span></a><span class="main"><span>(</span></span><span>12</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_40700..40705"><span>prems</span></a><span class="main"><span>(</span></span><span>9</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.force|method"><span class="operator"><span>force</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> best</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.divide_pos_pos|fact"><span>divide_pos_pos</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.ab_semigroup_mult_class.mult.commute|fact"><span>mult.commute</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.pos_le_divide_eq|fact"><span>pos_le_divide_eq</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_40700..40705"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_40700..40705"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>10</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_40700..40705"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>13</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_40700..40705"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_40700..40705"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>5</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.ab_semigroup_mult_class.mult.commute|fact"><span>mult.commute</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.pos_divide_le_eq|fact"><span>pos_divide_le_eq</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> best</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.frac_le|fact"><span>frac_le</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.linordered_ring_strict_class.mult_less_0_iff|fact"><span>mult_less_0_iff</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.swap_step_price_LE_next_price|fact"><span class="entity_def" id="Uniswap_SwapMath.swap_step_price_LE_next_price|thm"><span>swap_step_price_LE_next_price</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>feePips</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>feePips</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>price_target</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>next_price</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountIn</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountOut</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>feeAmout</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step|const"><span>swap_step</span></a><span> </span><span class="free"><span>price</span></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>amount_remain</span></span><span> </span><span class="free"><span>feePips</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>next_price</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step_def|fact"><span>swap_step_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let_def|fact"><span>Let_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.min_def|fact"><span>min_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.max_def|fact"><span>max_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.linorder_class.not_le|fact"><span>not_le</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>premises</span></span></span><span> </span><span class="entity_def" id="offset_41406..41411">prems</span><span> </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>t1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="free"><span>amount_remain</span></span><span>›</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> best</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.divide_nonneg_pos|fact"><span>divide_nonneg_pos</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_41406..41411"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_41406..41411"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>10</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_41406..41411"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_41406..41411"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>5</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> best</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.divide_le_0_iff|fact"><span>divide_le_0_iff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.ab_semigroup_mult_class.mult.commute|fact"><span>mult.commute</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.pos_le_divide_eq|fact"><span>pos_le_divide_eq</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_41406..41411"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_41406..41411"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>10</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_41406..41411"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>11</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_41406..41411"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.swap_step_next_price_LE_price_target|fact"><span class="entity_def" id="Uniswap_SwapMath.swap_step_next_price_LE_price_target|thm"><span>swap_step_next_price_LE_price_target</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>feePips</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>feePips</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>price_target</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>next_price</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountIn</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountOut</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>feeAmout</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step|const"><span>swap_step</span></a><span> </span><span class="free"><span>price</span></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>amount_remain</span></span><span> </span><span class="free"><span>feePips</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>next_price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>price_target</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step_def|fact"><span>swap_step_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let_def|fact"><span>Let_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.min_def|fact"><span>min_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.max_def|fact"><span>max_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.linorder_class.not_le|fact"><span>not_le</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> best</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.frac_less2|fact"><span>frac_less2</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.ab_semigroup_add_class.add.commute|fact"><span>add.commute</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.divide_divide_eq_right|fact"><span>divide_divide_eq_right</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.order_class.dual_order.order_iff_strict|fact"><span>dual_order.order_iff_strict</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.frac_less2|fact"><span>frac_less2</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.ordered_ab_group_add_class.less_diff_eq|fact"><span>less_diff_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.linorder_not_le|fact"><span>linorder_not_le</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.semidom_divide_class.nonzero_mult_div_cancel_left|fact"><span>nonzero_mult_div_cancel_left</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.order_le_less_trans|fact"><span>order_le_less_trans</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.divide_right_mono|fact"><span>divide_right_mono</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.fastforce|method"><span class="operator"><span>fastforce</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> best</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.linordered_ring_strict_class.mult_less_0_iff|fact"><span>mult_less_0_iff</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.swap_step_amountIn_Le_0|fact"><span class="entity_def" id="Uniswap_SwapMath.swap_step_amountIn_Le_0|thm"><span>swap_step_amountIn_Le_0</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>feePips</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>feePips</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>next_price</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountIn</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountOut</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>feeAmout</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step|const"><span>swap_step</span></a><span> </span><span class="free"><span>price</span></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>amount_remain</span></span><span> </span><span class="free"><span>feePips</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>amountIn</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step_def|fact"><span>swap_step_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let_def|fact"><span>Let_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.frac_le|fact"><span>frac_le</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.divide_nonpos_pos|fact"><span>divide_nonpos_pos</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.frac_le|fact"><span>frac_le</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.ab_semigroup_mult_class.mult.commute|fact"><span>mult.commute</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.semidom_divide_class.nonzero_mult_div_cancel_left|fact"><span>nonzero_mult_div_cancel_left</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.pos_divide_le_eq|fact"><span>pos_divide_le_eq</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.min_def|fact"><span>min_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.max_def|fact"><span>max_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.linorder_class.not_le|fact"><span>not_le</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.divide_pos_pos|fact"><span>divide_pos_pos</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.division_ring_class.eq_divide_imp|fact"><span>eq_divide_imp</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.frac_less2|fact"><span>frac_less2</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.mult_divide_mult_cancel_left_if|fact"><span>mult_divide_mult_cancel_left_if</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.nonzero_mult_divide_mult_cancel_right|fact"><span>nonzero_mult_divide_mult_cancel_right</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.nonzero_mult_divide_mult_cancel_right2|fact"><span>nonzero_mult_divide_mult_cancel_right2</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.ordered_ring_class.split_mult_pos_le|fact"><span>split_mult_pos_le</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.times_divide_eq_left|fact"><span>times_divide_eq_left</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.swap_step_amountOut_0|fact"><span class="entity_def" id="Uniswap_SwapMath.swap_step_amountOut_0|thm"><span>swap_step_amountOut_0</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>feePips</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>feePips</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>next_price</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountIn</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>amountOut</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>feeAmout</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step|const"><span>swap_step</span></a><span> </span><span class="free"><span>price</span></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>amount_remain</span></span><span> </span><span class="free"><span>feePips</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>amountOut</span></span><span>›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step_def|fact"><span>swap_step_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let_def|fact"><span>Let_def</span></a><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.max_def|fact"><span>max_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.min_def|fact"><span>min_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.ordered_semiring_0_class.mult_nonneg_nonpos|fact"><span>mult_nonneg_nonpos</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.frac_le|fact"><span>frac_le</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.linorder_class.not_le|fact"><span>not_le</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> del_insts</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.cancel_comm_monoid_add_class.add_cancel_right_right|fact"><span>add_cancel_right_right</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.field_class.divide_divide_eq_right|fact"><span>divide_divide_eq_right</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.linordered_ring_strict_class.mult_le_0_iff|fact"><span>mult_le_0_iff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.mult_zero_class.mult_not_zero|fact"><span>mult_not_zero</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.semidom_divide_class.nonzero_mult_div_cancel_left|fact"><span>nonzero_mult_div_cancel_left</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> best</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.linordered_idom_class.mult_le_cancel_left2|fact"><span>mult_le_cancel_left2</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> best</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.linordered_idom_class.mult_le_cancel_left2|fact"><span>mult_le_cancel_left2</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>premises</span></span></span><span> </span><span class="entity_def" id="offset_43629..43634">prems</span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_43654..43656">t1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>amount_remain</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span>feePips</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_43629..43634"><span>prems</span></a><span class="main"><span>(</span></span><span>12</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_43629..43634"><span>prems</span></a><span class="main"><span>(</span></span><span>8</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.fastforce|method"><span class="operator"><span>fastforce</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_43747..43749">t2</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="free"><span>amount_remain</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span>feePips</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>price</span></span><span>›</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/SMT/smt_systems.ML.html#SMT.smt|method"><span class="operator"><span>smt</span></span></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.divide_pos_pos|fact"><span>divide_pos_pos</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.ab_semigroup_mult_class.mult.commute|fact"><span>mult.commute</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.linordered_field_class.pos_divide_le_eq|fact"><span>pos_divide_le_eq</span></a><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_43629..43634"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>13</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_43629..43634"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>14</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_43629..43634"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_43629..43634"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>4</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_43654..43656"><span>t1</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_43629..43634"><span>prems</span></a><span class="main"><span class="main"><span>(</span></span></span><span>4</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_43747..43749"><span>t2</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>proc</span></span></span><span> </span><span class="entity_def" id="Uniswap_SwapMath.computeSwapStep_\&lt;phi&gt;app|fact"><span class="entity_def" id="Uniswap_SwapMath.computeSwapStep_def|fact"><span class="entity_def" id="Uniswap_SwapMath.computeSwapStep_\&lt;phi&gt;app|thm"><span class="entity_def" id="Uniswap_SwapMath.computeSwapStep_def|thm"><span class="entity_def" id="Uniswap_SwapMath.computeSwapStep_def|axiom"><span class="entity_def" id="Uniswap_SwapMath.computeSwapStep|const"><span>computeSwapStep</span></span></span></span></span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>input</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../Phi_System/Phi_BI.html#Phi_BI.\&lt;phi&gt;Type|const"><span>⦂</span></a></span><span> </span><span class="keyword1"><span>𝗏𝖺𝗅</span></span><span> </span><span class="main"><a class="entity_ref" href="../Phi_Semantics/PhiSem_Real_Abst.html#PhiSem_Real_Abst.\&lt;phi&gt;AReal|const"><span>ℝ</span></a></span><span class="main"><a class="entity_ref" href="../Phi_System/Spec_Framework.html#Spec_Framework.COMMA|const"><span>❟</span></a></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="main"><a class="entity_ref" href="../Phi_System/Phi_BI.html#Phi_BI.\&lt;phi&gt;Type|const"><span>⦂</span></a></span><span> </span><span class="keyword1"><span>𝗏𝖺𝗅</span></span><span> </span><span class="main"><a class="entity_ref" href="../Phi_Semantics/PhiSem_Real_Abst.html#PhiSem_Real_Abst.\&lt;phi&gt;AReal|const"><span>ℝ</span></a></span><span class="main"><a class="entity_ref" href="../Phi_System/Spec_Framework.html#Spec_Framework.COMMA|const"><span>❟</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../Phi_System/Phi_BI.html#Phi_BI.\&lt;phi&gt;Type|const"><span>⦂</span></a></span><span> </span><span class="keyword1"><span>𝗏𝖺𝗅</span></span><span> </span><span class="main"><a class="entity_ref" href="../Phi_Semantics/PhiSem_Real_Abst.html#PhiSem_Real_Abst.\&lt;phi&gt;AReal|const"><span>ℝ</span></a></span><span class="main"><a class="entity_ref" href="../Phi_System/Spec_Framework.html#Spec_Framework.COMMA|const"><span>❟</span></a></span><span> </span><span class="free"><span>amount_remain</span></span><span> </span><span class="main"><a class="entity_ref" href="../Phi_System/Phi_BI.html#Phi_BI.\&lt;phi&gt;Type|const"><span>⦂</span></a></span><span> </span><span class="keyword1"><span>𝗏𝖺𝗅</span></span><span> </span><span class="main"><a class="entity_ref" href="../Phi_Semantics/PhiSem_Real_Abst.html#PhiSem_Real_Abst.\&lt;phi&gt;AReal|const"><span>ℝ</span></a></span><span class="main"><a class="entity_ref" href="../Phi_System/Spec_Framework.html#Spec_Framework.COMMA|const"><span>❟</span></a></span><span> </span><span class="free"><span>feePips</span></span><span> </span><span class="main"><a class="entity_ref" href="../Phi_System/Phi_BI.html#Phi_BI.\&lt;phi&gt;Type|const"><span>⦂</span></a></span><span> </span><span class="keyword1"><span>𝗏𝖺𝗅</span></span><span> </span><span class="main"><a class="entity_ref" href="../Phi_Semantics/PhiSem_Real_Abst.html#PhiSem_Real_Abst.\&lt;phi&gt;AReal|const"><span>ℝ</span></a></span><span>›</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>premises</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>L</span></span><span>›</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span>  </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>feePips</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>feePips</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>›</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>output</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="bound"><span>next_price</span></span><span> </span><span class="main"><a class="entity_ref" href="../Phi_System/Phi_BI.html#Phi_BI.\&lt;phi&gt;Type|const"><span>⦂</span></a></span><span> </span><span class="keyword1"><span>𝗏𝖺𝗅</span></span><span> </span><span class="main"><a class="entity_ref" href="../Phi_Semantics/PhiSem_Real_Abst.html#PhiSem_Real_Abst.\&lt;phi&gt;AReal|const"><span>ℝ</span></a></span><span class="main"><a class="entity_ref" href="../Phi_System/Spec_Framework.html#Spec_Framework.COMMA|const"><span>❟</span></a></span><span> </span><span class="bound"><span>amountIn</span></span><span> </span><span class="main"><a class="entity_ref" href="../Phi_System/Phi_BI.html#Phi_BI.\&lt;phi&gt;Type|const"><span>⦂</span></a></span><span> </span><span class="keyword1"><span>𝗏𝖺𝗅</span></span><span> </span><span class="main"><a class="entity_ref" href="../Phi_Semantics/PhiSem_Real_Abst.html#PhiSem_Real_Abst.\&lt;phi&gt;AReal|const"><span>ℝ</span></a></span><span class="main"><a class="entity_ref" href="../Phi_System/Spec_Framework.html#Spec_Framework.COMMA|const"><span>❟</span></a></span><span> </span><span class="bound"><span>amountOut</span></span><span> </span><span class="main"><a class="entity_ref" href="../Phi_System/Phi_BI.html#Phi_BI.\&lt;phi&gt;Type|const"><span>⦂</span></a></span><span> </span><span class="keyword1"><span>𝗏𝖺𝗅</span></span><span> </span><span class="main"><a class="entity_ref" href="../Phi_Semantics/PhiSem_Real_Abst.html#PhiSem_Real_Abst.\&lt;phi&gt;AReal|const"><span>ℝ</span></a></span><span class="main"><a class="entity_ref" href="../Phi_System/Spec_Framework.html#Spec_Framework.COMMA|const"><span>❟</span></a></span><span> </span><span class="bound"><span>feeAmout</span></span><span> </span><span class="main"><a class="entity_ref" href="../Phi_System/Phi_BI.html#Phi_BI.\&lt;phi&gt;Type|const"><span>⦂</span></a></span><span> </span><span class="keyword1"><span>𝗏𝖺𝗅</span></span><span> </span><span class="main"><a class="entity_ref" href="../Phi_Semantics/PhiSem_Real_Abst.html#PhiSem_Real_Abst.\&lt;phi&gt;AReal|const"><span>ℝ</span></a></span><span>
          </span><span class="keyword1"><span>𝗌𝗎𝖻𝗃</span></span><span> </span><span class="bound"><span>next_price</span></span><span> </span><span class="bound"><span>amountIn</span></span><span> </span><span class="bound"><span>amountOut</span></span><span> </span><span class="bound"><span>feeAmout</span></span><span class="main"><span>.</span></span><span>
          </span><span class="main"><span>(</span></span><span class="bound"><span>next_price</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>amountIn</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>amountOut</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>feeAmout</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.swap_step|const"><span>swap_step</span></a><span> </span><span class="free"><span>price</span></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="free"><span>amount_remain</span></span><span> </span><span class="free"><span>feePips</span></span><span>›</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="../Phi_Semantics/PhiSem_CF_Routine.html#PhiSem_CF_Routine.routine|attribute"><span class="operator"><span>routine</span></span></a><span class="main"><span>]</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_44451..44452">❴</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.max_def|fact"><span>max_def</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="../Phi_System/IDE_CP_Core.html#IDE_CP_Core.\&lt;phi&gt;sledgehammer_simps|attribute"><span class="operator"><span>φsledgehammer_simps</span></span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.min_def|fact"><span>min_def</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="../Phi_System/IDE_CP_Core.html#IDE_CP_Core.\&lt;phi&gt;sledgehammer_simps|attribute"><span class="operator"><span>φsledgehammer_simps</span></span></a><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span>;;</span></span></span><span>

    </span><span class="keyword2"><span class="keyword"><span>var</span></span></span><span> </span><span class="skolem"><span>next_price</span></span><span class="main"><span>,</span></span><span> </span><span class="skolem"><span>feeAmount</span></span><span> </span><span class="keyword1"><span class="command"><span>;;</span></span></span><span>
    </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../Phi_System/Phi_BI.html#Phi_BI.\&lt;phi&gt;Type|const"><span>⦂</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../Phi_Semantics/PhiSem_Real_Abst.html#PhiSem_Real_Abst.\&lt;phi&gt;AReal|const"><span>ℝ</span></a></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../Phi_System/Phi_BI.html#Phi_BI.\&lt;phi&gt;Type|const"><span>⦂</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../Phi_Semantics/PhiSem_Real_Abst.html#PhiSem_Real_Abst.\&lt;phi&gt;AReal|const"><span>ℝ</span></a></span><span>›</span></span></span><span> </span><span class="main"><span>→</span></span><span> </span><span class="keyword2"><span class="keyword"><span>var</span></span></span><span> </span><span class="skolem"><span>amountIn</span></span><span class="main"><span>,</span></span><span> </span><span class="skolem"><span>amountOut</span></span><span> </span><span class="comment1"><span>(</span><span>*</span><span>TODO: support converge-of-branch between initialized and uninitialized variables</span><span>*</span><span>)</span></span><span>
    </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>$</span></span><span>price </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater_eq|const"><span>≥</span></a></span><span> </span><span class="main"><span>$</span></span><span>price_target</span><span>›</span></span></span><span> </span><span class="main"><span>→</span></span><span> </span><span class="keyword2"><span class="keyword"><span>val</span></span></span><span> </span><span class="skolem"><span>zeroForOne</span></span><span> </span><span class="keyword1"><span class="command"><span>;;</span></span></span><span>
    </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>$</span></span><span>amount_remain </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater_eq|const"><span>≥</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span>›</span></span></span><span> </span><span class="main"><span>→</span></span><span> </span><span class="keyword2"><span class="keyword"><span>val</span></span></span><span> </span><span class="skolem"><span>exactIn</span></span><span>

    </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹</span><span>We use some local definitions that save us from the very long expressions.</span><span>›</span></span></span><span>

    </span><span class="keyword3"><span class="command"><span>define</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>amount_remain'</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="skolem"><span>amount_remain'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="main"><span>$</span></span><span>exactIn </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="free"><span>amount_remain</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span>feePips</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><span class="free"><span>amount_remain</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>define</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>max_amount</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="skolem"><span>max_amount</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="main"><span>$</span></span><span>zeroForOne </span><span class="keyword1"><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.XAND|const"><span>XAND</span></a></span><span> </span><span class="main"><span>$</span></span><span>exactIn </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>price_target</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span>price</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>define</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>Δamount</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="skolem"><span>Δamount</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="main"><span>$</span></span><span>exactIn </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.min|const"><span>min</span></a><span> </span><span class="skolem"><span>amount_remain'</span></span><span> </span><span class="skolem"><span>max_amount</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.max|const"><span>max</span></a><span> </span><span class="skolem"><span>amount_remain'</span></span><span> </span><span class="skolem"><span>max_amount</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>define</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>next_price</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="skolem"><span>next_price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="main"><span>$</span></span><span>zeroForOne </span><span class="keyword1"><a class="entity_ref" href="Uniswap_SwapMath.html#Uniswap_SwapMath.XAND|const"><span>XAND</span></a></span><span> </span><span class="main"><span>$</span></span><span>exactIn </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="skolem"><span>Δamount</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="skolem"><span>Δamount</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="free"><span>L</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span> 
    </span><span class="keyword3"><span class="command"><span>define</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>amountIn</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="skolem"><span>amountIn</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="main"><span>$</span></span><span>zeroForOne </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="skolem"><span>next_price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>next_price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span>price</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>define</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>amountOut</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="skolem"><span>amountOut</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="main"><span>$</span></span><span>zeroForOne </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="skolem"><span>next_price</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span>L</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="skolem"><span>next_price</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span> </span><span class="keyword1"><span class="command"><span>;;</span></span></span><span>

    </span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Phi_Semantics/PhiSem_CF_Basic.html#PhiSem_CF_Basic.if_\&lt;phi&gt;app|fact"><span>if</span></a></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>$</span></span><span>exactIn</span><span>›</span></span></span><span> </span><span class="keyword1"><span class="command"><span>❴</span></span></span><span>
      </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>$</span></span><span>amount_remain </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>$</span></span><span>feePips</span><span class="main"><span>)</span></span><span>›</span></span></span><span> </span><span class="main"><span>→</span></span><span> </span><span class="keyword2"><span class="keyword"><span>val</span></span></span><span> </span><span class="skolem"><span>amountRemainingLessFee</span></span><span> </span><span class="keyword1"><span class="command"><span>;;</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Phi_Semantics/PhiSem_CF_Basic.html#PhiSem_CF_Basic.if_\&lt;phi&gt;app|fact"><span>if</span></a></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>$</span></span><span>zeroForOne</span><span>›</span></span></span><span> </span><span class="keyword1"><span class="command"><span>❴</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SqrtPriceMath.html#Uniswap_SqrtPriceMath.getAmount0Delta_\&lt;phi&gt;app|fact"><span>getAmount0Delta</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>$</span></span><span>price_target</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>$</span></span><span>price</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>$</span></span><span>L</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>❵.</span></span></span><span>
                       </span><span class="keyword1"><span class="command"><span>❴</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SqrtPriceMath.html#Uniswap_SqrtPriceMath.getAmount1Delta_\&lt;phi&gt;app|fact"><span>getAmount1Delta</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>$</span></span><span>price</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>$</span></span><span>price_target</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>$</span></span><span>L</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>❵.</span></span></span><span> </span><span class="main"><span>→</span></span><span> amountIn</span><span> </span><span class="keyword1"><span class="command"><span>;;</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Phi_Semantics/PhiSem_CF_Basic.html#PhiSem_CF_Basic.if_\&lt;phi&gt;app|fact"><span>if</span></a></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>$</span></span><span>amountRemainingLessFee </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater_eq|const"><span>≥</span></a></span><span> </span><span class="main"><span>$</span></span><span>amountIn</span><span>›</span></span></span><span> </span><span class="keyword1"><span class="command"><span>❴</span></span></span><span>
          </span><span class="main"><span>$</span></span><span>price_target </span><span class="main"><span>→</span></span><span> next_price</span><span>
      </span><span class="keyword1"><span class="command"><span>❵.</span></span></span><span> </span><span class="keyword1"><span class="command"><span>❴</span></span></span><span>
          </span><a class="entity_ref" href="Uniswap_SqrtPriceMath.html#Uniswap_SqrtPriceMath.getNextSqrtPriceFromInput_\&lt;phi&gt;app|fact"><span>getNextSqrtPriceFromInput</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>$</span></span><span>price</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>$</span></span><span>L</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>$</span></span><span>amountRemainingLessFee</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>$</span></span><span>zeroForOne</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>→</span></span><span> next_price</span><span>
      </span><span class="keyword1"><span class="command"><span>❵.</span></span></span><span> </span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Phi_System/IDE_CP_Applications1.html#IDE_CP_Applications1.is_\&lt;phi&gt;app|fact"><span>is</span></a></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="skolem"><span>next_price</span></span><span>›</span></span></span><span>  
    </span><span class="keyword1"><span class="command"><span>❵.</span></span></span><span> </span><span class="keyword1"><span class="command"><span>❴</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Phi_Semantics/PhiSem_CF_Basic.html#PhiSem_CF_Basic.if_\&lt;phi&gt;app|fact"><span>if</span></a></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>$</span></span><span>zeroForOne</span><span>›</span></span></span><span> </span><span class="keyword1"><span class="command"><span>❴</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SqrtPriceMath.html#Uniswap_SqrtPriceMath.getAmount1Delta_\&lt;phi&gt;app|fact"><span>getAmount1Delta</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>$</span></span><span>price_target</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>$</span></span><span>price</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>$</span></span><span>L</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>❵.</span></span></span><span>
                       </span><span class="keyword1"><span class="command"><span>❴</span></span></span><span> </span><a class="entity_ref" href="Uniswap_SqrtPriceMath.html#Uniswap_SqrtPriceMath.getAmount0Delta_\&lt;phi&gt;app|fact"><span>getAmount0Delta</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>$</span></span><span>price</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>$</span></span><span>price_target</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>$</span></span><span>L</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>❵.</span></span></span><span> </span><span class="main"><span>→</span></span><span> amountOut</span><span> </span><span class="keyword1"><span class="command"><span>;;</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Phi_Semantics/PhiSem_CF_Basic.html#PhiSem_CF_Basic.if_\&lt;phi&gt;app|fact"><span>if</span></a></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.uminus_class.uminus|const"><span>-</span></a></span><span class="main"><span>$</span></span><span>amount_remain </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater_eq|const"><span>≥</span></a></span><span> </span><span class="main"><span>$</span></span><span>amountOut</span><span>›</span></span></span><span> </span><span class="keyword1"><span class="command"><span>❴</span></span></span><span>
          </span><span class="main"><span>$</span></span><span>price_target </span><span class="main"><span>→</span></span><span> next_price</span><span>
      </span><span class="keyword1"><span class="command"><span>❵.</span></span></span><span> </span><span class="keyword1"><span class="command"><span>❴</span></span></span><span>
          </span><a class="entity_ref" href="Uniswap_SqrtPriceMath.html#Uniswap_SqrtPriceMath.getNextSqrtPriceFromOutput_\&lt;phi&gt;app|fact"><span>getNextSqrtPriceFromOutput</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>$</span></span><span>price</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>$</span></span><span>L</span><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="../Phi_Semantics/PhiSem_Common_Int.html#PhiSem_Common_Int.neg_\&lt;phi&gt;app|fact"><span class="dynamic"><span class="dynamic"><span>neg</span></span></span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>$</span></span><span>amount_remain</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>$</span></span><span>zeroForOne</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>→</span></span><span> next_price</span><span>
      </span><span class="keyword1"><span class="command"><span>❵.</span></span></span><span> </span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Phi_System/IDE_CP_Applications1.html#IDE_CP_Applications1.is_\&lt;phi&gt;app|fact"><span>is</span></a></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="skolem"><span>next_price</span></span><span>›</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>❵.</span></span></span><span>

    </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>$</span></span><span>price_target </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>$</span></span><span>next_price</span><span>›</span></span></span><span> </span><span class="main"><span>→</span></span><span> </span><span class="keyword2"><span class="keyword"><span>val</span></span></span><span> </span><span class="skolem"><span>max</span></span><span>

    </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹</span><span>Now we claim two intermediate lemmas that will help the later construction.</span><span>›</span></span></span><span> </span><span class="keyword1"><span class="command"><span>;;</span></span></span><span>
      
      </span><span class="main"><span>pure-fact</span></span><span> </span><span>t1</span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>$</span></span><span>zeroForOne </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>price_target</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="skolem"><span>next_price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="skolem"><span>next_price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>price</span></span><span>›</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span>t2</span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="main"><span>$</span></span><span>zeroForOne </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="skolem"><span>next_price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="skolem"><span>next_price</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>price_target</span></span><span>›</span></span></span><span> </span><span class="keyword1"><span class="command"><span>;;</span></span></span><span>

    </span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Phi_Semantics/PhiSem_CF_Basic.html#PhiSem_CF_Basic.if_\&lt;phi&gt;app|fact"><span>if</span></a></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>$</span></span><span>zeroForOne</span><span>›</span></span></span><span>
       </span><span class="keyword1"><span class="command"><span>❴</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Phi_Semantics/PhiSem_CF_Basic.html#PhiSem_CF_Basic.if_\&lt;phi&gt;app|fact"><span>if</span></a></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>$</span></span><span>max </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>$</span></span><span>exactIn</span><span>›</span></span></span><span> </span><span class="keyword1"><span class="command"><span>❴</span></span></span><span> </span><span class="main"><span>$</span></span><span>amountIn</span><span> </span><span class="keyword1"><span class="command"><span>❵.</span></span></span><span> </span><span class="keyword1"><span class="command"><span>❴</span></span></span><span>
        </span><a class="entity_ref" href="Uniswap_SqrtPriceMath.html#Uniswap_SqrtPriceMath.getAmount0Delta_\&lt;phi&gt;app|fact"><span>getAmount0Delta</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>$</span></span><span>next_price</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>$</span></span><span>price</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>$</span></span><span>L</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>❵.</span></span></span><span>
      </span><span class="main"><span>→</span></span><span> amountIn </span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Phi_System/IDE_CP_Applications1.html#IDE_CP_Applications1.is_\&lt;phi&gt;app|fact"><span>is</span></a></span></span><span> </span><span class="quoted"><span class="skolem"><span>amountIn</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Phi_Semantics/PhiSem_CF_Basic.html#PhiSem_CF_Basic.if_\&lt;phi&gt;app|fact"><span>if</span></a></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>$</span></span><span>max </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="main"><span>$</span></span><span>exactIn</span><span>›</span></span></span><span> </span><span class="keyword1"><span class="command"><span>❴</span></span></span><span> </span><span class="main"><span>$</span></span><span>amountOut</span><span> </span><span class="keyword1"><span class="command"><span>❵.</span></span></span><span> </span><span class="keyword1"><span class="command"><span>❴</span></span></span><span> 
        </span><a class="entity_ref" href="Uniswap_SqrtPriceMath.html#Uniswap_SqrtPriceMath.getAmount1Delta_\&lt;phi&gt;app|fact"><span>getAmount1Delta</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>$</span></span><span>next_price</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>$</span></span><span>price</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>$</span></span><span>L</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>❵.</span></span></span><span>
      </span><span class="main"><span>→</span></span><span> amountOut </span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Phi_System/IDE_CP_Applications1.html#IDE_CP_Applications1.is_\&lt;phi&gt;app|fact"><span>is</span></a></span></span><span> </span><span class="quoted"><span class="skolem"><span>amountOut</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>❵.</span></span></span><span> </span><span class="keyword1"><span class="command"><span>❴</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Phi_Semantics/PhiSem_CF_Basic.html#PhiSem_CF_Basic.if_\&lt;phi&gt;app|fact"><span>if</span></a></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>$</span></span><span>max </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>$</span></span><span>exactIn</span><span>›</span></span></span><span> </span><span class="keyword1"><span class="command"><span>❴</span></span></span><span> </span><span class="main"><span>$</span></span><span>amountIn</span><span> </span><span class="keyword1"><span class="command"><span>❵.</span></span></span><span> </span><span class="keyword1"><span class="command"><span>❴</span></span></span><span>
        </span><a class="entity_ref" href="Uniswap_SqrtPriceMath.html#Uniswap_SqrtPriceMath.getAmount1Delta_\&lt;phi&gt;app|fact"><span>getAmount1Delta</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>$</span></span><span>price</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>$</span></span><span>next_price</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>$</span></span><span>L</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>❵.</span></span></span><span>
      </span><span class="main"><span>→</span></span><span> amountIn </span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Phi_System/IDE_CP_Applications1.html#IDE_CP_Applications1.is_\&lt;phi&gt;app|fact"><span>is</span></a></span></span><span> </span><span class="quoted"><span class="skolem"><span>amountIn</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Phi_Semantics/PhiSem_CF_Basic.html#PhiSem_CF_Basic.if_\&lt;phi&gt;app|fact"><span>if</span></a></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>$</span></span><span>max </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="main"><span>$</span></span><span>exactIn</span><span>›</span></span></span><span> </span><span class="keyword1"><span class="command"><span>❴</span></span></span><span> </span><span class="main"><span>$</span></span><span>amountOut</span><span> </span><span class="keyword1"><span class="command"><span>❵.</span></span></span><span> </span><span class="keyword1"><span class="command"><span>❴</span></span></span><span>
        </span><a class="entity_ref" href="Uniswap_SqrtPriceMath.html#Uniswap_SqrtPriceMath.getAmount0Delta_\&lt;phi&gt;app|fact"><span>getAmount0Delta</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>$</span></span><span>price</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>$</span></span><span>next_price</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>$</span></span><span>L</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>❵.</span></span></span><span>
      </span><span class="main"><span>→</span></span><span> amountOut </span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Phi_System/IDE_CP_Applications1.html#IDE_CP_Applications1.is_\&lt;phi&gt;app|fact"><span>is</span></a></span></span><span> </span><span class="quoted"><span class="skolem"><span>amountOut</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>❵.</span></span></span><span>
  
  </span><span class="main"><span>pure-fact</span></span><span> </span><span>t3</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="main"><span>$</span></span><span>exactIn </span><span class="main"><span>⟹</span></span><span> </span><span class="skolem"><span>amountOut</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.uminus_class.uminus|const"><span>-</span></a></span><span> </span><span class="free"><span>amount_remain</span></span><span>›</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹</span><span>Therefore, when there is no precision lost, the following branch will never be entered</span><span>›</span></span></span><span> </span><span class="keyword1"><span class="command"><span>;;</span></span></span><span>

  </span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Phi_Semantics/PhiSem_CF_Basic.html#PhiSem_CF_Basic.if_\&lt;phi&gt;app|fact"><span>if</span></a></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="main"><span>$</span></span><span>exactIn </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>$</span></span><span>amountOut </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater|const"><span>&gt;</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.uminus_class.uminus|const"><span>-</span></a></span><span> </span><span class="main"><span>$</span></span><span>amount_remain</span><span>›</span></span></span><span> </span><span class="keyword1"><span class="command"><span>❴</span></span></span><span>
    </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.uminus_class.uminus|const"><span>-</span></a></span><span> </span><span class="main"><span>$</span></span><span>amount_remain</span><span>›</span></span></span><span> </span><span class="main"><span>→</span></span><span> amountOut</span><span>
  </span><span class="keyword1"><span class="command"><span>❵.</span></span></span><span> </span><span class="keyword1"><span class="command"><span>❴</span></span></span><span> </span><span class="keyword1"><span class="command"><span>❵.</span></span></span><span> </span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Phi_System/IDE_CP_Applications1.html#IDE_CP_Applications1.is_\&lt;phi&gt;app|fact"><span>is</span></a></span></span><span> </span><span class="quoted"><span class="skolem"><span>amountOut</span></span></span><span> </span><span class="keyword1"><span class="command"><span>;;</span></span></span><span>

  </span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Phi_Semantics/PhiSem_CF_Basic.html#PhiSem_CF_Basic.if_\&lt;phi&gt;app|fact"><span>if</span></a></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>$</span></span><span>exactIn </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>$</span></span><span>next_price </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><span class="main"><span>$</span></span><span>price_target</span><span>›</span></span></span><span> </span><span class="keyword1"><span class="command"><span>❴</span></span></span><span>
    </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>$</span></span><span>amount_remain </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>$</span></span><span>amountIn</span><span>›</span></span></span><span> </span><span class="main"><span>→</span></span><span> feeAmount </span><span class="keyword2"><span class="keyword"><a class="entity_ref" href="../Phi_System/IDE_CP_Applications1.html#IDE_CP_Applications1.is_\&lt;phi&gt;app|fact"><span>is</span></a></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="skolem"><span>amountIn</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="free"><span>feePips</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span>feePips</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span>
      </span><span class="comment1"><span>(</span><span>*</span><span>This is a problem cannot be automated</span><span>*</span><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>❵.</span></span></span><span> </span><span class="keyword1"><span class="command"><span>❴</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>$</span></span><span>amountIn </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span> </span><span class="main"><span>$</span></span><span>feePips </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fields.html#Fields.inverse_class.inverse_divide|const"><span>/</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>$</span></span><span>feePips</span><span class="main"><span>)</span></span><span>›</span></span></span><span> </span><span class="main"><span>→</span></span><span> feeAmount</span><span> </span><span class="keyword1"><span class="command"><span>❵.</span></span></span><span>
 
  </span><a class="entity_ref" href="Uniswap_SwapMath.html#offset_44451..44452"><span>return</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>$</span></span><span>next_price</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>$</span></span><span>amountIn</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>$</span></span><span>amountOut</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>$</span></span><span>feeAmount</span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>❵.</span></span></span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>
  
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span></pre>
</body>

</html>