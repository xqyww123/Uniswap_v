<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹resource_space_more.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹resource_space_more.ML›</h1>
</div>

<pre class="source"><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>GENERIC_RESOURCE_SPACE</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> Loc </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>RESOURCE_LOCALE</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> declare_entries_i </span><span class="main"><span>:</span></span><span>
         </span><span>binding</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>bstring</span><span> * </span><span>Position.T</span><span class="main"><span>)</span></span><span> </span><span>list</span><span>
      </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>binding</span><span> * </span><span>term</span><span> * </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span class="main"><span>(</span></span><span>term</span><span> </span><span class="entity"><span>Expression.map</span></span><span> * </span><span>term</span><span> </span><span class="entity"><span>Expression.rewrites</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span>
      </span><span class="main"><span>-&gt;</span></span><span> </span><span>theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.state</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> declare_entries </span><span class="main"><span>:</span></span><span>
         </span><span>binding</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>bstring</span><span> * </span><span>Position.T</span><span class="main"><span>)</span></span><span> </span><span>list</span><span>
      </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>binding</span><span> * </span><span>string</span><span> * </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>xstring</span><span> * </span><span>Position.T</span><span class="main"><span>)</span></span><span>
                            * </span><span class="main"><span>(</span></span><span>string</span><span> </span><span class="entity"><span>Expression.map</span></span><span> * </span><span class="main"><span>(</span></span><span class="entity"><span>Attrib.binding</span></span><span> * </span><span>string</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span>
      </span><span class="main"><span>-&gt;</span></span><span> </span><span>theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.state</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> define_command </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Outer_Syntax.command_keyword</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>unit</span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>GENERIC_RESOURCE_SPACE_ARGUMENT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> Loc </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>GENERIC_RESOURCE_LOCALE_ARGUMENT</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> additional_data' </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Loc.additional_data'</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> prepare_map_rewr </span><span class="main"><span>:</span></span><span> </span><span>binding</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span>
                    </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="entity"><span>Expression.map</span></span><span> * </span><span>term</span><span> </span><span class="entity"><span>Expression.rewrites</span></span><span>
                    </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="entity"><span>Expression.map</span></span><span> * </span><span>term</span><span> </span><span class="entity"><span>Expression.rewrites</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> prepare_space_name_binding </span><span class="main"><span>:</span></span><span> </span><span>binding</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mandatory_path </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> field_typ_of </span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> space_locale_exp </span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>term</span><span> </span><span class="entity"><span>Expression.map</span></span><span> * </span><span>term</span><span> </span><span class="entity"><span>Expression.rewrites</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>functor</span></span></span><span> </span><span class="entity"><span>Generic_Resource_Space</span></span><span> </span><span class="main"><span>(</span></span><span>Config </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>GENERIC_RESOURCE_SPACE_ARGUMENT</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>GENERIC_RESOURCE_SPACE</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Loc</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Generic_Resource_Locale</span></span><span class="main"><span>(</span></span><span class="entity"><span>Config.Loc</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Entries</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Theory_Data</span><span> </span><span class="main"><span>(</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>term</span><span> </span><span class="comment1"><span>(*const*)</span></span><span> * </span><span>term</span><span> </span><span class="comment1"><span>(*domain or interp*)</span></span><span class="main"><span>)</span></span><span> </span><span>Symtab.table</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>empty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Symtab.empty</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>merge</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Symtab.merge</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>read_expr_term</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>term0</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>term</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Syntax.read_term_global</span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>term0</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="main"><span>(</span></span><span>Term.add_frees</span><span> </span><span class="entity"><span>term</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>null</span><span> </span><span class="main"><span>(</span></span><span>Term.add_tfrees</span><span> </span><span class="entity"><span>term</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>null</span><span> </span><span class="main"><span>(</span></span><span>Term.add_vars</span><span> </span><span class="entity"><span>term</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>null</span><span> </span><span class="main"><span>(</span></span><span>Term.add_tvars</span><span> </span><span class="entity"><span>term</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>term</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>error</span><span> </span><span class="main"><span>(</span></span><span>Pretty.string_of</span><span> </span><span class="main"><span>(</span></span><span>Pretty.chunks</span><span> </span><span class="main"><span>[</span></span><span>
                  </span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>"The term contains free (type) variables!"</span></span><span class="main"><span>,</span></span><span>
                  </span><span>Syntax.pretty_term_global</span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>term</span></span><span>
              </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span> 

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>read_expr_maps</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Expression.Positional</span></span><span> </span><span class="entity"><span>terms</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Expression.Positional</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>read_expr_term</span></span><span> </span><span class="entity"><span>thy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>terms</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>read_expr_maps</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Expression.Named</span></span><span> </span><span class="entity"><span>terms</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Expression.Named</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>apsnd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>read_expr_term</span></span><span> </span><span class="entity"><span>thy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>terms</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>read_expr</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>xname</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>m</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rewr</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>Locale.check</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>xname</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>read_expr_maps</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>m</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>apsnd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>read_expr_term</span></span><span> </span><span class="entity"><span>thy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rewr</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>maps2</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>maps2</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>y</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>maps2</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>ys</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>maps2</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>ListPair.UnequalLengths</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>gen_declare_entries</span></span><span> </span><span class="entity"><span>prep_arg</span></span><span> </span><span class="entity"><span>prep_expr</span></span><span>
                        </span><span class="entity"><span>name_b</span></span><span> </span><span class="entity"><span>parents</span></span><span> </span><span class="entity"><span>entries0</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.init_global</span><span> </span><span class="entity"><span>thy</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>entries</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>B</span></span><span class="main"><span>,</span></span><span class="entity"><span>TM0</span></span><span class="main"><span>,</span></span><span class="entity"><span>E</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>prep_arg</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Config.additional_data'</span></span><span> </span><span class="entity"><span>TM0</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TM</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>B</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>TM</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prep_expr</span></span><span> </span><span class="entity"><span>thy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>E</span></span><span class="main"><span>)</span></span><span>
               </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"Contains type variables!"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>entries0</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>space_xname</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Config.prepare_space_name_binding</span></span><span> </span><span class="entity"><span>name_b</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>space_name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Sign.full_name</span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>space_xname</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>space_entries</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>B</span></span><span class="main"><span>,</span></span><span class="entity"><span>TM</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>Binding.name_of</span><span> </span><span class="entity"><span>B</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>TM</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>entries</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>thy</span></span><span>
   </span><span>|&gt;</span><span> </span><span class="entity"><span>Loc.define_Resource_Locale_i</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">sort</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../Phi_Algebras.Algebras.html#Algebras.sep_algebra|class"><span>sep_algebra</span></a><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Config.Loc.field_locale</span></span><span class="main"><span>,</span></span><span> </span><span>Position.none</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                            </span><span class="entity"><span>Config.additional_data'</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>space_xname</span></span><span>
                            </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span>false</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>parents</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>space_entries</span></span><span>
   </span><span>|&gt;</span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span>&lt;&gt;</span><span> </span><span class="entity"><span>Config.mandatory_path</span></span><span> </span><span>?</span><span> </span><span>Sign.mandatory_path</span><span> </span><span class="entity"><span>Config.mandatory_path</span></span><span>
   </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>space_locale_info</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Symtab.lookup</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Loc.locales</span></span><span> </span><span class="main"><span>(</span></span><span>Context.Theory</span><span> </span><span class="entity"><span>thy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>space_name</span></span><span>
                                    </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Fail</span><span> </span><span class="inner_quoted"><span>"internal bug #um90[3c"</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>calc_field_terms</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>db</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Entries.get</span><span> </span><span class="entity"><span>thy</span></span><span>
                    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>field_terms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>TM</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                            </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Symtab.lookup</span><span> </span><span class="entity"><span>db</span></span><span> </span><span class="entity"><span>name</span></span><span>
                              </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>const</span></span><span>
                               </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Config.field_typ_of</span></span><span> </span><span class="entity"><span>TM</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                          </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>components</span><span> </span><span class="entity"><span>space_locale_info</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>exp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>space_name</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span>false</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Config.space_locale_exp</span></span><span> </span><span class="entity"><span>field_terms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>field_terms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>exp</span></span><span class="main"><span>)</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>field_terms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>exp</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>calc_field_terms</span></span><span> </span><span class="entity"><span>thy</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>new_fields</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>N</span></span><span class="main"><span>,</span></span><span class="entity"><span>TM</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>N</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Config.field_typ_of</span></span><span> </span><span class="entity"><span>TM</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>NoSyn</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>entries</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>new_fields</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>parents</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>thy</span></span><span>
       </span><span>|&gt;</span><span> </span><span class="entity"><span>Named_Target.theory_init</span></span><span>
       </span><span>|&gt;</span><span> </span><span class="entity"><span>Interpretation.global_interpretation</span></span><span> </span><span class="entity"><span>exp</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
       </span><span>|&gt;</span><span> </span><span class="entity"><span>Proof.global_terminal_proof</span></span><span>
            </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>Method.Basic</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Method.METHOD</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Classical.standard_tac</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Position.no_range</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
             </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Method.Basic</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Method.SIMPLE_METHOD</span></span><span> </span><span>o</span><span> </span><span>Tactical.ALLGOALS</span><span> </span><span>o</span><span> </span><span class="entity"><span>Simplifier.simp_tac</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                   </span><span>Position.no_range</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
       </span><span>|&gt;</span><span> </span><span>Local_Theory.exit_global</span><span>
       </span><span>|&gt;</span><span> </span><span>pair</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>goal</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proof.raw_goal</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Interpretation.global_interpretation</span></span><span> </span><span class="entity"><span>exp</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
                                                                </span><span class="main"><span>(</span></span><span class="entity"><span>Named_Target.theory_init</span></span><span> </span><span class="entity"><span>thy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                     </span><span>|&gt;</span><span> </span><span>Thm.prems_of</span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>num</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>goals</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dest_conj_lift</span></span><span> </span><span class="entity"><span>N</span></span><span> </span><span class="entity"><span>X</span></span><span> </span><span class="main"><span>=</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>N</span></span><span> </span><span>&lt;=</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>X</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Conjunction.elim</span><span> </span><span class="entity"><span>X</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>A</span></span><span class="main"><span>,</span></span><span class="entity"><span>B</span></span><span class="main"><span>)</span></span><span>
                                             </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>dest_conj_lift</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>N</span></span><span>-</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>B</span></span><span class="main"><span>)</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>thy</span></span><span>
         </span><span>|&gt;</span><span> </span><span class="entity"><span>Debt_Axiom.debt_axiomatization</span></span><span> </span><span class="entity"><span>new_fields</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
                </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Binding.suffix_name</span><span> </span><span class="inner_quoted"><span>"_ax"</span></span><span> </span><span class="entity"><span>space_xname</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Logic.mk_conjunction_list</span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
         </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>consts</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ax</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thy0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thy0</span></span><span>
                  </span><span>|&gt;</span><span> </span><span>Entries.map</span><span> </span><span class="main"><span>(</span></span><span>fold2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>N</span></span><span class="main"><span>,</span></span><span class="entity"><span>item</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                            </span><span>Symtab.update_new</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>N</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>C</span></span><span class="main"><span>,</span></span><span class="entity"><span>item</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>consts</span></span><span> </span><span class="entity"><span>space_entries</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>axs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_conj_lift</span></span><span> </span><span class="entity"><span>num</span></span><span> </span><span class="entity"><span>ax</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>field_terms2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>exp2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>calc_field_terms</span></span><span> </span><span class="entity"><span>thy</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>exp_properties</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Expression.expression_i</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>maps2</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>B</span></span><span class="main"><span>,</span></span><span class="entity"><span>TM</span></span><span class="main"><span>,</span></span><span class="entity"><span>Es</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>locale</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_rewr</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                      </span><span class="main"><span>(</span></span><span class="entity"><span>locale</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>Config.mandatory_path</span></span><span>^</span><span class="inner_quoted"><span>"."</span></span><span>^</span><span>Binding.name_of</span><span> </span><span class="entity"><span>B</span></span><span class="main"><span>,</span></span><span>true</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                </span><span class="entity"><span>Config.prepare_map_rewr</span></span><span> </span><span class="entity"><span>B</span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="entity"><span>TM</span></span><span> </span><span class="entity"><span>map_rewr</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Es</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>entries</span></span><span> </span><span class="entity"><span>consts</span></span><span>
                  </span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>thy</span></span><span>
         </span><span>|&gt;</span><span> </span><span class="entity"><span>Named_Target.theory_init</span></span><span>
         </span><span>|&gt;</span><span> </span><span class="entity"><span>Interpretation.global_interpretation</span></span><span> </span><span class="entity"><span>exp2</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
         </span><span>|&gt;</span><span> </span><span class="entity"><span>Proof.global_terminal_proof</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>Method.Basic</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Method.SIMPLE_METHOD</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span>Seq.single</span><span> </span><span class="main"><span>(</span></span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Ax</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>S</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Thm.implies_elim</span><span> </span><span class="entity"><span>S</span></span><span> </span><span class="entity"><span>Ax</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>axs</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>,</span></span><span> </span><span>Position.no_range</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>
         </span><span>|&gt;</span><span> </span><span>Local_Theory.exit_global</span><span>
         </span><span>|&gt;</span><span> </span><span>pair</span><span> </span><span class="entity"><span>exp_properties</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
</span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
   </span><span>|&gt;</span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span>&lt;&gt;</span><span> </span><span class="entity"><span>Config.mandatory_path</span></span><span> </span><span>?</span><span> </span><span>apsnd</span><span> </span><span>Sign.parent_path</span><span>
   </span><span>|&gt;</span><span> </span><span>apsnd</span><span> </span><span class="entity"><span>Named_Target.theory_init</span></span><span>
   </span><span>|-&gt;</span><span> </span><span class="entity"><span>Interpretation.isar_interpretation</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>declare_entries_i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_declare_entries</span></span><span> </span><span class="entity"><span>Config.Loc.cert_arg</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>I</span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>declare_entries</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_declare_entries</span></span><span> </span><span class="entity"><span>Config.Loc.read_arg</span></span><span> </span><span class="entity"><span>read_expr</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>instance</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Scan.optional</span><span> </span><span class="main"><span>(</span></span><span>Parse.where_</span><span> </span><span>|--</span><span>
  </span><span>Parse.and_list1</span><span> </span><span class="main"><span>(</span></span><span>Parse.name</span><span> </span><span>--</span><span> </span><span class="main"><span>(</span></span><span>Parse.$$$</span><span> </span><span class="inner_quoted"><span>"="</span></span><span> </span><span>|--</span><span> </span><span>Parse.term</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>&gt;&gt;</span><span> </span><span class="entity"><span>Expression.Named</span></span><span> </span><span>||</span><span>
  </span><span>Scan.repeat1</span><span> </span><span class="main"><span>(</span></span><span>Parse.maybe</span><span> </span><span>Parse.term</span><span class="main"><span>)</span></span><span> </span><span>&gt;&gt;</span><span> </span><span class="entity"><span>Expression.Positional</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Expression.Named</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>--</span><span>
  </span><span class="main"><span>(</span></span><span>Scan.optional</span><span> </span><span class="main"><span>(</span></span><span>Parse.$$$</span><span> </span><span class="inner_quoted"><span>"rewrites"</span></span><span> </span><span>|--</span><span>
                      </span><span>Parse.and_list1</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Parse_Spec.opt_thm_name</span></span><span> </span><span class="inner_quoted"><span>":"</span></span><span> </span><span>--</span><span> </span><span>Parse.prop</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>plus1_unless</span></span><span> </span><span class="entity"><span>test</span></span><span> </span><span class="entity"><span>scan</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>scan</span></span><span> </span><span>:::</span><span> </span><span>Scan.repeat</span><span> </span><span class="main"><span>(</span></span><span>Parse.$$$</span><span> </span><span class="inner_quoted"><span>"+"</span></span><span> </span><span>|--</span><span> </span><span>Scan.unless</span><span> </span><span class="entity"><span>test</span></span><span> </span><span class="main"><span>(</span></span><span>Parse.!!!</span><span> </span><span class="entity"><span>scan</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>locale_keyword'</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Parse.$$$</span><span> </span><span class="inner_quoted"><span>"includes"</span></span><span> </span><span>||</span><span> </span><span class="entity"><span>Parse_Spec.locale_keyword</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>locale_expression</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>expr2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Parse.name_position</span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>expr1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>expr2</span></span><span> </span><span>--</span><span> </span><span class="entity"><span>instance</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>expr0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>plus1_unless</span></span><span> </span><span class="entity"><span>locale_keyword'</span></span><span> </span><span class="entity"><span>expr1</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>expr0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>comp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Parse.binding</span><span> </span><span>--|</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="keyword2"><span>::</span></span><span>›</span></span></span><span> </span><span>--</span><span> </span><span>Parse.!!!</span><span> </span><span>Parse.typ</span><span>
              </span><span>--</span><span> </span><span>Scan.optional</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="keyword2"><span>(</span></span><span>›</span></span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>locale_expression</span></span><span> </span><span>--|</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="keyword2"><span>)</span></span><span>›</span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
           </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>expr</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span class="entity"><span>expr</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>parent</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Parse.name_position</span><span>


</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>define_command</span></span><span> </span><span class="entity"><span>kwd</span></span><span> </span><span class="entity"><span>comment</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Outer_Syntax.command</span></span><span> </span><span class="entity"><span>kwd</span></span><span> </span><span class="entity"><span>comment</span></span><span>
      </span><span class="main"><span>(</span></span><span>Parse.binding</span><span> </span><span>--</span><span> </span><span>Scan.optional</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="keyword2"><span>=</span></span><span>›</span></span></span><span> </span><span>|--</span><span>
        </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Scan.repeat1</span><span> </span><span class="entity"><span>comp</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>pair</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>||</span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>plus1_unless</span></span><span> </span><span class="entity"><span>comp</span></span><span> </span><span class="entity"><span>parent</span></span><span> </span><span>--</span><span>
            </span><span>Scan.optional</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="keyword2"><span>+</span></span><span>›</span></span></span><span> </span><span>|--</span><span> </span><span>Parse.!!!</span><span> </span><span class="main"><span>(</span></span><span>Scan.repeat1</span><span> </span><span class="entity"><span>comp</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name_b</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>parents</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>entries</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="entity"><span>Toplevel.local_theory_to_proof</span></span><span> </span><span>NONE</span><span> </span><span>NONE</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
                </span><span>|&gt;</span><span> </span><span>Local_Theory.exit_global</span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>declare_entries</span></span><span> </span><span class="entity"><span>name_b</span></span><span> </span><span class="entity"><span>parents</span></span><span> </span><span class="entity"><span>entries</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>


</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Resource_Space_Argument</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>GENERIC_RESOURCE_SPACE_ARGUMENT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Loc</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Resource_Locale_Argument</span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>additional_data'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prepare_space_name_binding</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Binding.suffix_name</span><span> </span><span class="inner_quoted"><span>"_res"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mandatory_path</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"RES"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>prepare_map_rewr</span></span><span> </span><span class="entity"><span>field_B</span></span><span> </span><span class="entity"><span>field</span></span><span> </span><span class="entity"><span>domain</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Expression.Positional</span></span><span> </span><span class="entity"><span>TMS</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rw</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>Expression.Positional</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TMS</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="entity"><span>field</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rw</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>prepare_map_rewr</span></span><span> </span><span class="entity"><span>field_B</span></span><span> </span><span class="entity"><span>field</span></span><span> </span><span class="entity"><span>domain</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Expression.Named</span></span><span> </span><span class="entity"><span>TMS</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rw</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>Expression.Named</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Res"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>field</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>TMS</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rw</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>field_typ_of</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>type_of</span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../Resource_Space.html#Resource_Space.sep_closed_set|type"><span>sep_closed_set</span></a><span> </span><span class="entity"><span>T</span></span><span>›</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../Resource_Space.html#Resource_Space.kind|type"><span>Resource_Space.kind</span></a><span> </span><span class="quoted"><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../Phi_Semantics_Framework.html#Phi_Semantics_Framework.RES_N|type"><span>RES_N</span></a><span>›</span></span></span><span> </span><span class="quoted"><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../Phi_Semantics_Framework.html#Phi_Semantics_Framework.RES|type"><span>RES</span></a><span>›</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="quoted"><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../Resource_Space.html#Resource_Space.sep_closed_set|type"><span>sep_closed_set</span></a><span> </span><span class="entity"><span>T</span></span><span>›</span></span></span><span>›</span></span><span>
                   </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>TY</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>TYPE</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Internal Bug #qcujm903"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>TY</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>space_locale_exp</span></span><span> </span><span class="entity"><span>fields</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="entity"><span>Expression.Positional</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../Phi_Semantics_Framework.html#Phi_Semantics_Framework.RES.DOMAIN|const"><span>RES.DOMAIN</span></a><span>›</span></span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span>SOME</span><span> </span><span class="entity"><span>fields</span></span><span>
      </span><span>@</span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="keyword1"><span>TYPE</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="../../../../Phi_Semantics_Framework.html#Phi_Semantics_Framework.RES_N|type"><span>RES_N</span></a><span class="main"><span>)</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="keyword1"><span>TYPE</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="../../../../Phi_Semantics_Framework.html#Phi_Semantics_Framework.RES|type"><span>RES</span></a><span class="main"><span>)</span></span><span>›</span></span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Resource_Space</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Generic_Resource_Space</span></span><span class="main"><span>(</span></span><span class="entity"><span>Resource_Space_Argument</span></span><span class="main"><span>)</span></span><span>

</span></pre>
</body>

</html>