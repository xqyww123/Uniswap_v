<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹Tools/SMT/smt_systems.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹Tools/SMT/smt_systems.ML›</h1>
</div>

<pre class="source"><span class="comment1"><span>(*  Title:      HOL/Tools/SMT/smt_systems.ML
    Author:     Sascha Boehme, TU Muenchen

Setup SMT solvers.
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>SMT_SYSTEMS</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> cvc_extensions</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span>Config.T</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> z3_extensions</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span>Config.T</span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>SMT_Systems</span></span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>SMT_SYSTEMS</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mashN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"mash"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mepoN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"mepo"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>meshN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"mesh"</span></span><span>

</span><span class="comment1"><span>(* helper functions *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>check_tool</span></span><span> </span><span class="entity"><span>var</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>getenv</span><span> </span><span class="entity"><span>var</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>NONE</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>File.is_file</span><span> </span><span class="main"><span>(</span></span><span>Path.variable</span><span> </span><span class="entity"><span>var</span></span><span> </span><span>|&gt;</span><span> </span><span>Path.expand</span><span> </span><span>|&gt;</span><span> </span><span>Path.platform_exe</span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>s</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>make_avail</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>getenv</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"_SOLVER"</span></span><span class="main"><span>)</span></span><span> </span><span>&lt;&gt;</span><span> </span><span class="inner_quoted"><span>""</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>make_command</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span>getenv</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"_SOLVER"</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>outcome_of</span></span><span> </span><span class="entity"><span>unsat</span></span><span> </span><span class="entity"><span>sat</span></span><span> </span><span class="entity"><span>unknown</span></span><span> </span><span class="entity"><span>timeout</span></span><span> </span><span class="entity"><span>solver_name</span></span><span> </span><span class="entity"><span>line</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>String.isPrefix</span><span> </span><span class="entity"><span>unsat</span></span><span> </span><span class="entity"><span>line</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>SMT_Solver.Unsat</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>String.isPrefix</span><span> </span><span class="entity"><span>sat</span></span><span> </span><span class="entity"><span>line</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>SMT_Solver.Sat</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>String.isPrefix</span><span> </span><span class="entity"><span>unknown</span></span><span> </span><span class="entity"><span>line</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>SMT_Solver.Unknown</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>String.isPrefix</span><span> </span><span class="entity"><span>timeout</span></span><span> </span><span class="entity"><span>line</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>SMT_Solver.Time_Out</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>SMT_Failure.SMT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>SMT_Failure.Other_Failure</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Solver "</span></span><span> </span><span>^</span><span> </span><span>quote</span><span> </span><span class="entity"><span>solver_name</span></span><span> </span><span>^</span><span>
    </span><span class="inner_quoted"><span>" failed -- enable tracing using the "</span></span><span> </span><span>^</span><span> </span><span>quote</span><span> </span><span class="main"><span>(</span></span><span>Config.name_of</span><span> </span><span class="entity"><span>SMT_Config.trace</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
    </span><span class="inner_quoted"><span>" option for details"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="comment1"><span>(* When used with bitvectors, CVC4 can produce error messages like:

$ISABELLE_TMP_PREFIX/... No set-logic command was given before this point.

These message should be ignored.
*)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_blank_or_error_line</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_blank_or_error_line</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>String.isPrefix</span><span> </span><span class="inner_quoted"><span>"(error "</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>String.isPrefix</span><span> </span><span class="main"><span>(</span></span><span>getenv</span><span> </span><span class="inner_quoted"><span>"ISABELLE_TMP_PREFIX"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>s</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>on_first_line</span></span><span> </span><span class="entity"><span>test_outcome</span></span><span> </span><span class="entity"><span>solver_name</span></span><span> </span><span class="entity"><span>lines</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>split_first</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ls</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>l</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ls</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>l</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ls</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>split_first</span></span><span> </span><span class="main"><span>(</span></span><span>drop_prefix</span><span> </span><span class="entity"><span>is_blank_or_error_line</span></span><span> </span><span class="entity"><span>lines</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>test_outcome</span></span><span> </span><span class="entity"><span>solver_name</span></span><span> </span><span class="entity"><span>l</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ls</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>on_first_non_unsupported_line</span></span><span> </span><span class="entity"><span>test_outcome</span></span><span> </span><span class="entity"><span>solver_name</span></span><span> </span><span class="entity"><span>lines</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>on_first_line</span></span><span> </span><span class="entity"><span>test_outcome</span></span><span> </span><span class="entity"><span>solver_name</span></span><span> </span><span class="main"><span>(</span></span><span>filter</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>&lt;&gt;</span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"unsupported"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lines</span></span><span class="main"><span>)</span></span><span>


</span><span class="comment1"><span>(* CVC4 and cvc5 *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cvc_extensions</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Attrib.setup_config_bool</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="entity_def" id="SMT.cvc_extensions|attribute"><span>cvc_extensions</span></span><span>›</span></span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>false</span><span class="main"><span>)</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>cvc4_options</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"--no-stats"</span></span><span class="main"><span>,</span></span><span>
     </span><span class="inner_quoted"><span>"--random-seed="</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="main"><span>(</span></span><span>Config.get</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>SMT_Config.random_seed</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="inner_quoted"><span>"--lang=smt2"</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>SMT_Config.get_timeout</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"--tlimit"</span></span><span class="main"><span>,</span></span><span> </span><span>string_of_int</span><span> </span><span class="main"><span>(</span></span><span>Time.toMilliseconds</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>cvc5_options</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"--no-stats"</span></span><span class="main"><span>,</span></span><span>
     </span><span class="inner_quoted"><span>"--sat-random-seed="</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="main"><span>(</span></span><span>Config.get</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>SMT_Config.random_seed</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="inner_quoted"><span>"--lang=smt2"</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>SMT_Config.get_timeout</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"--tlimit"</span></span><span class="main"><span>,</span></span><span> </span><span>string_of_int</span><span> </span><span class="main"><span>(</span></span><span>Time.toMilliseconds</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>select_class</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Config.get</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>cvc_extensions</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Config.get</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>SMT_Config.higher_order</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="entity"><span>CVC_Interface.hosmtlib_cvcC</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="entity"><span>CVC_Interface.smtlib_cvcC</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Config.get</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>SMT_Config.higher_order</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="entity"><span>SMTLIB_Interface.hosmtlibC</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Config.get</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>SMT_Config.native_bv</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="entity"><span>SMTLIB_Interface.bvsmlibC</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="entity"><span>SMTLIB_Interface.smtlibC</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cvc4</span></span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>SMT_Solver.solver_config</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
  </span><span>name</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"cvc4"</span></span><span class="main"><span>,</span></span><span>
  </span><span>class</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>select_class</span></span><span class="main"><span>,</span></span><span>
  </span><span>avail</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>make_avail</span></span><span> </span><span class="inner_quoted"><span>"CVC4"</span></span><span class="main"><span>,</span></span><span>
  </span><span>command</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>make_command</span></span><span> </span><span class="inner_quoted"><span>"CVC4"</span></span><span class="main"><span>,</span></span><span>
  </span><span>options</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>cvc4_options</span></span><span class="main"><span>,</span></span><span>
  </span><span>smt_options</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>":produce-unsat-cores"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"true"</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
  </span><span>good_slices</span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="comment1"><span>(* FUDGE *)</span></span><span>
    </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>512</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>meshN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"--full-saturate-quant"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"--inst-when=full-last-call"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"--inst-no-entail"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"--term-db-mode=relevant"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"--multi-trigger-linear"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>64</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>meshN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"--decision=internal"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"--simplification=none"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"--full-saturate-quant"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>1024</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>meshN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"--relevant-triggers"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"--full-saturate-quant"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>256</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mepoN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"--trigger-sel=max"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"--full-saturate-quant"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>32</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>meshN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"--term-db-mode=relevant"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"--full-saturate-quant"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>128</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>meshN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"--no-e-matching"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"--full-saturate-quant"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>256</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>meshN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"--finite-model-find"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"--fmf-inst-engine"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
  </span><span>outcome</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>on_first_line</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>outcome_of</span></span><span> </span><span class="inner_quoted"><span>"unsat"</span></span><span> </span><span class="inner_quoted"><span>"sat"</span></span><span> </span><span class="inner_quoted"><span>"unknown"</span></span><span> </span><span class="inner_quoted"><span>"timeout"</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
  </span><span>parse_proof</span><span> </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="entity"><span>CVC_Proof_Parse.parse_proof</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
  </span><span>replay</span><span> </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>}</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cvc5</span></span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>SMT_Solver.solver_config</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
  </span><span>name</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"cvc5"</span></span><span class="main"><span>,</span></span><span>
  </span><span>class</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>select_class</span></span><span class="main"><span>,</span></span><span>
  </span><span>avail</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>make_avail</span></span><span> </span><span class="inner_quoted"><span>"CVC5"</span></span><span class="main"><span>,</span></span><span>
  </span><span>command</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>make_command</span></span><span> </span><span class="inner_quoted"><span>"CVC5"</span></span><span class="main"><span>,</span></span><span>
  </span><span>options</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>cvc5_options</span></span><span class="main"><span>,</span></span><span>
  </span><span>smt_options</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>":produce-unsat-cores"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"true"</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
  </span><span>good_slices</span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="comment1"><span>(* FUDGE *)</span></span><span>
    </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>512</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>meshN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"--full-saturate-quant"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"--inst-when=full-last-call"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"--inst-no-entail"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"--term-db-mode=relevant"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"--multi-trigger-linear"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>64</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>meshN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"--decision=internal"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"--simplification=none"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"--full-saturate-quant"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>1024</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>meshN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"--relevant-triggers"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"--full-saturate-quant"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>256</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mepoN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"--trigger-sel=max"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"--full-saturate-quant"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>32</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>meshN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"--term-db-mode=relevant"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"--full-saturate-quant"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>128</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>meshN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"--no-e-matching"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"--full-saturate-quant"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>256</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>meshN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"--finite-model-find"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"--fmf-inst-engine"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
  </span><span>outcome</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>on_first_line</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>outcome_of</span></span><span> </span><span class="inner_quoted"><span>"unsat"</span></span><span> </span><span class="inner_quoted"><span>"sat"</span></span><span> </span><span class="inner_quoted"><span>"unknown"</span></span><span> </span><span class="inner_quoted"><span>"timeout"</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
  </span><span>parse_proof</span><span> </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="entity"><span>CVC_Proof_Parse.parse_proof</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
  </span><span>replay</span><span> </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>}</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>


</span><span class="comment1"><span>(* veriT *)</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>select_class</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Config.get</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>SMT_Config.higher_order</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span class="entity"><span>SMTLIB_Interface.hosmtlibC</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span class="entity"><span>SMTLIB_Interface.smtlibC</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>veriT_options</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
   </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"--proof-with-sharing"</span></span><span class="main"><span>,</span></span><span>
    </span><span class="inner_quoted"><span>"--proof-define-skolems"</span></span><span class="main"><span>,</span></span><span>
    </span><span class="inner_quoted"><span>"--proof-prune"</span></span><span class="main"><span>,</span></span><span>
    </span><span class="inner_quoted"><span>"--proof-merge"</span></span><span class="main"><span>,</span></span><span>
    </span><span class="inner_quoted"><span>"--disable-print-success"</span></span><span class="main"><span>,</span></span><span>
    </span><span class="inner_quoted"><span>"--disable-banner"</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span>
    </span><span class="entity"><span>Verit_Strategies.veriT_current_strategy</span></span><span> </span><span class="main"><span>(</span></span><span>Context.Proof</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>SMT_Config.get_timeout</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"--max-time="</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="main"><span>(</span></span><span>Time.toMilliseconds</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>veriT</span></span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>SMT_Solver.solver_config</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
  </span><span>name</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"verit"</span></span><span class="main"><span>,</span></span><span>
  </span><span>class</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>select_class</span></span><span class="main"><span>,</span></span><span>
  </span><span>avail</span><span> </span><span class="main"><span>=</span></span><span> </span><span>is_some</span><span> </span><span>o</span><span> </span><span class="entity"><span>check_tool</span></span><span> </span><span class="inner_quoted"><span>"ISABELLE_VERIT"</span></span><span class="main"><span>,</span></span><span>
  </span><span>command</span><span> </span><span class="main"><span>=</span></span><span> </span><span>the</span><span> </span><span>o</span><span> </span><span class="entity"><span>check_tool</span></span><span> </span><span class="inner_quoted"><span>"ISABELLE_VERIT"</span></span><span class="main"><span>,</span></span><span>
  </span><span>options</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>veriT_options</span></span><span class="main"><span>,</span></span><span>
  </span><span>smt_options</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>":produce-proofs"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"true"</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
  </span><span>good_slices</span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="comment1"><span>(* FUDGE *)</span></span><span>
    </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>1024</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>meshN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>512</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mashN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>64</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>meshN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>128</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>meshN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>256</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mepoN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>32</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>meshN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
  </span><span>outcome</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>on_first_non_unsupported_line</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>outcome_of</span></span><span> </span><span class="inner_quoted"><span>"unsat"</span></span><span> </span><span class="inner_quoted"><span>"sat"</span></span><span> </span><span class="inner_quoted"><span>"unknown"</span></span><span> </span><span class="inner_quoted"><span>"Time limit exceeded"</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
  </span><span>parse_proof</span><span> </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="entity"><span>Lethe_Proof_Parse.parse_proof</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
  </span><span>replay</span><span> </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>Verit_Replay.replay</span></span><span> </span><span class="main"><span>}</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>


</span><span class="comment1"><span>(* Z3 *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>z3_extensions</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Attrib.setup_config_bool</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="entity_def" id="SMT.z3_extensions|attribute"><span>z3_extensions</span></span><span>›</span></span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>false</span><span class="main"><span>)</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>z3_options</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"smt.random_seed="</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="main"><span>(</span></span><span>Config.get</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>SMT_Config.random_seed</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="inner_quoted"><span>"smt.refine_inj_axioms=false"</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>SMT_Config.get_timeout</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"-T:"</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="main"><span>(</span></span><span>Real.ceil</span><span> </span><span class="main"><span>(</span></span><span>Time.toReal</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span>
    </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"-smt2"</span></span><span class="main"><span>]</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>select_class</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Config.get</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>z3_extensions</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Z3_Interface.smtlib_z3C</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Config.get</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>SMT_Config.native_bv</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>SMTLIB_Interface.bvsmlibC</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>SMTLIB_Interface.smtlibC</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>z3</span></span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>SMT_Solver.solver_config</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
  </span><span>name</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"z3"</span></span><span class="main"><span>,</span></span><span>
  </span><span>class</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>select_class</span></span><span class="main"><span>,</span></span><span>
  </span><span>avail</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>make_avail</span></span><span> </span><span class="inner_quoted"><span>"Z3"</span></span><span class="main"><span>,</span></span><span>
  </span><span>command</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>make_command</span></span><span> </span><span class="inner_quoted"><span>"Z3"</span></span><span class="main"><span>,</span></span><span>
  </span><span>options</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>z3_options</span></span><span class="main"><span>,</span></span><span>
  </span><span>smt_options</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>":produce-proofs"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"true"</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
  </span><span>good_slices</span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="comment1"><span>(* FUDGE *)</span></span><span>
    </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>1024</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>meshN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>512</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mepoN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>64</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>meshN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>256</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>meshN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>128</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mashN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>32</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>meshN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
  </span><span>outcome</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>on_first_line</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>outcome_of</span></span><span> </span><span class="inner_quoted"><span>"unsat"</span></span><span> </span><span class="inner_quoted"><span>"sat"</span></span><span> </span><span class="inner_quoted"><span>"unknown"</span></span><span> </span><span class="inner_quoted"><span>"timeout"</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
  </span><span>parse_proof</span><span> </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>Z3_Replay.parse_proof</span></span><span class="main"><span>,</span></span><span>
  </span><span>replay</span><span> </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>Z3_Replay.replay</span></span><span> </span><span class="main"><span>}</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="comment1"><span>(* smt tactic *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>parse_smt_options</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Scan.optional</span><span>
    </span><span class="main"><span>(</span></span><span>Args.parens</span><span> </span><span class="main"><span>(</span></span><span>Args.name</span><span> </span><span>--</span><span> </span><span>Scan.option</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="keyword2"><span>,</span></span><span>›</span></span></span><span> </span><span>|--</span><span> </span><span>Args.name</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>apfst</span><span> </span><span>SOME</span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>(</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>smt_method</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>solver</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>stgy</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>facts</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>default_solver</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>SMT_Config.solver_of</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>solver</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>the_default</span><span> </span><span class="entity"><span>default_solver</span></span><span> </span><span class="entity"><span>solver</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> 
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>solver</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"z3"</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>stgy</span></span><span> </span><span>&lt;&gt;</span><span> </span><span>NONE</span><span>
      </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>warning</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"No strategy is available for z3. Ignoring "</span></span><span> </span><span>^</span><span> </span><span>quote</span><span> </span><span class="main"><span>(</span></span><span>the</span><span> </span><span class="entity"><span>stgy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> 
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>ctxt</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>stgy</span></span><span> </span><span>&lt;&gt;</span><span> </span><span>NONE</span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Context.proof_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Verit_Strategies.select_veriT_stgy</span></span><span> </span><span class="main"><span>(</span></span><span>the</span><span> </span><span class="entity"><span>stgy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>I</span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>Context.Proof</span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>SMT_Config.select_solver</span></span><span> </span><span class="entity"><span>solver</span></span><span>
      </span><span>|&gt;</span><span> </span><span>Context.proof_of</span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>SOLVED'</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>SMT_Solver.smt_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thms</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Theory.setup</span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>Method.setup</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="entity_def" id="SMT.smt|method"><span>smt</span></span><span>›</span></span></span><span>
      </span><span class="main"><span>(</span></span><span>Scan.lift</span><span> </span><span class="entity"><span>parse_smt_options</span></span><span> </span><span>--</span><span> </span><span class="entity"><span>Attrib.thms</span></span><span> </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>METHOD</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>smt_method</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="inner_quoted"><span>"Call to the SMT solvers veriT or z3"</span></span><span class="main"><span>)</span></span><span>

</span><span class="comment1"><span>(* overall setup *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Theory.setup</span><span> </span><span class="main"><span>(</span></span><span>
  </span><span class="entity"><span>SMT_Solver.add_solver</span></span><span> </span><span class="entity"><span>cvc4</span></span><span> </span><span>#&gt;</span><span>
  </span><span class="entity"><span>SMT_Solver.add_solver</span></span><span> </span><span class="entity"><span>cvc5</span></span><span> </span><span>#&gt;</span><span>
  </span><span class="entity"><span>SMT_Solver.add_solver</span></span><span> </span><span class="entity"><span>veriT</span></span><span> </span><span>#&gt;</span><span>
  </span><span class="entity"><span>SMT_Solver.add_solver</span></span><span> </span><span class="entity"><span>z3</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span></pre>
</body>

</html>