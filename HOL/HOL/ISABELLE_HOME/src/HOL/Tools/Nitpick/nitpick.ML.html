<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹Tools/Nitpick/nitpick.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹Tools/Nitpick/nitpick.ML›</h1>
</div>

<pre class="source"><span class="comment1"><span>(*  Title:      HOL/Tools/Nitpick/nitpick.ML
    Author:     Jasmin Blanchette, TU Muenchen
    Copyright   2008, 2009, 2010

Finite model generation for HOL formulas using Kodkod.
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>NITPICK</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>term_postprocessor</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Nitpick_Model.term_postprocessor</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Auto_Try</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Try</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Normal</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>TPTP</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>{</span></span><span>cards_assigns</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>typ</span><span> </span><span>option</span><span> * </span><span>int</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     </span><span>maxes_assigns</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>typ</span><span class="main"><span>)</span></span><span> </span><span>option</span><span> * </span><span>int</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     </span><span>iters_assigns</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>typ</span><span class="main"><span>)</span></span><span> </span><span>option</span><span> * </span><span>int</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     </span><span>bitss</span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     </span><span>bisim_depths</span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     </span><span>boxes</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>typ</span><span> </span><span>option</span><span> * </span><span>bool</span><span> </span><span>option</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     </span><span>finitizes</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>typ</span><span> </span><span>option</span><span> * </span><span>bool</span><span> </span><span>option</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     </span><span>monos</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>typ</span><span> </span><span>option</span><span> * </span><span>bool</span><span> </span><span>option</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     </span><span>wfs</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>typ</span><span class="main"><span>)</span></span><span> </span><span>option</span><span> * </span><span>bool</span><span> </span><span>option</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     </span><span>sat_solver</span><span class="main"><span>:</span></span><span> </span><span>string</span><span class="main"><span>,</span></span><span>
     </span><span>falsify</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     </span><span>debug</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     </span><span>verbose</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     </span><span>overlord</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     </span><span>spy</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     </span><span>user_axioms</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
     </span><span>assms</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     </span><span>whacks</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     </span><span>merge_type_vars</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     </span><span>binary_ints</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
     </span><span>destroy_constrs</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     </span><span>specialize</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     </span><span>star_linear_preds</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     </span><span>total_consts</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
     </span><span>needs</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
     </span><span>peephole_optim</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     </span><span>datatype_sym_break</span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span>
     </span><span>kodkod_sym_break</span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span>
     </span><span>timeout</span><span class="main"><span>:</span></span><span> </span><span>Time.time</span><span class="main"><span>,</span></span><span>
     </span><span>tac_timeout</span><span class="main"><span>:</span></span><span> </span><span>Time.time</span><span class="main"><span>,</span></span><span>
     </span><span>max_threads</span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span>
     </span><span>show_types</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     </span><span>show_skolems</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     </span><span>show_consts</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     </span><span>evals</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     </span><span>formats</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>term</span><span> </span><span>option</span><span> * </span><span>int</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     </span><span>atomss</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>typ</span><span> </span><span>option</span><span> * </span><span>string</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     </span><span>max_potential</span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span>
     </span><span>max_genuine</span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span>
     </span><span>batch_size</span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span>
     </span><span>expect</span><span class="main"><span>:</span></span><span> </span><span>string</span><span class="main"><span>}</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> genuineN </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> quasi_genuineN </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> potentialN </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> noneN </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> unknownN </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> register_frac_type </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>string</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>theory</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> unregister_frac_type </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>theory</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> register_codatatype </span><span class="main"><span>:</span></span><span> </span><span>typ</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>typ</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>theory</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>theory</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> unregister_codatatype </span><span class="main"><span>:</span></span><span> </span><span>typ</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>theory</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> register_term_postprocessor </span><span class="main"><span>:</span></span><span>
    </span><span>typ</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>term_postprocessor</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>theory</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> unregister_term_postprocessor </span><span class="main"><span>:</span></span><span> </span><span>typ</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>theory</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> pick_nits_in_term </span><span class="main"><span>:</span></span><span>
    </span><span class="entity"><span>Proof.state</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>term</span><span> * </span><span>term</span><span class="main"><span>)</span></span><span> </span><span>list</span><span>
    </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> * </span><span>string</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> pick_nits_in_subgoal </span><span class="main"><span>:</span></span><span>
    </span><span class="entity"><span>Proof.state</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> * </span><span>string</span><span> </span><span>list</span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Nitpick</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>NITPICK</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Nitpick_Util</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Nitpick_HOL</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Nitpick_Preproc</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Nitpick_Mono</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Nitpick_Scope</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Nitpick_Peephole</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Nitpick_Rep</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Nitpick_Nut</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Nitpick_Kodkod</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Nitpick_Model</span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>KK</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Kodkod</span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Auto_Try</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Try</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Normal</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>TPTP</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_mode_nt</span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mode</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Normal</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>TPTP</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>cards_assigns</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>typ</span><span> </span><span>option</span><span> * </span><span>int</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   </span><span>maxes_assigns</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>typ</span><span class="main"><span>)</span></span><span> </span><span>option</span><span> * </span><span>int</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   </span><span>iters_assigns</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>typ</span><span class="main"><span>)</span></span><span> </span><span>option</span><span> * </span><span>int</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   </span><span>bitss</span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   </span><span>bisim_depths</span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   </span><span>boxes</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>typ</span><span> </span><span>option</span><span> * </span><span>bool</span><span> </span><span>option</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   </span><span>finitizes</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>typ</span><span> </span><span>option</span><span> * </span><span>bool</span><span> </span><span>option</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   </span><span>monos</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>typ</span><span> </span><span>option</span><span> * </span><span>bool</span><span> </span><span>option</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   </span><span>wfs</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>typ</span><span class="main"><span>)</span></span><span> </span><span>option</span><span> * </span><span>bool</span><span> </span><span>option</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   </span><span>sat_solver</span><span class="main"><span>:</span></span><span> </span><span>string</span><span class="main"><span>,</span></span><span>
   </span><span>falsify</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   </span><span>debug</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   </span><span>verbose</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   </span><span>overlord</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   </span><span>spy</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   </span><span>user_axioms</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
   </span><span>assms</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   </span><span>whacks</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   </span><span>merge_type_vars</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   </span><span>binary_ints</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
   </span><span>destroy_constrs</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   </span><span>specialize</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   </span><span>star_linear_preds</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   </span><span>total_consts</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
   </span><span>needs</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
   </span><span>peephole_optim</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   </span><span>datatype_sym_break</span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span>
   </span><span>kodkod_sym_break</span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span>
   </span><span>timeout</span><span class="main"><span>:</span></span><span> </span><span>Time.time</span><span class="main"><span>,</span></span><span>
   </span><span>tac_timeout</span><span class="main"><span>:</span></span><span> </span><span>Time.time</span><span class="main"><span>,</span></span><span>
   </span><span>max_threads</span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span>
   </span><span>show_types</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   </span><span>show_skolems</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   </span><span>show_consts</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   </span><span>evals</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   </span><span>formats</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>term</span><span> </span><span>option</span><span> * </span><span>int</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   </span><span>atomss</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>typ</span><span> </span><span>option</span><span> * </span><span>string</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   </span><span>max_potential</span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span>
   </span><span>max_genuine</span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span>
   </span><span>batch_size</span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span>
   </span><span>expect</span><span class="main"><span>:</span></span><span> </span><span>string</span><span class="main"><span>}</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>genuineN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"genuine"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>quasi_genuineN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"quasi_genuine"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>potentialN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"potential"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>noneN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"none"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unknownN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"unknown"</span></span><span>

</span><span class="comment1"><span>(* TODO: eliminate these historical aliases *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>register_frac_type</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Nitpick_HOL.register_frac_type_global</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unregister_frac_type</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Nitpick_HOL.unregister_frac_type_global</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>register_codatatype</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Nitpick_HOL.register_codatatype_global</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unregister_codatatype</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Nitpick_HOL.unregister_codatatype_global</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>register_term_postprocessor</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Nitpick_Model.register_term_postprocessor_global</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unregister_term_postprocessor</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Nitpick_Model.unregister_term_postprocessor_global</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>problem_extension</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>free_names</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   </span><span>sel_names</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   </span><span>nonsel_names</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   </span><span>rel_table</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span>NameTable.table</span><span class="main"><span>,</span></span><span>
   </span><span>unsound</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   </span><span>scope</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>scope</span></span><span class="main"><span>}</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>rich_problem</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>KK.problem</span></span><span> * </span><span class="entity"><span>problem_extension</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pretties_for_formulas</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>pretties_for_formulas</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>[</span></span><span>Pretty.str</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>plural_s_for_list</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>":"</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span>Pretty.indent</span><span> </span><span class="entity"><span>indent_size</span></span><span> </span><span class="main"><span>(</span></span><span>Pretty.chunks</span><span>
         </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                   </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>shorten_names_in_term</span></span><span>
                                   </span><span>|&gt;</span><span> </span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
               </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>ts</span></span><span> </span><span>downto</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>max_unsound_delay_ms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>200</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>max_unsound_delay_percent</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>unsound_delay_for_timeout</span></span><span> </span><span class="entity"><span>timeout</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Int.max</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span>Int.min</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>max_unsound_delay_ms</span></span><span class="main"><span>,</span></span><span>
                       </span><span>Time.toMilliseconds</span><span> </span><span class="entity"><span>timeout</span></span><span>
                       </span><span>*</span><span> </span><span class="entity"><span>max_unsound_delay_percent</span></span><span> </span><span>div</span><span> </span><span class="inner_numeral"><span>100</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>none_true</span></span><span> </span><span class="entity"><span>assigns</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>forall</span><span> </span><span class="main"><span>(</span></span><span>not_equal</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>assigns</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>has_lonely_bool_var</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const_</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>Pure.conjunction</span><span> </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> </span><span class="quoted"><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const_</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> </span><span class="quoted"><span>‹</span><span>Free</span><span> </span><span class="main"><span>_</span></span><span>›</span></span><span>›</span></span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>has_lonely_bool_var</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>syntactic_sorts</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">sort</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><span>{</span></span><a class="entity_ref" href="../../../../../HOL.html#HOL.default|class"><span>default</span></a><span class="main"><span>,</span></span><a class="entity_ref" href="../../../../../Groups.html#Groups.zero|class"><span>zero</span></a><span class="main"><span>,</span></span><a class="entity_ref" href="../../../../../Groups.html#Groups.one|class"><span>one</span></a><span class="main"><span>,</span></span><a class="entity_ref" href="../../../../../Groups.html#Groups.plus|class"><span>plus</span></a><span class="main"><span>,</span></span><a class="entity_ref" href="../../../../../Groups.html#Groups.minus|class"><span>minus</span></a><span class="main"><span>,</span></span><a class="entity_ref" href="../../../../../Groups.html#Groups.uminus|class"><span>uminus</span></a><span class="main"><span>,</span></span><a class="entity_ref" href="../../../../../Groups.html#Groups.times|class"><span>times</span></a><span class="main"><span>,</span></span><a class="entity_ref" href="../../../../../Fields.html#Fields.inverse|class"><span>inverse</span></a><span class="main"><span>,</span></span><a class="entity_ref" href="../../../../../Groups.html#Groups.abs|class"><span>abs</span></a><span class="main"><span>,</span></span><a class="entity_ref" href="../../../../../Groups.html#Groups.sgn|class"><span>sgn</span></a><span class="main"><span>,</span></span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord|class"><span>ord</span></a><span class="main"><span>,</span></span><a class="entity_ref" href="../../../../../HOL.html#HOL.equal|class"><span>equal</span></a><span class="main"><span>}</span></span><span>›</span></span></span><span> </span><span>@</span><span>
  </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">sort</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Num.html#Num.numeral|class"><span>numeral</span></a><span>›</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>has_tfree_syntactic_sort</span></span><span> </span><span class="main"><span>(</span></span><span>TFree</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>S</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span>subset</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>S</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>syntactic_sorts</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>has_tfree_syntactic_sort</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>has_syntactic_sorts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>exists_type</span><span> </span><span class="main"><span>(</span></span><span>exists_subtype</span><span> </span><span class="entity"><span>has_tfree_syntactic_sort</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>plazy</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Pretty.para</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pick_them_nits_in_term</span></span><span> </span><span class="entity"><span>deadline</span></span><span> </span><span class="entity"><span>state</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>step</span></span><span>
                           </span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>def_assm_ts</span></span><span> </span><span class="entity"><span>nondef_assm_ts</span></span><span> </span><span class="entity"><span>orig_t</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>time_start</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Time.now</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Proof.theory_of</span></span><span> </span><span class="entity"><span>state</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Proof.context_of</span></span><span> </span><span class="entity"><span>state</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>keywords</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thy_Header.get_keywords</span><span> </span><span class="entity"><span>thy</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>cards_assigns</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>maxes_assigns</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>iters_assigns</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bitss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bisim_depths</span></span><span class="main"><span>,</span></span><span>
         </span><span class="entity"><span>boxes</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>finitizes</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>monos</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wfs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sat_solver</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>falsify</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>debug</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>verbose</span></span><span class="main"><span>,</span></span><span>
         </span><span class="entity"><span>overlord</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>spy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>user_axioms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>assms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>whacks</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>merge_type_vars</span></span><span class="main"><span>,</span></span><span>
         </span><span class="entity"><span>binary_ints</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>destroy_constrs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>specialize</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>star_linear_preds</span></span><span class="main"><span>,</span></span><span>
         </span><span class="entity"><span>total_consts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>needs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>peephole_optim</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>datatype_sym_break</span></span><span class="main"><span>,</span></span><span>
         </span><span class="entity"><span>kodkod_sym_break</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tac_timeout</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_threads</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>show_types</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>show_skolems</span></span><span class="main"><span>,</span></span><span>
         </span><span class="entity"><span>show_consts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>evals</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>formats</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>atomss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_potential</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_genuine</span></span><span class="main"><span>,</span></span><span>
         </span><span class="entity"><span>batch_size</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>params</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>outcome</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Synchronized.var</span><span> </span><span class="inner_quoted"><span>"Nitpick.outcome"</span></span><span> </span><span class="main"><span>(</span></span><span>Queue.empty</span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span>Queue.T</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pprint</span></span><span> </span><span class="entity"><span>print</span></span><span> </span><span class="entity"><span>prt</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Auto_Try</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span>Synchronized.change</span><span> </span><span class="entity"><span>outcome</span></span><span> </span><span class="main"><span>(</span></span><span>Queue.enqueue</span><span> </span><span class="main"><span>(</span></span><span>Pretty.string_of</span><span> </span><span class="entity"><span>prt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="entity"><span>print</span></span><span> </span><span class="main"><span>(</span></span><span>Pretty.string_of</span><span> </span><span class="entity"><span>prt</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pprint_a</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>pprint</span></span><span> </span><span>writeln</span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pprint_nt</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>is_mode_nt</span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>pprint</span></span><span> </span><span>writeln</span><span> </span><span>o</span><span> </span><span class="entity"><span>f</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pprint_v</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>verbose</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>pprint</span></span><span> </span><span>writeln</span><span> </span><span>o</span><span> </span><span class="entity"><span>f</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pprint_d</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>debug</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>pprint</span></span><span> </span><span>tracing</span><span> </span><span>o</span><span> </span><span class="entity"><span>f</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>print</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>pprint</span></span><span> </span><span>writeln</span><span> </span><span>o</span><span> </span><span>Pretty.para</span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_t</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>TPTP</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>print</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>f</span></span><span>
</span><span class="comment1"><span>(*
    val print_g = pprint tracing o Pretty.str
*)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>print_nt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>pprint_nt</span></span><span> </span><span>o</span><span> </span><span>K</span><span> </span><span>o</span><span> </span><span class="entity"><span>plazy</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>print_v</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>pprint_v</span></span><span> </span><span>o</span><span> </span><span>K</span><span> </span><span>o</span><span> </span><span class="entity"><span>plazy</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>check_deadline</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Time.now</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Time.compare</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>deadline</span></span><span class="main"><span>)</span></span><span> </span><span>&lt;&gt;</span><span> </span><span>LESS</span><span>
        </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Timeout.TIMEOUT</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span>-</span><span> </span><span class="entity"><span>time_start</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>def_assm_ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nondef_assm_ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>assms</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span>&lt;&gt;</span><span> </span><span class="entity"><span>Normal</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>def_assm_ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nondef_assm_ts</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>step</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="entity"><span>print_nt</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"Nitpicking formula..."</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="entity"><span>pprint_nt</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Pretty.chunks</span><span> </span><span class="main"><span>(</span></span><span>
            </span><span class="entity"><span>pretties_for_formulas</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Nitpicking "</span></span><span> </span><span>^</span><span>
                </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>&lt;&gt;</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span>&lt;&gt;</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                   </span><span class="inner_quoted"><span>"subgoal "</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>i</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" of "</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>n</span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                   </span><span class="inner_quoted"><span>"goal"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nondef_assm_ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>orig_t</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>spying</span></span><span> </span><span class="entity"><span>spy</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>state</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"starting "</span></span><span> </span><span>^</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span class="entity"><span><span class="hidden">\&lt;^</span><span class="control">make_string</span><span class="hidden">&gt;</span></span></span></span></span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" mode"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_v</span></span><span> </span><span class="main"><span>(</span></span><span>prefix</span><span> </span><span class="inner_quoted"><span>"Timestamp: "</span></span><span> </span><span>o</span><span> </span><span>Date.fmt</span><span> </span><span class="inner_quoted"><span>"%H:%M:%S"</span></span><span>
                     </span><span>o</span><span> </span><span>Date.fromTimeLocal</span><span> </span><span>o</span><span> </span><span>Time.now</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>neg_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>falsify</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>orig_t</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">prop</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.False|const"><span>False</span></a><span>›</span></span></span><span class="main"><span>)</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>orig_t</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>conj_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>neg_t</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>def_assm_ts</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>nondef_assm_ts</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>evals</span></span><span> </span><span>@</span><span> </span><span>these</span><span> </span><span class="entity"><span>needs</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tfree_table</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>merge_type_vars</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>merged_type_var_table_for_terms</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>conj_ts</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>merge_tfrees</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>merge_type_vars_in_term</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>merge_type_vars</span></span><span> </span><span class="entity"><span>tfree_table</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>neg_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>neg_t</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>merge_tfrees</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>def_assm_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>def_assm_ts</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="entity"><span>merge_tfrees</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nondef_assm_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nondef_assm_ts</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="entity"><span>merge_tfrees</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>evals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>evals</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="entity"><span>merge_tfrees</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>needs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>needs</span></span><span> </span><span>|&gt;</span><span> </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>merge_tfrees</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>conj_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>neg_t</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>def_assm_ts</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>nondef_assm_ts</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>evals</span></span><span> </span><span>@</span><span> </span><span>these</span><span> </span><span class="entity"><span>needs</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>original_max_potential</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>max_potential</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>original_max_genuine</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>max_genuine</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>max_bisim_depth</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span>Integer.max</span><span> </span><span class="entity"><span>bisim_depths</span></span><span> </span><span class="inner_numeral"><span>~1</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>case_names</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>case_const_names</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>defs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>def_assm_ts</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>all_defs_of</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>subst</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nondefs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>all_nondefs_of</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>subst</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>def_tables</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>const_def_tables</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>defs</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nondef_table</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>const_nondef_table</span></span><span> </span><span class="entity"><span>nondefs</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>simp_table</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Unsynchronized.ref</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const_simp_table</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>subst</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>psimp_table</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>const_psimp_table</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>subst</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>choice_spec_table</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>const_choice_spec_table</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>subst</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nondefs</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>nondefs</span></span><span> </span><span>|&gt;</span><span> </span><span>filter_out</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_choice_spec_axiom</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>choice_spec_table</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>intro_table</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>inductive_intro_table</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>def_tables</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ground_thm_table</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ground_theorem_table</span></span><span> </span><span class="entity"><span>thy</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ersatz_table</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ersatz_table</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>hol_ctxt</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>wf_cache</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>{</span></span><span>thy</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thy</span></span><span class="main"><span>,</span></span><span> </span><span>ctxt</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>max_bisim_depth</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>max_bisim_depth</span></span><span class="main"><span>,</span></span><span> </span><span>boxes</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>boxes</span></span><span class="main"><span>,</span></span><span>
       </span><span>wfs</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>wfs</span></span><span class="main"><span>,</span></span><span> </span><span>user_axioms</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>user_axioms</span></span><span class="main"><span>,</span></span><span> </span><span>debug</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>debug</span></span><span class="main"><span>,</span></span><span> </span><span>whacks</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>whacks</span></span><span class="main"><span>,</span></span><span>
       </span><span>binary_ints</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>binary_ints</span></span><span class="main"><span>,</span></span><span> </span><span>destroy_constrs</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>destroy_constrs</span></span><span class="main"><span>,</span></span><span>
       </span><span>specialize</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>specialize</span></span><span class="main"><span>,</span></span><span> </span><span>star_linear_preds</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>star_linear_preds</span></span><span class="main"><span>,</span></span><span>
       </span><span>total_consts</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>total_consts</span></span><span class="main"><span>,</span></span><span> </span><span>needs</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>needs</span></span><span class="main"><span>,</span></span><span> </span><span>tac_timeout</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tac_timeout</span></span><span class="main"><span>,</span></span><span>
       </span><span>evals</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>evals</span></span><span class="main"><span>,</span></span><span> </span><span>case_names</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>case_names</span></span><span class="main"><span>,</span></span><span> </span><span>def_tables</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>def_tables</span></span><span class="main"><span>,</span></span><span>
       </span><span>nondef_table</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nondef_table</span></span><span class="main"><span>,</span></span><span> </span><span>nondefs</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nondefs</span></span><span class="main"><span>,</span></span><span> </span><span>simp_table</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>simp_table</span></span><span class="main"><span>,</span></span><span>
       </span><span>psimp_table</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>psimp_table</span></span><span class="main"><span>,</span></span><span> </span><span>choice_spec_table</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>choice_spec_table</span></span><span class="main"><span>,</span></span><span>
       </span><span>intro_table</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>intro_table</span></span><span class="main"><span>,</span></span><span> </span><span>ground_thm_table</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ground_thm_table</span></span><span class="main"><span>,</span></span><span>
       </span><span>ersatz_table</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ersatz_table</span></span><span class="main"><span>,</span></span><span> </span><span>skolems</span><span> </span><span class="main"><span>=</span></span><span> </span><span>Unsynchronized.ref</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
       </span><span>special_funs</span><span> </span><span class="main"><span>=</span></span><span> </span><span>Unsynchronized.ref</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
       </span><span>unrolled_preds</span><span> </span><span class="main"><span>=</span></span><span> </span><span>Unsynchronized.ref</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>wf_cache</span><span> </span><span class="main"><span>=</span></span><span> </span><span>Unsynchronized.ref</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
       </span><span>constr_cache</span><span> </span><span class="main"><span>=</span></span><span> </span><span>Unsynchronized.ref</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>}</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pseudo_frees</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>real_frees</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span>Term.add_frees</span><span> </span><span class="entity"><span>conj_ts</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>null</span><span> </span><span class="main"><span>(</span></span><span>fold</span><span> </span><span>Term.add_tvars</span><span> </span><span class="entity"><span>conj_ts</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span>
            </span><span>error</span><span> </span><span class="inner_quoted"><span>"Nitpick cannot handle goals with schematic type variables"</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nondef_ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>def_ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>need_ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>got_all_mono_user_axioms</span></span><span class="main"><span>,</span></span><span>
         </span><span class="entity"><span>no_poly_user_axioms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>binarize</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>preprocess_formulas</span></span><span> </span><span class="entity"><span>hol_ctxt</span></span><span> </span><span class="entity"><span>nondef_assm_ts</span></span><span> </span><span class="entity"><span>neg_t</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>got_all_user_axioms</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>got_all_mono_user_axioms</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>no_poly_user_axioms</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_wf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>gfp</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wf</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>pprint_nt</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Pretty.blk</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span>
          </span><span>Pretty.text</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"The "</span></span><span> </span><span>^</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>gfp</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"co"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"inductive predicate"</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span>
          </span><span class="main"><span>[</span></span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.quote</span><span> </span><span class="main"><span>(</span></span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span>
          </span><span>Pretty.text</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>wf</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                   </span><span class="inner_quoted"><span>"was proved well-founded; Nitpick can compute it \
                   \efficiently"</span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                   </span><span class="inner_quoted"><span>"could not be proved well-founded; Nitpick might need to \
                   \unroll it"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>verbose</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>List.app</span><span> </span><span class="entity"><span>print_wf</span></span><span> </span><span class="main"><span>(</span></span><span>!</span><span class="entity"><span>wf_cache</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>das_wort_formula</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>falsify</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"Negated conjecture"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>"Formula"</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>pprint_d</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Pretty.chunks</span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>pretties_for_formulas</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>das_wort_formula</span></span><span> </span><span class="main"><span>[</span></span><span>hd</span><span> </span><span class="entity"><span>nondef_ts</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span>
           </span><span class="entity"><span>pretties_for_formulas</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="inner_quoted"><span>"Relevant definitional axiom"</span></span><span> </span><span class="entity"><span>def_ts</span></span><span> </span><span>@</span><span>
           </span><span class="entity"><span>pretties_for_formulas</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="inner_quoted"><span>"Relevant nondefinitional axiom"</span></span><span>
                                 </span><span class="main"><span>(</span></span><span>tl</span><span> </span><span class="entity"><span>nondef_ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>List.app</span><span> </span><span class="main"><span>(</span></span><span>ignore</span><span> </span><span>o</span><span> </span><span>Term.type_of</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nondef_ts</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>def_ts</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>TYPE</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                   </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>TYPE</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Nitpick.pick_them_nits_in_term"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nondef_us</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nondef_ts</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nut_from_term</span></span><span> </span><span class="entity"><span>hol_ctxt</span></span><span> </span><span class="entity"><span>Eq</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>def_us</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>def_ts</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nut_from_term</span></span><span> </span><span class="entity"><span>hol_ctxt</span></span><span> </span><span class="entity"><span>DefEq</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>need_us</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>need_ts</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nut_from_term</span></span><span> </span><span class="entity"><span>hol_ctxt</span></span><span> </span><span class="entity"><span>Eq</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>free_names</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>const_names</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>fold</span><span> </span><span class="entity"><span>add_free_and_const_names</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nondef_us</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>def_us</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>need_us</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sel_names</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nonsel_names</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>List.partition</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_sel</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>nickname_of</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>const_names</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sound_finitizes</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>none_true</span></span><span> </span><span class="entity"><span>finitizes</span></span><span>
</span><span class="comment1"><span>(*
    val _ =
      List.app (print_g o string_for_nut ctxt) (nondef_us @ def_us @ need_us)
*)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unique_scope</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>forall</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>o</span><span> </span><span>length</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>cards_assigns</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>monotonicity_message</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>extra</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pretties</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pretty_maybe_quote</span></span><span> </span><span class="entity"><span>keywords</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>pretty_for_type</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Pretty.blk</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span>
          </span><span>Pretty.text</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"The type"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>plural_s_for_list</span></span><span> </span><span class="entity"><span>pretties</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span>
          </span><span class="entity"><span>pretty_serial_commas</span></span><span> </span><span class="inner_quoted"><span>"and"</span></span><span> </span><span class="entity"><span>pretties</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span>
          </span><span>Pretty.text</span><span> </span><span class="main"><span>(</span></span><span>
                 </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>none_true</span></span><span> </span><span class="entity"><span>monos</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                    </span><span class="inner_quoted"><span>"passed the monotonicity test"</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>length</span><span> </span><span class="entity"><span>pretties</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"is"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>"are"</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
                    </span><span class="inner_quoted"><span>" considered monotonic"</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
                 </span><span class="inner_quoted"><span>"; "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>extra</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_type_fundamentally_monotonic</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>is_data_type</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_quot_type</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
       </span><span class="main"><span>(</span></span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_pure_typedef</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>is_univ_typedef</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span>
      </span><span class="entity"><span>is_number_type</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>is_bit_type</span></span><span> </span><span class="entity"><span>T</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_type_actually_monotonic</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Timeout.apply</span><span> </span><span class="entity"><span>tac_timeout</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>formulas_monotonic</span></span><span> </span><span class="entity"><span>hol_ctxt</span></span><span> </span><span class="entity"><span>binarize</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span>
                          </span><span class="main"><span>(</span></span><span class="entity"><span>nondef_ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>def_ts</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>Timeout.TIMEOUT</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_type_kind_of_monotonic</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>triple_lookup</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>type_match</span></span><span> </span><span class="entity"><span>thy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>monos</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>is_type_actually_monotonic</span></span><span> </span><span class="entity"><span>T</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_type_monotonic</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>unique_scope</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>triple_lookup</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>type_match</span></span><span> </span><span class="entity"><span>thy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>monos</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>b</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>is_type_fundamentally_monotonic</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span>
             </span><span class="entity"><span>is_type_actually_monotonic</span></span><span> </span><span class="entity"><span>T</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_deep_data_type_finitizable</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>triple_lookup</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>type_match</span></span><span> </span><span class="entity"><span>thy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>finitizes</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>true</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_shallow_data_type_finitizable</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Nitpick.html#Nitpick.fun_box|type"><span>fun_box</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>is_type_kind_of_monotonic</span></span><span> </span><span class="entity"><span>T</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_shallow_data_type_finitizable</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>triple_lookup</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>type_match</span></span><span> </span><span class="entity"><span>thy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>finitizes</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>b</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>is_type_kind_of_monotonic</span></span><span> </span><span class="entity"><span>T</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_data_type_deep</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.unit|type"><span>unit</span></a><span>›</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nat_T</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>is_word_type</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span>
      </span><span>exists</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>o</span><span> </span><span>domain_type</span><span> </span><span>o</span><span> </span><span class="entity"><span>type_of</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sel_names</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>all_Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ground_types_in_terms</span></span><span> </span><span class="entity"><span>hol_ctxt</span></span><span> </span><span class="entity"><span>binarize</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nondef_ts</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>def_ts</span></span><span class="main"><span>)</span></span><span>
                 </span><span>|&gt;</span><span> </span><span>sort</span><span> </span><span>Term_Ord.typ_ord</span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>verbose</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>binary_ints</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span>true</span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
         </span><span>exists</span><span> </span><span class="main"><span>(</span></span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>nat_T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>int_T</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>all_Ts</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="entity"><span>print_v</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="inner_quoted"><span>"The option \"binary_ints\" will be ignored because of the \
                   \presence of rationals, reals, \"Suc\", \"gcd\", or \"lcm\" \
                   \in the problem"</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mono_Ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nonmono_Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>List.partition</span><span> </span><span class="entity"><span>is_type_monotonic</span></span><span> </span><span class="entity"><span>all_Ts</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>verbose</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>not</span><span> </span><span class="entity"><span>unique_scope</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>filter_out</span><span> </span><span class="entity"><span>is_type_fundamentally_monotonic</span></span><span> </span><span class="entity"><span>mono_Ts</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>interesting_mono_Ts</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>pprint_v</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>monotonicity_message</span></span><span> </span><span class="entity"><span>interesting_mono_Ts</span></span><span>
                          </span><span class="inner_quoted"><span>"Nitpick might be able to skip some scopes"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deep_dataTs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>shallow_dataTs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>all_Ts</span></span><span> </span><span>|&gt;</span><span> </span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_data_type</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
             </span><span>|&gt;</span><span> </span><span>List.partition</span><span> </span><span class="entity"><span>is_data_type_deep</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>finitizable_dataTs</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>deep_dataTs</span></span><span> </span><span>|&gt;</span><span> </span><span>filter_out</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_finite_type</span></span><span> </span><span class="entity"><span>hol_ctxt</span></span><span class="main"><span>)</span></span><span>
                   </span><span>|&gt;</span><span> </span><span>filter</span><span> </span><span class="entity"><span>is_deep_data_type_finitizable</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>shallow_dataTs</span></span><span> </span><span>|&gt;</span><span> </span><span>filter_out</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_finite_type</span></span><span> </span><span class="entity"><span>hol_ctxt</span></span><span class="main"><span>)</span></span><span>
                      </span><span>|&gt;</span><span> </span><span>filter</span><span> </span><span class="entity"><span>is_shallow_data_type_finitizable</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>verbose</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span>null</span><span> </span><span class="entity"><span>finitizable_dataTs</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="entity"><span>pprint_v</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>monotonicity_message</span></span><span> </span><span class="entity"><span>finitizable_dataTs</span></span><span>
                         </span><span class="inner_quoted"><span>"Nitpick can use a more precise finite encoding"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
</span><span class="comment1"><span>(*
    val _ = print_g "Monotonic types:"
    val _ = List.app (print_g o string_for_type ctxt) mono_Ts
    val _ = print_g "Nonmonotonic types:"
    val _ = List.app (print_g o string_for_type ctxt) nonmono_Ts
*)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>incremental</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Int.max</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>max_potential</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_genuine</span></span><span class="main"><span>)</span></span><span> </span><span>&gt;=</span><span> </span><span class="inner_numeral"><span>2</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>actual_sat_solver</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>sat_solver</span></span><span> </span><span>&lt;&gt;</span><span> </span><span class="inner_quoted"><span>"smart"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>incremental</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
           </span><span>not</span><span> </span><span class="main"><span>(</span></span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Kodkod_SAT.configured_sat_solvers</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span>
                       </span><span class="entity"><span>sat_solver</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>print_nt</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"An incremental SAT solver is required: \"SAT4J\" will \
                        \be used instead of "</span></span><span> </span><span>^</span><span> </span><span>quote</span><span> </span><span class="entity"><span>sat_solver</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
           </span><span class="inner_quoted"><span>"SAT4J"</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
          </span><span class="entity"><span>sat_solver</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="entity"><span>Kodkod_SAT.smart_sat_solver_name</span></span><span> </span><span class="entity"><span>incremental</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>sat_solver</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"smart"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="entity"><span>print_v</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="inner_quoted"><span>"Using SAT solver "</span></span><span> </span><span>^</span><span> </span><span>quote</span><span> </span><span class="entity"><span>actual_sat_solver</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"\nThe following"</span></span><span> </span><span>^</span><span>
            </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>incremental</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>" incremental "</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>" "</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
            </span><span class="inner_quoted"><span>"solvers are configured: "</span></span><span> </span><span>^</span><span>
            </span><span>commas_quote</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Kodkod_SAT.configured_sat_solvers</span></span><span> </span><span class="entity"><span>incremental</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>too_big_scopes</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Unsynchronized.ref</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>problem_for_scope</span></span><span> </span><span class="entity"><span>unsound</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>scope</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>card_assigns</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bits</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bisim_depth</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>data_types</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ofs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span>exists</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>other</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>scope_less_eq</span></span><span> </span><span class="entity"><span>other</span></span><span> </span><span class="entity"><span>scope</span></span><span class="main"><span>)</span></span><span>
                            </span><span class="main"><span>(</span></span><span>!</span><span class="entity"><span>too_big_scopes</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span>
                </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>TOO_LARGE</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Nitpick.pick_them_nits_in_term.\
                                 \problem_for_scope"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"too large scope"</span></span><span class="main"><span>)</span></span><span>
</span><span class="comment1"><span>(*
        val _ = print_g "Offsets:"
        val _ = List.app (fn (T, j0) =&gt;
                             print_g (string_for_type ctxt T ^ " = " ^
                                    string_of_int j0))
                         (Typtab.dest ofs)
*)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>effective_total_consts</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>total_consts</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span>SOME</span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>b</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>forall</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_exact_type</span></span><span> </span><span class="entity"><span>data_types</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>all_Ts</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>main_j0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>offset_of_type</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="entity"><span>bool_T</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nat_card</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nat_j0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>spec_of_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>nat_T</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>int_card</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>int_j0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>spec_of_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>int_T</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nat_j0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>main_j0</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>int_j0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>main_j0</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span>
                </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>BAD</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Nitpick.pick_them_nits_in_term.problem_for_scope"</span></span><span class="main"><span>,</span></span><span>
                           </span><span class="inner_quoted"><span>"bad offsets"</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>kk</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>kodkod_constrs</span></span><span> </span><span class="entity"><span>peephole_optim</span></span><span> </span><span class="entity"><span>nat_card</span></span><span> </span><span class="entity"><span>int_card</span></span><span> </span><span class="entity"><span>main_j0</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>free_names</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rep_table</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>choose_reps_for_free_vars</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>pseudo_frees</span></span><span> </span><span class="entity"><span>free_names</span></span><span>
                                    </span><span>NameTable.empty</span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sel_names</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rep_table</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>choose_reps_for_all_sels</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>rep_table</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nonsel_names</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rep_table</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>choose_reps_for_consts</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>effective_total_consts</span></span><span> </span><span class="entity"><span>nonsel_names</span></span><span>
                                 </span><span class="entity"><span>rep_table</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>guiltiest_party</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>min_highest_arity</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>NameTable.fold</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                             </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>n'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>arity_of_rep</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                               </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n'</span></span><span> </span><span>&gt;</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nickname_of</span></span><span> </span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>n'</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span>
                             </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rep_table</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>min_univ_card</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>NameTable.fold</span><span> </span><span class="main"><span>(</span></span><span>Integer.max</span><span> </span><span>o</span><span> </span><span class="entity"><span>min_univ_card_of_rep</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rep_table</span></span><span>
                         </span><span class="main"><span>(</span></span><span class="entity"><span>univ_card</span></span><span> </span><span class="entity"><span>nat_card</span></span><span> </span><span class="entity"><span>int_card</span></span><span> </span><span class="entity"><span>main_j0</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>KK.True</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>check_arity</span></span><span> </span><span class="entity"><span>guiltiest_party</span></span><span> </span><span class="entity"><span>min_univ_card</span></span><span> </span><span class="entity"><span>min_highest_arity</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>def_us</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>def_us</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>choose_reps_in_nut</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>unsound</span></span><span> </span><span class="entity"><span>rep_table</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nondef_us</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>nondef_us</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>choose_reps_in_nut</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>unsound</span></span><span> </span><span class="entity"><span>rep_table</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>need_us</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>need_us</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>choose_reps_in_nut</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>unsound</span></span><span> </span><span class="entity"><span>rep_table</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span>
</span><span class="comment1"><span>(*
        val _ = List.app (print_g o string_for_nut ctxt)
                         (free_names @ sel_names @ nonsel_names @
                          nondef_us @ def_us @ need_us)
*)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>free_rels</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pool</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_table</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>rename_free_vars</span></span><span> </span><span class="entity"><span>free_names</span></span><span> </span><span class="entity"><span>initial_pool</span></span><span> </span><span>NameTable.empty</span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sel_rels</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pool</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_table</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>rename_free_vars</span></span><span> </span><span class="entity"><span>sel_names</span></span><span> </span><span class="entity"><span>pool</span></span><span> </span><span class="entity"><span>rel_table</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>other_rels</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pool</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_table</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>rename_free_vars</span></span><span> </span><span class="entity"><span>nonsel_names</span></span><span> </span><span class="entity"><span>pool</span></span><span> </span><span class="entity"><span>rel_table</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nondef_us</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nondef_us</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_vars_in_nut</span></span><span> </span><span class="entity"><span>pool</span></span><span> </span><span class="entity"><span>rel_table</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>def_us</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>def_us</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_vars_in_nut</span></span><span> </span><span class="entity"><span>pool</span></span><span> </span><span class="entity"><span>rel_table</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>need_us</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>need_us</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_vars_in_nut</span></span><span> </span><span class="entity"><span>pool</span></span><span> </span><span class="entity"><span>rel_table</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nondef_fs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>kodkod_formula_from_nut</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>nondef_us</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>def_fs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>kodkod_formula_from_nut</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>def_us</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>formula</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>fold</span><span> </span><span class="entity"><span>s_and</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>def_fs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nondef_fs</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>KK.True</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>comment</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>unsound</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"unsound"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>"sound"</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"\n"</span></span><span> </span><span>^</span><span>
                      </span><span class="entity"><span>multiline_string_for_scope</span></span><span> </span><span class="entity"><span>scope</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>kodkod_sat_solver</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>Kodkod_SAT.sat_solver_spec</span></span><span> </span><span class="entity"><span>actual_sat_solver</span></span><span> </span><span>|&gt;</span><span> </span><span>snd</span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bit_width</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>bits</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_numeral"><span>16</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>bits</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>delay</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>unsound</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="entity"><span>unsound_delay_for_timeout</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deadline</span></span><span> </span><span>-</span><span> </span><span>Time.now</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
            </span><span class="inner_numeral"><span>0</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>settings</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"solver"</span></span><span class="main"><span>,</span></span><span> </span><span>commas_quote</span><span> </span><span class="entity"><span>kodkod_sat_solver</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"bit_width"</span></span><span class="main"><span>,</span></span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>bit_width</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"symmetry_breaking"</span></span><span class="main"><span>,</span></span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>kodkod_sym_break</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"sharing"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"3"</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"flatten"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"false"</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"delay"</span></span><span class="main"><span>,</span></span><span> </span><span>signed_string_of_int</span><span> </span><span class="entity"><span>delay</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>plain_rels</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>free_rels</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>other_rels</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>plain_bounds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bound_for_plain_rel</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>debug</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>plain_rels</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>plain_axioms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>declarative_axiom_for_plain_rel</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>plain_rels</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>need_vals</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>dtype</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>typ</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="entity"><span>typ</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>needed_values_for_data_type</span></span><span> </span><span class="entity"><span>need_us</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="entity"><span>dtype</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="entity"><span>data_types</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sel_bounds</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bound_for_sel_rel</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>debug</span></span><span> </span><span class="entity"><span>need_vals</span></span><span> </span><span class="entity"><span>data_types</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sel_rels</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dtype_axioms</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>declarative_axioms_for_data_types</span></span><span> </span><span class="entity"><span>hol_ctxt</span></span><span> </span><span class="entity"><span>binarize</span></span><span> </span><span class="entity"><span>need_us</span></span><span> </span><span class="entity"><span>need_vals</span></span><span>
              </span><span class="entity"><span>datatype_sym_break</span></span><span> </span><span class="entity"><span>bits</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="entity"><span>kk</span></span><span> </span><span class="entity"><span>rel_table</span></span><span> </span><span class="entity"><span>data_types</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>declarative_axioms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>plain_axioms</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>dtype_axioms</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>univ_card</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Int.max</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>univ_card</span></span><span> </span><span class="entity"><span>nat_card</span></span><span> </span><span class="entity"><span>int_card</span></span><span> </span><span class="entity"><span>main_j0</span></span><span>
                                     </span><span class="main"><span>(</span></span><span class="entity"><span>plain_bounds</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>sel_bounds</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>formula</span></span><span class="main"><span>,</span></span><span>
                                 </span><span class="entity"><span>main_j0</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>bits</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span>?</span><span> </span><span>Integer.add</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bits</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>built_in_bounds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>built_in_axioms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>bounds_and_axioms_for_built_in_rels_in_formulas</span></span><span> </span><span class="entity"><span>debug</span></span><span> </span><span class="entity"><span>univ_card</span></span><span>
              </span><span class="entity"><span>nat_card</span></span><span> </span><span class="entity"><span>int_card</span></span><span> </span><span class="entity"><span>main_j0</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>formula</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>declarative_axioms</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bounds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>built_in_bounds</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>plain_bounds</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>sel_bounds</span></span><span>
                     </span><span>|&gt;</span><span> </span><span>not</span><span> </span><span class="entity"><span>debug</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>merge_bounds</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>axioms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>built_in_axioms</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>declarative_axioms</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>highest_arity</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>fold</span><span> </span><span>Integer.max</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span>fst</span><span> </span><span class="entity"><span>bounds</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>formula</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span class="entity"><span>s_and</span></span><span> </span><span class="entity"><span>axioms</span></span><span> </span><span class="entity"><span>formula</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>bits</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>check_bits</span></span><span> </span><span class="entity"><span>bits</span></span><span> </span><span class="entity"><span>formula</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>formula</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>KK.False</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>check_arity</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="entity"><span>univ_card</span></span><span> </span><span class="entity"><span>highest_arity</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span>comment</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>comment</span></span><span class="main"><span>,</span></span><span> </span><span>settings</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>settings</span></span><span class="main"><span>,</span></span><span> </span><span>univ_card</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>univ_card</span></span><span class="main"><span>,</span></span><span>
               </span><span>tuple_assigns</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>bounds</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bounds</span></span><span class="main"><span>,</span></span><span>
               </span><span>int_bounds</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>bits</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>sequential_int_bounds</span></span><span> </span><span class="entity"><span>univ_card</span></span><span>
                            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>pow_of_two_int_bounds</span></span><span> </span><span class="entity"><span>bits</span></span><span> </span><span class="entity"><span>main_j0</span></span><span class="main"><span>,</span></span><span>
               </span><span>expr_assigns</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>formula</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>formula</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span>
              </span><span class="main"><span>{</span></span><span>free_names</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>free_names</span></span><span class="main"><span>,</span></span><span> </span><span>sel_names</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sel_names</span></span><span class="main"><span>,</span></span><span>
               </span><span>nonsel_names</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nonsel_names</span></span><span class="main"><span>,</span></span><span> </span><span>rel_table</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_table</span></span><span class="main"><span>,</span></span><span>
               </span><span>unsound</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>unsound</span></span><span class="main"><span>,</span></span><span> </span><span>scope</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>scope</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span class="entity"><span>TOO_LARGE</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>loc</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>msg</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>loc</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Nitpick_Kodkod.check_arity"</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
                </span><span>not</span><span> </span><span class="main"><span>(</span></span><span>Typtab.is_empty</span><span> </span><span class="entity"><span>ofs</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
               </span><span class="entity"><span>problem_for_scope</span></span><span> </span><span class="entity"><span>unsound</span></span><span>
                   </span><span class="main"><span>{</span></span><span>hol_ctxt</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>hol_ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>binarize</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>binarize</span></span><span class="main"><span>,</span></span><span>
                    </span><span>card_assigns</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>card_assigns</span></span><span class="main"><span>,</span></span><span> </span><span>bits</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bits</span></span><span class="main"><span>,</span></span><span>
                    </span><span>bisim_depth</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bisim_depth</span></span><span class="main"><span>,</span></span><span> </span><span>data_types</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>data_types</span></span><span class="main"><span>,</span></span><span>
                    </span><span>ofs</span><span> </span><span class="main"><span>=</span></span><span> </span><span>Typtab.empty</span><span class="main"><span>}</span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>loc</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Nitpick.pick_them_nits_in_term.\
                           \problem_for_scope"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
               </span><span>NONE</span><span>
             </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
               </span><span class="main"><span>(</span></span><span>Unsynchronized.change</span><span> </span><span class="entity"><span>too_big_scopes</span></span><span> </span><span class="main"><span>(</span></span><span>cons</span><span> </span><span class="entity"><span>scope</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="entity"><span>print_v</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                    </span><span class="inner_quoted"><span>"Limit reached: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>msg</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"; skipping "</span></span><span> </span><span>^</span><span>
                    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>unsound</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"potential component of "</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
                    </span><span class="inner_quoted"><span>"scope"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span>NONE</span><span class="main"><span>)</span></span><span>
           </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>TOO_SMALL</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>msg</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
             </span><span class="main"><span>(</span></span><span class="entity"><span>print_v</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span class="inner_quoted"><span>"Limit reached: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>msg</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"; skipping "</span></span><span> </span><span>^</span><span>
                  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>unsound</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"potential component of "</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
                  </span><span class="inner_quoted"><span>"scope"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span>NONE</span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>das_wort_model</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>falsify</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"counterexample"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>"model"</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>scopes</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Unsynchronized.ref</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>generated_scopes</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Unsynchronized.ref</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>generated_problems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Unsynchronized.ref</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>rich_problem</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>checked_problems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Unsynchronized.ref</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>met_potential</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Unsynchronized.ref</span><span> </span><span class="inner_numeral"><span>0</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>update_checked_problems</span></span><span> </span><span class="entity"><span>problems</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>List.app</span><span> </span><span class="main"><span>(</span></span><span>Unsynchronized.change</span><span> </span><span class="entity"><span>checked_problems</span></span><span> </span><span>o</span><span> </span><span>Option.map</span><span> </span><span>o</span><span> </span><span>cons</span><span>
                </span><span>o</span><span> </span><span>nth</span><span> </span><span class="entity"><span>problems</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>show_kodkod_warning</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>show_kodkod_warning</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_nt</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"Kodkod warning: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_and_check_model</span></span><span> </span><span class="entity"><span>genuine</span></span><span> </span><span class="entity"><span>bounds</span></span><span>
            </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="entity"><span>free_names</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sel_names</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nonsel_names</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_table</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>scope</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span>
             </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>problem_extension</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>print_t</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
               </span><span class="inner_quoted"><span>"% SZS status "</span></span><span> </span><span>^</span><span>
               </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>genuine</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>falsify</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"CounterSatisfiable"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>"Satisfiable"</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                  </span><span class="inner_quoted"><span>"GaveUp"</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"\n"</span></span><span> </span><span>^</span><span>
               </span><span class="inner_quoted"><span>"% SZS output start FiniteModel"</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>reconstructed_model</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>codatatypes_ok</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>reconstruct_hol_model</span></span><span>
              </span><span class="main"><span>{</span></span><span>show_types</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>show_types</span></span><span class="main"><span>,</span></span><span> </span><span>show_skolems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>show_skolems</span></span><span class="main"><span>,</span></span><span>
               </span><span>show_consts</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>show_consts</span></span><span class="main"><span>}</span></span><span>
              </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>formats</span></span><span> </span><span class="entity"><span>atomss</span></span><span> </span><span class="entity"><span>real_frees</span></span><span> </span><span class="entity"><span>pseudo_frees</span></span><span> </span><span class="entity"><span>free_names</span></span><span> </span><span class="entity"><span>sel_names</span></span><span>
              </span><span class="entity"><span>nonsel_names</span></span><span> </span><span class="entity"><span>rel_table</span></span><span> </span><span class="entity"><span>bounds</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>genuine_means_genuine</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>got_all_user_axioms</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>none_true</span></span><span> </span><span class="entity"><span>wfs</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
          </span><span class="entity"><span>sound_finitizes</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>total_consts</span></span><span> </span><span>&lt;&gt;</span><span> </span><span>SOME</span><span> </span><span>true</span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
          </span><span class="entity"><span>codatatypes_ok</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>assms_prop</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>Logic.mk_conjunction_list</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>neg_t</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>def_assm_ts</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>nondef_assm_ts</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>pprint_a</span></span><span> </span><span class="main"><span>(</span></span><span>Pretty.chunks</span><span>
             </span><span class="main"><span>[</span></span><span>Pretty.blk</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="main"><span>(</span></span><span>Pretty.text</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Auto_Try</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"Auto "</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
                          </span><span class="inner_quoted"><span>"Nitpick found a"</span></span><span> </span><span>^</span><span>
                          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>not</span><span> </span><span class="entity"><span>genuine</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>" potentially spurious "</span></span><span>
                           </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>genuine_means_genuine</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>" "</span></span><span>
                           </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>" quasi genuine "</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>das_wort_model</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span>
                   </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>pretties_for_scope</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>verbose</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                      </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
                    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>pretties</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>"for"</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pretties</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span>
                   </span><span class="main"><span>[</span></span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>":"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>Pretty.indent</span><span> </span><span class="entity"><span>indent_size</span></span><span> </span><span class="entity"><span>reconstructed_model</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
         </span><span class="entity"><span>print_t</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="inner_quoted"><span>"% SZS output end FiniteModel"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>genuine</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
           </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>has_lonely_bool_var</span></span><span> </span><span class="entity"><span>orig_t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
              </span><span class="entity"><span>print</span></span><span> </span><span class="inner_quoted"><span>"Hint: Maybe you forgot a colon after the lemma's name?"</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>has_syntactic_sorts</span></span><span> </span><span class="entity"><span>orig_t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
              </span><span class="entity"><span>print</span></span><span> </span><span class="inner_quoted"><span>"Hint: Maybe you forgot a type constraint?"</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
              </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>not</span><span> </span><span class="entity"><span>genuine_means_genuine</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>no_poly_user_axioms</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>options</span></span><span> </span><span class="main"><span>=</span></span><span>
                    </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span>|&gt;</span><span> </span><span>not</span><span> </span><span class="entity"><span>got_all_mono_user_axioms</span></span><span>
                          </span><span>?</span><span> </span><span>cons</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"user_axioms"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"\"true\""</span></span><span class="main"><span>)</span></span><span>
                       </span><span>|&gt;</span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>none_true</span></span><span> </span><span class="entity"><span>wfs</span></span><span class="main"><span>)</span></span><span>
                          </span><span>?</span><span> </span><span>cons</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"wf"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"\"smart\" or \"false\""</span></span><span class="main"><span>)</span></span><span>
                       </span><span>|&gt;</span><span> </span><span>not</span><span> </span><span class="entity"><span>sound_finitizes</span></span><span>
                          </span><span>?</span><span> </span><span>cons</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"finitize"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"\"smart\" or \"false\""</span></span><span class="main"><span>)</span></span><span>
                       </span><span>|&gt;</span><span> </span><span class="entity"><span>total_consts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span>true</span><span>
                          </span><span>?</span><span> </span><span>cons</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"total_consts"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"\"smart\" or \"false\""</span></span><span class="main"><span>)</span></span><span>
                       </span><span>|&gt;</span><span> </span><span>not</span><span> </span><span class="entity"><span>codatatypes_ok</span></span><span>
                          </span><span>?</span><span> </span><span>cons</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"bisim_depth"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"a nonnegative value"</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="main"><span>=</span></span><span>
                    </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>value</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>quote</span><span> </span><span class="entity"><span>name</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" set to "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>value</span></span><span class="main"><span>)</span></span><span>
                        </span><span class="entity"><span>options</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                  </span><span class="entity"><span>print</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Try again with "</span></span><span> </span><span>^</span><span>
                         </span><span>space_implode</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>serial_commas</span></span><span> </span><span class="inner_quoted"><span>"and"</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
                         </span><span class="inner_quoted"><span>" to confirm that the "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>das_wort_model</span></span><span> </span><span>^</span><span>
                         </span><span class="inner_quoted"><span>" is genuine"</span></span><span class="main"><span>)</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                </span><span class="entity"><span>print</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Nitpick is unable to guarantee the authenticity of \
                       \the "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>das_wort_model</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" in the presence of \
                       \polymorphic axioms"</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
              </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span>NONE</span><span class="main"><span>)</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>not</span><span> </span><span class="entity"><span>genuine</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
             </span><span class="main"><span>(</span></span><span>Unsynchronized.inc</span><span> </span><span class="entity"><span>met_potential</span></span><span class="main"><span>;</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
             </span><span>NONE</span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>pair</span><span> </span><span class="entity"><span>genuine_means_genuine</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>solve_any_problem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>found_really_genuine</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_potential</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_genuine</span></span><span class="main"><span>,</span></span><span>
                           </span><span class="entity"><span>donno</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>first_time</span></span><span> </span><span class="entity"><span>problems</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>kodkod_scala</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Config.get</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>KK.kodkod_scala</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>max_potential</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Int.max</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_potential</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>max_genuine</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Int.max</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_genuine</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_and_check</span></span><span> </span><span class="entity"><span>genuine</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bounds</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>print_and_check_model</span></span><span> </span><span class="entity"><span>genuine</span></span><span> </span><span class="entity"><span>bounds</span></span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>problems</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>max_solutions</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>max_potential</span></span><span> </span><span>+</span><span> </span><span class="entity"><span>max_genuine</span></span><span>
                            </span><span>|&gt;</span><span> </span><span>not</span><span> </span><span class="entity"><span>incremental</span></span><span> </span><span>?</span><span> </span><span>Integer.min</span><span> </span><span class="inner_numeral"><span>1</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>max_solutions</span></span><span> </span><span>&lt;=</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>found_really_genuine</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>donno</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>KK.solve_any_problem</span></span><span> </span><span class="entity"><span>kodkod_scala</span></span><span> </span><span class="entity"><span>debug</span></span><span> </span><span class="entity"><span>overlord</span></span><span> </span><span class="entity"><span>deadline</span></span><span> </span><span class="entity"><span>max_threads</span></span><span>
                                    </span><span class="entity"><span>max_solutions</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>problems</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span class="entity"><span>KK.Normal</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>unsat_js</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>update_checked_problems</span></span><span> </span><span class="entity"><span>problems</span></span><span> </span><span class="entity"><span>unsat_js</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>show_kodkod_warning</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>;</span></span><span>
             </span><span class="main"><span>(</span></span><span class="entity"><span>found_really_genuine</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_potential</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_genuine</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>donno</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>KK.Normal</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sat_ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>unsat_js</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lib_ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>con_ps</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span>List.partition</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>unsound</span><span> </span><span>o</span><span> </span><span>snd</span><span> </span><span>o</span><span> </span><span>nth</span><span> </span><span class="entity"><span>problems</span></span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sat_ps</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="entity"><span>update_checked_problems</span></span><span> </span><span class="entity"><span>problems</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unsat_js</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>lib_ps</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="entity"><span>show_kodkod_warning</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>con_ps</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>genuine_codes</span></span><span> </span><span class="main"><span>=</span></span><span>
                    </span><span class="entity"><span>lib_ps</span></span><span> </span><span>|&gt;</span><span> </span><span>take</span><span> </span><span class="entity"><span>max_potential</span></span><span>
                           </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_and_check</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span>
                           </span><span>|&gt;</span><span> </span><span>filter</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>found_really_genuine</span></span><span> </span><span class="main"><span>=</span></span><span>
                    </span><span class="entity"><span>found_really_genuine</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>exists</span><span> </span><span>fst</span><span> </span><span class="entity"><span>genuine_codes</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>num_genuine</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>genuine_codes</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>max_genuine</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>max_genuine</span></span><span> </span><span>-</span><span> </span><span class="entity"><span>num_genuine</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>max_potential</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>max_potential</span></span><span>
                                      </span><span>-</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>lib_ps</span></span><span> </span><span>-</span><span> </span><span class="entity"><span>num_genuine</span></span><span class="main"><span>)</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>max_genuine</span></span><span> </span><span>&lt;=</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                    </span><span class="main"><span>(</span></span><span class="entity"><span>found_really_genuine</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>donno</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                      </span><span class="comment1"><span>(* "co_js" is the list of sound problems whose unsound
                         pendants couldn't be satisfied and hence that most
                         probably can't be satisfied themselves. *)</span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>co_js</span></span><span> </span><span class="main"><span>=</span></span><span>
                        </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>unsat_js</span></span><span>
                        </span><span>|&gt;</span><span> </span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                                      </span><span class="entity"><span>j</span></span><span> </span><span>&gt;=</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
                                      </span><span class="entity"><span>scopes_equivalent</span></span><span>
                                          </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>scope</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>problems</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                           </span><span class="main"><span>#</span></span><span>scope</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>problems</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bye_js</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>sort_distinct</span><span> </span><span>int_ord</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>sat_ps</span></span><span> </span><span>@</span><span>
                                                          </span><span class="entity"><span>unsat_js</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>co_js</span></span><span class="main"><span>)</span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>problems</span></span><span> </span><span class="main"><span>=</span></span><span>
                        </span><span class="entity"><span>problems</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>filter_out_indices</span></span><span> </span><span class="entity"><span>bye_js</span></span><span>
                                 </span><span>|&gt;</span><span> </span><span class="entity"><span>max_potential</span></span><span> </span><span>&lt;=</span><span> </span><span class="inner_numeral"><span>0</span></span><span>
                                    </span><span>?</span><span> </span><span>filter_out</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>unsound</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                      </span><span class="entity"><span>solve_any_problem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>found_really_genuine</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_potential</span></span><span class="main"><span>,</span></span><span>
                                         </span><span class="entity"><span>max_genuine</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>donno</span></span><span class="main"><span>)</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>problems</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>genuine_codes</span></span><span> </span><span class="main"><span>=</span></span><span>
                    </span><span class="entity"><span>con_ps</span></span><span> </span><span>|&gt;</span><span> </span><span>take</span><span> </span><span class="entity"><span>max_genuine</span></span><span>
                           </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_and_check</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>max_genuine</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>max_genuine</span></span><span> </span><span>-</span><span> </span><span>length</span><span> </span><span class="entity"><span>genuine_codes</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>found_really_genuine</span></span><span> </span><span class="main"><span>=</span></span><span>
                    </span><span class="entity"><span>found_really_genuine</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>exists</span><span> </span><span>fst</span><span> </span><span class="entity"><span>genuine_codes</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>max_genuine</span></span><span> </span><span>&lt;=</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>not</span><span> </span><span class="entity"><span>first_time</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                    </span><span class="main"><span>(</span></span><span class="entity"><span>found_really_genuine</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_genuine</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>donno</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bye_js</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>sort_distinct</span><span> </span><span>int_ord</span><span>
                                                 </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>sat_ps</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>unsat_js</span></span><span class="main"><span>)</span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>problems</span></span><span> </span><span class="main"><span>=</span></span><span>
                        </span><span class="entity"><span>problems</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>filter_out_indices</span></span><span> </span><span class="entity"><span>bye_js</span></span><span>
                                 </span><span>|&gt;</span><span> </span><span>filter_out</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>unsound</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                      </span><span class="entity"><span>solve_any_problem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>found_really_genuine</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_genuine</span></span><span class="main"><span>,</span></span><span>
                                         </span><span class="entity"><span>donno</span></span><span class="main"><span>)</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>problems</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>KK.TimedOut</span></span><span> </span><span class="entity"><span>unsat_js</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>update_checked_problems</span></span><span> </span><span class="entity"><span>problems</span></span><span> </span><span class="entity"><span>unsat_js</span></span><span class="main"><span>;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Timeout.TIMEOUT</span><span> </span><span>Time.zeroTime</span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>KK.Error</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>unsat_js</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>update_checked_problems</span></span><span> </span><span class="entity"><span>problems</span></span><span> </span><span class="entity"><span>unsat_js</span></span><span class="main"><span>;</span></span><span>
             </span><span class="entity"><span>print_v</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Kodkod error: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
             </span><span class="main"><span>(</span></span><span class="entity"><span>found_really_genuine</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_potential</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_genuine</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>donno</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>run_batch</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>scopes</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>found_really_genuine</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_potential</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_genuine</span></span><span class="main"><span>,</span></span><span>
                              </span><span class="entity"><span>donno</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>scopes</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="entity"><span>print_nt</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="inner_quoted"><span>"The scope specification is inconsistent"</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>verbose</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="entity"><span>pprint_nt</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Pretty.chunks</span><span>
                </span><span class="main"><span>[</span></span><span>Pretty.blk</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span>
                     </span><span>Pretty.text</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                               </span><span class="inner_quoted"><span>"Batch "</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" of "</span></span><span> </span><span>^</span><span>
                               </span><span>signed_string_of_int</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>": "</span></span><span>
                             </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                               </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
                            </span><span class="inner_quoted"><span>"Trying "</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>scopes</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
                            </span><span class="inner_quoted"><span>" scope"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>plural_s_for_list</span></span><span> </span><span class="entity"><span>scopes</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>":"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                 </span><span>Pretty.indent</span><span> </span><span class="entity"><span>indent_size</span></span><span>
                     </span><span class="main"><span>(</span></span><span>Pretty.chunks</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span>
                          </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                              </span><span>Pretty.block</span><span> </span><span class="main"><span>(</span></span><span>
                                  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>pretties_for_scope</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span>true</span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                                     </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>"Empty"</span></span><span class="main"><span>]</span></span><span>
                                   </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>pretties</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>pretties</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                          </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>scopes</span></span><span> </span><span>downto</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>scopes</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
            </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>add_problem_for_scope</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>scope</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>unsound</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>problems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>donno</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>check_deadline</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>problem_for_scope</span></span><span> </span><span class="entity"><span>unsound</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
             </span><span>SOME</span><span> </span><span class="entity"><span>problem</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
             </span><span class="main"><span>(</span></span><span class="entity"><span>problems</span></span><span>
              </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>null</span><span> </span><span class="entity"><span>problems</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span>
                  </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>KK.problems_equivalent</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>problem</span></span><span class="main"><span>,</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>problems</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                  </span><span>?</span><span> </span><span>cons</span><span> </span><span class="entity"><span>problem</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>donno</span></span><span class="main"><span>)</span></span><span>
           </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>problems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>donno</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>problems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>donno</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>fold</span><span> </span><span class="entity"><span>add_problem_for_scope</span></span><span>
               </span><span class="main"><span>(</span></span><span>map_product</span><span> </span><span>pair</span><span> </span><span class="entity"><span>scopes</span></span><span>
                    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>max_genuine</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span>false</span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span>
                     </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>max_potential</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span>true</span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
               </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>donno</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Unsynchronized.change</span><span> </span><span class="entity"><span>generated_problems</span></span><span> </span><span class="main"><span>(</span></span><span>append</span><span> </span><span class="entity"><span>problems</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Unsynchronized.change</span><span> </span><span class="entity"><span>generated_scopes</span></span><span> </span><span class="main"><span>(</span></span><span>append</span><span> </span><span class="entity"><span>scopes</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unsound_problems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sound_problems</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span>List.partition</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>unsound</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>!</span><span class="entity"><span>generated_problems</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span>null</span><span> </span><span class="entity"><span>sound_problems</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
                 </span><span>forall</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>KK.is_problem_trivially_false</span></span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span>
                        </span><span class="entity"><span>sound_problems</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                </span><span class="entity"><span>print_nt</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                    </span><span class="inner_quoted"><span>"Warning: The conjecture "</span></span><span> </span><span>^</span><span>
                    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>falsify</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"either trivially holds"</span></span><span>
                     </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>"is either trivially unsatisfiable"</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
                    </span><span class="inner_quoted"><span>" for the given scopes or lies outside Nitpick's supported \
                    \fragment"</span></span><span> </span><span>^</span><span>
                    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>exists</span><span> </span><span class="main"><span>(</span></span><span>not</span><span> </span><span>o</span><span> </span><span class="entity"><span>KK.is_problem_trivially_false</span></span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span>
                               </span><span class="entity"><span>unsound_problems</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                       </span><span class="inner_quoted"><span>"; only potentially spurious "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>das_wort_model</span></span><span> </span><span>^</span><span>
                       </span><span class="inner_quoted"><span>"s may be found"</span></span><span>
                     </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                       </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
            </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>solve_any_problem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>found_really_genuine</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_potential</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_genuine</span></span><span class="main"><span>,</span></span><span>
                           </span><span class="entity"><span>donno</span></span><span class="main"><span>)</span></span><span> </span><span>true</span><span> </span><span class="main"><span>(</span></span><span>rev</span><span> </span><span class="entity"><span>problems</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>scope_count</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>problems</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>rich_problem</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>length</span><span> </span><span class="main"><span>(</span></span><span>filter</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>scopes_equivalent</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>scope</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>problems</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>excipit</span></span><span> </span><span class="entity"><span>did_so_and_so</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>do_filter</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>!</span><span class="entity"><span>met_potential</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>max_potential</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>filter_out</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>unsound</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>I</span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>total</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="main"><span>(</span></span><span>!</span><span class="entity"><span>scopes</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unsat</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                   </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>scope_count</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>do_filter</span></span><span> </span><span class="main"><span>(</span></span><span>!</span><span class="entity"><span>generated_problems</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                     </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>I</span><span>
                   </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                     </span><span class="entity"><span>scope_count</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>do_filter</span></span><span> </span><span class="main"><span>(</span></span><span>these</span><span> </span><span class="main"><span>(</span></span><span>!</span><span class="entity"><span>checked_problems</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                                 </span><span class="entity"><span>scope</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>n</span></span><span>
                     </span><span>?</span><span> </span><span>Integer.add</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>!</span><span class="entity"><span>generated_scopes</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>TPTP</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"% SZS status GaveUp\n"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
        </span><span class="inner_quoted"><span>"Nitpick "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>did_so_and_so</span></span><span> </span><span>^</span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>is_some</span><span> </span><span class="main"><span>(</span></span><span>!</span><span class="entity"><span>checked_problems</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>total</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
           </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>unsat</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" of "</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>total</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" scope"</span></span><span>
           </span><span>^</span><span> </span><span class="entity"><span>plural_s</span></span><span> </span><span class="entity"><span>total</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
           </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>skipped</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>the_scopes</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>all_scopes</span></span><span> </span><span class="entity"><span>hol_ctxt</span></span><span> </span><span class="entity"><span>binarize</span></span><span> </span><span class="entity"><span>cards_assigns</span></span><span> </span><span class="entity"><span>maxes_assigns</span></span><span> </span><span class="entity"><span>iters_assigns</span></span><span>
                 </span><span class="entity"><span>bitss</span></span><span> </span><span class="entity"><span>bisim_depths</span></span><span> </span><span class="entity"><span>mono_Ts</span></span><span> </span><span class="entity"><span>nonmono_Ts</span></span><span> </span><span class="entity"><span>deep_dataTs</span></span><span>
                 </span><span class="entity"><span>finitizable_dataTs</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>skipped</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
              </span><span class="entity"><span>print_nt</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"Skipping "</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>skipped</span></span><span> </span><span>^</span><span>
                                 </span><span class="inner_quoted"><span>" scope"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>plural_s</span></span><span> </span><span class="entity"><span>skipped</span></span><span> </span><span>^</span><span>
                                 </span><span class="inner_quoted"><span>". (Consider using \"mono\" or \
                                 \\"merge_type_vars\" to prevent this.)"</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
              </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>scopes</span></span><span> </span><span>:=</span><span> </span><span class="entity"><span>the_scopes</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>run_batches</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
                    </span><span class="main"><span>(</span></span><span class="entity"><span>found_really_genuine</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_potential</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_genuine</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>donno</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>donno</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>max_genuine</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>print_nt</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>excipit</span></span><span> </span><span class="inner_quoted"><span>"checked"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>unknownN</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>max_genuine</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>original_max_genuine</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>max_potential</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>original_max_potential</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>print_t</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="inner_quoted"><span>"% SZS status GaveUp"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
             </span><span class="entity"><span>print_nt</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"Nitpick found no "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>das_wort_model</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>skipped</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>unknownN</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>noneN</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>print_nt</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                 </span><span class="entity"><span>excipit</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"could not find a"</span></span><span> </span><span>^</span><span>
                          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>max_genuine</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                             </span><span class="inner_quoted"><span>" better "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>das_wort_model</span></span><span>
                           </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                             </span><span class="inner_quoted"><span>"ny better "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>das_wort_model</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"s"</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
                          </span><span class="inner_quoted"><span>"\nIt checked"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
             </span><span class="entity"><span>potentialN</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>found_really_genuine</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
          </span><span class="entity"><span>genuineN</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
          </span><span class="entity"><span>quasi_genuineN</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>run_batches</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>batch</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>batches</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_genuine</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>run_batch</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>batch</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="entity"><span>run_batches</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>max_genuine</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>batches</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>z</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>batches</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>chunk_list</span></span><span> </span><span class="entity"><span>batch_size</span></span><span> </span><span class="main"><span>(</span></span><span>!</span><span class="entity"><span>scopes</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>outcome_code</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>run_batches</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>batches</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>batches</span></span><span>
                  </span><span class="main"><span>(</span></span><span>false</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_potential</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_genuine</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>Timeout.TIMEOUT</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
             </span><span class="main"><span>(</span></span><span class="entity"><span>print_nt</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>excipit</span></span><span> </span><span class="inner_quoted"><span>"ran out of time after checking"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>!</span><span class="entity"><span>met_potential</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>potentialN</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>unknownN</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_v</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"Total time: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_of_time</span></span><span> </span><span class="main"><span>(</span></span><span>Time.now</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span>-</span><span> </span><span class="entity"><span>time_start</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>spying</span></span><span> </span><span class="entity"><span>spy</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>state</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"outcome: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>outcome_code</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>outcome_code</span></span><span class="main"><span>,</span></span><span> </span><span>Queue.content</span><span> </span><span class="main"><span>(</span></span><span>Synchronized.value</span><span> </span><span class="entity"><span>outcome</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="comment1"><span>(* Give the inner timeout a chance. *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>timeout_bonus</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>seconds</span><span> </span><span class="inner_numeral"><span>1.0</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pick_nits_in_term</span></span><span> </span><span class="entity"><span>state</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>params</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>timeout</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>expect</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>step</span></span><span>
                      </span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>def_assm_ts</span></span><span> </span><span class="entity"><span>nondef_assm_ts</span></span><span> </span><span class="entity"><span>orig_t</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>print_nt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_mode_nt</span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>writeln</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>print_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>TPTP</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>writeln</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unknown_outcome</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unknownN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>deadline</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Timeout.end_time</span><span> </span><span class="entity"><span>timeout</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>outcome</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>outcome_code</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span>Timeout.apply</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>timeout</span></span><span> </span><span>+</span><span> </span><span class="entity"><span>timeout_bonus</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>pick_them_nits_in_term</span></span><span> </span><span class="entity"><span>deadline</span></span><span> </span><span class="entity"><span>state</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>step</span></span><span> </span><span class="entity"><span>subst</span></span><span>
                                    </span><span class="entity"><span>def_assm_ts</span></span><span> </span><span class="entity"><span>nondef_assm_ts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>orig_t</span></span><span>
        </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span class="entity"><span>TOO_LARGE</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>details</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
               </span><span class="main"><span>(</span></span><span class="entity"><span>print_t</span></span><span> </span><span class="inner_quoted"><span>"% SZS status GaveUp"</span></span><span class="main"><span>;</span></span><span>
                </span><span class="entity"><span>print_nt</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Limit reached: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>details</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>unknown_outcome</span></span><span class="main"><span>)</span></span><span>
             </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>TOO_SMALL</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>details</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
               </span><span class="main"><span>(</span></span><span class="entity"><span>print_t</span></span><span> </span><span class="inner_quoted"><span>"% SZS status GaveUp"</span></span><span class="main"><span>;</span></span><span>
                </span><span class="entity"><span>print_nt</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Limit reached: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>details</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>unknown_outcome</span></span><span class="main"><span>)</span></span><span>
             </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Kodkod.SYNTAX</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>details</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
               </span><span class="main"><span>(</span></span><span class="entity"><span>print_t</span></span><span> </span><span class="inner_quoted"><span>"% SZS status GaveUp"</span></span><span class="main"><span>;</span></span><span>
                </span><span class="entity"><span>print_nt</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Malformed Kodkodi output: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>details</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="entity"><span>unknown_outcome</span></span><span class="main"><span>)</span></span><span>
             </span><span class="main"><span>|</span></span><span> </span><span>Timeout.TIMEOUT</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
               </span><span class="main"><span>(</span></span><span class="entity"><span>print_t</span></span><span> </span><span class="inner_quoted"><span>"% SZS status TimedOut"</span></span><span class="main"><span>;</span></span><span>
                </span><span class="entity"><span>print_nt</span></span><span> </span><span class="inner_quoted"><span>"Nitpick ran out of time"</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>unknown_outcome</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>expect</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>outcome_code</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>expect</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>outcome</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Unexpected outcome: "</span></span><span> </span><span>^</span><span> </span><span>quote</span><span> </span><span class="entity"><span>outcome_code</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_fixed_equation</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
                      </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>Pure.eq</span><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Const</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span>Variable.is_fixed</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>s</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_fixed_equation</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>extract_fixed_frees</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>assms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>subst</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>other_assms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>List.partition</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_fixed_equation</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>assms</span></span><span>
      </span><span>|&gt;&gt;</span><span> </span><span>map</span><span> </span><span>Logic.dest_equals</span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>subst</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>other_assms</span></span><span class="main"><span>,</span></span><span> </span><span>subst_atomic</span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pick_nits_in_subgoal</span></span><span> </span><span class="entity"><span>state</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>step</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Proof.context_of</span></span><span> </span><span class="entity"><span>state</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>state</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>Proof.raw_goal</span></span><span> </span><span>|&gt;</span><span> </span><span class="main"><span>#</span></span><span>goal</span><span> </span><span>|&gt;</span><span> </span><span>Thm.prop_of</span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Logic.count_prems</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>writeln</span><span> </span><span class="inner_quoted"><span>"No subgoal!"</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>noneN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.goal_params</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>|&gt;</span><span> </span><span>fst</span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>assms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>Thm.term_of</span><span> </span><span class="main"><span>(</span></span><span>Assumption.all_assms_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>subst</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>assms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>extract_fixed_frees</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>assms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>pick_nits_in_term</span></span><span> </span><span class="entity"><span>state</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>step</span></span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>assms</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span></pre>
</body>

</html>