<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹Tools/Nitpick/kodkod.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹Tools/Nitpick/kodkod.ML›</h1>
</div>

<pre class="source"><span class="comment1"><span>(*  Title:      HOL/Tools/Nitpick/kodkod.ML
    Author:     Jasmin Blanchette, TU Muenchen
    Copyright   2008-2014

ML interface for Kodkod.
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>KODKOD</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>n_ary_index</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>int</span><span> * </span><span>int</span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>setting</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>string</span><span> * </span><span>string</span><span>

  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>tuple</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Tuple</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int list </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>TupleIndex</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>TupleReg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index

  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>tuple_set</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>TupleUnion</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> tuple_set * tuple_set </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>TupleDifference</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> tuple_set * tuple_set </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>TupleIntersect</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> tuple_set * tuple_set </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>TupleProduct</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> tuple_set * tuple_set </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>TupleProject</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> tuple_set * int </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>TupleSet</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> tuple list </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>TupleRange</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> tuple * tuple </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>TupleArea</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> tuple * tuple </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>TupleAtomSeq</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * int </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>TupleSetReg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index

  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>tuple_assign</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>AssignTuple</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index * tuple </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>AssignTupleSet</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index * tuple_set

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>bound</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n_ary_index</span></span><span> * </span><span>string</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> * </span><span class="entity"><span>tuple_set</span></span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>int_bound</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>int</span><span> </span><span>option</span><span> * </span><span class="entity"><span>tuple_set</span></span><span> </span><span>list</span><span>

  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>formula</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>All</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> decl list * formula </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Exist</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> decl list * formula </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>FormulaLet</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> expr_assign list * formula </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>FormulaIf</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> formula * formula * formula </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Or</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> formula * formula </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Iff</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> formula * formula </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Implies</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> formula * formula </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>And</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> formula * formula </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Not</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> formula </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Acyclic</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Function</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index * rel_expr * rel_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Functional</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index * rel_expr * rel_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>TotalOrdering</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index * rel_expr * rel_expr * rel_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Subset</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr * rel_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>RelEq</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr * rel_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>IntEq</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr * int_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>LT</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr * int_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>LE</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr * int_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>No</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Lone</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>One</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Some</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>False</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>True</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>FormulaReg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int
  </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>rel_expr</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>RelLet</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> expr_assign list * rel_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>RelIf</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> formula * rel_expr * rel_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Union</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr * rel_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Difference</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr * rel_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Override</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr * rel_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Intersect</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr * rel_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Product</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr * rel_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>IfNo</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr * rel_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Project</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr * int_expr list </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Join</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr * rel_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Closure</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>ReflexiveClosure</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Transpose</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Comprehension</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> decl list * formula </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Bits</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Int</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Iden</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Ints</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>None</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Univ</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Atom</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>AtomSeq</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * int </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Rel</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Var</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>RelReg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index
  </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>int_expr</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Sum</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> decl list * int_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>IntLet</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> expr_assign list * int_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>IntIf</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> formula * int_expr * int_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>SHL</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr * int_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>SHA</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr * int_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>SHR</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr * int_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Add</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr * int_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Sub</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr * int_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Mult</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr * int_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Div</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr * int_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Mod</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr * int_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Cardinality</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>SetSum</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>BitOr</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr * int_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>BitXor</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr * int_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>BitAnd</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr * int_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>BitNot</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Neg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Absolute</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Signum</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Num</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>IntReg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int
  </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>decl</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>DeclNo</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index * rel_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>DeclLone</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index * rel_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>DeclOne</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index * rel_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>DeclSome</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index * rel_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>DeclSet</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index * rel_expr
  </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>expr_assign</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>AssignFormulaReg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * formula </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>AssignRelReg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index * rel_expr </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>AssignIntReg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * int_expr

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span>'a</span><span> </span><span class="entity"><span>fold_expr_funcs</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>{</span></span><span>formula_func</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>formula</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span class="main"><span>,</span></span><span>
     </span><span>rel_expr_func</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>rel_expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span class="main"><span>,</span></span><span>
     </span><span>int_expr_func</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>int_expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span class="main"><span>}</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> fold_formula </span><span class="main"><span>:</span></span><span> </span><span>'a</span><span> </span><span class="entity"><span>fold_expr_funcs</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>formula</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> fold_rel_expr </span><span class="main"><span>:</span></span><span> </span><span>'a</span><span> </span><span class="entity"><span>fold_expr_funcs</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rel_expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> fold_int_expr </span><span class="main"><span>:</span></span><span> </span><span>'a</span><span> </span><span class="entity"><span>fold_expr_funcs</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>int_expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> fold_decl </span><span class="main"><span>:</span></span><span> </span><span>'a</span><span> </span><span class="entity"><span>fold_expr_funcs</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>decl</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> fold_expr_assign </span><span class="main"><span>:</span></span><span> </span><span>'a</span><span> </span><span class="entity"><span>fold_expr_funcs</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr_assign</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span>'a</span><span> </span><span class="entity"><span>fold_tuple_funcs</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>{</span></span><span>tuple_func</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tuple</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span class="main"><span>,</span></span><span>
     </span><span>tuple_set_func</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tuple_set</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span class="main"><span>}</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> fold_tuple </span><span class="main"><span>:</span></span><span> </span><span>'a</span><span> </span><span class="entity"><span>fold_tuple_funcs</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>tuple</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> fold_tuple_set </span><span class="main"><span>:</span></span><span> </span><span>'a</span><span> </span><span class="entity"><span>fold_tuple_funcs</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>tuple_set</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> fold_tuple_assign </span><span class="main"><span>:</span></span><span> </span><span>'a</span><span> </span><span class="entity"><span>fold_tuple_funcs</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>tuple_assign</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> fold_bound </span><span class="main"><span>:</span></span><span>
      </span><span>'a</span><span> </span><span class="entity"><span>fold_expr_funcs</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="entity"><span>fold_tuple_funcs</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>bound</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> fold_int_bound </span><span class="main"><span>:</span></span><span> </span><span>'a</span><span> </span><span class="entity"><span>fold_tuple_funcs</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>int_bound</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>{</span></span><span>comment</span><span class="main"><span>:</span></span><span> </span><span>string</span><span class="main"><span>,</span></span><span>
     </span><span>settings</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>setting</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     </span><span>univ_card</span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span>
     </span><span>tuple_assigns</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tuple_assign</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     </span><span>bounds</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bound</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     </span><span>int_bounds</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>int_bound</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     </span><span>expr_assigns</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>expr_assign</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     </span><span>formula</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>formula</span></span><span class="main"><span>}</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>raw_bound</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>n_ary_index</span></span><span> * </span><span>int</span><span> </span><span>list</span><span> </span><span>list</span><span>

  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>outcome</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Normal</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span>int * raw_bound list</span><span class="main"><span>)</span></span><span> list * int list * string </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>TimedOut</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int list </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Error</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string * int list

  </span><span class="keyword1"><span class="keyword"><span>exception</span></span></span><span> SYNTAX </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>string</span><span> * </span><span>string</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> max_arity </span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> arity_of_rel_expr </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>rel_expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> is_problem_trivially_false </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> problems_equivalent </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>problem</span></span><span> * </span><span class="entity"><span>problem</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> solve_any_problem </span><span class="main"><span>:</span></span><span>
    </span><span>bool</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>Time.time</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>outcome</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> kodkod_scala </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span>Config.T</span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Kodkod</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>KODKOD</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>n_ary_index</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>int</span><span> * </span><span>int</span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>setting</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>string</span><span> * </span><span>string</span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>tuple</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Tuple</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int list </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>TupleIndex</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>TupleReg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>tuple_set</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>TupleUnion</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> tuple_set * tuple_set </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>TupleDifference</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> tuple_set * tuple_set </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>TupleIntersect</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> tuple_set * tuple_set </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>TupleProduct</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> tuple_set * tuple_set </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>TupleProject</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> tuple_set * int </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>TupleSet</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> tuple list </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>TupleRange</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> tuple * tuple </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>TupleArea</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> tuple * tuple </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>TupleAtomSeq</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * int </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>TupleSetReg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>tuple_assign</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>AssignTuple</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index * tuple </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>AssignTupleSet</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index * tuple_set

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>bound</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n_ary_index</span></span><span> * </span><span>string</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> * </span><span class="entity"><span>tuple_set</span></span><span> </span><span>list</span><span>
</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>int_bound</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>int</span><span> </span><span>option</span><span> * </span><span class="entity"><span>tuple_set</span></span><span> </span><span>list</span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>formula</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>All</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> decl list * formula </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Exist</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> decl list * formula </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>FormulaLet</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> expr_assign list * formula </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>FormulaIf</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> formula * formula * formula </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Or</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> formula * formula </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Iff</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> formula * formula </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Implies</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> formula * formula </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>And</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> formula * formula </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Not</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> formula </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Acyclic</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Function</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index * rel_expr * rel_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Functional</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index * rel_expr * rel_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>TotalOrdering</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index * rel_expr * rel_expr * rel_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Subset</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr * rel_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>RelEq</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr * rel_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>IntEq</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr * int_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>LT</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr * int_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>LE</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr * int_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>No</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Lone</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>One</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Some</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>False</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>True</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>FormulaReg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>rel_expr</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>RelLet</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> expr_assign list * rel_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>RelIf</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> formula * rel_expr * rel_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Union</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr * rel_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Difference</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr * rel_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Override</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr * rel_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Intersect</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr * rel_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Product</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr * rel_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>IfNo</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr * rel_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Project</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr * int_expr list </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Join</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr * rel_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Closure</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>ReflexiveClosure</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Transpose</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Comprehension</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> decl list * formula </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Bits</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Int</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Iden</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Ints</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>None</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Univ</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Atom</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>AtomSeq</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * int </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Rel</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Var</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>RelReg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>int_expr</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Sum</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> decl list * int_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>IntLet</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> expr_assign list * int_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>IntIf</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> formula * int_expr * int_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>SHL</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr * int_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>SHA</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr * int_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>SHR</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr * int_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Add</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr * int_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Sub</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr * int_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Mult</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr * int_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Div</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr * int_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Mod</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr * int_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Cardinality</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>SetSum</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rel_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>BitOr</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr * int_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>BitXor</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr * int_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>BitAnd</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr * int_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>BitNot</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Neg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Absolute</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Signum</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Num</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>IntReg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>decl</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>DeclNo</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index * rel_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>DeclLone</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index * rel_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>DeclOne</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index * rel_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>DeclSome</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index * rel_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>DeclSet</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index * rel_expr
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>expr_assign</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>AssignFormulaReg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * formula </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>AssignRelReg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> n_ary_index * rel_expr </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>AssignIntReg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * int_expr

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>comment</span><span class="main"><span>:</span></span><span> </span><span>string</span><span class="main"><span>,</span></span><span>
   </span><span>settings</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>setting</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   </span><span>univ_card</span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span>
   </span><span>tuple_assigns</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tuple_assign</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   </span><span>bounds</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bound</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   </span><span>int_bounds</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>int_bound</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   </span><span>expr_assigns</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>expr_assign</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   </span><span>formula</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>formula</span></span><span class="main"><span>}</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>raw_bound</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>n_ary_index</span></span><span> * </span><span>int</span><span> </span><span>list</span><span> </span><span>list</span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>outcome</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Normal</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span>int * raw_bound list</span><span class="main"><span>)</span></span><span> list * int list * string </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>TimedOut</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int list </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Error</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string * int list

</span><span class="keyword1"><span class="keyword"><span>exception</span></span></span><span> </span><span class="entity"><span>SYNTAX</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>string</span><span> * </span><span>string</span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span>'a</span><span> </span><span class="entity"><span>fold_expr_funcs</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>formula_func</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>formula</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span class="main"><span>,</span></span><span>
   </span><span>rel_expr_func</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>rel_expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span class="main"><span>,</span></span><span>
   </span><span>int_expr_func</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>int_expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span class="main"><span>}</span></span><span>


</span><span class="comment1"><span>(** Auxiliary functions on Kodkod problems **)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fold_formula</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>F</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span>'a</span><span> </span><span class="entity"><span>fold_expr_funcs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>formula</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>formula</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span class="entity"><span>All</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_decl</span></span><span> </span><span class="entity"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ds</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_formula</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>f</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Exist</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_decl</span></span><span> </span><span class="entity"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ds</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_formula</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>f</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>FormulaLet</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_expr_assign</span></span><span> </span><span class="entity"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bs</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_formula</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>f</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>FormulaIf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="entity"><span>fold_formula</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_formula</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>f1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_formula</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>f2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_formula</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>f1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_formula</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>f2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Iff</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_formula</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>f1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_formula</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>f2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Implies</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_formula</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>f1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_formula</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>f2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_formula</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>f1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_formula</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>f2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Not</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_formula</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>f</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Acyclic</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rel</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Function</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rel</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Functional</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rel</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>TotalOrdering</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r3</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rel</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r2</span></span><span>
    </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r3</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Subset</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>RelEq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>IntEq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>LT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>LE</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>No</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Lone</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>One</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Some</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>False</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>#</span></span><span>formula_func</span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>formula</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>True</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>#</span></span><span>formula_func</span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>formula</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>FormulaReg</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>#</span></span><span>formula_func</span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>formula</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>rel_expr</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>rel_expr</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span class="entity"><span>RelLet</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_expr_assign</span></span><span> </span><span class="entity"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bs</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>RelIf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="entity"><span>fold_formula</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Union</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Difference</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Override</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Intersect</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Product</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>IfNo</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Project</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>is</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span>#&gt;</span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>is</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Join</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Closure</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>ReflexiveClosure</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Transpose</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Comprehension</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_decl</span></span><span> </span><span class="entity"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ds</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_formula</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>f</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Bits</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Int</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Iden</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>#</span></span><span>rel_expr_func</span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>rel_expr</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Ints</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>#</span></span><span>rel_expr_func</span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>rel_expr</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>None</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>#</span></span><span>rel_expr_func</span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>rel_expr</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Univ</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>#</span></span><span>rel_expr_func</span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>rel_expr</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Atom</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>#</span></span><span>rel_expr_func</span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>rel_expr</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>AtomSeq</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>#</span></span><span>rel_expr_func</span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>rel_expr</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rel</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>#</span></span><span>rel_expr_func</span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>rel_expr</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Var</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>#</span></span><span>rel_expr_func</span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>rel_expr</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>RelReg</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>#</span></span><span>rel_expr_func</span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>rel_expr</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>int_expr</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>int_expr</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span class="entity"><span>Sum</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_decl</span></span><span> </span><span class="entity"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ds</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>IntLet</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_expr_assign</span></span><span> </span><span class="entity"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bs</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>IntIf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="entity"><span>fold_formula</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>SHL</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>SHA</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>SHR</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Add</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Sub</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Mult</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Div</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Mod</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Cardinality</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>SetSum</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>BitOr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>BitXor</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>BitAnd</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>BitNot</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Neg</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Absolute</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Signum</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Num</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>#</span></span><span>int_expr_func</span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>int_expr</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>IntReg</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>#</span></span><span>int_expr_func</span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>int_expr</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>fold_decl</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>decl</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>decl</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span class="entity"><span>DeclNo</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Var</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>DeclLone</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Var</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>DeclOne</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Var</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>DeclSome</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Var</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>DeclSet</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Var</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>fold_expr_assign</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>assign</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>assign</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span class="entity"><span>AssignFormulaReg</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_formula</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FormulaReg</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_formula</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>f</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>AssignRelReg</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>RelReg</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>r</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>AssignIntReg</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>IntReg</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_int_expr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>i</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span>'a</span><span> </span><span class="entity"><span>fold_tuple_funcs</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>tuple_func</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tuple</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span class="main"><span>,</span></span><span>
   </span><span>tuple_set_func</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tuple_set</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span class="main"><span>}</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fold_tuple</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>F</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span>'a</span><span> </span><span class="entity"><span>fold_tuple_funcs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>tuple_func</span><span> </span><span class="entity"><span>F</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fold_tuple_set</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>tuple_set</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>tuple_set</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span class="entity"><span>TupleUnion</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ts1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_tuple_set</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>ts1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_tuple_set</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>ts2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>TupleDifference</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ts1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_tuple_set</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>ts1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_tuple_set</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>ts2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>TupleIntersect</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ts1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_tuple_set</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>ts1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_tuple_set</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>ts2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>TupleProduct</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ts1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_tuple_set</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>ts1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_tuple_set</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>ts2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>TupleProject</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ts</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_tuple_set</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>ts</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>TupleSet</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_tuple</span></span><span> </span><span class="entity"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>TupleRange</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_tuple</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_tuple</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>t2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>TupleArea</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_tuple</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_tuple</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>t2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>TupleAtomSeq</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>#</span></span><span>tuple_set_func</span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>tuple_set</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>TupleSetReg</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>#</span></span><span>tuple_set_func</span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>tuple_set</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fold_tuple_assign</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>assign</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>assign</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span class="entity"><span>AssignTuple</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_tuple</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TupleReg</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_tuple</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>t</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>AssignTupleSet</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="entity"><span>fold_tuple_set</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TupleSetReg</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_tuple_set</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>ts</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fold_bound</span></span><span> </span><span class="entity"><span>expr_F</span></span><span> </span><span class="entity"><span>tuple_F</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>zs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_rel_expr</span></span><span> </span><span class="entity"><span>expr_F</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rel</span></span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>zs</span></span><span class="main"><span>)</span></span><span>
  </span><span>#&gt;</span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_tuple_set</span></span><span> </span><span class="entity"><span>tuple_F</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tss</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fold_int_bound</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_tuple_set</span></span><span> </span><span class="entity"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tss</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>max_arity</span></span><span> </span><span class="entity"><span>univ_card</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>floor</span><span> </span><span class="main"><span>(</span></span><span>Math.ln</span><span> </span><span class="inner_numeral"><span>2147483647.0</span></span><span>
                                 </span><span>/</span><span> </span><span>Math.ln</span><span> </span><span class="main"><span>(</span></span><span>Real.fromInt</span><span> </span><span class="entity"><span>univ_card</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>RelLet</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="entity"><span>r</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>RelIf</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="entity"><span>r1</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Union</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="entity"><span>r1</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Difference</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="entity"><span>r1</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Override</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="entity"><span>r1</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Intersect</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="entity"><span>r1</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Product</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sum_arities_of_rel_exprs</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span class="entity"><span>r2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>IfNo</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="entity"><span>r1</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Project</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>is</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>is</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Join</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sum_arities_of_rel_exprs</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span class="entity"><span>r2</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Closure</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ReflexiveClosure</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Transpose</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Comprehension</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ds</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>+</span><span> </span><span>o</span><span> </span><span class="entity"><span>arity_of_decl</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ds</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Bits</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Int</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="entity"><span>Iden</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="entity"><span>Ints</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="entity"><span>None</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="entity"><span>Univ</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Atom</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AtomSeq</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rel</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>n</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Var</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>n</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>RelReg</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>n</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>sum_arities_of_rel_exprs</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span class="entity"><span>r2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span>+</span><span> </span><span class="entity"><span>arity_of_rel_expr</span></span><span> </span><span class="entity"><span>r2</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>arity_of_decl</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>DeclNo</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>n</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_decl</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>DeclLone</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>n</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_decl</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>DeclOne</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>n</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_decl</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>DeclSome</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>n</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_decl</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>DeclSet</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>n</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_problem_trivially_false</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span>formula</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>False</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>problem</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_problem_trivially_false</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>chop_solver</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>take</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span>o</span><span> </span><span>space_explode</span><span> </span><span class="inner_quoted"><span>","</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>settings_equivalent</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>settings_equivalent</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>key1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>value1</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>settings1</span></span><span class="main"><span>,</span></span><span>
                         </span><span class="main"><span>(</span></span><span class="entity"><span>key2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>value2</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>settings2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>key1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>key2</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>value1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>value2</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>key1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"delay"</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span>
     </span><span class="main"><span>(</span></span><span class="entity"><span>key1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"solver"</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>chop_solver</span></span><span> </span><span class="entity"><span>value1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>chop_solver</span></span><span> </span><span class="entity"><span>value2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
    </span><span class="entity"><span>settings_equivalent</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>settings1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>settings2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>settings_equivalent</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>problems_equivalent</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p1</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>problem</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p2</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>problem</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>#</span></span><span>univ_card</span><span> </span><span class="entity"><span>p1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>univ_card</span><span> </span><span class="entity"><span>p2</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
  </span><span class="main"><span>#</span></span><span>formula</span><span> </span><span class="entity"><span>p1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>formula</span><span> </span><span class="entity"><span>p2</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
  </span><span class="main"><span>#</span></span><span>bounds</span><span> </span><span class="entity"><span>p1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>bounds</span><span> </span><span class="entity"><span>p2</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
  </span><span class="main"><span>#</span></span><span>expr_assigns</span><span> </span><span class="entity"><span>p1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>expr_assigns</span><span> </span><span class="entity"><span>p2</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
  </span><span class="main"><span>#</span></span><span>tuple_assigns</span><span> </span><span class="entity"><span>p1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>tuple_assigns</span><span> </span><span class="entity"><span>p2</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
  </span><span class="main"><span>#</span></span><span>int_bounds</span><span> </span><span class="entity"><span>p1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>int_bounds</span><span> </span><span class="entity"><span>p2</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
  </span><span class="entity"><span>settings_equivalent</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>settings</span><span> </span><span class="entity"><span>p1</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>settings</span><span> </span><span class="entity"><span>p2</span></span><span class="main"><span>)</span></span><span>

</span><span class="comment1"><span>(** Serialization of problem **)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>base_name</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span>&lt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>string_of_int</span><span> </span><span class="main"><span>(</span></span><span>~</span><span class="entity"><span>j</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"'"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>j</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>n_ary_name</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prefix</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prefix</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>base_name</span></span><span> </span><span class="entity"><span>j</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>n_ary_name</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>prefix</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prefix</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>base_name</span></span><span> </span><span class="entity"><span>j</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>n_ary_name</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>prefix</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prefix</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"_"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>base_name</span></span><span> </span><span class="entity"><span>j</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>atom_name</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"A"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>base_name</span></span><span> </span><span class="entity"><span>j</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>atom_seq_name</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"u"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>base_name</span></span><span> </span><span class="entity"><span>k</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>atom_seq_name</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>j0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"u"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>base_name</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"@"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>base_name</span></span><span> </span><span class="entity"><span>j0</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>formula_reg_name</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"$f"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>base_name</span></span><span> </span><span class="entity"><span>j</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rel_reg_name</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"$e"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>base_name</span></span><span> </span><span class="entity"><span>j</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>int_reg_name</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"$i"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>base_name</span></span><span> </span><span class="entity"><span>j</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tuple_name</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>n_ary_name</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="inner_quoted"><span>"A"</span></span><span> </span><span class="inner_quoted"><span>"P"</span></span><span> </span><span class="inner_quoted"><span>"T"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rel_name</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>n_ary_name</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="inner_quoted"><span>"s"</span></span><span> </span><span class="inner_quoted"><span>"r"</span></span><span> </span><span class="inner_quoted"><span>"m"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>var_name</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>n_ary_name</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="inner_quoted"><span>"S"</span></span><span> </span><span class="inner_quoted"><span>"R"</span></span><span> </span><span class="inner_quoted"><span>"M"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tuple_reg_name</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>n_ary_name</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="inner_quoted"><span>"$A"</span></span><span> </span><span class="inner_quoted"><span>"$P"</span></span><span> </span><span class="inner_quoted"><span>"$T"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tuple_set_reg_name</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>n_ary_name</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="inner_quoted"><span>"$a"</span></span><span> </span><span class="inner_quoted"><span>"$p"</span></span><span> </span><span class="inner_quoted"><span>"$t"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>inline_comment</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>inline_comment</span></span><span> </span><span class="entity"><span>comment</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="inner_quoted"><span>" /* "</span></span><span> </span><span>^</span><span> </span><span>translate_string</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="inner_quoted"><span>"\n"</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="inner_quoted"><span>"*"</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"* "</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>comment</span></span><span> </span><span>^</span><span>
    </span><span class="inner_quoted"><span>" */"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>block_comment</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>block_comment</span></span><span> </span><span class="entity"><span>comment</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>prefix_lines</span><span> </span><span class="inner_quoted"><span>"// "</span></span><span> </span><span class="entity"><span>comment</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"\n"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>commented_rel_name</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_name</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>inline_comment</span></span><span> </span><span class="entity"><span>s</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_for_tuple</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Tuple</span></span><span> </span><span class="entity"><span>js</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span>^</span><span> </span><span>commas</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>atom_name</span></span><span> </span><span class="entity"><span>js</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"]"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_tuple</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TupleIndex</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tuple_name</span></span><span> </span><span class="entity"><span>x</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_tuple</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TupleReg</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tuple_reg_name</span></span><span> </span><span class="entity"><span>x</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>no_prec</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>100</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prec_TupleUnion</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prec_TupleIntersect</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prec_TupleProduct</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>3</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prec_TupleProject</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>4</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>precedence_ts</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TupleUnion</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_TupleUnion</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_ts</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TupleDifference</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_TupleUnion</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_ts</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TupleIntersect</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_TupleIntersect</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_ts</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TupleProduct</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_TupleProduct</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_ts</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TupleProject</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_TupleProject</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_ts</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>no_prec</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_for_tuple_set</span></span><span> </span><span class="entity"><span>tuple_set</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>tuple_set</span></span><span> </span><span class="entity"><span>outer_prec</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prec</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>precedence_ts</span></span><span> </span><span class="entity"><span>tuple_set</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>need_parens</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prec</span></span><span> </span><span>&lt;</span><span> </span><span class="entity"><span>outer_prec</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>need_parens</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>tuple_set</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
           </span><span class="entity"><span>TupleUnion</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ts1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>ts1</span></span><span> </span><span class="entity"><span>prec</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" + "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>ts2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prec</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>TupleDifference</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ts1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
           </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>ts1</span></span><span> </span><span class="entity"><span>prec</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" - "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>ts2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prec</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>TupleIntersect</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ts1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>ts1</span></span><span> </span><span class="entity"><span>prec</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" &amp; "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>ts2</span></span><span> </span><span class="entity"><span>prec</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>TupleProduct</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ts1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>ts1</span></span><span> </span><span class="entity"><span>prec</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"-&gt;"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>ts2</span></span><span> </span><span class="entity"><span>prec</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>TupleProject</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="entity"><span>prec</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>c</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"]"</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>TupleSet</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"{"</span></span><span> </span><span>^</span><span> </span><span>commas</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>string_for_tuple</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"}"</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>TupleRange</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
           </span><span class="inner_quoted"><span>"{"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_for_tuple</span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span>^</span><span>
           </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>t2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>" .. "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_for_tuple</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"}"</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>TupleArea</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
           </span><span class="inner_quoted"><span>"{"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_for_tuple</span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" # "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_for_tuple</span></span><span> </span><span class="entity"><span>t2</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"}"</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>TupleAtomSeq</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>atom_seq_name</span></span><span> </span><span class="entity"><span>x</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>TupleSetReg</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>tuple_set_reg_name</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>need_parens</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>tuple_set</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_for_tuple_assign</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AssignTuple</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>tuple_reg_name</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" := "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_for_tuple</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"\n"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_tuple_assign</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AssignTupleSet</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>tuple_set_reg_name</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" := "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_for_tuple_set</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"\n"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_for_bound</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>zs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="inner_quoted"><span>"bounds "</span></span><span> </span><span>^</span><span> </span><span>commas</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>commented_rel_name</span></span><span> </span><span class="entity"><span>zs</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>": "</span></span><span> </span><span>^</span><span>
  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>length</span><span> </span><span class="entity"><span>tss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>"["</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span>commas</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>string_for_tuple_set</span></span><span> </span><span class="entity"><span>tss</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>length</span><span> </span><span class="entity"><span>tss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>"]"</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"\n"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>int_string_for_bound</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>opt_n</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>opt_n</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
     </span><span>SOME</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>signed_string_of_int</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>": "</span></span><span>
   </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span>^</span><span> </span><span>commas</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>string_for_tuple_set</span></span><span> </span><span class="entity"><span>tss</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"]"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prec_All</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prec_Or</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prec_Iff</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>3</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prec_Implies</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>4</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prec_And</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>5</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prec_Not</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>6</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prec_Eq</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>7</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prec_Some</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>8</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prec_SHL</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>9</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prec_Add</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>10</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prec_Mult</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>11</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prec_Override</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>12</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prec_Intersect</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>13</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prec_Product</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>14</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prec_IfNo</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>15</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prec_Project</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>17</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prec_Join</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>18</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prec_BitNot</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>19</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>precedence_f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>All</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_All</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Exist</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_All</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FormulaLet</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_All</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FormulaIf</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_All</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_Or</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Iff</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_Iff</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Implies</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_Implies</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_And</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_Not</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Acyclic</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>no_prec</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Function</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>no_prec</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Functional</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>no_prec</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TotalOrdering</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>no_prec</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Subset</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_Eq</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>RelEq</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_Eq</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>IntEq</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_Eq</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>LT</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_Eq</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>LE</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_Eq</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>No</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_Some</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Lone</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_Some</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>One</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_Some</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Some</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_Some</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_f</span></span><span> </span><span class="entity"><span>False</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>no_prec</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_f</span></span><span> </span><span class="entity"><span>True</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>no_prec</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FormulaReg</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>no_prec</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>precedence_r</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>RelLet</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_All</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_r</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>RelIf</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_All</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_r</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Union</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_Add</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_r</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Difference</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_Add</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_r</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Override</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_Override</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_r</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Intersect</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_Intersect</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_r</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Product</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_Product</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_r</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>IfNo</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_IfNo</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_r</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Project</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_Project</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_r</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Join</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_Join</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_r</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Closure</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_BitNot</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_r</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ReflexiveClosure</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_BitNot</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_r</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Transpose</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_BitNot</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_r</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Comprehension</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>no_prec</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_r</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Bits</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>no_prec</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_r</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Int</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>no_prec</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_r</span></span><span> </span><span class="entity"><span>Iden</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>no_prec</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_r</span></span><span> </span><span class="entity"><span>Ints</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>no_prec</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_r</span></span><span> </span><span class="entity"><span>None</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>no_prec</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_r</span></span><span> </span><span class="entity"><span>Univ</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>no_prec</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_r</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Atom</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>no_prec</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_r</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AtomSeq</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>no_prec</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_r</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rel</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>no_prec</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_r</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Var</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>no_prec</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_r</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>RelReg</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>no_prec</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>precedence_i</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Sum</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_All</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_i</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>IntLet</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_All</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_i</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>IntIf</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_All</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_i</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>SHL</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_SHL</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_i</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>SHA</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_SHL</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_i</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>SHR</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_SHL</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_i</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Add</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_Add</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_i</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Sub</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_Add</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_i</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Mult</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_Mult</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_i</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Div</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_Mult</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_i</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Mod</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_Mult</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_i</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Cardinality</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>no_prec</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_i</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>SetSum</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>no_prec</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_i</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BitOr</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_Intersect</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_i</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BitXor</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_Intersect</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_i</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BitAnd</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_Intersect</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_i</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BitNot</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_BitNot</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_i</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Neg</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_BitNot</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_i</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Absolute</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_BitNot</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_i</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Signum</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prec_BitNot</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_i</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Num</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>no_prec</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>precedence_i</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>IntReg</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>no_prec</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>write_problem</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="entity"><span>problems</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>out_outmost_f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>out_outmost_f</span></span><span> </span><span class="entity"><span>f1</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"\n   &amp;&amp; "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_outmost_f</span></span><span> </span><span class="entity"><span>f2</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>out_outmost_f</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>out_f</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>prec_And</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>out_f</span></span><span> </span><span class="entity"><span>formula</span></span><span> </span><span class="entity"><span>outer_prec</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prec</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>precedence_f</span></span><span> </span><span class="entity"><span>formula</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>need_parens</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prec</span></span><span> </span><span>&lt;</span><span> </span><span class="entity"><span>outer_prec</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>need_parens</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>formula</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
           </span><span class="entity"><span>All</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"all ["</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_decls</span></span><span> </span><span class="entity"><span>ds</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"] | "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_f</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Exist</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"some ["</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_decls</span></span><span> </span><span class="entity"><span>ds</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"] | "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_f</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>FormulaLet</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"let ["</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_assigns</span></span><span> </span><span class="entity"><span>bs</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"] | "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_f</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>FormulaIf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"if "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_f</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" then "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_f</span></span><span> </span><span class="entity"><span>f1</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" else "</span></span><span class="main"><span>;</span></span><span>
            </span><span class="entity"><span>out_f</span></span><span> </span><span class="entity"><span>f2</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out_f</span></span><span> </span><span class="entity"><span>f1</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" || "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_f</span></span><span> </span><span class="entity"><span>f2</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Iff</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out_f</span></span><span> </span><span class="entity"><span>f1</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" &lt;=&gt; "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_f</span></span><span> </span><span class="entity"><span>f2</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Implies</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out_f</span></span><span> </span><span class="entity"><span>f1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prec</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" =&gt; "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_f</span></span><span> </span><span class="entity"><span>f2</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out_f</span></span><span> </span><span class="entity"><span>f1</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" &amp;&amp; "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_f</span></span><span> </span><span class="entity"><span>f2</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Not</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"! "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_f</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Acyclic</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"ACYCLIC("</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>rel_name</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Function</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"FUNCTION("</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>rel_name</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>", "</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" -&gt; one "</span></span><span class="main"><span>;</span></span><span>
            </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r2</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Functional</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"FUNCTION("</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>rel_name</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>", "</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" -&gt; lone "</span></span><span class="main"><span>;</span></span><span>
            </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r2</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>TotalOrdering</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r3</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"TOTAL_ORDERING("</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>rel_name</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>", "</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>", "</span></span><span class="main"><span>;</span></span><span>
            </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r2</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>", "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r3</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Subset</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" in "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r2</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>RelEq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" = "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r2</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>IntEq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i1</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" = "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i2</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>LT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i1</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" &lt; "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i2</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>LE</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i1</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" &lt;= "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i2</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>No</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"no "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Lone</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"lone "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>One</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"one "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Some</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"some "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>False</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"false"</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>True</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"true"</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>FormulaReg</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>formula_reg_name</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>need_parens</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>rel_expr</span></span><span> </span><span class="entity"><span>outer_prec</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prec</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>precedence_r</span></span><span> </span><span class="entity"><span>rel_expr</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>need_parens</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prec</span></span><span> </span><span>&lt;</span><span> </span><span class="entity"><span>outer_prec</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>need_parens</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>rel_expr</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
           </span><span class="entity"><span>RelLet</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"let ["</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_assigns</span></span><span> </span><span class="entity"><span>bs</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"] | "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>RelIf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"if "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_f</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" then "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span>
            </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" else "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r2</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Union</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" + "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prec</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Difference</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" - "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prec</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Override</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" ++ "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r2</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Intersect</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" &amp; "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r2</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Product</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"-&gt;"</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r2</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>IfNo</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"\\"</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r2</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Project</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>is</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"["</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_columns</span></span><span> </span><span class="entity"><span>is</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"]"</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Join</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"."</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prec</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Closure</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"^"</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>ReflexiveClosure</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"*"</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Transpose</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"~"</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Comprehension</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"{["</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_decls</span></span><span> </span><span class="entity"><span>ds</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"] | "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_f</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"}"</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Bits</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"Bits["</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"]"</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Int</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"Int["</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"]"</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Iden</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"iden"</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Ints</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"ints"</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>None</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"none"</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Univ</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"univ"</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Atom</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>atom_name</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>AtomSeq</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>atom_seq_name</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rel</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_name</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Var</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_name</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>RelReg</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_reg_name</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>need_parens</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>int_expr</span></span><span> </span><span class="entity"><span>outer_prec</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prec</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>precedence_i</span></span><span> </span><span class="entity"><span>int_expr</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>need_parens</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prec</span></span><span> </span><span>&lt;</span><span> </span><span class="entity"><span>outer_prec</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>need_parens</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>int_expr</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
           </span><span class="entity"><span>Sum</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"sum ["</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_decls</span></span><span> </span><span class="entity"><span>ds</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"] | "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>IntLet</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"let ["</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_assigns</span></span><span> </span><span class="entity"><span>bs</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"] | "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>IntIf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"if "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_f</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" then "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i1</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span>
            </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" else "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i2</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>SHL</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i1</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" &lt;&lt; "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prec</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>SHA</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i1</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" &gt;&gt; "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prec</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>SHR</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i1</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" &gt;&gt;&gt; "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prec</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Add</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i1</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" + "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prec</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Sub</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i1</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" - "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prec</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Mult</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i1</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" * "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prec</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Div</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i1</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" / "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prec</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Mod</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i1</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" % "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prec</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Cardinality</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"#("</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>SetSum</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"sum("</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>BitOr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i1</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" | "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i2</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>BitXor</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i1</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" ^ "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i2</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>BitAnd</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i1</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" &amp; "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i2</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>BitNot</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"~"</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Neg</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"-"</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Absolute</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"abs "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Signum</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"sgn "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>prec</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Num</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="main"><span>(</span></span><span>signed_string_of_int</span><span> </span><span class="entity"><span>k</span></span><span class="main"><span>)</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>IntReg</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>int_reg_name</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>need_parens</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>out_decls</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>out_decls</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>d</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>out_decl</span></span><span> </span><span class="entity"><span>d</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>out_decls</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>d</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ds</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out_decl</span></span><span> </span><span class="entity"><span>d</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>", "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_decls</span></span><span> </span><span class="entity"><span>ds</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>out_decl</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>DeclNo</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_name</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" : no "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>out_decl</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>DeclLone</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_name</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" : lone "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>out_decl</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>DeclOne</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_name</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" : one "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>out_decl</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>DeclSome</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_name</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" : some "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>out_decl</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>DeclSet</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_name</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" : set "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>out_assigns</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>out_assigns</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>b</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>out_assign</span></span><span> </span><span class="entity"><span>b</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>out_assigns</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>b</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>bs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out_assign</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>", "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_assigns</span></span><span> </span><span class="entity"><span>bs</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>out_assign</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AssignFormulaReg</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>formula_reg_name</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" := "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_f</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>out_assign</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AssignRelReg</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_reg_name</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" := "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_r</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>out_assign</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AssignIntReg</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>int_reg_name</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>" := "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>out_columns</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>out_columns</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>i</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>out_columns</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>is</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out_i</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>", "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_columns</span></span><span> </span><span class="entity"><span>is</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>out_problem</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>comment</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>settings</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>univ_card</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tuple_assigns</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bounds</span></span><span class="main"><span>,</span></span><span>
                     </span><span class="entity"><span>int_bounds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>expr_assigns</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>formula</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>out</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"\n"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>block_comment</span></span><span> </span><span class="entity"><span>comment</span></span><span> </span><span>^</span><span>
              </span><span>implode</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>key</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>value</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>key</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>": "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>value</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"\n"</span></span><span class="main"><span>)</span></span><span>
                            </span><span class="entity"><span>settings</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
              </span><span class="inner_quoted"><span>"univ: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>atom_seq_name</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>univ_card</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"\n"</span></span><span> </span><span>^</span><span>
              </span><span>implode</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>string_for_tuple_assign</span></span><span> </span><span class="entity"><span>tuple_assigns</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
              </span><span>implode</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>string_for_bound</span></span><span> </span><span class="entity"><span>bounds</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
              </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>int_bounds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                 </span><span class="inner_quoted"><span>""</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                 </span><span class="inner_quoted"><span>"int_bounds: "</span></span><span> </span><span>^</span><span>
                 </span><span>commas</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>int_string_for_bound</span></span><span> </span><span class="entity"><span>int_bounds</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"\n"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
         </span><span>List.app</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>out_assign</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>";"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>expr_assigns</span></span><span class="main"><span>;</span></span><span>
         </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>"solve "</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out_outmost_f</span></span><span> </span><span class="entity"><span>formula</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="inner_quoted"><span>";\n"</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>out</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"// This file was generated by Isabelle (most likely Nitpick)\n"</span></span><span> </span><span>^</span><span>
         </span><span class="inner_quoted"><span>"// "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>ATP_Util.timestamp</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"\n"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span>List.app</span><span> </span><span class="entity"><span>out_problem</span></span><span> </span><span class="entity"><span>problems</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="comment1"><span>(** Parsing of solution **)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_ident_char</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Symbol.is_ascii_letter</span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>Symbol.is_ascii_digit</span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span>
  </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"_"</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"'"</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"$"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>strip_blanks</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>strip_blanks</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>" "</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>strip_blanks</span></span><span> </span><span class="entity"><span>ss</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>strip_blanks</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>s1</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>" "</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>s1</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>strip_blanks</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s1</span></span><span> </span><span>::</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>s2</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_ident_char</span></span><span> </span><span class="entity"><span>s1</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>is_ident_char</span></span><span> </span><span class="entity"><span>s2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span class="entity"><span>s1</span></span><span> </span><span>::</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>strip_blanks</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s2</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span class="entity"><span>strip_blanks</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s1</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>s2</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>strip_blanks</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>strip_blanks</span></span><span> </span><span class="entity"><span>ss</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>scan_nat</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Scan.repeat1</span><span> </span><span class="main"><span>(</span></span><span>Scan.one</span><span> </span><span>Symbol.is_ascii_digit</span><span class="main"><span>)</span></span><span>
  </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span>the</span><span> </span><span>o</span><span> </span><span>Int.fromString</span><span> </span><span>o</span><span> </span><span>implode</span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>scan_rel_name</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="inner_quoted"><span>"s"</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>scan_nat</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>pair</span><span> </span><span class="inner_numeral"><span>1</span></span><span>
   </span><span>||</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"r"</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>scan_nat</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>pair</span><span> </span><span class="inner_numeral"><span>2</span></span><span>
   </span><span>||</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="inner_quoted"><span>"m"</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>scan_nat</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"_"</span></span><span class="main"><span>)</span></span><span> </span><span>--</span><span> </span><span class="entity"><span>scan_nat</span></span><span class="main"><span>)</span></span><span> </span><span>--</span><span> </span><span>Scan.option</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="inner_quoted"><span>"'"</span></span><span class="main"><span>)</span></span><span>
  </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span>~</span><span class="entity"><span>j</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
       </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>scan_atom</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"A"</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>scan_nat</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>parse_non_empty_list</span></span><span> </span><span class="entity"><span>scan</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>scan</span></span><span> </span><span>:::</span><span> </span><span>Scan.repeat</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>scan</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>parse_list</span></span><span> </span><span class="entity"><span>scan</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>parse_non_empty_list</span></span><span> </span><span class="entity"><span>scan</span></span><span> </span><span>||</span><span> </span><span>Scan.succeed</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>parse_tuple</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>parse_list</span></span><span> </span><span class="entity"><span>scan_atom</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"]"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>parse_tuple_set</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>parse_list</span></span><span> </span><span class="entity"><span>parse_tuple</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"]"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>parse_assignment</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>scan_rel_name</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"="</span></span><span class="main"><span>)</span></span><span> </span><span>--</span><span> </span><span class="entity"><span>parse_tuple_set</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>parse_instance</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Scan.this_string</span><span> </span><span class="inner_quoted"><span>"relations:"</span></span><span>
  </span><span>|--</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"{"</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>parse_list</span></span><span> </span><span class="entity"><span>parse_assignment</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"}"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>extract_instance</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>fst</span><span> </span><span>o</span><span> </span><span>Scan.finite</span><span> </span><span>Symbol.stopper</span><span>
            </span><span class="main"><span>(</span></span><span>Scan.error</span><span> </span><span class="main"><span>(</span></span><span>!!</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                                </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>SYNTAX</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Kodkod.extract_instance"</span></span><span class="main"><span>,</span></span><span>
                                              </span><span class="inner_quoted"><span>"ill-formed Kodkodi output"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                            </span><span class="entity"><span>parse_instance</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span>o</span><span> </span><span class="entity"><span>strip_blanks</span></span><span> </span><span>o</span><span> </span><span>raw_explode</span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>problem_marker</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"*** PROBLEM "</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>outcome_marker</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"---OUTCOME---\n"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>instance_marker</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"---INSTANCE---\n"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>read_section_body</span></span><span> </span><span class="entity"><span>marker</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Substring.string</span><span> </span><span>o</span><span> </span><span>fst</span><span> </span><span>o</span><span> </span><span>Substring.position</span><span> </span><span class="inner_quoted"><span>"\n\n"</span></span><span>
  </span><span>o</span><span> </span><span>Substring.triml</span><span> </span><span class="main"><span>(</span></span><span>size</span><span> </span><span class="entity"><span>marker</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>read_next_instance</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Substring.position</span><span> </span><span class="entity"><span>instance_marker</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span>|&gt;</span><span> </span><span>snd</span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Substring.isEmpty</span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>SYNTAX</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Kodkod.read_next_instance"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"expected \"INSTANCE\" marker"</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span class="entity"><span>read_section_body</span></span><span> </span><span class="entity"><span>instance_marker</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>extract_instance</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>read_next_outcomes</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>js</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Substring.position</span><span> </span><span class="entity"><span>outcome_marker</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Substring.isEmpty</span><span> </span><span class="entity"><span>s2</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span>
       </span><span>not</span><span> </span><span class="main"><span>(</span></span><span>Substring.isEmpty</span><span> </span><span class="main"><span>(</span></span><span>Substring.position</span><span> </span><span class="entity"><span>problem_marker</span></span><span> </span><span class="entity"><span>s1</span></span><span>
                               </span><span>|&gt;</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>js</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>outcome</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>read_section_body</span></span><span> </span><span class="entity"><span>outcome_marker</span></span><span> </span><span class="entity"><span>s2</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Substring.triml</span><span> </span><span class="main"><span>(</span></span><span>size</span><span> </span><span class="entity"><span>outcome_marker</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>s2</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>String.isSuffix</span><span> </span><span class="inner_quoted"><span>"UNSATISFIABLE"</span></span><span> </span><span class="entity"><span>outcome</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
          </span><span class="entity"><span>read_next_outcomes</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>js</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>String.isSuffix</span><span> </span><span class="inner_quoted"><span>"SATISFIABLE"</span></span><span> </span><span class="entity"><span>outcome</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
          </span><span class="entity"><span>read_next_outcomes</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>read_next_instance</span></span><span> </span><span class="entity"><span>s2</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>js</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
          </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>SYNTAX</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Kodkod.read_next_outcomes"</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="inner_quoted"><span>"unknown outcome "</span></span><span> </span><span>^</span><span> </span><span>quote</span><span> </span><span class="entity"><span>outcome</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>read_next_problems</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>js</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Substring.position</span><span> </span><span class="entity"><span>problem_marker</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span>|&gt;</span><span> </span><span>snd</span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Substring.isEmpty</span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>js</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Substring.triml</span><span> </span><span class="main"><span>(</span></span><span>size</span><span> </span><span class="entity"><span>problem_marker</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>s</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>j_plus_1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span>|&gt;</span><span> </span><span>Substring.takel</span><span> </span><span class="main"><span>(</span></span><span>not_equal</span><span> </span><span class="inner_quoted"><span>#" "</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>Substring.string</span><span>
                         </span><span>|&gt;</span><span> </span><span>Int.fromString</span><span> </span><span>|&gt;</span><span> </span><span>the</span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>j_plus_1</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>read_next_problems</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>read_next_outcomes</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>js</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>Option.Option</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>SYNTAX</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Kodkod.read_next_problems"</span></span><span class="main"><span>,</span></span><span>
                                        </span><span class="inner_quoted"><span>"expected number after \"PROBLEM\""</span></span><span class="main"><span>)</span></span><span>


</span><span class="comment1"><span>(** Main Kodkod entry point **)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>serial_string_and_temporary_dir</span></span><span> </span><span class="entity"><span>overlord</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>overlord</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span> </span><span>getenv</span><span> </span><span class="inner_quoted"><span>"ISABELLE_HOME_USER"</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span>serial_string</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>getenv</span><span> </span><span class="inner_quoted"><span>"ISABELLE_TMP"</span></span><span class="main"><span>)</span></span><span>

</span><span class="comment1"><span>(* The fudge term below is to account for Kodkodi's slow start-up time, which
   is partly due to the JVM and partly due to the ML "bash" function. *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fudge_ms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>250</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>uncached_solve_any_problem</span></span><span> </span><span class="entity"><span>kodkod_scala</span></span><span> </span><span class="entity"><span>overlord</span></span><span> </span><span class="entity"><span>deadline</span></span><span> </span><span class="entity"><span>max_threads0</span></span><span> </span><span class="entity"><span>max_solutions</span></span><span> </span><span class="entity"><span>problems</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>find_index</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>True</span></span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>formula</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>problems</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>indexed_problems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span>&gt;=</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                             </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>problems</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
                           </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                             </span><span>filter_out</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_problem_trivially_false</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span>
                                        </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span>length</span><span> </span><span class="entity"><span>problems</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>problems</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>triv_js</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>filter_out</span><span> </span><span class="main"><span>(</span></span><span>AList.defined</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>indexed_problems</span></span><span class="main"><span>)</span></span><span>
                             </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span>length</span><span> </span><span class="entity"><span>problems</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>reindex</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span>o</span><span> </span><span>nth</span><span> </span><span class="entity"><span>indexed_problems</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>max_threads</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>max_threads0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Options.default_int</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">system_option</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>kodkod_max_threads</span><span>›</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>max_threads0</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>external_process</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>not</span><span> </span><span class="entity"><span>kodkod_scala</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>overlord</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>timeout0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Time.toMilliseconds</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deadline</span></span><span> </span><span>-</span><span> </span><span>Time.now</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>timeout</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>external_process</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>timeout0</span></span><span> </span><span>-</span><span> </span><span class="entity"><span>fudge_ms</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>timeout0</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>solve_all</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>max_solutions</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>1</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>indexed_problems</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span class="entity"><span>Normal</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>triv_js</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>timeout</span></span><span> </span><span>&lt;=</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>TimedOut</span></span><span> </span><span class="entity"><span>triv_js</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>kki</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>buf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Unsynchronized.ref</span><span> </span><span>Buffer.empty</span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Unsynchronized.change</span><span> </span><span class="entity"><span>buf</span></span><span> </span><span class="main"><span>(</span></span><span>Buffer.add</span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>write_problem</span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>snd</span><span> </span><span class="entity"><span>indexed_problems</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Buffer.content</span><span> </span><span class="main"><span>(</span></span><span>!</span><span> </span><span class="entity"><span>buf</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rc</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>out</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>err</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>external_process</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>serial_str</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>temp_dir</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>serial_string_and_temporary_dir</span></span><span> </span><span class="entity"><span>overlord</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>path_for</span></span><span> </span><span class="entity"><span>suf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Path.explode</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>temp_dir</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"/kodkodi"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>serial_str</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"."</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>suf</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>kki_path</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>path_for</span></span><span> </span><span class="inner_quoted"><span>"kki"</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>out_path</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>path_for</span></span><span> </span><span class="inner_quoted"><span>"out"</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>err_path</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>path_for</span></span><span> </span><span class="inner_quoted"><span>"err"</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>remove_temporary_files</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>overlord</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>List.app</span><span> </span><span class="main"><span>(</span></span><span>ignore</span><span> </span><span>o</span><span> </span><span>try</span><span> </span><span>File.rm</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>kki_path</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>out_path</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>err_path</span></span><span class="main"><span>]</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>File.write</span><span> </span><span class="entity"><span>kki_path</span></span><span> </span><span class="entity"><span>kki</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rc</span></span><span> </span><span class="main"><span>=</span></span><span>
                  </span><span class="entity"><span>Isabelle_System.bash</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"cd "</span></span><span> </span><span>^</span><span> </span><span>Bash.string</span><span> </span><span class="entity"><span>temp_dir</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>";\n\
                    \\"$KODKODI/bin/kodkodi\""</span></span><span> </span><span>^</span><span>
                    </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>" -max-msecs "</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>timeout</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
                    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>solve_all</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>" -solve-all"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
                    </span><span class="inner_quoted"><span>" -max-solutions "</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>max_solutions</span></span><span> </span><span>^</span><span>
                    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>max_threads</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>" -max-threads "</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>max_threads</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
                    </span><span class="inner_quoted"><span>" &lt; "</span></span><span> </span><span>^</span><span> </span><span>File.bash_path</span><span> </span><span class="entity"><span>kki_path</span></span><span> </span><span>^</span><span>
                    </span><span class="inner_quoted"><span>" &gt; "</span></span><span> </span><span>^</span><span> </span><span>File.bash_path</span><span> </span><span class="entity"><span>out_path</span></span><span> </span><span>^</span><span>
                    </span><span class="inner_quoted"><span>" 2&gt; "</span></span><span> </span><span>^</span><span> </span><span>File.bash_path</span><span> </span><span class="entity"><span>err_path</span></span><span class="main"><span>)</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>out</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>File.read</span><span> </span><span class="entity"><span>out_path</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>err</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>File.read</span><span> </span><span class="entity"><span>err_path</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>remove_temporary_files</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rc</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>out</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>err</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
              </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span class="entity"><span>exn</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>remove_temporary_files</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span>Exn.reraise</span><span> </span><span class="entity"><span>exn</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>timeout</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>solve_all</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>max_solutions</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>max_threads</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>kki</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>XML.Encode</span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>pair</span><span> </span><span>int</span><span> </span><span class="main"><span>(</span></span><span>pair</span><span> </span><span>bool</span><span> </span><span class="main"><span>(</span></span><span>pair</span><span> </span><span>int</span><span> </span><span class="main"><span>(</span></span><span>pair</span><span> </span><span>int</span><span> </span><span>string</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
            </span><span>|&gt;</span><span> </span><span>YXML.string_of_body</span><span>
            </span><span>|&gt;</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">scala</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>kodkod</span><span>›</span></span></span><span>
            </span><span>|&gt;</span><span> </span><span>YXML.parse_body</span><span>
            </span><span>|&gt;</span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>XML.Decode</span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>triple</span><span> </span><span>int</span><span> </span><span>string</span><span> </span><span>string</span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_js</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>read_next_problems</span></span><span> </span><span class="main"><span>(</span></span><span>Substring.full</span><span> </span><span class="entity"><span>out</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;&gt;</span><span> </span><span>rev</span><span> </span><span>||&gt;</span><span> </span><span>rev</span><span>
          </span><span>|&gt;</span><span> </span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="entity"><span>reindex</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>apsnd</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>reindex</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>js</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>triv_js</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>nontriv_js</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>first_error</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>trim_split_lines</span><span> </span><span class="entity"><span>err</span></span><span>
          </span><span>|&gt;</span><span> </span><span>map</span><span>
           </span><span class="main"><span>(</span></span><span>perhaps</span><span> </span><span class="main"><span>(</span></span><span>try</span><span> </span><span class="main"><span>(</span></span><span>unsuffix</span><span> </span><span class="inner_quoted"><span>"."</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>#&gt;</span><span>
            </span><span>perhaps</span><span> </span><span class="main"><span>(</span></span><span>try</span><span> </span><span class="main"><span>(</span></span><span>unprefix</span><span> </span><span class="inner_quoted"><span>"Solve error: "</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>#&gt;</span><span>
            </span><span>perhaps</span><span> </span><span class="main"><span>(</span></span><span>try</span><span> </span><span class="main"><span>(</span></span><span>unprefix</span><span> </span><span class="inner_quoted"><span>"Error: "</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>find_first</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>line</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>line</span></span><span> </span><span>&lt;&gt;</span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>line</span></span><span> </span><span>&lt;&gt;</span><span> </span><span class="inner_quoted"><span>"EXIT"</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>the_default</span><span> </span><span class="inner_quoted"><span>""</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span>null</span><span> </span><span class="entity"><span>ps</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>rc</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Normal</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>js</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>first_error</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>rc</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>TimedOut</span></span><span> </span><span class="entity"><span>js</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>rc</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>130</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Exn.Interrupt</span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>Error</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>first_error</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"Unknown error"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>first_error</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>js</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cached_outcome</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Synchronized.var</span><span> </span><span class="inner_quoted"><span>"Kodkod.cached_outcome"</span></span><span>
                   </span><span class="main"><span>(</span></span><span>NONE</span><span> </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>int</span><span> * </span><span class="entity"><span>problem</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span> * </span><span class="entity"><span>outcome</span></span><span class="main"><span>)</span></span><span> </span><span>option</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>solve_any_problem</span></span><span> </span><span class="entity"><span>kodkod_scala</span></span><span> </span><span class="entity"><span>debug</span></span><span> </span><span class="entity"><span>overlord</span></span><span> </span><span class="entity"><span>deadline</span></span><span> </span><span class="entity"><span>max_threads</span></span><span> </span><span class="entity"><span>max_solutions</span></span><span>
                      </span><span class="entity"><span>problems</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>do_solve</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>uncached_solve_any_problem</span></span><span> </span><span class="entity"><span>kodkod_scala</span></span><span> </span><span class="entity"><span>overlord</span></span><span> </span><span class="entity"><span>deadline</span></span><span> </span><span class="entity"><span>max_threads</span></span><span> </span><span class="entity"><span>max_solutions</span></span><span>
                                 </span><span class="entity"><span>problems</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>debug</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>overlord</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span class="entity"><span>do_solve</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>AList.lookup</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>max1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ps1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>max2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ps2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                            </span><span class="entity"><span>max1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>max2</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>length</span><span> </span><span class="entity"><span>ps1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>ps2</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
                            </span><span>forall</span><span> </span><span class="entity"><span>problems_equivalent</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ps1</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>ps2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                        </span><span class="main"><span>(</span></span><span>the_list</span><span> </span><span class="main"><span>(</span></span><span>Synchronized.value</span><span> </span><span class="entity"><span>cached_outcome</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                        </span><span class="main"><span>(</span></span><span class="entity"><span>max_solutions</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>problems</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span>SOME</span><span> </span><span class="entity"><span>outcome</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>outcome</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>outcome</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>do_solve</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>outcome</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
             </span><span class="entity"><span>Normal</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
             </span><span>Synchronized.change</span><span> </span><span class="entity"><span>cached_outcome</span></span><span>
                                 </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>max_solutions</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>problems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>outcome</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
           </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="entity"><span>outcome</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>kodkod_scala</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Attrib.setup_option_bool</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">system_option</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>kodkod_scala</span><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span class="entity_def" id="Nitpick.kodkod_scala|attribute"><span>⌂</span></span></span></span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span></pre>
</body>

</html>