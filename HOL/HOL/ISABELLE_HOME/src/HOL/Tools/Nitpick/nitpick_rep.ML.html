<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹Tools/Nitpick/nitpick_rep.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹Tools/Nitpick/nitpick_rep.ML›</h1>
</div>

<pre class="source"><span class="comment1"><span>(*  Title:      HOL/Tools/Nitpick/nitpick_rep.ML
    Author:     Jasmin Blanchette, TU Muenchen
    Copyright   2008, 2009, 2010

Kodkod representations of Nitpick terms.
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>NITPICK_REP</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>polarity</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Nitpick_Util.polarity</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Nitpick_Scope.scope</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Any</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Formula</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> polarity </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Atom</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * int </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Struct</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rep list </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Vect</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * rep </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Func</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rep * rep </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Opt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rep

  </span><span class="keyword1"><span class="keyword"><span>exception</span></span></span><span> REP </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>string</span><span> * </span><span class="entity"><span>rep</span></span><span> </span><span>list</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> string_for_polarity </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>polarity</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> string_for_rep </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> is_Func </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> is_Opt </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> is_opt_rep </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> flip_rep_polarity </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rep</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> card_of_rep </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> arity_of_rep </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> min_univ_card_of_rep </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> is_one_rep </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> is_lone_rep </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> dest_Func </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rep</span></span><span> * </span><span class="entity"><span>rep</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> lazy_range_rep </span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span>Typtab.table</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>unit</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rep</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> binder_reps </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> body_rep </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rep</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> one_rep </span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span>Typtab.table</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rep</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> optable_rep </span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span>Typtab.table</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rep</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> opt_rep </span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span>Typtab.table</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rep</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> unopt_rep </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rep</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> min_rep </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rep</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> min_reps </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> card_of_domain_from_rep </span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rep_to_binary_rel_rep </span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span>Typtab.table</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rep</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> best_one_rep_for_type </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rep</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> best_opt_set_rep_for_type </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rep</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> best_non_opt_set_rep_for_type </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rep</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> best_set_rep_for_type </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rep</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> best_non_opt_symmetric_reps_for_fun_type </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rep</span></span><span> * </span><span class="entity"><span>rep</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> atom_schema_of_rep </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>int</span><span> * </span><span>int</span><span class="main"><span>)</span></span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> atom_schema_of_reps </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>int</span><span> * </span><span>int</span><span class="main"><span>)</span></span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> type_schema_of_rep </span><span class="main"><span>:</span></span><span> </span><span>typ</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> type_schema_of_reps </span><span class="main"><span>:</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> all_combinations_for_rep </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span>list</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> all_combinations_for_reps </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span>list</span><span> </span><span>list</span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Nitpick_Rep</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>NITPICK_REP</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Nitpick_Util</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Nitpick_HOL</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Nitpick_Scope</span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Any</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Formula</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> polarity </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Atom</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * int </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Struct</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rep list </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Vect</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * rep </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Func</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rep * rep </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Opt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rep

</span><span class="keyword1"><span class="keyword"><span>exception</span></span></span><span> </span><span class="entity"><span>REP</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>string</span><span> * </span><span class="entity"><span>rep</span></span><span> </span><span>list</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_for_polarity</span></span><span> </span><span class="entity"><span>Pos</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"+"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_polarity</span></span><span> </span><span class="entity"><span>Neg</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"-"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_polarity</span></span><span> </span><span class="entity"><span>Neut</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>atomic_string_for_rep</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>string_for_rep</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>String.isPrefix</span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_substring_of</span></span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>s</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>s</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>string_for_rep</span></span><span> </span><span class="entity"><span>Any</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"X"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Formula</span></span><span> </span><span class="entity"><span>polar</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"F"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_for_polarity</span></span><span> </span><span class="entity"><span>polar</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Atom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>j0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="inner_quoted"><span>"A"</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>k</span></span><span> </span><span>^</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>j0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>"@"</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>j0</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Struct</span></span><span> </span><span class="entity"><span>rs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span>^</span><span> </span><span>commas</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>string_for_rep</span></span><span> </span><span class="entity"><span>rs</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"]"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Vect</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span>string_of_int</span><span> </span><span class="entity"><span>k</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" x "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>atomic_string_for_rep</span></span><span> </span><span class="entity"><span>R</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>atomic_string_for_rep</span></span><span> </span><span class="entity"><span>R1</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" =&gt; "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_for_rep</span></span><span> </span><span class="entity"><span>R2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Opt</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>atomic_string_for_rep</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"?"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_Func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_Func</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_Opt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Opt</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_Opt</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_opt_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>is_opt_rep</span></span><span> </span><span class="entity"><span>R2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_opt_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Opt</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_opt_rep</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>card_of_rep</span></span><span> </span><span class="entity"><span>Any</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>REP</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Nitpick_Rep.card_of_rep"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Any</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>card_of_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Formula</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>card_of_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Atom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>k</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>card_of_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Struct</span></span><span> </span><span class="entity"><span>rs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Integer.prod</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>card_of_rep</span></span><span> </span><span class="entity"><span>rs</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>card_of_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Vect</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>reasonable_power</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>card_of_rep</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>k</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>card_of_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>reasonable_power</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>card_of_rep</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>card_of_rep</span></span><span> </span><span class="entity"><span>R1</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>card_of_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Opt</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>card_of_rep</span></span><span> </span><span class="entity"><span>R</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>arity_of_rep</span></span><span> </span><span class="entity"><span>Any</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>REP</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Nitpick_Rep.arity_of_rep"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Any</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Formula</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Atom</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Struct</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Integer.sum</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>arity_of_rep</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Vect</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>arity_of_rep</span></span><span> </span><span class="entity"><span>R</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>arity_of_rep</span></span><span> </span><span class="entity"><span>R1</span></span><span> </span><span>+</span><span> </span><span class="entity"><span>arity_of_rep</span></span><span> </span><span class="entity"><span>R2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Opt</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>arity_of_rep</span></span><span> </span><span class="entity"><span>R</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>min_univ_card_of_rep</span></span><span> </span><span class="entity"><span>Any</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>REP</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Nitpick_Rep.min_univ_card_of_rep"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Any</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>min_univ_card_of_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Formula</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>min_univ_card_of_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Atom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>j0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span>+</span><span> </span><span class="entity"><span>j0</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>min_univ_card_of_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Struct</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span>fold</span><span> </span><span>Integer.max</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>min_univ_card_of_rep</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>min_univ_card_of_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Vect</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>min_univ_card_of_rep</span></span><span> </span><span class="entity"><span>R</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>min_univ_card_of_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span>Int.max</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>min_univ_card_of_rep</span></span><span> </span><span class="entity"><span>R1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>min_univ_card_of_rep</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>min_univ_card_of_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Opt</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>min_univ_card_of_rep</span></span><span> </span><span class="entity"><span>R</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_one_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Atom</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_one_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Struct</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_one_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Vect</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_one_rep</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_lone_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Opt</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>is_one_rep</span></span><span> </span><span class="entity"><span>R</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_lone_rep</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>is_one_rep</span></span><span> </span><span class="entity"><span>R</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dest_Func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Func</span></span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>z</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>dest_Func</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>REP</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Nitpick_Rep.dest_Func"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>R</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>lazy_range_rep</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Vect</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>R</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>lazy_range_rep</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>R2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>lazy_range_rep</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>ran_card</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Opt</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Opt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lazy_range_rep</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>ran_card</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>lazy_range_rep</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="main"><span>(</span></span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>fun</span><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Atom</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Atom</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>offset_of_type</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="entity"><span>T2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>lazy_range_rep</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="main"><span>(</span></span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>fun</span><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ran_card</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Atom</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Atom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ran_card</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>offset_of_type</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="entity"><span>T2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>lazy_range_rep</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>REP</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Nitpick_Rep.lazy_range_rep"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>R</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>binder_reps</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>R1</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>binder_reps</span></span><span> </span><span class="entity"><span>R2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>binder_reps</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>body_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>body_rep</span></span><span> </span><span class="entity"><span>R2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>body_rep</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>R</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>flip_rep_polarity</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Formula</span></span><span> </span><span class="entity"><span>polar</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Formula</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>flip_polarity</span></span><span> </span><span class="entity"><span>polar</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>flip_rep_polarity</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>flip_rep_polarity</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>flip_rep_polarity</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>R</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>one_rep</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>Any</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>REP</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Nitpick_Rep.one_rep"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Any</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>one_rep</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Atom</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Atom</span></span><span> </span><span class="entity"><span>x</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>one_rep</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Struct</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Struct</span></span><span> </span><span class="entity"><span>Rs</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>one_rep</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Vect</span></span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Vect</span></span><span> </span><span class="entity"><span>z</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>one_rep</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Opt</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>one_rep</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>R</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>one_rep</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Atom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>card_of_rep</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>offset_of_type</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>optable_rep</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="main"><span>(</span></span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>fun</span><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>optable_rep</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="entity"><span>T2</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>optable_rep</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="main"><span>(</span></span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Set.html#Set.set|type"><span>set</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>optable_rep</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T'</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>bool_T</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>R</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>optable_rep</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>one_rep</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>R</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>opt_rep</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="main"><span>(</span></span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>fun</span><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>opt_rep</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="entity"><span>T2</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>opt_rep</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="main"><span>(</span></span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Set.html#Set.set|type"><span>set</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>opt_rep</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T'</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>bool_T</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>R</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>opt_rep</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Opt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>optable_rep</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>unopt_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>unopt_rep</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>unopt_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Opt</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>R</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>unopt_rep</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>R</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>min_polarity</span></span><span> </span><span class="entity"><span>polar1</span></span><span> </span><span class="entity"><span>polar2</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>polar1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>polar2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
    </span><span class="entity"><span>polar1</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>polar1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Neut</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
    </span><span class="entity"><span>polar2</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>polar2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Neut</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
    </span><span class="entity"><span>polar1</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
    </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>ARG</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Nitpick_Rep.min_polarity"</span></span><span class="main"><span>,</span></span><span>
               </span><span>commas</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>quote</span><span> </span><span>o</span><span> </span><span class="entity"><span>string_for_polarity</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>polar1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>polar2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="comment1"><span>(* It's important that Func is before Vect, because if the range is Opt we
   could lose information by converting a Func to a Vect. *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>min_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Opt</span></span><span> </span><span class="entity"><span>R1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Opt</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Opt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>min_rep</span></span><span> </span><span class="entity"><span>R1</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>min_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Opt</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Opt</span></span><span> </span><span class="entity"><span>R</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>min_rep</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Opt</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Opt</span></span><span> </span><span class="entity"><span>R</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>min_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Formula</span></span><span> </span><span class="entity"><span>polar1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Formula</span></span><span> </span><span class="entity"><span>polar2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Formula</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>min_polarity</span></span><span> </span><span class="entity"><span>polar1</span></span><span> </span><span class="entity"><span>polar2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>min_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Formula</span></span><span> </span><span class="entity"><span>polar</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Formula</span></span><span> </span><span class="entity"><span>polar</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>min_rep</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Formula</span></span><span> </span><span class="entity"><span>polar</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Formula</span></span><span> </span><span class="entity"><span>polar</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>min_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Atom</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Atom</span></span><span> </span><span class="entity"><span>x</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>min_rep</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Atom</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Atom</span></span><span> </span><span class="entity"><span>x</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>min_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Struct</span></span><span> </span><span class="entity"><span>Rs1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Struct</span></span><span> </span><span class="entity"><span>Rs2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Struct</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>min_reps</span></span><span> </span><span class="entity"><span>Rs1</span></span><span> </span><span class="entity"><span>Rs2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>min_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Struct</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Struct</span></span><span> </span><span class="entity"><span>Rs</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>min_rep</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Struct</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Struct</span></span><span> </span><span class="entity"><span>Rs</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>min_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R1</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R11</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R12</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R2</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R21</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R22</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>apply2</span><span> </span><span class="entity"><span>is_opt_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R12</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R22</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
       </span><span class="main"><span>(</span></span><span>true</span><span class="main"><span>,</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>R1</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>false</span><span class="main"><span>,</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>R2</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>R11</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>R21</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R11</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>min_rep</span></span><span> </span><span class="entity"><span>R12</span></span><span> </span><span class="entity"><span>R22</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>min_rep</span></span><span> </span><span class="entity"><span>R11</span></span><span> </span><span class="entity"><span>R21</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>R11</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>R1</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>min_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Func</span></span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Func</span></span><span> </span><span class="entity"><span>z</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>min_rep</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Func</span></span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Func</span></span><span> </span><span class="entity"><span>z</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>min_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Vect</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Vect</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>k1</span></span><span> </span><span>&lt;</span><span> </span><span class="entity"><span>k2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Vect</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R1</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>k1</span></span><span> </span><span>&gt;</span><span> </span><span class="entity"><span>k2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Vect</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>Vect</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>min_rep</span></span><span> </span><span class="entity"><span>R1</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>min_rep</span></span><span> </span><span class="entity"><span>R1</span></span><span> </span><span class="entity"><span>R2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>REP</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Nitpick_Rep.min_rep"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>R1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>min_reps</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>min_reps</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>min_reps</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R1</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>Rs1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R2</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>Rs2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>R1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>R2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>R1</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>min_reps</span></span><span> </span><span class="entity"><span>Rs1</span></span><span> </span><span class="entity"><span>Rs2</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>min_rep</span></span><span> </span><span class="entity"><span>R1</span></span><span> </span><span class="entity"><span>R2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>R1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>R1</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>Rs1</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>R2</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>Rs2</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>card_of_domain_from_rep</span></span><span> </span><span class="entity"><span>ran_card</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span class="entity"><span>Atom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>exact_log</span></span><span> </span><span class="entity"><span>ran_card</span></span><span> </span><span class="entity"><span>k</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Vect</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>k</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R1</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>card_of_rep</span></span><span> </span><span class="entity"><span>R1</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Opt</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>card_of_domain_from_rep</span></span><span> </span><span class="entity"><span>ran_card</span></span><span> </span><span class="entity"><span>R</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>REP</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Nitpick_Rep.card_of_domain_from_rep"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>R</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rep_to_binary_rel_rep</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>exact_root</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>card_of_domain_from_rep</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>j0</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>offset_of_type</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.dest_prodT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pseudo_domain_type</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Struct</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Atom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>j0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Atom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>j0</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Formula</span></span><span> </span><span class="entity"><span>Neut</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>best_one_rep_for_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>scope</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>card_assigns</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>scope</span></span><span class="main"><span>)</span></span><span>
                          </span><span class="main"><span>(</span></span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>fun</span><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Vect</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>card_of_type</span></span><span> </span><span class="entity"><span>card_assigns</span></span><span> </span><span class="entity"><span>T1</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>best_one_rep_for_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>T2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>best_one_rep_for_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="main"><span>(</span></span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Set.html#Set.set|type"><span>set</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>best_one_rep_for_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T'</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>bool_T</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>best_one_rep_for_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="main"><span>(</span></span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.prod|type"><span>prod</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Struct</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>best_one_rep_for_type</span></span><span> </span><span class="entity"><span>scope</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>best_one_rep_for_type</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>card_assigns</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ofs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Atom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>card_of_type</span></span><span> </span><span class="entity"><span>card_assigns</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>offset_of_type</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>best_opt_set_rep_for_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="main"><span>(</span></span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>fun</span><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>best_one_rep_for_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>T1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>best_opt_set_rep_for_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>T2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>best_opt_set_rep_for_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="main"><span>(</span></span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Set.html#Set.set|type"><span>set</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>best_opt_set_rep_for_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T'</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>bool_T</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>best_opt_set_rep_for_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>scope</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>ofs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>opt_rep</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>best_one_rep_for_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>best_non_opt_set_rep_for_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="main"><span>(</span></span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>fun</span><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>best_one_rep_for_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>T1</span></span><span class="main"><span>,</span></span><span>
           </span><span class="entity"><span>best_non_opt_set_rep_for_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>T2</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
       </span><span class="main"><span>(</span></span><span class="entity"><span>R1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Atom</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Formula</span></span><span> </span><span class="entity"><span>Neut</span></span><span class="main"><span>)</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Func</span></span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>best_non_opt_set_rep_for_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="main"><span>(</span></span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Set.html#Set.set|type"><span>set</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>best_non_opt_set_rep_for_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T'</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>bool_T</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>best_non_opt_set_rep_for_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>best_one_rep_for_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>T</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>best_set_rep_for_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>scope</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>data_types</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_exact_type</span></span><span> </span><span class="entity"><span>data_types</span></span><span> </span><span>true</span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>best_non_opt_set_rep_for_type</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>best_opt_set_rep_for_type</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>T</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>best_non_opt_symmetric_reps_for_fun_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>scope</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>ofs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>
                                           </span><span class="main"><span>(</span></span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>fun</span><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>optable_rep</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="entity"><span>T1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>best_one_rep_for_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>T1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="entity"><span>optable_rep</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="entity"><span>T2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>best_one_rep_for_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>T2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>best_non_opt_symmetric_reps_for_fun_type</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>TYPE</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Nitpick_Rep.best_non_opt_symmetric_reps_for_fun_type"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>atom_schema_of_rep</span></span><span> </span><span class="entity"><span>Any</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>REP</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Nitpick_Rep.atom_schema_of_rep"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Any</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>atom_schema_of_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Formula</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>atom_schema_of_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Atom</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>atom_schema_of_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Struct</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>atom_schema_of_reps</span></span><span> </span><span class="entity"><span>Rs</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>atom_schema_of_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Vect</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>replicate_list</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>atom_schema_of_rep</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>atom_schema_of_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>atom_schema_of_rep</span></span><span> </span><span class="entity"><span>R1</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>atom_schema_of_rep</span></span><span> </span><span class="entity"><span>R2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>atom_schema_of_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Opt</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>atom_schema_of_rep</span></span><span> </span><span class="entity"><span>R</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>atom_schema_of_reps</span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>maps</span><span> </span><span class="entity"><span>atom_schema_of_rep</span></span><span> </span><span class="entity"><span>Rs</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>type_schema_of_rep</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Formula</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_schema_of_rep</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Atom</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_schema_of_rep</span></span><span> </span><span class="main"><span>(</span></span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.prod|type"><span>prod</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Struct</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>R1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>type_schema_of_reps</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T2</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>R1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_schema_of_rep</span></span><span> </span><span class="main"><span>(</span></span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>fun</span><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Vect</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>replicate_list</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>type_schema_of_rep</span></span><span> </span><span class="entity"><span>T2</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_schema_of_rep</span></span><span> </span><span class="main"><span>(</span></span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>fun</span><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>type_schema_of_rep</span></span><span> </span><span class="entity"><span>T1</span></span><span> </span><span class="entity"><span>R1</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>type_schema_of_rep</span></span><span> </span><span class="entity"><span>T2</span></span><span> </span><span class="entity"><span>R2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_schema_of_rep</span></span><span> </span><span class="main"><span>(</span></span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Set.html#Set.set|type"><span>set</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>type_schema_of_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T'</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>bool_T</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>R</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_schema_of_rep</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Opt</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>type_schema_of_rep</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>R</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_schema_of_rep</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>REP</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Nitpick_Rep.type_schema_of_rep"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>R</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>type_schema_of_reps</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="entity"><span>type_schema_of_rep</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>all_combinations_for_rep</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>all_combinations</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>atom_schema_of_rep</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>all_combinations_for_reps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>all_combinations</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>atom_schema_of_reps</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span></pre>
</body>

</html>