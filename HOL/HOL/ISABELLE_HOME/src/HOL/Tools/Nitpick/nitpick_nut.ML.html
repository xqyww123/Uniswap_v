<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹Tools/Nitpick/nitpick_nut.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹Tools/Nitpick/nitpick_nut.ML›</h1>
</div>

<pre class="source"><span class="comment1"><span>(*  Title:      HOL/Tools/Nitpick/nitpick_nut.ML
    Author:     Jasmin Blanchette, TU Muenchen
    Copyright   2008, 2009, 2010

Nitpick underlying terms (nuts).
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>NITPICK_NUT</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>hol_context</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Nitpick_HOL.hol_context</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Nitpick_Scope.scope</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>name_pool</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Nitpick_Peephole.name_pool</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Nitpick_Rep.rep</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>cst</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>False</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>True</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Iden</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Num</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Unknown</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Unrep</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Suc</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Add</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Subtract</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Multiply</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Divide</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Gcd</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Lcm</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Fracs</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>NormFrac</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>NatToInt</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>IntToNat</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>op1</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Not</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Finite</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Converse</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Closure</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>SingletonSet</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>IsUnknown</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>SafeThe</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>First</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Second</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Cast</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>op2</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>All</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Exist</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Less</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>DefEq</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Eq</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Triad</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Composition</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Apply</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Lambda</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>op3</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Let</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>If</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Cst</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> cst * typ * rep </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Op1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> op1 * typ * rep * nut </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Op2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> op2 * typ * rep * nut * nut </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Op3</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> op3 * typ * rep * nut * nut * nut </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Tuple</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> typ * rep * nut list </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Construct</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> nut list * typ * rep * nut list </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>BoundName</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * typ * rep * string </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>FreeName</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string * typ * rep </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>ConstName</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string * typ * rep </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>BoundRel</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> Kodkod.n_ary_index * typ * rep * string </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>FreeRel</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> Kodkod.n_ary_index * typ * rep * string </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>RelReg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * typ * rep </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>FormulaReg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * typ * rep

  </span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> NameTable </span><span class="main"><span>:</span></span><span> </span><span>TABLE</span><span>

  </span><span class="keyword1"><span class="keyword"><span>exception</span></span></span><span> NUT </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>string</span><span> * </span><span class="entity"><span>nut</span></span><span> </span><span>list</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> string_for_nut </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> inline_nut </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> type_of </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rep_of </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rep</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nickname_of </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> is_skolem_name </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> is_eval_name </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> is_Cst </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>cst</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> fold_nut </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nut</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> map_nut </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nut</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>nut</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>nut</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> untuple </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nut</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> add_free_and_const_names </span><span class="main"><span>:</span></span><span>
    </span><span class="entity"><span>nut</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span>list</span><span> * </span><span class="entity"><span>nut</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span>list</span><span> * </span><span class="entity"><span>nut</span></span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> name_ord </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span>ord</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> the_name </span><span class="main"><span>:</span></span><span> </span><span>'a</span><span> </span><span>NameTable.table</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> the_rel </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span>NameTable.table</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Kodkod.n_ary_index</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nut_from_term </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>hol_context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>op2</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>nut</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> is_fully_representable_set </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> choose_reps_for_free_vars </span><span class="main"><span>:</span></span><span>
    </span><span class="entity"><span>scope</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>typ</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span>NameTable.table</span><span>
    </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span>list</span><span> * </span><span class="entity"><span>rep</span></span><span> </span><span>NameTable.table</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> choose_reps_for_consts </span><span class="main"><span>:</span></span><span>
    </span><span class="entity"><span>scope</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span>NameTable.table</span><span>
    </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span>list</span><span> * </span><span class="entity"><span>rep</span></span><span> </span><span>NameTable.table</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> choose_reps_for_all_sels </span><span class="main"><span>:</span></span><span>
    </span><span class="entity"><span>scope</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span>NameTable.table</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span>list</span><span> * </span><span class="entity"><span>rep</span></span><span> </span><span>NameTable.table</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> choose_reps_in_nut </span><span class="main"><span>:</span></span><span>
    </span><span class="entity"><span>scope</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span>NameTable.table</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>nut</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rename_free_vars </span><span class="main"><span>:</span></span><span>
    </span><span class="entity"><span>nut</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>name_pool</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span>NameTable.table</span><span>
    </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span>list</span><span> * </span><span class="entity"><span>name_pool</span></span><span> * </span><span class="entity"><span>nut</span></span><span> </span><span>NameTable.table</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rename_vars_in_nut </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>name_pool</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span>NameTable.table</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>nut</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Nitpick_Nut</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>NITPICK_NUT</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Nitpick_Util</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Nitpick_HOL</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Nitpick_Scope</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Nitpick_Peephole</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Nitpick_Rep</span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>KK</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Kodkod</span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>cst</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>False</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>True</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Iden</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Num</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Unknown</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Unrep</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Suc</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Add</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Subtract</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Multiply</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Divide</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Gcd</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Lcm</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Fracs</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>NormFrac</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>NatToInt</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>IntToNat</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>op1</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Not</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Finite</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Converse</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Closure</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>SingletonSet</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>IsUnknown</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>SafeThe</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>First</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Second</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Cast</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>op2</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>All</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Exist</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Less</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>DefEq</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Eq</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Triad</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Composition</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Apply</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Lambda</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>op3</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Let</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>If</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Cst</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> cst * typ * rep </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Op1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> op1 * typ * rep * nut </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Op2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> op2 * typ * rep * nut * nut </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Op3</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> op3 * typ * rep * nut * nut * nut </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Tuple</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> typ * rep * nut list </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Construct</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> nut list * typ * rep * nut list </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>BoundName</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * typ * rep * string </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>FreeName</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string * typ * rep </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>ConstName</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string * typ * rep </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>BoundRel</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> KK.n_ary_index * typ * rep * string </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>FreeRel</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> KK.n_ary_index * typ * rep * string </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>RelReg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * typ * rep </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>FormulaReg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * typ * rep

</span><span class="keyword1"><span class="keyword"><span>exception</span></span></span><span> </span><span class="entity"><span>NUT</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>string</span><span> * </span><span class="entity"><span>nut</span></span><span> </span><span>list</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_for_cst</span></span><span> </span><span class="entity"><span>False</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"False"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_cst</span></span><span> </span><span class="entity"><span>True</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"True"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_cst</span></span><span> </span><span class="entity"><span>Iden</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Iden"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Num</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Num "</span></span><span> </span><span>^</span><span> </span><span>signed_string_of_int</span><span> </span><span class="entity"><span>j</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_cst</span></span><span> </span><span class="entity"><span>Unknown</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Unknown"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_cst</span></span><span> </span><span class="entity"><span>Unrep</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Unrep"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_cst</span></span><span> </span><span class="entity"><span>Suc</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Suc"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_cst</span></span><span> </span><span class="entity"><span>Add</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Add"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_cst</span></span><span> </span><span class="entity"><span>Subtract</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Subtract"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_cst</span></span><span> </span><span class="entity"><span>Multiply</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Multiply"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_cst</span></span><span> </span><span class="entity"><span>Divide</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Divide"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_cst</span></span><span> </span><span class="entity"><span>Gcd</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Gcd"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_cst</span></span><span> </span><span class="entity"><span>Lcm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Lcm"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_cst</span></span><span> </span><span class="entity"><span>Fracs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Fracs"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_cst</span></span><span> </span><span class="entity"><span>NormFrac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"NormFrac"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_cst</span></span><span> </span><span class="entity"><span>NatToInt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"NatToInt"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_cst</span></span><span> </span><span class="entity"><span>IntToNat</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"IntToNat"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_for_op1</span></span><span> </span><span class="entity"><span>Not</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Not"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_op1</span></span><span> </span><span class="entity"><span>Finite</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Finite"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_op1</span></span><span> </span><span class="entity"><span>Converse</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Converse"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_op1</span></span><span> </span><span class="entity"><span>Closure</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Closure"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_op1</span></span><span> </span><span class="entity"><span>SingletonSet</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"SingletonSet"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_op1</span></span><span> </span><span class="entity"><span>IsUnknown</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"IsUnknown"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_op1</span></span><span> </span><span class="entity"><span>SafeThe</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"SafeThe"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_op1</span></span><span> </span><span class="entity"><span>First</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"First"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_op1</span></span><span> </span><span class="entity"><span>Second</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Second"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_op1</span></span><span> </span><span class="entity"><span>Cast</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Cast"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_for_op2</span></span><span> </span><span class="entity"><span>All</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"All"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_op2</span></span><span> </span><span class="entity"><span>Exist</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Exist"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_op2</span></span><span> </span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Or"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_op2</span></span><span> </span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"And"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_op2</span></span><span> </span><span class="entity"><span>Less</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Less"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_op2</span></span><span> </span><span class="entity"><span>DefEq</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"DefEq"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_op2</span></span><span> </span><span class="entity"><span>Eq</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Eq"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_op2</span></span><span> </span><span class="entity"><span>Triad</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Triad"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_op2</span></span><span> </span><span class="entity"><span>Composition</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Composition"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_op2</span></span><span> </span><span class="entity"><span>Apply</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Apply"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_op2</span></span><span> </span><span class="entity"><span>Lambda</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Lambda"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_for_op3</span></span><span> </span><span class="entity"><span>Let</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Let"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_for_op3</span></span><span> </span><span class="entity"><span>If</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"If"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>basic_string_for_nut</span></span><span> </span><span class="entity"><span>indent</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>basic_string_for_nut</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>indent</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>indent</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>"\n"</span></span><span> </span><span>^</span><span> </span><span>implode</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>indent</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>" "</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
    </span><span class="inner_quoted"><span>"("</span></span><span> </span><span>^</span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
       </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
       </span><span class="inner_quoted"><span>"Cst "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_for_cst</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span>Syntax.string_of_typ</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span>
       </span><span class="entity"><span>string_for_rep</span></span><span> </span><span class="entity"><span>R</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Op1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oper</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
       </span><span class="inner_quoted"><span>"Op1 "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_for_op1</span></span><span> </span><span class="entity"><span>oper</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span>Syntax.string_of_typ</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span>
       </span><span class="entity"><span>string_for_rep</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>u1</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oper</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
       </span><span class="inner_quoted"><span>"Op2 "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_for_op2</span></span><span> </span><span class="entity"><span>oper</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span>Syntax.string_of_typ</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span>
       </span><span class="entity"><span>string_for_rep</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>u2</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Op3</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oper</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u3</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
       </span><span class="inner_quoted"><span>"Op3 "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_for_op3</span></span><span> </span><span class="entity"><span>oper</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span>Syntax.string_of_typ</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span>
       </span><span class="entity"><span>string_for_rep</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>u2</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>u3</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Tuple</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>us</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
       </span><span class="inner_quoted"><span>"Tuple "</span></span><span> </span><span>^</span><span> </span><span>Syntax.string_of_typ</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_for_rep</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span>^</span><span>
       </span><span>implode</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>us</span></span><span class="main"><span>)</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Construct</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>us'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>us</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
       </span><span class="inner_quoted"><span>"Construct "</span></span><span> </span><span>^</span><span> </span><span>implode</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>us'</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span>
       </span><span>Syntax.string_of_typ</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_for_rep</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span>
       </span><span>implode</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>us</span></span><span class="main"><span>)</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>BoundName</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nick</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
       </span><span class="inner_quoted"><span>"BoundName "</span></span><span> </span><span>^</span><span> </span><span>signed_string_of_int</span><span> </span><span class="entity"><span>j</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span>
       </span><span>Syntax.string_of_typ</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_for_rep</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nick</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>FreeName</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
       </span><span class="inner_quoted"><span>"FreeName "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>s</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span>Syntax.string_of_typ</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span>
       </span><span class="entity"><span>string_for_rep</span></span><span> </span><span class="entity"><span>R</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>ConstName</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
       </span><span class="inner_quoted"><span>"ConstName "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>s</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span>Syntax.string_of_typ</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span>
       </span><span class="entity"><span>string_for_rep</span></span><span> </span><span class="entity"><span>R</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>BoundRel</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nick</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
       </span><span class="inner_quoted"><span>"BoundRel "</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"."</span></span><span> </span><span>^</span><span> </span><span>signed_string_of_int</span><span> </span><span class="entity"><span>j</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span>
       </span><span>Syntax.string_of_typ</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_for_rep</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nick</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>FreeRel</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nick</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
       </span><span class="inner_quoted"><span>"FreeRel "</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"."</span></span><span> </span><span>^</span><span> </span><span>signed_string_of_int</span><span> </span><span class="entity"><span>j</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span>
       </span><span>Syntax.string_of_typ</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_for_rep</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nick</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>RelReg</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
       </span><span class="inner_quoted"><span>"RelReg "</span></span><span> </span><span>^</span><span> </span><span>signed_string_of_int</span><span> </span><span class="entity"><span>j</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span>Syntax.string_of_typ</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>^</span><span>
       </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_for_rep</span></span><span> </span><span class="entity"><span>R</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>FormulaReg</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
       </span><span class="inner_quoted"><span>"FormulaReg "</span></span><span> </span><span>^</span><span> </span><span>signed_string_of_int</span><span> </span><span class="entity"><span>j</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span>
       </span><span>Syntax.string_of_typ</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_for_rep</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
    </span><span class="inner_quoted"><span>")"</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>string_for_nut</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>basic_string_for_nut</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>inline_nut</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Op1</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>inline_nut</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>inline_nut</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Op3</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>inline_nut</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Tuple</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>us</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>forall</span><span> </span><span class="entity"><span>inline_nut</span></span><span> </span><span class="entity"><span>us</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>inline_nut</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>T</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Op1</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>T</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>T</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Op3</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>T</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Tuple</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>T</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Construct</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>T</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoundName</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>T</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FreeName</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>T</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ConstName</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>T</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoundRel</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>T</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FreeRel</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>T</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>RelReg</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>T</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FormulaReg</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>T</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rep_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>R</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>rep_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Op1</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>R</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>rep_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>R</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>rep_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Op3</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>R</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>rep_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Tuple</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>R</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>rep_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Construct</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>R</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>rep_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoundName</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>R</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>rep_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FreeName</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>R</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>rep_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ConstName</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>R</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>rep_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoundRel</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>R</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>rep_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FreeRel</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>R</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>rep_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>RelReg</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>R</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>rep_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FormulaReg</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>R</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>nickname_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoundName</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nick</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nick</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>nickname_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FreeName</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>s</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>nickname_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ConstName</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>s</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>nickname_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoundRel</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nick</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nick</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>nickname_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FreeRel</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nick</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nick</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>nickname_of</span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>NUT</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Nitpick_Nut.nickname_of"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>u</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_skolem_name</span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>space_explode</span><span> </span><span class="entity"><span>name_sep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nickname_of</span></span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>)</span></span><span>
  </span><span>|&gt;</span><span> </span><span>exists</span><span> </span><span class="main"><span>(</span></span><span>String.isPrefix</span><span> </span><span class="entity"><span>skolem_prefix</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span class="entity"><span>NUT</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Nitpick_Nut.nickname_of"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_eval_name</span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>String.isPrefix</span><span> </span><span class="entity"><span>eval_prefix</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nickname_of</span></span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span class="entity"><span>NUT</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Nitpick_Nut.nickname_of"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_Cst</span></span><span> </span><span class="entity"><span>cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cst'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>cst'</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_Cst</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fold_nut</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span class="entity"><span>Op1</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_nut</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>u1</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_nut</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_nut</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>u2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Op3</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u3</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_nut</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_nut</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>u2</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_nut</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>u3</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Tuple</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>us</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_nut</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>us</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Construct</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>us'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>us</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_nut</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>us</span></span><span> </span><span>#&gt;</span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_nut</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>us'</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>u</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_nut</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span class="entity"><span>Op1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oper</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Op1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oper</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_nut</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oper</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oper</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_nut</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_nut</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Op3</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oper</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u3</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="entity"><span>Op3</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oper</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_nut</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_nut</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_nut</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>u3</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Tuple</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>us</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Tuple</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_nut</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>us</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Construct</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>us'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>us</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="entity"><span>Construct</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_nut</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>us'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_nut</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>us</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>u</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>name_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoundName</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j1</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>BoundName</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j2</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span>int_ord</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>j2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>name_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoundName</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>LESS</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>name_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>BoundName</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>GREATER</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>name_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FreeName</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T1</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FreeName</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T2</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>fast_string_ord</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s2</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
       </span><span>EQUAL</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term_Ord.typ_ord</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T2</span></span><span class="main"><span>)</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>ord</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>ord</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>name_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FreeName</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>LESS</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>name_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FreeName</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>GREATER</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>name_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ConstName</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T1</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ConstName</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T2</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>fast_string_ord</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s2</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
       </span><span>EQUAL</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term_Ord.typ_ord</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T2</span></span><span class="main"><span>)</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>ord</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>ord</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>name_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>NUT</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Nitpick_Nut.name_ord"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>num_occurrences_in_nut</span></span><span> </span><span class="entity"><span>needle_u</span></span><span> </span><span class="entity"><span>stack_u</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>fold_nut</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>needle_u</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Integer.add</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>I</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>stack_u</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>is_subnut_of</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>not_equal</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>num_occurrences_in_nut</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>substitute_in_nut</span></span><span> </span><span class="entity"><span>needle_u</span></span><span> </span><span class="entity"><span>needle_u'</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>map_nut</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>needle_u</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>needle_u'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>add_free_and_const_names</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>fold_nut</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                      </span><span class="entity"><span>FreeName</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>insert</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>ConstName</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>apsnd</span><span> </span><span class="main"><span>(</span></span><span>insert</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>I</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>modify_name_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoundName</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nick</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>BoundName</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nick</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>modify_name_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FreeName</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>FreeName</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>modify_name_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ConstName</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ConstName</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>modify_name_rep</span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>NUT</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Nitpick_Nut.modify_name_rep"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>u</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>NameTable</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Table</span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>key</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nut</span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ord</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>name_ord</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>the_name</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>NameTable.lookup</span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span>SOME</span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>u</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>NUT</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Nitpick_Nut.the_name"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>name</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>the_rel</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>the_name</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span class="entity"><span>FreeRel</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>x</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>NUT</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Nitpick_Nut.the_rel"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>u</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_fst</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.Pair|const"><span>Pair</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t1</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>domain_type</span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_fst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>res_T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.dest_prodT</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>res_T</span></span><span class="main"><span>,</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>res_T</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_snd</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.Pair|const"><span>Pair</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>(</span></span><span>domain_type</span><span> </span><span class="main"><span>(</span></span><span>range_type</span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_snd</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>res_T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>snd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.dest_prodT</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>res_T</span></span><span class="main"><span>,</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.prod.snd|const"><span>snd</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>res_T</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>factorize</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.prod|type"><span>prod</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span>maps</span><span> </span><span class="entity"><span>factorize</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mk_fst</span></span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_snd</span></span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>factorize</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>z</span></span><span class="main"><span>]</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>nut_from_term</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>hol_ctxt</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>eq</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>aux</span></span><span> </span><span class="entity"><span>eq</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>aux</span></span><span> </span><span class="entity"><span>Eq</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>Ts</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sub'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>aux</span></span><span> </span><span class="entity"><span>eq</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>Ts</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>sub_abs</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>aux</span></span><span> </span><span class="entity"><span>eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>sub_equals</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span class="entity"><span>t2</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>binder_Ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body_T</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>strip_type</span><span> </span><span class="main"><span>(</span></span><span>domain_type</span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>binder_Ts</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>eq</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Eq</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>incr_boundvars</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>t1</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>incr_boundvars</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>t2</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>Bound</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>downto</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>equation</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.eq|const"><span>HOL.eq</span></a><span>›</span></span><span class="main"><span>,</span></span><span>
                                      </span><span class="entity"><span>body_T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>body_T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>bool_T</span></span><span class="main"><span>)</span></span><span>
                                   </span><span>$</span><span> </span><span>betapplys</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>betapplys</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span>
                  </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                               </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.All|const"><span>All</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>bool_T</span></span><span class="main"><span>)</span></span><span>
                                </span><span>$</span><span> </span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"x"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nat_subscript</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                           </span><span class="entity"><span>binder_Ts</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>equation</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>fst</span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>sub'</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
              </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>eq</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bool_T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>aux</span></span><span> </span><span class="entity"><span>Eq</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>aux</span></span><span> </span><span class="entity"><span>Eq</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>do_quantifier</span></span><span> </span><span class="entity"><span>quant</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bound_u</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>BoundName</span></span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>body_u</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sub_abs</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>t1</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>quant</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bool_T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bound_u</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body_u</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>do_apply</span></span><span> </span><span class="entity"><span>t0</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ts'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>split_last</span><span> </span><span class="entity"><span>ts</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts'</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fastype_of1</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Apply</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pseudo_range_type</span></span><span> </span><span class="entity"><span>T1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>do_construct</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>num_binder_types</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>-</span><span> </span><span>length</span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Construct</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>ConstName</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                                  </span><span>o</span><span> </span><span class="entity"><span>nth_sel_for_constr</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
                                </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>~1</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>num_sels_for_constr_type</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                            </span><span>body_type</span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span>
                            </span><span class="entity"><span>ts</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>`</span><span class="main"><span>(</span></span><span>curry</span><span> </span><span>fastype_of1</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                               </span><span>|&gt;</span><span> </span><span>maps</span><span> </span><span class="entity"><span>factorize</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sub</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>eta_expand</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>k</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>strip_comb</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>Pure.all</span><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>do_quantifier</span></span><span> </span><span class="entity"><span>All</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>t1</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t0</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>Pure.all</span><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t1</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>sub'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t0</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>eta_expand</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>Pure.eq</span><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>sub_equals</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span class="entity"><span>t2</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>Pure.imp</span><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prop_T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Op1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prop_T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub'</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>Pure.conjunction</span><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>And</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prop_T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub'</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub'</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t1</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>sub'</span></span><span> </span><span class="entity"><span>t1</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.Not|const"><span>Not</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t1</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
             </span><span class="entity"><span>Op1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u11</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>u11</span></span><span>
           </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Op1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bool_T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.False|const"><span>False</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>False</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.True|const"><span>True</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>True</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.All|const"><span>All</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>do_quantifier</span></span><span> </span><span class="entity"><span>All</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>t1</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t0</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.All|const"><span>All</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t1</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>sub'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t0</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>eta_expand</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.Ex|const"><span>Ex</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>do_quantifier</span></span><span> </span><span class="entity"><span>Exist</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>t1</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t0</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.Ex|const"><span>Ex</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t1</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>sub'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t0</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>eta_expand</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.eq|const"><span>HOL.eq</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t1</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>Op1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>SingletonSet</span></span><span class="main"><span>,</span></span><span> </span><span>range_type</span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.eq|const"><span>HOL.eq</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>sub_equals</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span class="entity"><span>t2</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.conj|const"><span>HOL.conj</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>And</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bool_T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub'</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub'</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.disj|const"><span>HOL.disj</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bool_T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.implies|const"><span>HOL.implies</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bool_T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Op1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bool_T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub'</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.If|const"><span>If</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t3</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>Op3</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>If</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nth_range_type</span></span><span> </span><span class="inner_numeral"><span>3</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>t3</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.Let|const"><span>Let</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>Op3</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Let</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nth_range_type</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>BoundName</span></span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
               </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub_abs</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>T'</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t0</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.Let|const"><span>Let</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>sub</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t0</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t1</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>eta_expand</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>t2</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.Pair|const"><span>Pair</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>Tuple</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nth_range_type</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t1</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>Op1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>First</span></span><span class="main"><span>,</span></span><span> </span><span>range_type</span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.prod.snd|const"><span>snd</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t1</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>Op1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Second</span></span><span class="main"><span>,</span></span><span> </span><span>range_type</span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Set.html#Set.member|const"><span>Set.member</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>do_apply</span></span><span> </span><span class="entity"><span>t2</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t1</span></span><span class="main"><span>]</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Set.html#Set.Collect|const"><span>Collect</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t1</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>t1</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Relation.html#Relation.Id|const"><span>Id</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Iden</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Relation.html#Relation.converse|const"><span>converse</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t1</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>Op1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Converse</span></span><span class="main"><span>,</span></span><span> </span><span>range_type</span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Transitive_Closure.html#Transitive_Closure.trancl|const"><span>trancl</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t1</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>Op1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Closure</span></span><span class="main"><span>,</span></span><span> </span><span>range_type</span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcomp|const"><span>relcomp</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Composition</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nth_range_type</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Nat.html#Nat.Suc|const"><span>Suc</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_built_in_const</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Suc</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_constr</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>do_construct</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>ConstName</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Finite_Set.html#Finite_Set.finite|const"><span>finite</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t1</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_finite_type</span></span><span> </span><span class="entity"><span>hol_ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>domain_type</span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
             </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>True</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bool_T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
             </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.top_class.top|const"><span>top</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>False</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bool_T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span>
           </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Op1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Finite</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bool_T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Int.html#Int.nat|const"><span>nat</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>IntToNat</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.zero_class.zero|const"><span>zero_class.zero</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_built_in_const</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Num</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_constr</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>do_construct</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>ConstName</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.one_class.one|const"><span>one_class.one</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_built_in_const</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Num</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>ConstName</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.plus_class.plus|const"><span>plus_class.plus</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_built_in_const</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Add</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>ConstName</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.minus_class.minus|const"><span>minus_class.minus</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_built_in_const</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Subtract</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>ConstName</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.times_class.times|const"><span>times_class.times</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_built_in_const</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Multiply</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>ConstName</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Rings.html#Rings.divide_class.divide|const"><span>Rings.divide</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_built_in_const</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Divide</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>ConstName</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t0</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.less|const"><span>ord_class.less</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="entity"><span>ts</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_built_in_const</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Less</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bool_T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
            </span><span class="entity"><span>do_apply</span></span><span> </span><span class="entity"><span>t0</span></span><span> </span><span class="entity"><span>ts</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t0</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.less_eq|const"><span>ord_class.less_eq</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="entity"><span>ts</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_built_in_const</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="comment1"><span>(* FIXME: find out if this case is necessary *)</span></span><span>
            </span><span class="entity"><span>Op1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bool_T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Less</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bool_T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
            </span><span class="entity"><span>do_apply</span></span><span> </span><span class="entity"><span>t0</span></span><span> </span><span class="entity"><span>ts</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Nitpick.html#Nitpick.nat_gcd|const"><span>nat_gcd</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Gcd</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Nitpick.html#Nitpick.nat_lcm|const"><span>nat_lcm</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Lcm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.uminus_class.uminus|const"><span>uminus_class.uminus</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_built_in_const</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>num_T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>domain_type</span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Apply</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>num_T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>num_T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span>
                   </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Subtract</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>num_T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>num_T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>num_T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                   </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Num</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>num_T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
            </span><span class="entity"><span>ConstName</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Nitpick.html#Nitpick.unknown|const"><span>unknown</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Unknown</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Nitpick.html#Nitpick.is_unknown|const"><span>is_unknown</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t1</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>Op1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>IsUnknown</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bool_T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Nitpick.html#Nitpick.safe_The|const"><span>safe_The</span></a><span>›</span></span><span class="main"><span>,</span></span><span>
                  </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>fun</span><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t1</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>Op1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>SafeThe</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Nitpick.html#Nitpick.Frac|const"><span>Frac</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Fracs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Nitpick.html#Nitpick.norm_frac|const"><span>norm_frac</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NormFrac</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Nat.html#Nat.semiring_1_class.of_nat|const"><span>of_nat</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span>›</span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NatToInt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Nat.html#Nat.semiring_1_class.of_nat|const"><span>of_nat</span></a><span>›</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>T</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Nitpick.html#Nitpick.unsigned_bit|type"><span>unsigned_bit</span></a><span> </span><a class="entity_ref" href="../../../../../Nitpick.html#Nitpick.word|type"><span>word</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><a class="entity_ref" href="../../../../../Nitpick.html#Nitpick.signed_bit|type"><span>signed_bit</span></a><span> </span><a class="entity_ref" href="../../../../../Nitpick.html#Nitpick.word|type"><span>word</span></a><span>›</span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NatToInt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t0</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_constr</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="entity"><span>do_construct</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>ts</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>String.isPrefix</span><span> </span><span class="entity"><span>numeral_prefix</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Num</span></span><span> </span><span class="main"><span>(</span></span><span>the</span><span> </span><span class="main"><span>(</span></span><span>Int.fromString</span><span> </span><span class="main"><span>(</span></span><span>unprefix</span><span> </span><span class="entity"><span>numeral_prefix</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
            </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>arity_of_built_in_const</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
               </span><span>SOME</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
               </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span>-</span><span> </span><span>length</span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                  </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>TERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Nitpick_Nut.nut_from_term.aux"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>eta_expand</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>k</span></span><span class="main"><span>)</span></span><span>
                       </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>do_apply</span></span><span> </span><span class="entity"><span>t0</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span>
             </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>ConstName</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span>
                       </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>do_apply</span></span><span> </span><span class="entity"><span>t0</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>FreeName</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Var</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>TERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Nitpick_Nut.nut_from_term.aux"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Bound</span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>BoundName</span></span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span>-</span><span> </span><span class="entity"><span>j</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Lambda</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>--&gt;</span><span> </span><span>fastype_of1</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span>
               </span><span class="entity"><span>BoundName</span></span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub_abs</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>do_apply</span></span><span> </span><span class="entity"><span>t0</span></span><span> </span><span class="entity"><span>ts</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>aux</span></span><span> </span><span class="entity"><span>eq</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_fully_representable_set</span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_opt_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rep_of</span></span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span class="entity"><span>FreeName</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Op1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>SingletonSet</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Op1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Converse</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>is_fully_representable_set</span></span><span> </span><span class="entity"><span>u1</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Lambda</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>False</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oper</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>oper</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Apply</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span class="entity"><span>ConstName</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="entity"><span>is_sel_like_and_no_discr</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../List.html#List.list.set|const"><span>set</span></a><span>›</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span>false</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rep_for_abs_fun</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>best_non_opt_symmetric_reps_for_fun_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R1</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>card_of_rep</span></span><span> </span><span class="entity"><span>R1</span></span><span> </span><span>&lt;&gt;</span><span> </span><span class="entity"><span>card_of_rep</span></span><span> </span><span class="entity"><span>R2</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>Opt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>choose_rep_for_free_var</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>pseudo_frees</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>table</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>exists</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nickname_of</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pseudo_frees</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
               </span><span class="entity"><span>best_opt_set_rep_for_type</span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
               </span><span class="entity"><span>best_non_opt_set_rep_for_type</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>type_of</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>modify_name_rep</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>R</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span>NameTable.update</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>table</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>choose_rep_for_const</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>scope</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span>hol_ctxt</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>total_consts</span></span><span> </span><span class="entity"><span>v</span></span><span>
                         </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>table</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nickname_of</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_abs_fun</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
               </span><span class="entity"><span>rep_for_abs_fun</span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_rep_fun</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
               </span><span class="entity"><span>Func</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>best_non_opt_symmetric_reps_for_fun_type</span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>total_consts</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>is_skolem_name</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span>
                     </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Nitpick.html#Nitpick.bisim|const"><span>bisim</span></a><span>›</span></span><span class="main"><span>,</span></span><span>
                                    </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Nitpick.html#Nitpick.bisim_iterator_max|const"><span>bisim_iterator_max</span></a><span>›</span></span><span class="main"><span>]</span></span><span>
                            </span><span class="main"><span>(</span></span><span class="entity"><span>original_name</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
               </span><span class="entity"><span>best_non_opt_set_rep_for_type</span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../List.html#List.list.set|const"><span>set</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../List.html#List.distinct|const"><span>distinct</span></a><span>›</span></span><span class="main"><span>,</span></span><span>
                                    </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.less|const"><span>ord_class.less</span></a><span>›</span></span><span class="main"><span>,</span></span><span>
                                    </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.less_eq|const"><span>ord_class.less_eq</span></a><span>›</span></span><span class="main"><span>]</span></span><span>
                            </span><span class="main"><span>(</span></span><span class="entity"><span>original_name</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
               </span><span class="entity"><span>best_set_rep_for_type</span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
               </span><span class="entity"><span>best_opt_set_rep_for_type</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>T</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>modify_name_rep</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>R</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span>NameTable.update</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>table</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>choose_reps_for_free_vars</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>pseudo_frees</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>choose_rep_for_free_var</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>pseudo_frees</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>table</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>choose_reps_for_consts</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>total_consts</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>choose_rep_for_const</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>total_consts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>table</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>choose_rep_for_nth_sel_for_constr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>scope</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>hol_ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>binarize</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>
                                      </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>table</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>binarized_and_boxed_nth_sel_for_constr</span></span><span> </span><span class="entity"><span>hol_ctxt</span></span><span> </span><span class="entity"><span>binarize</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>n</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>R'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>is_word_type</span></span><span> </span><span class="main"><span>(</span></span><span>body_type</span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>is_fun_type</span></span><span> </span><span class="main"><span>(</span></span><span>range_type</span><span> </span><span class="entity"><span>T'</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
                 </span><span class="entity"><span>is_boolean_type</span></span><span> </span><span class="main"><span>(</span></span><span>body_type</span><span> </span><span class="entity"><span>T'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>is_set_type</span></span><span> </span><span class="main"><span>(</span></span><span>body_type</span><span> </span><span class="entity"><span>T'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
               </span><span class="entity"><span>best_non_opt_set_rep_for_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>T'</span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
               </span><span class="entity"><span>best_opt_set_rep_for_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>T'</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>unopt_rep</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ConstName</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R'</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span>NameTable.update</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R'</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>table</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>choose_rep_for_sels_for_constr</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>choose_rep_for_nth_sel_for_constr</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
           </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>~1</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>num_sels_for_constr_type</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>choose_rep_for_sels_of_data_type</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span>deep</span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>data_type_spec</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>I</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>choose_rep_for_sels_of_data_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>constrs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>choose_rep_for_sels_for_constr</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>const</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>constrs</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>choose_reps_for_all_sels</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>scope</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>data_types</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>choose_rep_for_sels_of_data_type</span></span><span> </span><span class="entity"><span>scope</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>data_types</span></span><span> </span><span>o</span><span> </span><span>pair</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>min_univ_card</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>choose_rep_for_bound_var</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>best_one_rep_for_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>type_of</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>arity</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>arity_of_rep</span></span><span> </span><span class="entity"><span>R</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>arity</span></span><span> </span><span>&gt;</span><span> </span><span class="entity"><span>KK.max_arity</span></span><span> </span><span class="entity"><span>min_univ_card</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>TOO_LARGE</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Nitpick_Nut.choose_rep_for_bound_var"</span></span><span class="main"><span>,</span></span><span>
                       </span><span class="inner_quoted"><span>"arity "</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>arity</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" of bound variable \
                       \too large"</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span>NameTable.update</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="comment1"><span>(* A nut is said to be constructive if whenever it evaluates to unknown in our
   three-valued logic, it would evaluate to an unrepresentable value ("Unrep")
   according to the HOL semantics. For example, "Suc n" is constructive if "n"
   is representable or "Unrep", because unknown implies "Unrep". *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_constructive</span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>is_Cst</span></span><span> </span><span class="entity"><span>Unrep</span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span>
  </span><span class="main"><span>(</span></span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_fun_or_set_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>type_of</span></span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
   </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_opt_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rep_of</span></span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Num</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cst</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>body_type</span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nat_T</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Suc</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>cst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Add</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Apply</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>forall</span><span> </span><span class="entity"><span>is_constructive</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Op3</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>If</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u3</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_opt_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rep_of</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>forall</span><span> </span><span class="entity"><span>is_constructive</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>u2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u3</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Tuple</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>us</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>forall</span><span> </span><span class="entity"><span>is_constructive</span></span><span> </span><span class="entity"><span>us</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Construct</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>us</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>forall</span><span> </span><span class="entity"><span>is_constructive</span></span><span> </span><span class="entity"><span>us</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>unknown_boolean</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="entity"><span>Formula</span></span><span> </span><span class="entity"><span>Pos</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>False</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Formula</span></span><span> </span><span class="entity"><span>Neg</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>True</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Unknown</span></span><span class="main"><span>,</span></span><span>
       </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>s_op1</span></span><span> </span><span class="entity"><span>oper</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>oper</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Not</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_Cst</span></span><span> </span><span class="entity"><span>True</span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>False</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_Cst</span></span><span> </span><span class="entity"><span>False</span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>True</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>SAME</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>SAME</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
   </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span class="entity"><span>SAME</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Op1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oper</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>s_op2</span></span><span> </span><span class="entity"><span>oper</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="entity"><span>u2</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>oper</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span class="entity"><span>All</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_subnut_of</span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="entity"><span>u2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>All</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>u2</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Exist</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_subnut_of</span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="entity"><span>u2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Exist</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>u2</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>exists</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_Cst</span></span><span> </span><span class="entity"><span>True</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>True</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>unopt_rep</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_Cst</span></span><span> </span><span class="entity"><span>False</span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>u2</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_Cst</span></span><span> </span><span class="entity"><span>False</span></span><span> </span><span class="entity"><span>u2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>u1</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>SAME</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>exists</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_Cst</span></span><span> </span><span class="entity"><span>False</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>False</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>unopt_rep</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_Cst</span></span><span> </span><span class="entity"><span>True</span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>u2</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_Cst</span></span><span> </span><span class="entity"><span>True</span></span><span> </span><span class="entity"><span>u2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>u1</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>SAME</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Eq</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>apply2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_Cst</span></span><span> </span><span class="entity"><span>Unrep</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
         </span><span class="main"><span>(</span></span><span>true</span><span class="main"><span>,</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>unknown_boolean</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>R</span></span><span>
       </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>false</span><span class="main"><span>,</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>SAME</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
       </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>forall</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_opt_rep</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>rep_of</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>SAME</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>False</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Formula</span></span><span> </span><span class="entity"><span>Neut</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Triad</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_Cst</span></span><span> </span><span class="entity"><span>True</span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>u1</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_Cst</span></span><span> </span><span class="entity"><span>False</span></span><span> </span><span class="entity"><span>u2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>u2</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>SAME</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Apply</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_Cst</span></span><span> </span><span class="entity"><span>Unrep</span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Unrep</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_Cst</span></span><span> </span><span class="entity"><span>Unrep</span></span><span> </span><span class="entity"><span>u2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_boolean_type</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_fully_representable_set</span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>False</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Formula</span></span><span> </span><span class="entity"><span>Neut</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>unknown_boolean</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>R</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_constructive</span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
          </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Unrep</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Apply</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ConstName</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../List.html#List.append|const"><span>List.append</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Unrep</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>SAME</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>SAME</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>SAME</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
   </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span class="entity"><span>SAME</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oper</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>s_op3</span></span><span> </span><span class="entity"><span>oper</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="entity"><span>u2</span></span><span> </span><span class="entity"><span>u3</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>oper</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span class="entity"><span>Let</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>inline_nut</span></span><span> </span><span class="entity"><span>u2</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>num_occurrences_in_nut</span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="entity"><span>u3</span></span><span> </span><span>&lt;</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="entity"><span>substitute_in_nut</span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="entity"><span>u2</span></span><span> </span><span class="entity"><span>u3</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>SAME</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>SAME</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
   </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span class="entity"><span>SAME</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Op3</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oper</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u3</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>s_tuple</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="entity"><span>us</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>exists</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_Cst</span></span><span> </span><span class="entity"><span>Unrep</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>us</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Unrep</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>Tuple</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>us</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>untuple</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Tuple</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>us</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>untuple</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>us</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>untuple</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>]</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>choose_reps_in_nut</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>scope</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>card_assigns</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bits</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>data_types</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ofs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>
                       </span><span class="entity"><span>unsound</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bool_atom_R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Atom</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>offset_of_type</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="entity"><span>bool_T</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>bool_rep</span></span><span> </span><span class="entity"><span>polar</span></span><span> </span><span class="entity"><span>opt</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>polar</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Neut</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>opt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Opt</span></span><span> </span><span class="entity"><span>bool_atom_R</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>Formula</span></span><span> </span><span class="entity"><span>polar</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>triad</span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="entity"><span>u2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>s_op2</span></span><span> </span><span class="entity"><span>Triad</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>type_of</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Opt</span></span><span> </span><span class="entity"><span>bool_atom_R</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="entity"><span>u2</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>triad_fn</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>triad</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>Pos</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>Neg</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>unrepify_nut_in_nut</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="entity"><span>polar</span></span><span> </span><span class="entity"><span>needle_u</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>needle_T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="entity"><span>needle_u</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>substitute_in_nut</span></span><span> </span><span class="entity"><span>needle_u</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_fun_or_set_type</span></span><span> </span><span class="entity"><span>needle_T</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Unknown</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>Unrep</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>needle_T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Any</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span>#&gt;</span><span> </span><span class="entity"><span>aux</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="entity"><span>polar</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>aux</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="entity"><span>polar</span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>gsub</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>aux</span></span><span> </span><span class="entity"><span>table</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gsub</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>Neut</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>False</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>False</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Formula</span></span><span> </span><span class="entity"><span>Neut</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>True</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>True</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Formula</span></span><span> </span><span class="entity"><span>Neut</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Num</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_word_type</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_twos_complement_representable</span></span><span> </span><span class="entity"><span>bits</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Num</span></span><span> </span><span class="entity"><span>j</span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>Unrep</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>best_opt_set_rep_for_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
               </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>j0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>spec_of_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>T</span></span><span>
               </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ok</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>int_T</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>atom_for_int</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>j0</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span>&lt;&gt;</span><span> </span><span class="inner_numeral"><span>~1</span></span><span>
                         </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span>&lt;</span><span> </span><span class="entity"><span>k</span></span><span class="main"><span>)</span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>ok</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Num</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Atom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>j0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Unrep</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Opt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Atom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>j0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Suc</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>fun</span><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T1</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Atom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>spec_of_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>T1</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Suc</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Opt</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Fracs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Fracs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>best_non_opt_set_rep_for_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NormFrac</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>R1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Atom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>spec_of_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="main"><span>(</span></span><span>domain_type</span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NormFrac</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Opt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Struct</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>R1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R1</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cst</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>cst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Unknown</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>cst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Unrep</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_boolean_type</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>polar</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>unsound</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>flip_polarity</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
              </span><span class="main"><span>(</span></span><span>true</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Pos</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>False</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Formula</span></span><span> </span><span class="entity"><span>Pos</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>true</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Neg</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>True</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Formula</span></span><span> </span><span class="entity"><span>Neg</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cst</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>best_opt_set_rep_for_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Add</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Subtract</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Multiply</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Divide</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Gcd</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Lcm</span></span><span class="main"><span>]</span></span><span>
                         </span><span class="entity"><span>cst</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>domain_type</span><span> </span><span class="entity"><span>T</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>R1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Atom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>spec_of_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>T1</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>total</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>T1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nat_T</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
                          </span><span class="main"><span>(</span></span><span class="entity"><span>cst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Subtract</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>cst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Divide</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>cst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Gcd</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cst</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R1</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span>not</span><span> </span><span class="entity"><span>total</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>Opt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>R1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>cst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>NatToInt</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>cst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>IntToNat</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dom_card</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dom_j0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>spec_of_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="main"><span>(</span></span><span>domain_type</span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ran_card</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ran_j0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>spec_of_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="main"><span>(</span></span><span>range_type</span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>total</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_word_type</span></span><span> </span><span class="main"><span>(</span></span><span>domain_type</span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
                          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>cst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>NatToInt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                             </span><span class="entity"><span>max_int_for_card</span></span><span> </span><span class="entity"><span>ran_card</span></span><span> </span><span>&gt;=</span><span> </span><span class="entity"><span>dom_card</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span>
                           </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                             </span><span class="entity"><span>max_int_for_card</span></span><span> </span><span class="entity"><span>dom_card</span></span><span> </span><span>&lt;</span><span> </span><span class="entity"><span>ran_card</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cst</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Atom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dom_card</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dom_j0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                 </span><span class="entity"><span>Atom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ran_card</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ran_j0</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>not</span><span> </span><span class="entity"><span>total</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>Opt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
            </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cst</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>best_set_rep_for_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Op1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>gsub</span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>flip_polarity</span></span><span> </span><span class="entity"><span>polar</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
             </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Triad</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u11</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u12</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
             </span><span class="entity"><span>triad</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s_op1</span></span><span> </span><span class="entity"><span>Not</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Formula</span></span><span> </span><span class="entity"><span>Pos</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>u12</span></span><span class="main"><span>)</span></span><span>
                   </span><span class="main"><span>(</span></span><span class="entity"><span>s_op1</span></span><span> </span><span class="entity"><span>Not</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Formula</span></span><span> </span><span class="entity"><span>Neg</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>u11</span></span><span class="main"><span>)</span></span><span>
           </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>u1'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>s_op1</span></span><span> </span><span class="entity"><span>Not</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>flip_rep_polarity</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rep_of</span></span><span> </span><span class="entity"><span>u1'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>u1'</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Op1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>IsUnknown</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_opt_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rep_of</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Op1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>IsUnknown</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Formula</span></span><span> </span><span class="entity"><span>Neut</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>False</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Formula</span></span><span> </span><span class="entity"><span>Neut</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Op1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oper</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>u1</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>R1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rep_of</span></span><span> </span><span class="entity"><span>u1</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>oper</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                      </span><span class="entity"><span>Finite</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>bool_rep</span></span><span> </span><span class="entity"><span>polar</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_opt_rep</span></span><span> </span><span class="entity"><span>R1</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_opt_rep</span></span><span> </span><span class="entity"><span>R1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>best_opt_set_rep_for_type</span></span><span>
                            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>best_non_opt_set_rep_for_type</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>T</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>s_op1</span></span><span> </span><span class="entity"><span>oper</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Less</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>u1</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>u2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>u2</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bool_rep</span></span><span> </span><span class="entity"><span>polar</span></span><span> </span><span class="main"><span>(</span></span><span>exists</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_opt_rep</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>rep_of</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>s_op2</span></span><span> </span><span class="entity"><span>Less</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="entity"><span>u2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>DefEq</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>s_op2</span></span><span> </span><span class="entity"><span>DefEq</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Formula</span></span><span> </span><span class="entity"><span>Neut</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Eq</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>u1'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>u1</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>u2'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>u2</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>non_opt_case</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>s_op2</span></span><span> </span><span class="entity"><span>Eq</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Formula</span></span><span> </span><span class="entity"><span>polar</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>u1'</span></span><span> </span><span class="entity"><span>u2'</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>opt_opt_case</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>polar</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Neut</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                </span><span class="entity"><span>triad_fn</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>polar</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>s_op2</span></span><span> </span><span class="entity"><span>Eq</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Formula</span></span><span> </span><span class="entity"><span>polar</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>u1'</span></span><span> </span><span class="entity"><span>u2'</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                </span><span class="entity"><span>non_opt_case</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>hybrid_case</span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="comment1"><span>(* hackish optimization *)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_constructive</span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>s_op2</span></span><span> </span><span class="entity"><span>Eq</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Formula</span></span><span> </span><span class="entity"><span>Neut</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>u1'</span></span><span> </span><span class="entity"><span>u2'</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>opt_opt_case</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>unsound</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>polar</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Neg</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span>
               </span><span class="entity"><span>is_concrete_type</span></span><span> </span><span class="entity"><span>data_types</span></span><span> </span><span>true</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>type_of</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_opt_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rep_of</span></span><span> </span><span class="entity"><span>u1'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>is_opt_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rep_of</span></span><span> </span><span class="entity"><span>u2'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                </span><span class="main"><span>(</span></span><span>true</span><span class="main"><span>,</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>opt_opt_case</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>true</span><span class="main"><span>,</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>hybrid_case</span></span><span> </span><span class="entity"><span>u1'</span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>false</span><span class="main"><span>,</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>hybrid_case</span></span><span> </span><span class="entity"><span>u2'</span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>false</span><span class="main"><span>,</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>non_opt_case</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
              </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>False</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Formula</span></span><span> </span><span class="entity"><span>Pos</span></span><span class="main"><span>)</span></span><span>
              </span><span>|&gt;</span><span> </span><span class="entity"><span>polar</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Neut</span></span><span> </span><span>?</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pos_u</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>triad</span></span><span> </span><span class="entity"><span>pos_u</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>gsub</span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="entity"><span>Neg</span></span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Apply</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>u1</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>u2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>u2</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="entity"><span>u1</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>R1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rep_of</span></span><span> </span><span class="entity"><span>u1</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>R2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rep_of</span></span><span> </span><span class="entity"><span>u2</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>opt</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>is_opt_rep</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>ConstName</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../List.html#List.list.set|const"><span>set</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span>
              </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>exists</span><span> </span><span class="entity"><span>is_opt_rep</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>R1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>]</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ran_R</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_boolean_type</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                </span><span class="entity"><span>bool_rep</span></span><span> </span><span class="entity"><span>polar</span></span><span> </span><span class="entity"><span>opt</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                </span><span class="entity"><span>lazy_range_rep</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="entity"><span>T1</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>card_of_type</span></span><span> </span><span class="entity"><span>card_assigns</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span>
                               </span><span class="main"><span>(</span></span><span class="entity"><span>unopt_rep</span></span><span> </span><span class="entity"><span>R1</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>opt</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>opt_rep</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="entity"><span>T</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>s_op2</span></span><span> </span><span class="entity"><span>Apply</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>ran_R</span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="entity"><span>u2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Lambda</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>best_set_rep_for_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
             </span><span class="entity"><span>R</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R1</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
               </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>table'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>NameTable.update</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>table</span></span><span>
               </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>u1'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>aux</span></span><span> </span><span class="entity"><span>table'</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>Neut</span></span><span> </span><span class="entity"><span>u1</span></span><span>
               </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>u2'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>aux</span></span><span> </span><span class="entity"><span>table'</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>Neut</span></span><span> </span><span class="entity"><span>u2</span></span><span>
               </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_opt_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rep_of</span></span><span> </span><span class="entity"><span>u2'</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>opt_rep</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>R</span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>unopt_rep</span></span><span> </span><span class="entity"><span>R</span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>s_op2</span></span><span> </span><span class="entity"><span>Lambda</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="entity"><span>u1'</span></span><span> </span><span class="entity"><span>u2'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
           </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>NUT</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Nitpick_Nut.choose_reps_in_nut.aux"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>u</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oper</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>oper</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>All</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>oper</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Exist</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>table'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>choose_rep_for_bound_var</span></span><span> </span><span class="entity"><span>scope</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>untuple</span></span><span> </span><span>I</span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>)</span></span><span>
                                </span><span class="entity"><span>table</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>u1'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>aux</span></span><span> </span><span class="entity"><span>table'</span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="entity"><span>polar</span></span><span> </span><span class="entity"><span>u1</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>u2'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>aux</span></span><span> </span><span class="entity"><span>table'</span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="entity"><span>polar</span></span><span> </span><span class="entity"><span>u2</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>polar</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Neut</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>is_opt_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rep_of</span></span><span> </span><span class="entity"><span>u2'</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                </span><span class="entity"><span>triad_fn</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>polar</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>gsub</span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="entity"><span>polar</span></span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>quant_u</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>s_op2</span></span><span> </span><span class="entity"><span>oper</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Formula</span></span><span> </span><span class="entity"><span>polar</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>u1'</span></span><span> </span><span class="entity"><span>u2'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span>
                     </span><span class="main"><span>(</span></span><span class="entity"><span>unsound</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>polar</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Pos</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oper</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>All</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span>
                     </span><span class="entity"><span>is_complete_type</span></span><span> </span><span class="entity"><span>data_types</span></span><span> </span><span>true</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>type_of</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                    </span><span class="entity"><span>quant_u</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>connective</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>oper</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>All</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>And</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>Or</span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unrepified_u</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>unrepify_nut_in_nut</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="entity"><span>polar</span></span><span>
                                                             </span><span class="entity"><span>u1</span></span><span> </span><span class="entity"><span>u2</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                      </span><span class="entity"><span>s_op2</span></span><span> </span><span class="entity"><span>connective</span></span><span> </span><span class="entity"><span>T</span></span><span>
                            </span><span class="main"><span>(</span></span><span class="entity"><span>min_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rep_of</span></span><span> </span><span class="entity"><span>quant_u</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rep_of</span></span><span> </span><span class="entity"><span>unrepified_u</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                            </span><span class="entity"><span>quant_u</span></span><span> </span><span class="entity"><span>unrepified_u</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>oper</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Or</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>oper</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>And</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>u1'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gsub</span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="entity"><span>polar</span></span><span> </span><span class="entity"><span>u1</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>u2'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gsub</span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="entity"><span>polar</span></span><span> </span><span class="entity"><span>u2</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>polar</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Neut</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_opt_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rep_of</span></span><span> </span><span class="entity"><span>u1'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>is_opt_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rep_of</span></span><span> </span><span class="entity"><span>u2'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                   </span><span class="main"><span>(</span></span><span>true</span><span class="main"><span>,</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>triad_fn</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>polar</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>gsub</span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="entity"><span>polar</span></span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>)</span></span><span>
                 </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>true</span><span class="main"><span>,</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                   </span><span class="entity"><span>s_op2</span></span><span> </span><span class="entity"><span>oper</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Opt</span></span><span> </span><span class="entity"><span>bool_atom_R</span></span><span class="main"><span>)</span></span><span>
                         </span><span class="main"><span>(</span></span><span class="entity"><span>triad_fn</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>polar</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>gsub</span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="entity"><span>polar</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>u2'</span></span><span>
                 </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>false</span><span class="main"><span>,</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                   </span><span class="entity"><span>s_op2</span></span><span> </span><span class="entity"><span>oper</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Opt</span></span><span> </span><span class="entity"><span>bool_atom_R</span></span><span class="main"><span>)</span></span><span>
                         </span><span class="entity"><span>u1'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>triad_fn</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>polar</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>gsub</span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="entity"><span>polar</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                 </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>false</span><span class="main"><span>,</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>SAME</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                 </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>SAME</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span class="entity"><span>SAME</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>s_op2</span></span><span> </span><span class="entity"><span>oper</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Formula</span></span><span> </span><span class="entity"><span>polar</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>u1'</span></span><span> </span><span class="entity"><span>u2'</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>u1</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>u2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>u2</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span class="entity"><span>best_non_opt_set_rep_for_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>T</span></span><span>
                </span><span>|&gt;</span><span> </span><span>exists</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_opt_rep</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>rep_of</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>]</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>opt_rep</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="entity"><span>T</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>s_op2</span></span><span> </span><span class="entity"><span>oper</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="entity"><span>u2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Op3</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Let</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u3</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>u2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>u2</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>R2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rep_of</span></span><span> </span><span class="entity"><span>u2</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>table'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>NameTable.update</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>table</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>modify_name_rep</span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="entity"><span>R2</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>u3</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>aux</span></span><span> </span><span class="entity"><span>table'</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>polar</span></span><span> </span><span class="entity"><span>u3</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>s_op3</span></span><span> </span><span class="entity"><span>Let</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rep_of</span></span><span> </span><span class="entity"><span>u3</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="entity"><span>u2</span></span><span> </span><span class="entity"><span>u3</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Op3</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>If</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u3</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>u1</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>u2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gsub</span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="entity"><span>polar</span></span><span> </span><span class="entity"><span>u2</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>u3</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gsub</span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="entity"><span>polar</span></span><span> </span><span class="entity"><span>u3</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>min_R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>min_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rep_of</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rep_of</span></span><span> </span><span class="entity"><span>u3</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>min_R</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>is_opt_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rep_of</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>)</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>opt_rep</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="entity"><span>T</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>s_op3</span></span><span> </span><span class="entity"><span>If</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="entity"><span>u1</span></span><span> </span><span class="entity"><span>u2</span></span><span> </span><span class="entity"><span>u3</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Tuple</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>us</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>best_one_rep_for_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>type_of</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>us</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>us</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>us</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>R'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Struct</span></span><span> </span><span class="entity"><span>Rs</span></span><span>
                     </span><span>|&gt;</span><span> </span><span>exists</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_opt_rep</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>rep_of</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>us</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>opt_rep</span></span><span> </span><span class="entity"><span>ofs</span></span><span> </span><span class="entity"><span>T</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>s_tuple</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>R'</span></span><span> </span><span class="entity"><span>us</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Construct</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>us'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>us</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>us</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>us</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>rep_of</span></span><span> </span><span class="entity"><span>us</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>best_one_rep_for_type</span></span><span> </span><span class="entity"><span>scope</span></span><span> </span><span class="entity"><span>T</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>total</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>constr_spec</span></span><span> </span><span class="entity"><span>data_types</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>original_name</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nickname_of</span></span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>us'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>opt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>exists</span><span> </span><span class="entity"><span>is_opt_rep</span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>not</span><span> </span><span class="entity"><span>total</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>Construct</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>us'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>opt</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>Opt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>us</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>modify_name_rep</span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>the_name</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>polar</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Neut</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_boolean_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>type_of</span></span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span>
               </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_opt_rep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rep_of</span></span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
              </span><span class="entity"><span>u</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
              </span><span class="entity"><span>s_op1</span></span><span> </span><span class="entity"><span>Cast</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>type_of</span></span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Formula</span></span><span> </span><span class="entity"><span>polar</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>u</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>aux</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="entity"><span>Pos</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fresh_n_ary_index</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fresh_n_ary_index</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>m</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>m</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>fresh_n_ary_index</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>m</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fresh_rel</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>rels</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>formula_reg</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_reg</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rels'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fresh_n_ary_index</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>rels</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>{</span></span><span>rels</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rels'</span></span><span class="main"><span>,</span></span><span> </span><span>vars</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>,</span></span><span> </span><span>formula_reg</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>formula_reg</span></span><span class="main"><span>,</span></span><span>
         </span><span>rel_reg</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_reg</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fresh_var</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>rels</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>formula_reg</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_reg</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vars'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fresh_n_ary_index</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>{</span></span><span>rels</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rels</span></span><span class="main"><span>,</span></span><span> </span><span>vars</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>vars'</span></span><span class="main"><span>,</span></span><span> </span><span>formula_reg</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>formula_reg</span></span><span class="main"><span>,</span></span><span>
         </span><span>rel_reg</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_reg</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fresh_formula_reg</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>rels</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>formula_reg</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_reg</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="entity"><span>formula_reg</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>{</span></span><span>rels</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rels</span></span><span class="main"><span>,</span></span><span> </span><span>vars</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>,</span></span><span> </span><span>formula_reg</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>formula_reg</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span>
                 </span><span>rel_reg</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_reg</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fresh_rel_reg</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>rels</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>formula_reg</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_reg</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="entity"><span>rel_reg</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>{</span></span><span>rels</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rels</span></span><span class="main"><span>,</span></span><span> </span><span>vars</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>,</span></span><span> </span><span>formula_reg</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>formula_reg</span></span><span class="main"><span>,</span></span><span>
             </span><span>rel_reg</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_reg</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rename_plain_var</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ws</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pool</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>table</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>is_formula</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rep_of</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Formula</span></span><span> </span><span class="entity"><span>Neut</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fresh</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_formula</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>fresh_formula_reg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>fresh_rel_reg</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pool</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fresh</span></span><span> </span><span class="entity"><span>pool</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>constr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_formula</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>FormulaReg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>RelReg</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>constr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rep_of</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>w</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ws</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pool</span></span><span class="main"><span>,</span></span><span> </span><span>NameTable.update</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>table</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>shape_tuple</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.prod|type"><span>prod</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>Struct</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>R1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
                </span><span class="entity"><span>us</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>arity1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>arity_of_rep</span></span><span> </span><span class="entity"><span>R1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="entity"><span>Tuple</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>shape_tuple</span></span><span> </span><span class="entity"><span>T1</span></span><span> </span><span class="entity"><span>R1</span></span><span> </span><span class="main"><span>(</span></span><span>List.take</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>us</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>arity1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>shape_tuple</span></span><span> </span><span class="entity"><span>T2</span></span><span> </span><span class="entity"><span>R2</span></span><span> </span><span class="main"><span>(</span></span><span>List.drop</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>us</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>arity1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>shape_tuple</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>Vect</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>us</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Tuple</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>shape_tuple</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pseudo_range_type</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>R'</span></span><span class="main"><span>)</span></span><span>
                     </span><span class="main"><span>(</span></span><span class="entity"><span>chunk_list</span></span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>us</span></span><span> </span><span>div</span><span> </span><span class="entity"><span>k</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>us</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>shape_tuple</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>u</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>NUT</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Nitpick_Nut.shape_tuple"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>u</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>shape_tuple</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>us</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>NUT</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Nitpick_Nut.shape_tuple"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>us</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rename_n_ary_var</span></span><span> </span><span class="entity"><span>rename_free</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ws</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pool</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>table</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="entity"><span>v</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rep_of</span></span><span> </span><span class="entity"><span>v</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>arity</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>arity_of_rep</span></span><span> </span><span class="entity"><span>R</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nick</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nickname_of</span></span><span> </span><span class="entity"><span>v</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>constr</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fresh</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>rename_free</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FreeRel</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fresh_rel</span></span><span class="main"><span>)</span></span><span>
                          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoundRel</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fresh_var</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>not</span><span> </span><span class="entity"><span>rename_free</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>arity</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>atom_schema</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>atom_schema_of_rep</span></span><span> </span><span class="entity"><span>R</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>type_schema</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>type_schema_of_rep</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>R</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>js</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pool</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>funpow</span><span> </span><span class="entity"><span>arity</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>js</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pool</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                                          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pool</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fresh</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="entity"><span>pool</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                                            </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>js</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pool</span></span><span class="main"><span>)</span></span><span>
                                          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
                                </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pool</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ws'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                           </span><span class="entity"><span>constr</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Atom</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span>
                                   </span><span class="entity"><span>nick</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" ["</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>j</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"]"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                       </span><span class="main"><span>(</span></span><span>rev</span><span> </span><span class="entity"><span>js</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atom_schema</span></span><span> </span><span class="entity"><span>type_schema</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ws'</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ws</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pool</span></span><span class="main"><span>,</span></span><span> </span><span>NameTable.update</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>shape_tuple</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="entity"><span>ws'</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>table</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pool</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span class="entity"><span>ConstName</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_sel_like_and_no_discr</span></span><span> </span><span class="entity"><span>nick</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>domain_type</span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Nitpick.html#Nitpick.unsigned_bit|type"><span>unsigned_bit</span></a><span> </span><a class="entity_ref" href="../../../../../Nitpick.html#Nitpick.word|type"><span>word</span></a><span>›</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="entity"><span>unsigned_bit_word_sel_rel</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pool</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Nitpick.html#Nitpick.signed_bit|type"><span>signed_bit</span></a><span> </span><a class="entity_ref" href="../../../../../Nitpick.html#Nitpick.word|type"><span>word</span></a><span>›</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="entity"><span>signed_bit_word_sel_rel</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pool</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fresh</span></span><span> </span><span class="entity"><span>arity</span></span><span> </span><span class="entity"><span>pool</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
              </span><span class="entity"><span>fresh</span></span><span> </span><span class="entity"><span>arity</span></span><span> </span><span class="entity"><span>pool</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fresh</span></span><span> </span><span class="entity"><span>arity</span></span><span> </span><span class="entity"><span>pool</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>constr</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>arity</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nick</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>w</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ws</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pool</span></span><span class="main"><span>,</span></span><span> </span><span>NameTable.update</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>table</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rename_free_vars</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>pool</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pool</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>table</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_n_ary_var</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pool</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>table</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span>rev</span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pool</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>table</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rename_vars_in_nut</span></span><span> </span><span class="entity"><span>pool</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span class="entity"><span>Cst</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>u</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Op1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oper</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Op1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oper</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rename_vars_in_nut</span></span><span> </span><span class="entity"><span>pool</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oper</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>oper</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>All</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>oper</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Exist</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>oper</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Lambda</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pool</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>table</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_n_ary_var</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>untuple</span></span><span> </span><span>I</span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>)</span></span><span>
                                    </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pool</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>table</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oper</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rename_vars_in_nut</span></span><span> </span><span class="entity"><span>pool</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span>
             </span><span class="entity"><span>rename_vars_in_nut</span></span><span> </span><span class="entity"><span>pool</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span class="entity"><span>Op2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oper</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rename_vars_in_nut</span></span><span> </span><span class="entity"><span>pool</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span>
           </span><span class="entity"><span>rename_vars_in_nut</span></span><span> </span><span class="entity"><span>pool</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Op3</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Let</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u3</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>inline_nut</span></span><span> </span><span class="entity"><span>u2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>u2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rename_vars_in_nut</span></span><span> </span><span class="entity"><span>pool</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="entity"><span>u2</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>NameTable.update</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>table</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>rename_vars_in_nut</span></span><span> </span><span class="entity"><span>pool</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="entity"><span>u3</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>untuple</span></span><span> </span><span>I</span><span> </span><span class="entity"><span>u1</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pool</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>table'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="entity"><span>rename_plain_var</span></span><span> </span><span class="entity"><span>bs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pool</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>table</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>Op3</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Let</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rename_vars_in_nut</span></span><span> </span><span class="entity"><span>pool</span></span><span> </span><span class="entity"><span>table'</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span>
             </span><span class="entity"><span>rename_vars_in_nut</span></span><span> </span><span class="entity"><span>pool</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>,</span></span><span>
             </span><span class="entity"><span>rename_vars_in_nut</span></span><span> </span><span class="entity"><span>pool</span></span><span> </span><span class="entity"><span>table'</span></span><span> </span><span class="entity"><span>u3</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Op3</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oper</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u3</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="entity"><span>Op3</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oper</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rename_vars_in_nut</span></span><span> </span><span class="entity"><span>pool</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span>
         </span><span class="entity"><span>rename_vars_in_nut</span></span><span> </span><span class="entity"><span>pool</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rename_vars_in_nut</span></span><span> </span><span class="entity"><span>pool</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="entity"><span>u3</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Tuple</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>us</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Tuple</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_vars_in_nut</span></span><span> </span><span class="entity"><span>pool</span></span><span> </span><span class="entity"><span>table</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>us</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Construct</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>us'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>us</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="entity"><span>Construct</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_vars_in_nut</span></span><span> </span><span class="entity"><span>pool</span></span><span> </span><span class="entity"><span>table</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>us'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span>
               </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_vars_in_nut</span></span><span> </span><span class="entity"><span>pool</span></span><span> </span><span class="entity"><span>table</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>us</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>the_name</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="entity"><span>u</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span></pre>
</body>

</html>