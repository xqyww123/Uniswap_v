<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹Tools/BNF/bnf_gfp.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹Tools/BNF/bnf_gfp.ML›</h1>
</div>

<pre class="source"><span class="comment1"><span>(*  Title:      HOL/Tools/BNF/bnf_gfp.ML
    Author:     Dmitriy Traytel, TU Muenchen
    Author:     Andrei Popescu, TU Muenchen
    Author:     Jasmin Blanchette, TU Muenchen
    Author:     Jan van Brügge, TU Muenchen
    Copyright   2012, 2022

Codatatype construction.
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>BNF_GFP</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> construct_gfp</span><span class="main"><span>:</span></span><span> </span><span>mixfix</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>binding</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>sort</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> * </span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="entity"><span>BNF_Def.bnf</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>BNF_Comp.absT_info</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="entity"><span>BNF_FP_Util.fp_result</span></span><span> * </span><span>local_theory</span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>BNF_GFP</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>BNF_GFP</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>BNF_Def</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>BNF_Util</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>BNF_Tactics</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>BNF_Comp</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>BNF_FP_Util</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>BNF_FP_Def_Sugar</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>BNF_GFP_Util</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>BNF_GFP_Tactics</span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>wit_tree</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Wit_Leaf</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Wit_Node</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span>int * int * int list</span><span class="main"><span>)</span></span><span> * wit_tree list</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_tree_args</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>I'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>sort_distinct</span><span> </span><span>int_ord</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>I</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>I'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>finish</span></span><span> </span><span class="entity"><span>Iss</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>seen</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nwit</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>I</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>treess</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span>&lt;</span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>seen</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>j</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Wit_Leaf</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
          </span><span>map_index</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>finish</span></span><span> </span><span class="entity"><span>Iss</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>(</span></span><span>insert</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="entity"><span>seen</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>Iss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span> </span><span>-</span><span> </span><span class="entity"><span>m</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>flat</span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>minimize_wits</span></span><span class="main"><span>)</span></span><span>
      </span><span class="entity"><span>I</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Wit_Node</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="entity"><span>m</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nwit</span></span><span class="main"><span>,</span></span><span> </span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>&lt;</span><span> </span><span class="entity"><span>m</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>I</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>map_product</span><span> </span><span class="entity"><span>mk_tree_args</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>treess</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
    </span><span>|&gt;</span><span> </span><span class="entity"><span>minimize_wits</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tree_to_ctor_wit</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Wit_Leaf</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>j</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tree_to_ctor_wit</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>ctors</span></span><span> </span><span class="entity"><span>witss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Wit_Node</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nwit</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>I</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>subtrees</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
     </span><span class="main"><span>(</span></span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>ctors</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>witss</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>nwit</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span class="entity"><span>tree_to_ctor_wit</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>ctors</span></span><span> </span><span class="entity"><span>witss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>subtrees</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tree_to_coind_wits</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Wit_Leaf</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tree_to_coind_wits</span></span><span> </span><span class="entity"><span>lwitss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Wit_Node</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nwit</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>I</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>subtrees</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
     </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>I</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>nth</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>lwitss</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>nwit</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tree_to_coind_wits</span></span><span> </span><span class="entity"><span>lwitss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>subtrees</span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(*all BNFs have the same lives*)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>construct_gfp</span></span><span> </span><span class="entity"><span>mixfixes</span></span><span> </span><span class="entity"><span>map_bs</span></span><span> </span><span class="entity"><span>rel_bs</span></span><span> </span><span class="entity"><span>pred_bs</span></span><span> </span><span class="entity"><span>set_bss0</span></span><span> </span><span class="entity"><span>bs</span></span><span> </span><span class="entity"><span>resBs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>resDs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Dss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnfs</span></span><span> </span><span class="entity"><span>absT_infos</span></span><span>
    </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>time</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>time</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>timer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>time</span></span><span> </span><span class="main"><span>(</span></span><span>Timer.startRealTimer</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>live_of_bnf</span></span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span> </span><span class="comment1"><span>(*active*)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span>-</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>;</span></span><span> </span><span class="comment1"><span>(*passive, if 0 don't generate a new BNF*)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ls</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>m</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>internals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Config.get</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>bnf_internals</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>b_names</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>Binding.name_of</span><span> </span><span class="entity"><span>bs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>b_name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_common_name</span></span><span> </span><span class="entity"><span>b_names</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Binding.name</span><span> </span><span class="entity"><span>b_name</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_internal_of_b</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Binding.prefix_name</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"_"</span></span><span class="main"><span>)</span></span><span> </span><span>#&gt;</span><span> </span><span>Binding.prefix</span><span> </span><span>true</span><span> </span><span class="entity"><span>b_name</span></span><span> </span><span>#&gt;</span><span> </span><span>Binding.concealed</span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_internal_b</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_internal_of_b</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_internal_bs</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_internal_of_b</span></span><span> </span><span class="entity"><span>name</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>external_bs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>Binding.prefix</span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>b_names</span></span><span> </span><span class="entity"><span>bs</span></span><span>
      </span><span>|&gt;</span><span> </span><span>not</span><span> </span><span class="entity"><span>internals</span></span><span> </span><span>?</span><span> </span><span>map</span><span> </span><span>Binding.concealed</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>union</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Dss</span></span><span> </span><span class="entity"><span>resDs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>names_lthy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span>Variable.declare_typ</span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>passives</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>subtract</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>o</span><span> </span><span>apsnd</span><span> </span><span>TFree</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>resBs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* tvars *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>passiveAs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>activeAs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>passiveBs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>activeBs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>passiveCs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>activeCs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idxT</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>variant_tfrees</span></span><span> </span><span class="entity"><span>passives</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_TFrees</span></span><span> </span><span class="entity"><span>n</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>variant_tfrees</span></span><span> </span><span class="entity"><span>passives</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_TFrees</span></span><span> </span><span class="entity"><span>n</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_TFrees</span></span><span> </span><span class="entity"><span>m</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_TFrees</span></span><span> </span><span class="entity"><span>n</span></span><span>
      </span><span>||&gt;</span><span> </span><span>fst</span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_TFrees</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
      </span><span>||&gt;</span><span> </span><span>the_single</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>allAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>activeAs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>allBs'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>passiveBs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>activeBs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Ass</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>allAs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>allBs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>activeBs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Bss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>allBs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>allCs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>activeCs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>allCs'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>passiveBs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>activeCs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Css'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>allCs'</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* types *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dead_poss</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="main"><span>(</span></span><span>TFree</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>TFree</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>resBs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_param</span></span><span> </span><span>NONE</span><span> </span><span class="entity"><span>passive</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>passive</span></span><span class="main"><span>,</span></span><span> </span><span>tl</span><span> </span><span class="entity"><span>passive</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_param</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>passive</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>passive</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_params</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_map</span><span> </span><span class="entity"><span>mk_param</span></span><span> </span><span class="entity"><span>dead_poss</span></span><span> </span><span>#&gt;</span><span> </span><span>fst</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_FTs</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_T_of_bnf</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Dss</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>params</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>params'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>`</span><span class="main"><span>(</span></span><span>map</span><span> </span><span>Term.dest_TFree</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_params</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>FTsAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_FTs</span></span><span> </span><span class="entity"><span>allAs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>FTsBs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_FTs</span></span><span> </span><span class="entity"><span>allBs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>FTsCs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_FTs</span></span><span> </span><span class="entity"><span>allCs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ATs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>BTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>activeAs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>B'Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>activeBs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>B''Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>activeCs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>U</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>activeAs</span></span><span> </span><span class="entity"><span>FTsAs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>s'Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>U</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>activeBs</span></span><span> </span><span class="entity"><span>FTsBs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>s''Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>U</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>activeCs</span></span><span> </span><span class="entity"><span>FTsCs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>U</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>activeAs</span></span><span> </span><span class="entity"><span>activeBs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>self_fTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>activeAs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>gTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>U</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>activeBs</span></span><span> </span><span class="entity"><span>activeCs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>all_gTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>U</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>allBs</span></span><span> </span><span class="entity"><span>allCs'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>RTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_prodT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>U</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>activeAs</span></span><span> </span><span class="entity"><span>activeBs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sRTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_prodT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>U</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>activeAs</span></span><span> </span><span class="entity"><span>activeAs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>R'Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_prodT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>U</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>activeBs</span></span><span> </span><span class="entity"><span>activeCs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>setsRTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>sRTs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>setRTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>RTs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>all_sbisT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_tupleT</span></span><span> </span><span class="entity"><span>setsRTs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>setR'Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>R'Ts</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>FRTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_FTs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>passiveAs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>RTs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* terms *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mapsAsAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_map_of_bnf</span></span><span> </span><span class="entity"><span>Dss</span></span><span> </span><span class="entity"><span>Ass</span></span><span> </span><span class="entity"><span>Ass</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mapsAsBs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_map_of_bnf</span></span><span> </span><span class="entity"><span>Dss</span></span><span> </span><span class="entity"><span>Ass</span></span><span> </span><span class="entity"><span>Bss</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mapsBsCs'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_map_of_bnf</span></span><span> </span><span class="entity"><span>Dss</span></span><span> </span><span class="entity"><span>Bss</span></span><span> </span><span class="entity"><span>Css'</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mapsAsCs'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_map_of_bnf</span></span><span> </span><span class="entity"><span>Dss</span></span><span> </span><span class="entity"><span>Ass</span></span><span> </span><span class="entity"><span>Css'</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_fsts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_map_of_bnf</span></span><span> </span><span class="entity"><span>Dss</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>passiveAs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>RTs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ass</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_snds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_map_of_bnf</span></span><span> </span><span class="entity"><span>Dss</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>passiveAs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>RTs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Bss</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_setss</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_sets_of_bnf</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>live</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Dss</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>live</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>setssAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_setss</span></span><span> </span><span class="entity"><span>allAs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>setssAs'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>setssAs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bis_setss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_setss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>passiveAs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>RTs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>relsAsBs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_rel_of_bnf</span></span><span> </span><span class="entity"><span>Dss</span></span><span> </span><span class="entity"><span>Ass</span></span><span> </span><span class="entity"><span>Bss</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_bd_of_bnf</span></span><span> </span><span class="entity"><span>Dss</span></span><span> </span><span class="entity"><span>Ass</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sum_bd</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Library.foldr1</span><span> </span><span class="main"><span>(</span></span><span>uncurry</span><span> </span><span class="entity"><span>mk_csum</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bds</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sum_bdT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dest_relT</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>sum_bd</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sum_bdT_params</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sum_bdT_params'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>`</span><span class="main"><span>(</span></span><span>map</span><span> </span><span>TFree</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Term.add_tfreesT</span><span> </span><span class="entity"><span>sum_bdT</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>zs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>zs'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>self_fs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>all_gs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xFs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>yFs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>yFs_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"b"</span></span><span> </span><span class="entity"><span>activeAs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"B"</span></span><span> </span><span class="entity"><span>BTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"s"</span></span><span> </span><span class="entity"><span>sTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"f"</span></span><span> </span><span class="entity"><span>fTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"f"</span></span><span> </span><span class="entity"><span>self_fTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"g"</span></span><span> </span><span class="entity"><span>all_gTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"x"</span></span><span> </span><span class="entity"><span>FTsAs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"y"</span></span><span> </span><span class="entity"><span>FTsBs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"y"</span></span><span> </span><span class="entity"><span>FTsBs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>passive_UNIVs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_UNIV</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>passive_eqs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.eq_const</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>active_UNIVs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_UNIV</span></span><span> </span><span class="entity"><span>activeAs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>passive_ids</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>active_ids</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>activeAs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fsts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>fst_const</span></span><span> </span><span class="entity"><span>RTs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>snds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>snd_const</span></span><span> </span><span class="entity"><span>RTs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* thms *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_card_orders</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>bd_card_order_of_bnf</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_card_order</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>hd</span><span> </span><span class="entity"><span>bd_card_orders</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_Card_orders</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>bd_Card_order_of_bnf</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_Card_order</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>hd</span><span> </span><span class="entity"><span>bd_Card_orders</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_Cinfinites</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>bd_Cinfinite_of_bnf</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_Cinfinite</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>hd</span><span> </span><span class="entity"><span>bd_Cinfinites</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_regularCards</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>bd_regularCard_of_bnf</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>in_monos</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>in_mono_of_bnf</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_comp0s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>map_comp0_of_bnf</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sym_map_comps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_sym</span></span><span> </span><span class="entity"><span>map_comp0s</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_comps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>map_comp_of_bnf</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_cong0s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>map_cong0_of_bnf</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_id0s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>map_id0_of_bnf</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_ids</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>map_id_of_bnf</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_bdss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>set_bd_of_bnf</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_mapss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>set_map_of_bnf</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_congs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>rel_cong0_of_bnf</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_converseps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>rel_conversep_of_bnf</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_Grps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>rel_Grp_of_bnf</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>le_rel_OOs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>le_rel_OO_of_bnf</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>in_rels</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>in_rel_of_bnf</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>timer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>time</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>timer</span></span><span> </span><span class="inner_quoted"><span>"Extracted terms &amp; thms"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* derived thms *)</span></span><span>

    </span><span class="comment1"><span>(*map g1 ... gm g(m+1) ... g(m+n) (map id ... id f(m+1) ... f(m+n) x) =
      map g1 ... gm (g(m+1) o f(m+1)) ... (g(m+n) o f(m+n)) x*)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_map_comp_id</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>mapAsBs</span></span><span> </span><span class="entity"><span>mapBsCs</span></span><span> </span><span class="entity"><span>mapAsCs</span></span><span> </span><span class="entity"><span>map_comp0</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mapBsCs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>all_gs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span>
          </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mapAsBs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>passive_ids</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rhs</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mapAsCs</span></span><span class="main"><span>,</span></span><span> </span><span>take</span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>all_gs</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span>drop</span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>all_gs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lhs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rhs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_map_comp_id_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>map_comp0</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_comp_id_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_map_comp_id</span></span><span> </span><span class="entity"><span>xFs</span></span><span> </span><span class="entity"><span>mapsAsBs</span></span><span> </span><span class="entity"><span>mapsBsCs'</span></span><span> </span><span class="entity"><span>mapsAsCs'</span></span><span> </span><span class="entity"><span>map_comps</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(*forall a : set(m+1) x. f(m+1) a = a; ...; forall a : set(m+n) x. f(m+n) a = a ==&gt;
      map id ... id f(m+1) ... f(m+n) x = x*)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_map_cong0L</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>mapAsAs</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>map_cong0</span></span><span> </span><span class="entity"><span>map_id</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_prem</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>z'</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Ball</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span class="entity"><span>z'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_prem</span></span><span> </span><span class="main"><span>(</span></span><span>drop</span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>self_fs</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>zs'</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mapAsAs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>passive_ids</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>self_fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>goal</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_map_cong0L_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>map_cong0</span></span><span> </span><span class="entity"><span>map_id</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_cong0L_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_map_cong0L</span></span><span> </span><span class="entity"><span>xFs</span></span><span> </span><span class="entity"><span>mapsAsAs</span></span><span> </span><span class="entity"><span>setssAs</span></span><span> </span><span class="entity"><span>map_cong0s</span></span><span> </span><span class="entity"><span>map_ids</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>in_mono'_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>subset_refl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.set_mp|fact"><span>set_mp</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>in_monos</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_arg_cong_thms</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>yFs</span></span><span> </span><span class="entity"><span>yFs_copy</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>maps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mapx</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mapx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>all_gs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mapsBsCs'</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concls</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mapx</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mapx</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mapx</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="entity"><span>yFs</span></span><span> </span><span class="entity"><span>yFs_copy</span></span><span> </span><span class="entity"><span>maps</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>prem</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prem</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="entity"><span>concls</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>THEN'</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>)</span></span><span>
        </span><span class="entity"><span>goals</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>timer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>time</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>timer</span></span><span> </span><span class="inner_quoted"><span>"Derived simple theorems"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* coalgebra *)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>coalg_bind</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_internal_b</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>coN</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>algN</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>coalg_def_bind</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.def_binding</span><span> </span><span class="entity"><span>coalg_bind</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(*forall i = 1 ... n: (∀x ∈ Bi. si ∈ Fi_in UNIV .. UNIV B1 ... Bn)*)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>coalg_spec</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ins</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_in</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>passive_UNIVs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>setssAs</span></span><span> </span><span class="entity"><span>FTsAs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_coalg_conjunct</span></span><span> </span><span class="entity"><span>B</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>X</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>z'</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>mk_Ball</span></span><span> </span><span class="entity"><span>B</span></span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span class="entity"><span>z'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_coalg_conjunct</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>ins</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>zs'</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span>o</span><span> </span><span>Term.dest_Free</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Bs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rhs</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>coalg_free</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>coalg_def_free</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy_old</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span>Local_Theory.begin_nested</span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>Local_Theory.define</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>coalg_bind</span></span><span class="main"><span>,</span></span><span> </span><span>NoSyn</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>coalg_def_bind</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>coalg_spec</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;</span><span> </span><span>`</span><span>Local_Theory.end_nested</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.export_morphism</span><span> </span><span class="entity"><span>lthy_old</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>coalg</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>Term.dest_Const</span><span> </span><span class="main"><span>(</span></span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>coalg_free</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>coalg_def</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_unabs_def</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_obj_eq</span></span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>coalg_def_free</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_coalg</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>coalgT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Library.foldr</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>coalg</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>coalgT</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>zs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>zs'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>B's</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s's</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"b"</span></span><span> </span><span class="entity"><span>activeAs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"B"</span></span><span> </span><span class="entity"><span>BTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"B'"</span></span><span> </span><span class="entity"><span>B'Ts</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"s"</span></span><span> </span><span class="entity"><span>sTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"s'"</span></span><span> </span><span class="entity"><span>s'Ts</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>coalg_prem</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_coalg</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>coalg_in_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="entity"><span>coalg_def</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>iffD1</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>mk_conjunctN</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>bspec</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>coalg_set_thmss</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>coalg_prem</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_coalg</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_prem</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>B</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>B</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_concl</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>B</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_leq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>B</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_prem</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>conclss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_concl</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="main"><span>(</span></span><span>drop</span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>setssAs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goalss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>prem</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>concls</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>coalg_prem</span></span><span> </span><span>::</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>prem</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>concls</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="entity"><span>conclss</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="entity"><span>mk_coalg_set_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>coalg_def</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>)</span></span><span>
        </span><span class="entity"><span>goals</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goalss</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_tcoalg</span></span><span> </span><span class="entity"><span>BTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_coalg</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_UNIV</span></span><span> </span><span class="entity"><span>BTs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tcoalg_thm</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_tcoalg</span></span><span> </span><span class="entity"><span>activeAs</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>coalg_def</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>iffD2</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>THEN</span><span> </span><span class="entity"><span>CONJ_WRAP</span></span><span>
            </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ballI</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectI</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>CONJ_WRAP'</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.subset_UNIV|fact"><span>subset_UNIV</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>allAs</span></span><span class="main"><span>]</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>timer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>time</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>timer</span></span><span> </span><span class="inner_quoted"><span>"Coalgebra definition &amp; thms"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* morphism *)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mor_bind</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_internal_b</span></span><span> </span><span class="entity"><span>morN</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mor_def_bind</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.def_binding</span><span> </span><span class="entity"><span>mor_bind</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(*fbetw) forall i = 1 ... n: (∀x ∈ Bi. fi x ∈ B'i)*)</span></span><span>
    </span><span class="comment1"><span>(*mor) forall i = 1 ... n: (∀x ∈ Bi.
       Fi_map id ... id f1 ... fn (si x) = si' (fi x)*)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mor_spec</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_fbetw</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>B1</span></span><span> </span><span class="entity"><span>B2</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>z'</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>mk_Ball</span></span><span> </span><span class="entity"><span>B1</span></span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span class="entity"><span>z'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>B2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_mor</span></span><span> </span><span class="entity"><span>B</span></span><span> </span><span class="entity"><span>mapAsBs</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>s'</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>z'</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>mk_Ball</span></span><span> </span><span class="entity"><span>B</span></span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span class="entity"><span>z'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span>
            </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mapAsBs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>passive_ids</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>s</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s'</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span>
          </span><span class="main"><span>(</span></span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_fbetw</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>B's</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>zs'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 7</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_mor</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>mapsAsBs</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>s's</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>zs'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span>o</span><span> </span><span>Term.dest_Free</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Bs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ss</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>B's</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>s's</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rhs</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>mor_free</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mor_def_free</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy_old</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span>Local_Theory.begin_nested</span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>Local_Theory.define</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>mor_bind</span></span><span class="main"><span>,</span></span><span> </span><span>NoSyn</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mor_def_bind</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mor_spec</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;</span><span> </span><span>`</span><span>Local_Theory.end_nested</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.export_morphism</span><span> </span><span class="entity"><span>lthy_old</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mor</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>Term.dest_Const</span><span> </span><span class="main"><span>(</span></span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>mor_free</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mor_def</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_unabs_def</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>5</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_obj_eq</span></span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>mor_def_free</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_mor</span></span><span> </span><span class="entity"><span>Bs1</span></span><span> </span><span class="entity"><span>ss1</span></span><span> </span><span class="entity"><span>Bs2</span></span><span> </span><span class="entity"><span>ss2</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Bs1</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ss1</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Bs2</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ss2</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>fastype_of</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Bs1</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ss1</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Bs2</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ss2</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>morT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Library.foldr</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mor</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>morT</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>zs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>z's</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Bs_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>B's</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>B''s</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s's</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s''s</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>RFs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"b"</span></span><span> </span><span class="entity"><span>activeAs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"b"</span></span><span> </span><span class="entity"><span>activeBs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"B"</span></span><span> </span><span class="entity"><span>BTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"B"</span></span><span> </span><span class="entity"><span>BTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"B'"</span></span><span> </span><span class="entity"><span>B'Ts</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"B''"</span></span><span> </span><span class="entity"><span>B''Ts</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"s"</span></span><span> </span><span class="entity"><span>sTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"s'"</span></span><span> </span><span class="entity"><span>s'Ts</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"s''"</span></span><span> </span><span class="entity"><span>s''Ts</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"f"</span></span><span> </span><span class="entity"><span>fTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"f"</span></span><span> </span><span class="entity"><span>fTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"g"</span></span><span> </span><span class="entity"><span>gTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"x"</span></span><span> </span><span class="entity"><span>FRTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"R"</span></span><span> </span><span class="entity"><span>setRTs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mor_prem</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_mor</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>B's</span></span><span> </span><span class="entity"><span>s's</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mor_image_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>morE_thms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prem</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_mor</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>B's</span></span><span> </span><span class="entity"><span>s's</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_image_goal</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>B1</span></span><span> </span><span class="entity"><span>B2</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prem</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_leq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_image</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>B1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>B2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>image_goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_image_goal</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>B's</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_elim_goal</span></span><span> </span><span class="entity"><span>B</span></span><span> </span><span class="entity"><span>mapAsBs</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>s'</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>prem</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_Trueprop_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>B</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mapAsBs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>passive_ids</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>s</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s'</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>elim_goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_elim_goal</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>mapsAsBs</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>s's</span></span><span> </span><span class="entity"><span>zs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="entity"><span>mk_mor_elim_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>mor_def</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>image_goals</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>elim_goals</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mor_image'_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.set_mp|fact"><span>set_mp</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>imageI</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mor_image_thms</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mor_incl_thm</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>mk_leq</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>Bs_copy</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_mor</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>Bs_copy</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>active_ids</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_mor_incl_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>mor_def</span></span><span> </span><span class="entity"><span>map_ids</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mor_id_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mor_incl_thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>subset_refl</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mor_comp_thm</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_mor</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>B's</span></span><span> </span><span class="entity"><span>s's</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_mor</span></span><span> </span><span class="entity"><span>B's</span></span><span> </span><span class="entity"><span>s's</span></span><span> </span><span class="entity"><span>B''s</span></span><span> </span><span class="entity"><span>s''s</span></span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_mor</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>B''s</span></span><span> </span><span class="entity"><span>s''s</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>gs</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="entity"><span>mk_mor_comp_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>mor_def</span></span><span> </span><span class="entity"><span>mor_image'_thms</span></span><span> </span><span class="entity"><span>morE_thms</span></span><span> </span><span class="entity"><span>map_comp_id_thms</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mor_cong_thm</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span>
         </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs_copy</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mk_mor</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>B's</span></span><span> </span><span class="entity"><span>s's</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_mor</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>B's</span></span><span> </span><span class="entity"><span>s's</span></span><span> </span><span class="entity"><span>fs_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>THEN'</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mor_UNIV_thm</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_conjunct</span></span><span> </span><span class="entity"><span>mapAsBs</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>s'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mapAsBs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>passive_ids</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_mor</span></span><span> </span><span class="entity"><span>active_UNIVs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_UNIV</span></span><span> </span><span class="entity"><span>activeBs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>s's</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_conjunct</span></span><span> </span><span class="entity"><span>mapsAsBs</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>s's</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>lhs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rhs</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lhs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rhs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_mor_UNIV_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>morE_thms</span></span><span> </span><span class="entity"><span>mor_def</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mor_str_thm</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>maps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.list_comb</span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>mk_map_of_bnf</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>allAs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>passiveAs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>FTsAs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>passive_ids</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Dss</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_mor</span></span><span> </span><span class="entity"><span>active_UNIVs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_UNIV</span></span><span> </span><span class="entity"><span>FTsAs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>maps</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_mor_str_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>mor_UNIV_thm</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>timer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>time</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>timer</span></span><span> </span><span class="inner_quoted"><span>"Morphism definition &amp; thms"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* bisimulation *)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bis_bind</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_internal_b</span></span><span> </span><span class="entity"><span>bisN</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bis_def_bind</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.def_binding</span><span> </span><span class="entity"><span>bis_bind</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_bis_le_conjunct</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="entity"><span>B1</span></span><span> </span><span class="entity"><span>B2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_leq</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Times</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>B1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>B2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bis_le</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_bis_le_conjunct</span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>B's</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bis_spec</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fst_args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>passive_ids</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fsts</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>snd_args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>passive_ids</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>snds</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_bis</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>s'</span></span><span> </span><span class="entity"><span>b1</span></span><span> </span><span class="entity"><span>b2</span></span><span> </span><span class="entity"><span>RF</span></span><span> </span><span class="entity"><span>map1</span></span><span> </span><span class="entity"><span>map2</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>list_all_free</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>b1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b2</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_imp</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_prod</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>b1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b2</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>mk_Bex</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_in</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>passive_UNIVs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>RF</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>RF</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_conj</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fst_args</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>RF</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>b1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>snd_args</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>RF</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>b2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>bis_le</span></span><span class="main"><span>,</span></span><span> </span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span>
            </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 9</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_bis</span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>s's</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>z's</span></span><span> </span><span class="entity"><span>RFs</span></span><span> </span><span class="entity"><span>map_fsts</span></span><span> </span><span class="entity"><span>map_snds</span></span><span> </span><span class="entity"><span>bis_setss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span>o</span><span> </span><span>Term.dest_Free</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Bs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ss</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>B's</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>s's</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rhs</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>bis_free</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bis_def_free</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy_old</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span>Local_Theory.begin_nested</span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>Local_Theory.define</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>bis_bind</span></span><span class="main"><span>,</span></span><span> </span><span>NoSyn</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bis_def_bind</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bis_spec</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;</span><span> </span><span>`</span><span>Local_Theory.end_nested</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.export_morphism</span><span> </span><span class="entity"><span>lthy_old</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bis</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>Term.dest_Const</span><span> </span><span class="main"><span>(</span></span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>bis_free</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bis_def</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_unabs_def</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>5</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_obj_eq</span></span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>bis_def_free</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_bis</span></span><span> </span><span class="entity"><span>Bs1</span></span><span> </span><span class="entity"><span>ss1</span></span><span> </span><span class="entity"><span>Bs2</span></span><span> </span><span class="entity"><span>ss2</span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Bs1</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ss1</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Bs2</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ss2</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bisT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Library.foldr</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bis</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bisT</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>zs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>z's</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>B's</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>B''s</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s's</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s''s</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rtuple</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Rtuple'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>Rs_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R's</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sRs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>idx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ris</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"b"</span></span><span> </span><span class="entity"><span>activeAs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"b"</span></span><span> </span><span class="entity"><span>activeBs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"B"</span></span><span> </span><span class="entity"><span>BTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"B'"</span></span><span> </span><span class="entity"><span>B'Ts</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"B''"</span></span><span> </span><span class="entity"><span>B''Ts</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"s"</span></span><span> </span><span class="entity"><span>sTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"s'"</span></span><span> </span><span class="entity"><span>s'Ts</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"s''"</span></span><span> </span><span class="entity"><span>s''Ts</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"f"</span></span><span> </span><span class="entity"><span>fTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>~~</span><span class="main"><span>)</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"Rtuple"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>all_sbisT</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"R"</span></span><span> </span><span class="entity"><span>setRTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"R"</span></span><span> </span><span class="entity"><span>setRTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"R'"</span></span><span> </span><span class="entity"><span>setR'Ts</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"R"</span></span><span> </span><span class="entity"><span>setsRTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>~~</span><span class="main"><span>)</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"i"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>idxT</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"I"</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>idxT</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"Ri"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>idxT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>setRTs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bis_cong_thm</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span>
         </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bis</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>B's</span></span><span> </span><span class="entity"><span>s's</span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span>::</span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Rs_copy</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bis</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>B's</span></span><span> </span><span class="entity"><span>s's</span></span><span> </span><span class="entity"><span>Rs_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>THEN'</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bis_rel_thm</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_conjunct</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>s'</span></span><span> </span><span class="entity"><span>b1</span></span><span> </span><span class="entity"><span>b2</span></span><span> </span><span class="entity"><span>rel</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>list_all_free</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>b1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b2</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_imp</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_prod</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>b1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b2</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>passive_eqs</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_in_rel</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>b1</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>b2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>bis_le</span></span><span class="main"><span>,</span></span><span> </span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span>
            </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_conjunct</span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>s's</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>z's</span></span><span> </span><span class="entity"><span>relsAsBs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bis</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>B's</span></span><span> </span><span class="entity"><span>s's</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rhs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_bis_rel_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>bis_def</span></span><span> </span><span class="entity"><span>in_rels</span></span><span> </span><span class="entity"><span>map_comps</span></span><span>
            </span><span class="entity"><span>map_cong0s</span></span><span> </span><span class="entity"><span>set_mapss</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bis_converse_thm</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bis</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>B's</span></span><span> </span><span class="entity"><span>s's</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bis</span></span><span> </span><span class="entity"><span>B's</span></span><span> </span><span class="entity"><span>s's</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>mk_converse</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_bis_converse_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>bis_rel_thm</span></span><span> </span><span class="entity"><span>rel_congs</span></span><span>
            </span><span class="entity"><span>rel_converseps</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bis_O_thm</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bis</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>B's</span></span><span> </span><span class="entity"><span>s's</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bis</span></span><span> </span><span class="entity"><span>B's</span></span><span> </span><span class="entity"><span>s's</span></span><span> </span><span class="entity"><span>B''s</span></span><span> </span><span class="entity"><span>s''s</span></span><span> </span><span class="entity"><span>R's</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bis</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>B''s</span></span><span> </span><span class="entity"><span>s''s</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>mk_rel_comp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="entity"><span>R's</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_bis_O_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>bis_rel_thm</span></span><span> </span><span class="entity"><span>rel_congs</span></span><span> </span><span class="entity"><span>le_rel_OOs</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bis_Gr_thm</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bis</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>B's</span></span><span> </span><span class="entity"><span>s's</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="entity"><span>mk_Gr</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>coalg_prem</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mor_prem</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>coalg_prem</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mor_prem</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_bis_Gr_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>bis_rel_thm</span></span><span> </span><span class="entity"><span>rel_Grps</span></span><span> </span><span class="entity"><span>mor_image_thms</span></span><span>
            </span><span class="entity"><span>morE_thms</span></span><span> </span><span class="entity"><span>coalg_in_thms</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bis_image2_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bis_cong_thm</span></span><span> </span><span>OF</span><span>
      </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>bis_O_thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>bis_Gr_thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>bis_converse_thm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bis_Gr_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span>
      </span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Greatest_Fixpoint.html#BNF_Greatest_Fixpoint.image2_Gr|fact"><span>image2_Gr</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bis_Id_on_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bis_cong_thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>mor_id_thm</span></span><span> </span><span>RSN</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bis_Gr_thm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span>
      </span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Greatest_Fixpoint.html#BNF_Greatest_Fixpoint.Id_on_Gr|fact"><span>Id_on_Gr</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bis_Union_thm</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prem</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Ball</span></span><span> </span><span class="entity"><span>Idx</span></span><span>
            </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span class="entity"><span>idx'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bis</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>B's</span></span><span> </span><span class="entity"><span>s's</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ris</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bis</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>B's</span></span><span> </span><span class="entity"><span>s's</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_UNION</span></span><span> </span><span class="entity"><span>Idx</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ris</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>prem</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prem</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_bis_Union_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>bis_def</span></span><span> </span><span class="entity"><span>in_mono'_thms</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* self-bisimulation *)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_sbis</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bis</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* largest self-bisimulation *)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lsbis_binds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_internal_bs</span></span><span> </span><span class="entity"><span>lsbisN</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>lsbis_bind</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>lsbis_binds</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lsbis_def_bind</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>rpair</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span>o</span><span> </span><span>Thm.def_binding</span><span> </span><span>o</span><span> </span><span class="entity"><span>lsbis_bind</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>all_sbis</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Collect</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>Rtuple'</span></span><span class="main"><span>,</span></span><span> </span><span>snd</span><span> </span><span class="entity"><span>Rtuple'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>list_exists_free</span></span><span> </span><span class="entity"><span>sRs</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rtuple</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_tuple</span></span><span> </span><span class="entity"><span>sRs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_sbis</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>sRs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>lsbis_spec</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span>o</span><span> </span><span>Term.dest_Free</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Bs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>mk_UNION</span></span><span> </span><span class="entity"><span>all_sbis</span></span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span class="entity"><span>Rtuple'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_nthN</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>Rtuple</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>lsbis_frees</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lsbis_def_frees</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy_old</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span>Local_Theory.begin_nested</span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Local_Theory.define</span><span>
        </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>lsbis_bind</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span>NoSyn</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lsbis_def_bind</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lsbis_spec</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span>
      </span><span>|&gt;&gt;</span><span> </span><span>apsnd</span><span> </span><span>split_list</span><span> </span><span>o</span><span> </span><span>split_list</span><span>
      </span><span>||&gt;</span><span> </span><span>`</span><span>Local_Theory.end_nested</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.export_morphism</span><span> </span><span class="entity"><span>lthy_old</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lsbis_defs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="entity"><span>mk_unabs_def</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_obj_eq</span></span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>def</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lsbis_def_frees</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lsbiss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>Term.dest_Const</span><span> </span><span>o</span><span> </span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lsbis_frees</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_lsbis</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>RT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_relT</span></span><span> </span><span class="main"><span>(</span></span><span>`</span><span>I</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.dest_setT</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lsbisT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Library.foldr</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>RT</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>lsbiss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lsbisT</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>zs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>zs'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sRs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"b"</span></span><span> </span><span class="entity"><span>activeAs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"B"</span></span><span> </span><span class="entity"><span>BTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"s"</span></span><span> </span><span class="entity"><span>sTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"R"</span></span><span> </span><span class="entity"><span>setsRTs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sbis_prem</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_sbis</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>sRs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>coalg_prem</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_coalg</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sbis_lsbis_thm</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_sbis</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_lsbis</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="entity"><span>mk_sbis_lsbis_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>lsbis_defs</span></span><span> </span><span class="entity"><span>bis_Union_thm</span></span><span> </span><span class="entity"><span>bis_cong_thm</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lsbis_incl_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>sbis_lsbis_thm</span></span><span> </span><span>RS</span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>bis_def</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>iffD1</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>conjunct1</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>mk_conjunctN</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lsbisE_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_specN</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sbis_lsbis_thm</span></span><span> </span><span>RS</span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>bis_def</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>iffD1</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>conjunct2</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>mk_conjunctN</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>mp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>incl_lsbis_thms</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_concl</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_leq</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_lsbis</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sbis_prem</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_concl</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>sRs</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="entity"><span>mk_incl_lsbis_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>def</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>)</span></span><span>
        </span><span class="entity"><span>goals</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>lsbis_defs</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>equiv_lsbis_thms</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_concl</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>B</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_equiv</span></span><span> </span><span class="entity"><span>B</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_lsbis</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>B</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>coalg_prem</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_concl</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>B</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>l_incl</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>incl_l</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
            </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_equiv_lsbis_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>sbis_lsbis_thm</span></span><span> </span><span class="entity"><span>l_incl</span></span><span> </span><span class="entity"><span>incl_l</span></span><span>
              </span><span class="entity"><span>bis_Id_on_thm</span></span><span> </span><span class="entity"><span>bis_converse_thm</span></span><span> </span><span class="entity"><span>bis_O_thm</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="entity"><span>goals</span></span><span> </span><span class="entity"><span>lsbis_incl_thms</span></span><span> </span><span class="entity"><span>incl_lsbis_thms</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>timer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>time</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>timer</span></span><span> </span><span class="inner_quoted"><span>"Bisimulations"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* bounds *)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sbd'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sbdT'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sbd_card_order'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sbd_Cinfinite'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sbd_Card_order'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_sbdss'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sum_bd</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sum_bdT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bd_card_order</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bd_Cinfinite</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bd_Card_order</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_bdss</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sbdT_bind</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_internal_b</span></span><span> </span><span class="entity"><span>sum_bdTN</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>sbdT_name</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sbdT_glob_info</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sbdT_loc_info</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="entity"><span>typedef</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sbdT_bind</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sum_bdT_params'</span></span><span class="main"><span>,</span></span><span> </span><span>NoSyn</span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_UNIV</span></span><span> </span><span class="entity"><span>sum_bdT</span></span><span class="main"><span>)</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>exI</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>UNIV_I</span></span><span class="main"><span>]</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sbdT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sbdT_name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sum_bdT_params</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Abs_sbdT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Abs_name</span><span> </span><span class="entity"><span>sbdT_glob_info</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sum_bdT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>sbdT</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sbd_bind</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_internal_b</span></span><span> </span><span class="entity"><span>sum_bdN</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sbd_def_bind</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.def_binding</span><span> </span><span class="entity"><span>sbd_bind</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sbd_spec</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_dir_image</span></span><span> </span><span class="entity"><span>sum_bd</span></span><span> </span><span class="entity"><span>Abs_sbdT</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>sbd_free</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sbd_def_free</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy_old</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="entity"><span>lthy</span></span><span>
            </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span>Local_Theory.begin_nested</span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Local_Theory.define</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>sbd_bind</span></span><span class="main"><span>,</span></span><span> </span><span>NoSyn</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sbd_def_bind</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sbd_spec</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>||&gt;</span><span> </span><span>`</span><span>Local_Theory.end_nested</span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.export_morphism</span><span> </span><span class="entity"><span>lthy_old</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sbd_def</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_obj_eq</span></span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>sbd_def_free</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sbd</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>Term.dest_Const</span><span> </span><span class="main"><span>(</span></span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>sbd_free</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_relT</span></span><span> </span><span class="main"><span>(</span></span><span>`</span><span>I</span><span> </span><span class="entity"><span>sbdT</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Abs_sbdT_inj</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Abs_inj_thm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Abs_inject</span><span> </span><span class="entity"><span>sbdT_loc_info</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Abs_sbdT_bij</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Abs_bij_thm</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>Abs_sbdT_inj</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Abs_cases</span><span> </span><span class="entity"><span>sbdT_loc_info</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sum_Cinfinite</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_sum_Cinfinite</span></span><span> </span><span class="entity"><span>bd_Cinfinites</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sum_Card_order</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sum_Cinfinite</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>conjunct2</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sum_card_order</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_sum_card_order</span></span><span> </span><span class="entity"><span>bd_card_orders</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sbd_ordIso</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Least_Fixpoint.html#BNF_Least_Fixpoint.ssubst_Pair_rhs|fact"><span>ssubst_Pair_rhs</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span>
            </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Cardinal_Arithmetic.html#BNF_Cardinal_Arithmetic.dir_image|fact"><span>dir_image</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Abs_sbdT_inj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sum_Card_order</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>sbd_def</span></span><span>
          </span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sbd_card_order</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.arg_cong|fact"><span>arg_cong</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>of</span></span><span> </span><span class="main"><span class="main"><span class="main"><span>_</span></span></span></span><span> </span><span class="main"><span class="main"><span class="main"><span>_</span></span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../../../../BNF_Cardinal_Order_Relation.html#BNF_Cardinal_Order_Relation.card_order|const"><span>card_order</span></a></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span>
            </span><span class="main"><span>[</span></span><span class="entity"><span>sbd_def</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Cardinal_Arithmetic.html#BNF_Cardinal_Arithmetic.card_order_dir_image|fact"><span>card_order_dir_image</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Abs_sbdT_bij</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sum_card_order</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sbd_Cinfinite</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Cardinal_Arithmetic.html#BNF_Cardinal_Arithmetic.Cinfinite_cong|fact"><span>Cinfinite_cong</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>sbd_ordIso</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sum_Cinfinite</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sbd_Card_order</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>conjunct2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>sbd_Cinfinite</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_set_sbd</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>bd_Card_order</span></span><span> </span><span class="entity"><span>bds</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Wellorder_Constructions.html#BNF_Wellorder_Constructions.ordLess_ordIso_trans|fact"><span>ordLess_ordIso_trans</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span>
              </span><span class="main"><span>[</span></span><span class="entity"><span>mk_ordLess_csum</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>bd_Card_order</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sbd_ordIso</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bds</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_sbdss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_set_sbd</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>bd_Card_orders</span></span><span> </span><span class="entity"><span>set_bdss</span></span><span class="main"><span>;</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
         </span><span class="main"><span>(</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sbd</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sbdT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sbd_card_order</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sbd_Cinfinite</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sbd_Card_order</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_sbdss</span></span><span class="main"><span>)</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sbd</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_card_suc</span></span><span> </span><span class="entity"><span>sbd'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sbdT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dest_relT</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>sbd</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sbd_card_order</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Cardinal_Order_Relation.html#BNF_Cardinal_Order_Relation.card_order_card_suc|fact"><span>card_order_card_suc</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>sbd_card_order'</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sbd_Cinfinite</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Cardinal_Arithmetic.html#BNF_Cardinal_Arithmetic.Cinfinite_card_suc|fact"><span>Cinfinite_card_suc</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>sbd_Cinfinite'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sbd_card_order'</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sbd_Card_order</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Cardinal_Order_Relation.html#BNF_Cardinal_Order_Relation.Card_order_card_suc|fact"><span>Card_order_card_suc</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>sbd_card_order'</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sbd_regularCard</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Cardinal_Arithmetic.html#BNF_Cardinal_Arithmetic.regularCard_card_suc|fact"><span>regularCard_card_suc</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>sbd_card_order'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sbd_Cinfinite'</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_sbdss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Wellorder_Constructions.html#BNF_Wellorder_Constructions.ordLess_transitive|fact"><span>ordLess_transitive</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span>
      </span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Cardinal_Order_Relation.html#BNF_Cardinal_Order_Relation.card_suc_greater|fact"><span>card_suc_greater</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>sbd_card_order'</span></span><span class="main"><span>]</span></span><span>
    </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_sbdss'</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sbdTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>sbdT</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sum_sbdT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_sumTN</span></span><span> </span><span class="entity"><span>sbdTs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sum_sbd_listT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.listT</span></span><span> </span><span class="entity"><span>sum_sbdT</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sum_sbd_list_setT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>sum_sbd_listT</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bdTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span> </span><span>@</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>sbdT</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>to_sbd_maps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_map_of_bnf</span></span><span> </span><span class="entity"><span>Dss</span></span><span> </span><span class="entity"><span>Ass</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>bdTs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bdFTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_FTs</span></span><span> </span><span class="entity"><span>bdTs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sbdFT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_sumTN</span></span><span> </span><span class="entity"><span>bdFTs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>treeT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_prodT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sum_sbd_list_setT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sum_sbd_listT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>sbdFT</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>treeQT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>treeT</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>treeTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span> </span><span>@</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>treeT</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>treeQTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span> </span><span>@</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>treeQT</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>treeFTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_FTs</span></span><span> </span><span class="entity"><span>treeTs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tree_maps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_map_of_bnf</span></span><span> </span><span class="entity"><span>Dss</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>bdTs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>treeTs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>final_maps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_map_of_bnf</span></span><span> </span><span class="entity"><span>Dss</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>treeTs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>treeQTs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>isNode_setss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_setss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>passiveAs</span></span><span> </span><span>@</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>sbdT</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>root</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_set</span></span><span> </span><span class="entity"><span>sum_sbd_listT</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_list</span></span><span> </span><span class="entity"><span>sum_sbdT</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Zero</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_tuple</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>absdummy</span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="entity"><span>root</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>activeAs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Lev_recT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>Zero</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Nil</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_tuple</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>z'</span></span><span class="main"><span>=&gt;</span></span><span>
      </span><span>Term.absfree</span><span> </span><span class="entity"><span>z'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_InN</span></span><span> </span><span class="entity"><span>activeAs</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>zs'</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rv_recT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>Nil</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>zs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>zs'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>zs_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nat</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nat'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>sumx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sumx'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>kks</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>kks'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>kl</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>kl'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>kl_copy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>kl'_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Kl</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Kl'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lab</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lab'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>Kl_lab</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Kl_lab'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Lev_rec</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Lev_rec'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rv_rec</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rv_rec'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"b"</span></span><span> </span><span class="entity"><span>activeAs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"b"</span></span><span> </span><span class="entity"><span>activeAs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"s"</span></span><span> </span><span class="entity"><span>sTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>~~</span><span class="main"><span>)</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"n"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>HOLogic.natT</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>~~</span><span class="main"><span>)</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"sumx"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sum_sbdT</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"k"</span></span><span> </span><span class="entity"><span>sbdTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>~~</span><span class="main"><span>)</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"kl"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sum_sbd_listT</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>~~</span><span class="main"><span>)</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"kl"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sum_sbd_listT</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>~~</span><span class="main"><span>)</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"Kl"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sum_sbd_list_setT</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>~~</span><span class="main"><span>)</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"lab"</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sum_sbd_listT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>sbdFT</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>~~</span><span class="main"><span>)</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"Kl_lab"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>treeT</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"x"</span></span><span> </span><span class="entity"><span>bdFTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>~~</span><span class="main"><span>)</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"rec"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Lev_recT</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>~~</span><span class="main"><span>)</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"rec"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rv_recT</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>k'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>kks</span></span><span class="main"><span>,</span></span><span> </span><span>hd</span><span> </span><span class="entity"><span>kks'</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>timer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>time</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>timer</span></span><span> </span><span class="inner_quoted"><span>"Bounds"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* tree coalgebra *)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>isNode_binds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_internal_bs</span></span><span> </span><span class="entity"><span>isNodeN</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>isNode_bind</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>isNode_binds</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>isNode_def_bind</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>rpair</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span>o</span><span> </span><span>Thm.def_binding</span><span> </span><span>o</span><span> </span><span class="entity"><span>isNode_bind</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>isNodeT</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Library.foldr</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fastype_of</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Kl</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lab</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>kl</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Succs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>k'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="entity"><span>HOLogic.mk_Collect</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>k'</span></span><span class="main"><span>,</span></span><span> </span><span>snd</span><span> </span><span class="entity"><span>k'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_InN</span></span><span> </span><span class="entity"><span>sbdTs</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_Succ</span></span><span> </span><span class="entity"><span>Kl</span></span><span> </span><span class="entity"><span>kl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>kks</span></span><span> </span><span class="entity"><span>kks'</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>isNode_spec</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>active_sets</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>drop</span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>list_exists_free</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span>
          </span><span class="main"><span>(</span></span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lab</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>kl</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_InN</span></span><span> </span><span class="entity"><span>bdFTs</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span>
          </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>active_sets</span></span><span> </span><span class="entity"><span>Succs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span>o</span><span> </span><span>Term.dest_Free</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Kl</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lab</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>kl</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>rhs</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>isNode_frees</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>isNode_def_frees</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy_old</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span>Local_Theory.begin_nested</span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Local_Theory.define</span><span>
        </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>isNode_bind</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span>NoSyn</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>isNode_def_bind</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>isNode_spec</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>isNode_setss</span></span><span>
      </span><span>|&gt;&gt;</span><span> </span><span>apsnd</span><span> </span><span>split_list</span><span> </span><span>o</span><span> </span><span>split_list</span><span>
      </span><span>||&gt;</span><span> </span><span>`</span><span>Local_Theory.end_nested</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.export_morphism</span><span> </span><span class="entity"><span>lthy_old</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>isNode_defs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="entity"><span>mk_unabs_def</span></span><span> </span><span class="inner_numeral"><span>3</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_obj_eq</span></span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>def</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>isNode_def_frees</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>isNodes</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>Term.dest_Const</span><span> </span><span>o</span><span> </span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>isNode_frees</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_isNode</span></span><span> </span><span class="entity"><span>kl</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>isNodes</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>isNodeT</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Kl</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lab</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>kl</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>isTree</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>empty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_list</span></span><span> </span><span class="entity"><span>sum_sbdT</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Kl</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tree</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Ball</span></span><span> </span><span class="entity"><span>Kl</span></span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span class="entity"><span>kl'</span></span><span>
          </span><span class="main"><span>(</span></span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Succ</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>k'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="entity"><span>mk_Ball</span></span><span> </span><span class="entity"><span>Succ</span></span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span class="entity"><span>k'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_isNode</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>mk_append</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>kl</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_list</span></span><span> </span><span class="entity"><span>sum_sbdT</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mk_InN</span></span><span> </span><span class="entity"><span>sbdTs</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>Succs</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>kks</span></span><span> </span><span class="entity"><span>kks'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>empty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tree</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>carT_binds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_internal_bs</span></span><span> </span><span class="entity"><span>carTN</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>carT_bind</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>carT_binds</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>carT_def_bind</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>rpair</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span>o</span><span> </span><span>Thm.def_binding</span><span> </span><span>o</span><span> </span><span class="entity"><span>carT_bind</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>carT_spec</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>HOLogic.mk_Collect</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>Kl_lab'</span></span><span class="main"><span>,</span></span><span> </span><span>snd</span><span> </span><span class="entity"><span>Kl_lab'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>list_exists_free</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Kl</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lab</span></span><span class="main"><span>]</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Kl_lab</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_prod</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Kl</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lab</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>isTree</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_isNode</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_list</span></span><span> </span><span class="entity"><span>sum_sbdT</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>carT_frees</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>carT_def_frees</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy_old</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span>Local_Theory.begin_nested</span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span>Local_Theory.define</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>carT_bind</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span>NoSyn</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>carT_def_bind</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>carT_spec</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span>
      </span><span>|&gt;&gt;</span><span> </span><span>apsnd</span><span> </span><span>split_list</span><span> </span><span>o</span><span> </span><span>split_list</span><span>
      </span><span>||&gt;</span><span> </span><span>`</span><span>Local_Theory.end_nested</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.export_morphism</span><span> </span><span class="entity"><span>lthy_old</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>carT_defs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_obj_eq</span></span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>def</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>carT_def_frees</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>carTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>Term.dest_Const</span><span> </span><span>o</span><span> </span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>carT_frees</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_carT</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>carTs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>treeT</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>strT_binds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_internal_bs</span></span><span> </span><span class="entity"><span>strTN</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>strT_bind</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>strT_binds</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>strT_def_bind</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>rpair</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span>o</span><span> </span><span>Thm.def_binding</span><span> </span><span>o</span><span> </span><span class="entity"><span>strT_bind</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>strT_spec</span></span><span> </span><span class="entity"><span>mapFT</span></span><span> </span><span class="entity"><span>FT</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_f</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="entity"><span>k'</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>in_k</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_InN</span></span><span> </span><span class="entity"><span>sbdTs</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Term.absfree</span><span> </span><span class="entity"><span>k'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_prod</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Shift</span></span><span> </span><span class="entity"><span>Kl</span></span><span> </span><span class="entity"><span>in_k</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_shift</span></span><span> </span><span class="entity"><span>lab</span></span><span> </span><span class="entity"><span>in_k</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mapFT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>passive_ids</span></span><span> </span><span>@</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_f</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>kks</span></span><span> </span><span class="entity"><span>kks'</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fTs1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fTs2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apsnd</span><span> </span><span>tl</span><span> </span><span class="main"><span>(</span></span><span>chop</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>FT</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bdFTs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_undefined</span></span><span> </span><span class="entity"><span>fTs1</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span>::</span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_undefined</span></span><span> </span><span class="entity"><span>fTs2</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>HOLogic.mk_case_prod</span></span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span class="entity"><span>Kl'</span></span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span class="entity"><span>lab'</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>mk_case_sumN</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lab</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>HOLogic.mk_list</span></span><span> </span><span class="entity"><span>sum_sbdT</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>strT_frees</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>strT_def_frees</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy_old</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span>Local_Theory.begin_nested</span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mapFT</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>FT</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Local_Theory.define</span><span>
        </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>strT_bind</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span>NoSyn</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>strT_def_bind</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>strT_spec</span></span><span> </span><span class="entity"><span>mapFT</span></span><span> </span><span class="entity"><span>FT</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>tree_maps</span></span><span> </span><span class="entity"><span>treeFTs</span></span><span>
      </span><span>|&gt;&gt;</span><span> </span><span>apsnd</span><span> </span><span>split_list</span><span> </span><span>o</span><span> </span><span>split_list</span><span>
      </span><span>||&gt;</span><span> </span><span>`</span><span>Local_Theory.end_nested</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.export_morphism</span><span> </span><span class="entity"><span>lthy_old</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>strT_defs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="entity"><span>trans</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_obj_eq</span></span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>def</span></span><span class="main"><span>)</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>fun_cong</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="entity"><span>strT_def_frees</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>strTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>Term.dest_Const</span><span> </span><span>o</span><span> </span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>strT_frees</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_strT</span></span><span> </span><span class="entity"><span>FT</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>strTs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>treeT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>FT</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>carTAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_carT</span></span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>strTAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_strT</span></span><span> </span><span class="entity"><span>treeFTs</span></span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>coalgT_thm</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_coalg</span></span><span> </span><span class="entity"><span>carTAs</span></span><span> </span><span class="entity"><span>strTAs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_coalgT_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>m</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>coalg_def</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>isNode_defs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>carT_defs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>strT_defs</span></span><span> </span><span class="entity"><span>set_mapss</span></span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>timer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>time</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>timer</span></span><span> </span><span class="inner_quoted"><span>"Tree coalgebra"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_to_sbd</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>i'</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>mk_toCard</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>setssAs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>m</span></span><span> </span><span>+</span><span> </span><span class="entity"><span>i'</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sbd</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_from_sbd</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>i'</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>mk_fromCard</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>setssAs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>m</span></span><span> </span><span>+</span><span> </span><span class="entity"><span>i'</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sbd</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_to_sbd_thmss</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>set_sbd</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Wellorder_Constructions.html#BNF_Wellorder_Constructions.ordLess_imp_ordLeq|fact"><span>ordLess_imp_ordLeq</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>set_sbd</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sbd_Card_order</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>drop</span><span> </span><span class="entity"><span>m</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_sbdss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>to_sbd_inj_thmss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_to_sbd_thmss</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Greatest_Fixpoint.html#BNF_Greatest_Fixpoint.toCard_inj|fact"><span>toCard_inj</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>from_to_sbd_thmss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_to_sbd_thmss</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Greatest_Fixpoint.html#BNF_Greatest_Fixpoint.fromCard_toCard|fact"><span>fromCard_toCard</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Lev_bind</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_internal_b</span></span><span> </span><span class="entity"><span>LevN</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Lev_def_bind</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>rpair</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.def_binding</span><span> </span><span class="entity"><span>Lev_bind</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Lev_spec</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_Suc</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>setsAs</span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="entity"><span>a'</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>drop</span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>setsAs</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_set</span></span><span> </span><span class="entity"><span>i'</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Cons</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>kl_copy</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>mk_Cons</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_InN</span></span><span> </span><span class="entity"><span>sbdTs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_to_sbd</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>i'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i'</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>kl</span></span><span class="main"><span>)</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>b_set</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>b</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>kl_rec</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>kl</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_nthN</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>Lev_rec</span></span><span> </span><span class="entity"><span>i'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span class="entity"><span>HOLogic.mk_Collect</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>kl'_copy</span></span><span class="main"><span>,</span></span><span> </span><span>snd</span><span> </span><span class="entity"><span>kl'_copy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>list_exists_free</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>b</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>kl</span></span><span class="main"><span>]</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Cons</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>b_set</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>kl_rec</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Term.absfree</span><span> </span><span class="entity"><span>a'</span></span><span> </span><span class="main"><span>(</span></span><span>Library.foldl1</span><span> </span><span class="entity"><span>mk_union</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_set</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>zs_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Suc</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.absdummy</span><span> </span><span class="entity"><span>HOLogic.natT</span></span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span class="entity"><span>Lev_rec'</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_tuple</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_Suc</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>setssAs</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>zs'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_rec_nat</span></span><span> </span><span class="entity"><span>Zero</span></span><span> </span><span class="entity"><span>Suc</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span>o</span><span> </span><span>Term.dest_Free</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>rhs</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>Lev_free</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Lev_def_free</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy_old</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span>Local_Theory.begin_nested</span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>Local_Theory.define</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>Lev_bind</span></span><span class="main"><span>,</span></span><span> </span><span>NoSyn</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Lev_def_bind</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Lev_spec</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;</span><span> </span><span>`</span><span>Local_Theory.end_nested</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.export_morphism</span><span> </span><span class="entity"><span>lthy_old</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Lev_def</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_unabs_def</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_obj_eq</span></span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>Lev_def_free</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Lev</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>Term.dest_Const</span><span> </span><span class="main"><span>(</span></span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>Lev_free</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_Lev</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>nat</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>LevT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Library.foldr</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.natT</span></span><span> </span><span>--&gt;</span><span>
          </span><span class="entity"><span>HOLogic.mk_tupleT</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>domain_type</span><span> </span><span class="entity"><span>U</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>sum_sbd_list_setT</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_nthN</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Lev</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>LevT</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>nat</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Lev_0s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rec_simps</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Greatest_Fixpoint.html#BNF_Greatest_Fixpoint.rec_nat_0_imp|fact"><span>rec_nat_0_imp</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Lev_def</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Lev_Sucs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rec_simps</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Greatest_Fixpoint.html#BNF_Greatest_Fixpoint.rec_nat_Suc_imp|fact"><span>rec_nat_Suc_imp</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Lev_def</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rv_bind</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_internal_b</span></span><span> </span><span class="entity"><span>rvN</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rv_def_bind</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>rpair</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.def_binding</span><span> </span><span class="entity"><span>rv_bind</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rv_spec</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_Cons</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="entity"><span>b'</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_case</span></span><span> </span><span class="entity"><span>i'</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>Term.absfree</span><span> </span><span class="entity"><span>k'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_nthN</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>rv_rec</span></span><span> </span><span class="entity"><span>i'</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_from_sbd</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>i'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>k</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Term.absfree</span><span> </span><span class="entity"><span>b'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_case_sumN</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>mk_case</span></span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>sumx</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Cons</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.absfree</span><span> </span><span class="entity"><span>sumx'</span></span><span> </span><span class="main"><span>(</span></span><span>Term.absdummy</span><span> </span><span class="entity"><span>sum_sbd_listT</span></span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span class="entity"><span>rv_rec'</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_tuple</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_Cons</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>zs'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_rec_list</span></span><span> </span><span class="entity"><span>Nil</span></span><span> </span><span class="entity"><span>Cons</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span>o</span><span> </span><span>Term.dest_Free</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>rhs</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>rv_free</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rv_def_free</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy_old</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span>Local_Theory.begin_nested</span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>Local_Theory.define</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>rv_bind</span></span><span class="main"><span>,</span></span><span> </span><span>NoSyn</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rv_def_bind</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rv_spec</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;</span><span> </span><span>`</span><span>Local_Theory.end_nested</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.export_morphism</span><span> </span><span class="entity"><span>lthy_old</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rv_def</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_unabs_def</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_obj_eq</span></span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>rv_def_free</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rv</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>Term.dest_Const</span><span> </span><span class="main"><span>(</span></span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>rv_free</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rv</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>kl</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>domain_type</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rvT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Library.foldr</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ts</span></span><span class="main"><span>,</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>kl</span></span><span> </span><span>--&gt;</span><span>
          </span><span class="entity"><span>HOLogic.mk_tupleT</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>mk_sumTN</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_nthN</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rv</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rvT</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>kl</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rv_Nils</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rec_simps</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Greatest_Fixpoint.html#BNF_Greatest_Fixpoint.rec_list_Nil_imp|fact"><span>rec_list_Nil_imp</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>rv_def</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rv_Conss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rec_simps</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Greatest_Fixpoint.html#BNF_Greatest_Fixpoint.rec_list_Cons_imp|fact"><span>rec_list_Cons_imp</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>rv_def</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>beh_binds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_internal_bs</span></span><span> </span><span class="entity"><span>behN</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>beh_bind</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>beh_binds</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>beh_def_bind</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>rpair</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span>o</span><span> </span><span>Thm.def_binding</span><span> </span><span>o</span><span> </span><span class="entity"><span>beh_bind</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>beh_spec</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_case</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>to_sbd_map</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="entity"><span>k'</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>Term.absfree</span><span> </span><span class="entity"><span>k'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_InN</span></span><span> </span><span class="entity"><span>bdFTs</span></span><span>
            </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>to_sbd_map</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>passive_ids</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_to_sbd</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>k</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Lab</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.absfree</span><span> </span><span class="entity"><span>kl'</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>mk_case_sumN</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_case</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>to_sbd_maps</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>zs'</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rv</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>kl</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_prod</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_UNION</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_UNIV</span></span><span> </span><span class="entity"><span>HOLogic.natT</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span class="entity"><span>nat'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Lev</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>nat</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Lab</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span>o</span><span> </span><span>Term.dest_Free</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ss</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>z</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rhs</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>beh_frees</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>beh_def_frees</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy_old</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span>Local_Theory.begin_nested</span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 2</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span>Local_Theory.define</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>beh_bind</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span>NoSyn</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>beh_def_bind</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>beh_spec</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>zs</span></span><span>
      </span><span>|&gt;&gt;</span><span> </span><span>apsnd</span><span> </span><span>split_list</span><span> </span><span>o</span><span> </span><span>split_list</span><span>
      </span><span>||&gt;</span><span> </span><span>`</span><span>Local_Theory.end_nested</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.export_morphism</span><span> </span><span class="entity"><span>lthy_old</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>beh_defs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="entity"><span>mk_unabs_def</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_obj_eq</span></span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>def</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>beh_def_frees</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>behs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>Term.dest_Const</span><span> </span><span>o</span><span> </span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>beh_frees</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_beh</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>behT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Library.foldr</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ts</span></span><span class="main"><span>,</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>activeAs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>treeT</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>behs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>behT</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>zs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>zs_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>zs_copy2</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nat</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nat'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>kl</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>kl'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"b"</span></span><span> </span><span class="entity"><span>activeAs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"b"</span></span><span> </span><span class="entity"><span>activeAs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"b"</span></span><span> </span><span class="entity"><span>activeAs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"s"</span></span><span> </span><span class="entity"><span>sTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>~~</span><span class="main"><span>)</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"n"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>HOLogic.natT</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>~~</span><span class="main"><span>)</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"kl"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sum_sbd_listT</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>length_Lev_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>length_Lev'_thms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_conjunct</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>kl</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_Lev</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>nat</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_size</span></span><span> </span><span class="entity"><span>kl</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nat</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>list_all_free</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>kl</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>zs</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="entity"><span>mk_conjunct</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>zs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>o</span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span>Term.absfree</span><span> </span><span class="entity"><span>nat'</span></span><span> </span><span class="entity"><span>goal</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nat</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>length_Lev</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="entity"><span>goal</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_length_Lev_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>cts</span></span><span> </span><span class="entity"><span>Lev_0s</span></span><span> </span><span class="entity"><span>Lev_Sucs</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>length_Lev'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_specN</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>length_Lev</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>length_Levs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>length_Lev'</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>mk_conjunctN</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>mp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_implies</span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>kl</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_Lev</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>nat</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>mk_Trueprop_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>kl</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_Lev</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_size</span></span><span> </span><span class="entity"><span>kl</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>zs</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>length_Levs'</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>length_Lev</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
            </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="entity"><span>mk_length_Lev'_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>length_Lev</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>goals</span></span><span> </span><span class="entity"><span>length_Levs</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>length_Levs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>length_Levs'</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rv_last_thmss</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_conjunct</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>i'</span></span><span> </span><span class="entity"><span>z_copy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>list_exists_free</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>z_copy</span></span><span class="main"><span>]</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rv</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_append</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>kl</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_list</span></span><span> </span><span class="entity"><span>sum_sbdT</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mk_InN</span></span><span> </span><span class="entity"><span>sbdTs</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="entity"><span>i'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>mk_InN</span></span><span> </span><span class="entity"><span>activeAs</span></span><span> </span><span class="entity"><span>z_copy</span></span><span> </span><span class="entity"><span>i'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>list_all_free</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>zs</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span>
              </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_conjunct</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>zs_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>zs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.ctyp_of</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>sum_sbdT</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>o</span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span>Term.absfree</span><span> </span><span class="entity"><span>kl'</span></span><span> </span><span class="entity"><span>goal</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>kl</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rv_last</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="entity"><span>goal</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_rv_last_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>cTs</span></span><span> </span><span class="entity"><span>cts</span></span><span> </span><span class="entity"><span>rv_Nils</span></span><span> </span><span class="entity"><span>rv_Conss</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rv_last'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_specN</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rv_last</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>rv_last'</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>mk_conjunctN</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>mk_conjunctN</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>i'</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_Lev_thmsss</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_conjunct</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_conjunct'</span></span><span> </span><span class="entity"><span>i'</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>z'</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_conjunct''</span></span><span> </span><span class="entity"><span>i''</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="entity"><span>z''</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_imp</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z''</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_append</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>kl</span></span><span class="main"><span>,</span></span><span>
                      </span><span class="entity"><span>HOLogic.mk_list</span></span><span> </span><span class="entity"><span>sum_sbdT</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mk_InN</span></span><span> </span><span class="entity"><span>sbdTs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_to_sbd</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>z'</span></span><span> </span><span class="entity"><span>i'</span></span><span> </span><span class="entity"><span>i''</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z''</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i''</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                      </span><span class="entity"><span>mk_Lev</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Suc</span></span><span> </span><span class="entity"><span>nat</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rv</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>kl</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_InN</span></span><span> </span><span class="entity"><span>activeAs</span></span><span> </span><span class="entity"><span>z'</span></span><span> </span><span class="entity"><span>i'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="main"><span>(</span></span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span>
                    </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_conjunct''</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="main"><span>(</span></span><span>drop</span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>zs_copy2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>kl</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_Lev</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>nat</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_conjunct'</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>setssAs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>zs_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>list_all_free</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>kl</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>zs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>zs_copy</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>zs_copy2</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="entity"><span>mk_conjunct</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>zs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>o</span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span>Term.absfree</span><span> </span><span class="entity"><span>nat'</span></span><span> </span><span class="entity"><span>goal</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nat</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_Lev</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="entity"><span>goal</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="entity"><span>mk_set_Lev_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>cts</span></span><span> </span><span class="entity"><span>Lev_0s</span></span><span> </span><span class="entity"><span>Lev_Sucs</span></span><span> </span><span class="entity"><span>rv_Nils</span></span><span> </span><span class="entity"><span>rv_Conss</span></span><span> </span><span class="entity"><span>from_to_sbd_thmss</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_Lev'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_specN</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>3</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_Lev</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i''</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>set_Lev'</span></span><span> </span><span>RS</span><span>
          </span><span class="entity"><span>mk_conjunctN</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>mp</span></span><span> </span><span>RS</span><span>
          </span><span class="entity"><span>mk_conjunctN</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>i'</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>mp</span></span><span> </span><span>RS</span><span>
          </span><span class="entity"><span>mk_conjunctN</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>i''</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>mp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_image_Lev_thmsss</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_conjunct</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_conjunct'</span></span><span> </span><span class="entity"><span>i'</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_conjunct''</span></span><span> </span><span class="entity"><span>i''</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>z''</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_imp</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rv</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>kl</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_InN</span></span><span> </span><span class="entity"><span>activeAs</span></span><span> </span><span class="entity"><span>z''</span></span><span> </span><span class="entity"><span>i''</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_image</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_to_sbd</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>z''</span></span><span> </span><span class="entity"><span>i''</span></span><span> </span><span class="entity"><span>i'</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z''</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="entity"><span>mk_append</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>kl</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_list</span></span><span> </span><span class="entity"><span>sum_sbdT</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mk_InN</span></span><span> </span><span class="entity"><span>sbdTs</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="entity"><span>i'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>mk_Lev</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Suc</span></span><span> </span><span class="entity"><span>nat</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="main"><span>(</span></span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_conjunct''</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>zs_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>kl</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_Lev</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>nat</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="entity"><span>mk_conjunct'</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="main"><span>(</span></span><span>drop</span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>setssAs'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>list_all_free</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>kl</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>k</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>zs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>zs_copy</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="entity"><span>mk_conjunct</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>zs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>o</span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span>Term.absfree</span><span> </span><span class="entity"><span>nat'</span></span><span> </span><span class="entity"><span>goal</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nat</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_image_Lev</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="entity"><span>goal</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="entity"><span>mk_set_image_Lev_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>cts</span></span><span> </span><span class="entity"><span>Lev_0s</span></span><span> </span><span class="entity"><span>Lev_Sucs</span></span><span> </span><span class="entity"><span>rv_Nils</span></span><span> </span><span class="entity"><span>rv_Conss</span></span><span>
                </span><span class="entity"><span>from_to_sbd_thmss</span></span><span> </span><span class="entity"><span>to_sbd_inj_thmss</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_image_Lev'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_specN</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_image_Lev</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i''</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>set_image_Lev'</span></span><span> </span><span>RS</span><span>
          </span><span class="entity"><span>mk_conjunctN</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>mp</span></span><span> </span><span>RS</span><span>
          </span><span class="entity"><span>mk_conjunctN</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>i''</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>mp</span></span><span> </span><span>RS</span><span>
          </span><span class="entity"><span>mk_conjunctN</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>i'</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>mp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mor_beh_thm</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_mor</span></span><span> </span><span class="entity"><span>active_UNIVs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>carTAs</span></span><span> </span><span class="entity"><span>strTAs</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_beh</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_mor_beh_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>mor_def</span></span><span> </span><span class="entity"><span>mor_cong_thm</span></span><span>
            </span><span class="entity"><span>beh_defs</span></span><span> </span><span class="entity"><span>carT_defs</span></span><span> </span><span class="entity"><span>strT_defs</span></span><span> </span><span class="entity"><span>isNode_defs</span></span><span>
            </span><span class="entity"><span>to_sbd_inj_thmss</span></span><span> </span><span class="entity"><span>from_to_sbd_thmss</span></span><span> </span><span class="entity"><span>Lev_0s</span></span><span> </span><span class="entity"><span>Lev_Sucs</span></span><span> </span><span class="entity"><span>rv_Nils</span></span><span> </span><span class="entity"><span>rv_Conss</span></span><span>
            </span><span class="entity"><span>length_Lev_thms</span></span><span> </span><span class="entity"><span>length_Lev'_thms</span></span><span> </span><span class="entity"><span>rv_last_thmss</span></span><span> </span><span class="entity"><span>set_Lev_thmsss</span></span><span>
            </span><span class="entity"><span>set_image_Lev_thmsss</span></span><span> </span><span class="entity"><span>set_mapss</span></span><span> </span><span class="entity"><span>map_comp_id_thms</span></span><span> </span><span class="entity"><span>map_cong0s</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>timer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>time</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>timer</span></span><span> </span><span class="inner_quoted"><span>"Behavioral morphism"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lsbisAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_lsbis</span></span><span> </span><span class="entity"><span>carTAs</span></span><span> </span><span class="entity"><span>strTAs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_str_final</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>mk_univ</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>final_maps</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>passive_ids</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_proj</span></span><span> </span><span class="entity"><span>lsbisAs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>strTAs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>car_finals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_quotient</span></span><span> </span><span class="entity"><span>carTAs</span></span><span> </span><span class="entity"><span>lsbisAs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>str_finals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_str_final</span></span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>coalgT_set_thmss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>coalgT_thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>coalg_set_thmss</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>equiv_LSBIS_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>coalgT_thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>equiv_lsbis_thms</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>congruent_str_final_thms</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="entity"><span>final_map</span></span><span> </span><span class="entity"><span>strT</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_congruent</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_comp</span></span><span>
            </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>final_map</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>passive_ids</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_proj</span></span><span> </span><span class="entity"><span>lsbisAs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>strT</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>lsbisAs</span></span><span> </span><span class="entity"><span>final_maps</span></span><span> </span><span class="entity"><span>strTAs</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>lsbisE</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>map_comp_id</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>map_cong0</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
            </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_congruent_str_final_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>lsbisE</span></span><span> </span><span class="entity"><span>map_comp_id</span></span><span>
              </span><span class="entity"><span>map_cong0</span></span><span> </span><span class="entity"><span>equiv_LSBIS_thms</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>)</span></span><span>
        </span><span class="entity"><span>goals</span></span><span> </span><span class="entity"><span>lsbisE_thms</span></span><span> </span><span class="entity"><span>map_comp_id_thms</span></span><span> </span><span class="entity"><span>map_cong0s</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>coalg_final_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_coalg</span></span><span> </span><span class="entity"><span>car_finals</span></span><span> </span><span class="entity"><span>str_finals</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_coalg_final_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>coalg_def</span></span><span>
        </span><span class="entity"><span>congruent_str_final_thms</span></span><span> </span><span class="entity"><span>equiv_LSBIS_thms</span></span><span> </span><span class="entity"><span>set_mapss</span></span><span> </span><span class="entity"><span>coalgT_set_thmss</span></span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mor_T_final_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_mor</span></span><span> </span><span class="entity"><span>carTAs</span></span><span> </span><span class="entity"><span>strTAs</span></span><span> </span><span class="entity"><span>car_finals</span></span><span> </span><span class="entity"><span>str_finals</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>mk_proj</span></span><span> </span><span class="entity"><span>lsbisAs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_mor_T_final_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>mor_def</span></span><span> </span><span class="entity"><span>congruent_str_final_thms</span></span><span>
        </span><span class="entity"><span>equiv_LSBIS_thms</span></span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mor_final_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mor_comp_thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mor_beh_thm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mor_T_final_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>in_car_final_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mor_final_thm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>UNIV_I</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mor_image'_thms</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>timer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>time</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>timer</span></span><span> </span><span class="inner_quoted"><span>"Final coalgebra"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>T_names</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T_glob_infos</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T_loc_infos</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mx</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>car_final</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>in_car_final</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>typedef</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>b</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>params</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mx</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>car_final</span></span><span> </span><span>NONE</span><span>
            </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>exI</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>in_car_final</span></span><span class="main"><span>]</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="entity"><span>bs</span></span><span> </span><span class="entity"><span>mixfixes</span></span><span> </span><span class="entity"><span>car_finals</span></span><span> </span><span class="entity"><span>in_car_final_thms</span></span><span>
      </span><span>|&gt;&gt;</span><span> </span><span>apsnd</span><span> </span><span>split_list</span><span> </span><span>o</span><span> </span><span>split_list</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>params'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>T_names</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_Ts</span></span><span> </span><span class="entity"><span>passive</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Term.typ_subst_atomic</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>passiveAs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>passive</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Ts'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Ts</span></span><span> </span><span class="entity"><span>passiveBs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Rep_Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>info</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Rep_name</span><span> </span><span class="entity"><span>info</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>treeQT</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>T_glob_infos</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Abs_Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>info</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Abs_name</span><span> </span><span class="entity"><span>info</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>treeQT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>T_glob_infos</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Reps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>#</span></span><span>Rep</span><span> </span><span class="entity"><span>T_loc_infos</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Rep_injects</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>#</span></span><span>Rep_inject</span><span> </span><span class="entity"><span>T_loc_infos</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Abs_inverses</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>#</span></span><span>Abs_inverse</span><span> </span><span class="entity"><span>T_loc_infos</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>timer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>time</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>timer</span></span><span> </span><span class="inner_quoted"><span>"THE TYPEDEFs &amp; Rep/Abs thms"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>UNIVs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_UNIV</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>FTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_FTs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>passiveAs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>FTs_setss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_setss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>passiveAs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_FTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_map_of_bnf</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>treeQTs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>passiveAs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Dss</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unfold_fTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>activeAs</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>emptys</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_set</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Zeros</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>empty</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
     </span><span class="entity"><span>HOLogic.mk_tuple</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>absdummy</span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="entity"><span>empty</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>emptys</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>hrecTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>Zeros</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>zs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Jzs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jzs'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"b"</span></span><span> </span><span class="entity"><span>activeAs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"s"</span></span><span> </span><span class="entity"><span>sTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"z"</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dtor_bind</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>external_bs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>Binding.prefix_name</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dtorN</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"_"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dtor_def_bind</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>rpair</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span>o</span><span> </span><span>Binding.concealed</span><span> </span><span>o</span><span> </span><span>Thm.def_binding</span><span> </span><span>o</span><span> </span><span class="entity"><span>dtor_bind</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dtor_spec</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>map_FT</span></span><span> </span><span class="entity"><span>Jz</span></span><span> </span><span class="entity"><span>Jz'</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Term.absfree</span><span> </span><span class="entity"><span>Jz'</span></span><span>
        </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_FT</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Abs_Ts</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rep</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Jz</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>dtor_frees</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor_def_frees</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy_old</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span>Local_Theory.begin_nested</span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mapx</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Jz</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Jz'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span>Local_Theory.define</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>dtor_bind</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span>NoSyn</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>dtor_def_bind</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor_spec</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>mapx</span></span><span> </span><span class="entity"><span>Jz</span></span><span> </span><span class="entity"><span>Jz'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>Rep_Ts</span></span><span> </span><span class="entity"><span>str_finals</span></span><span> </span><span class="entity"><span>map_FTs</span></span><span> </span><span class="entity"><span>Jzs</span></span><span> </span><span class="entity"><span>Jzs'</span></span><span>
      </span><span>|&gt;&gt;</span><span> </span><span>apsnd</span><span> </span><span>split_list</span><span> </span><span>o</span><span> </span><span>split_list</span><span>
      </span><span>||&gt;</span><span> </span><span>`</span><span>Local_Theory.end_nested</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.export_morphism</span><span> </span><span class="entity"><span>lthy_old</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_dtors</span></span><span> </span><span class="entity"><span>passive</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Term.subst_atomic_types</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.typ</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>params'</span></span><span> </span><span>~~</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_params</span></span><span> </span><span class="entity"><span>passive</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span>
        </span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dtor_frees</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dtors</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_dtors</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dtor's</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_dtors</span></span><span> </span><span class="entity"><span>passiveBs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dtor_defs</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_obj_eq</span></span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>def</span></span><span class="main"><span>)</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>fun_cong</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dtor_def_frees</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>coalg_final_set_thmss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>coalg_final_thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>coalg_set_thmss</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mor_Rep_thm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mor_Abs_thm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mor_Rep</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_mor</span></span><span> </span><span class="entity"><span>UNIVs</span></span><span> </span><span class="entity"><span>dtors</span></span><span> </span><span class="entity"><span>car_finals</span></span><span> </span><span class="entity"><span>str_finals</span></span><span> </span><span class="entity"><span>Rep_Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_mor_Rep_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mor_def</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>dtor_defs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Reps</span></span><span>
              </span><span class="entity"><span>Abs_inverses</span></span><span> </span><span class="entity"><span>coalg_final_set_thmss</span></span><span> </span><span class="entity"><span>map_comp_id_thms</span></span><span> </span><span class="entity"><span>map_cong0L_thms</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mor_Abs</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_mor</span></span><span> </span><span class="entity"><span>car_finals</span></span><span> </span><span class="entity"><span>str_finals</span></span><span> </span><span class="entity"><span>UNIVs</span></span><span> </span><span class="entity"><span>dtors</span></span><span> </span><span class="entity"><span>Abs_Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_mor_Abs_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mor_def</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>dtor_defs</span></span><span class="main"><span>)</span></span><span>
              </span><span class="entity"><span>Abs_inverses</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>mor_Rep</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mor_Abs</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>timer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>time</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>timer</span></span><span> </span><span class="inner_quoted"><span>"dtor definitions &amp; thms"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>unfold_bind</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>external_bs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>Binding.prefix_name</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dtor_unfoldN</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"_"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unfold_def_bind</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>rpair</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span>o</span><span> </span><span>Binding.concealed</span><span> </span><span>o</span><span> </span><span>Thm.def_binding</span><span> </span><span>o</span><span> </span><span class="entity"><span>unfold_bind</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>unfold_spec</span></span><span> </span><span class="entity"><span>abs</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span>o</span><span> </span><span>Term.dest_Free</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ss</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>z</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>abs</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>unfold_frees</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>unfold_def_frees</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy_old</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span>Local_Theory.begin_nested</span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>abs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span>Local_Theory.define</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>unfold_bind</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span>NoSyn</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_def_bind</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>unfold_spec</span></span><span> </span><span class="entity"><span>abs</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>Abs_Ts</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>mk_proj</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>lsbisAs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_beh</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>zs</span></span><span>
      </span><span>|&gt;&gt;</span><span> </span><span>apsnd</span><span> </span><span>split_list</span><span> </span><span>o</span><span> </span><span>split_list</span><span>
      </span><span>||&gt;</span><span> </span><span>`</span><span>Local_Theory.end_nested</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.export_morphism</span><span> </span><span class="entity"><span>lthy_old</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unfolds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>unfold_frees</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unfold_names</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>dest_Const</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>unfolds</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_unfolds</span></span><span> </span><span class="entity"><span>passives</span></span><span> </span><span class="entity"><span>actives</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>active</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span>Library.foldr</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>actives</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_FTs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>passives</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>actives</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>active</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="entity"><span>unfold_names</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Ts</span></span><span> </span><span class="entity"><span>passives</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>actives</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_unfold</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>unfold_names</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Library.foldr</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>,</span></span><span> </span><span>domain_type</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>--&gt;</span><span> </span><span>nth</span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unfold_defs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="entity"><span>mk_unabs_def</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_obj_eq</span></span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>def</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>unfold_def_frees</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>ss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>TRs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>unfold_fs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"s"</span></span><span> </span><span class="entity"><span>sTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"r"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_relT</span></span><span> </span><span>o</span><span> </span><span>`</span><span>I</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"f"</span></span><span> </span><span class="entity"><span>unfold_fTs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mor_unfold_thm</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Abs_inverses'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>RS</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>in_car_final_thms</span></span><span> </span><span class="entity"><span>Abs_inverses</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>morEs'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mor_final_thm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>UNIV_I</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>morE_thms</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_mor</span></span><span> </span><span class="entity"><span>active_UNIVs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>UNIVs</span></span><span> </span><span class="entity"><span>dtors</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_unfold</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_mor_unfold_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>mor_UNIV_thm</span></span><span> </span><span class="entity"><span>dtor_defs</span></span><span>
            </span><span class="entity"><span>unfold_defs</span></span><span> </span><span class="entity"><span>Abs_inverses'</span></span><span> </span><span class="entity"><span>morEs'</span></span><span> </span><span class="entity"><span>map_comp_id_thms</span></span><span> </span><span class="entity"><span>map_cong0s</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dtor_unfold_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mor_unfold_thm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>UNIV_I</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>morE_thms</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>raw_coind_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>raw_coind_thm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prem</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_sbis</span></span><span> </span><span class="entity"><span>UNIVs</span></span><span> </span><span class="entity"><span>dtors</span></span><span> </span><span class="entity"><span>TRs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span>
          </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_leq</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Id_const</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>TRs</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>prem</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>`</span><span class="entity"><span>split_conj_thm</span></span><span> </span><span class="main"><span>(</span></span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prem</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_raw_coind_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>bis_def</span></span><span> </span><span class="entity"><span>bis_cong_thm</span></span><span> </span><span class="entity"><span>bis_O_thm</span></span><span>
            </span><span class="entity"><span>bis_converse_thm</span></span><span> </span><span class="entity"><span>bis_Gr_thm</span></span><span> </span><span class="entity"><span>tcoalg_thm</span></span><span> </span><span class="entity"><span>coalgT_thm</span></span><span> </span><span class="entity"><span>mor_T_final_thm</span></span><span> </span><span class="entity"><span>sbis_lsbis_thm</span></span><span>
            </span><span class="entity"><span>lsbis_incl_thms</span></span><span> </span><span class="entity"><span>incl_lsbis_thms</span></span><span> </span><span class="entity"><span>equiv_LSBIS_thms</span></span><span> </span><span class="entity"><span>mor_Rep_thm</span></span><span> </span><span class="entity"><span>Rep_injects</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_unique_mor_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>unfold_unique_mor_thm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prem</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_mor</span></span><span> </span><span class="entity"><span>active_UNIVs</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>UNIVs</span></span><span> </span><span class="entity"><span>dtors</span></span><span> </span><span class="entity"><span>unfold_fs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_fun_eq</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_unfold</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unique</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span>
          </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="entity"><span>mk_fun_eq</span></span><span> </span><span class="entity"><span>unfold_fs</span></span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>prem</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>unique</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bis_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tcoalg_thm</span></span><span> </span><span>RSN</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tcoalg_thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>bis_image2_thm</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mor_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mor_comp_thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mor_final_thm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mor_Abs_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unique_mor</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prem</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>unique</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_unfold_unique_mor_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>raw_coind_thms</span></span><span>
            </span><span class="entity"><span>bis_thm</span></span><span> </span><span class="entity"><span>mor_thm</span></span><span> </span><span class="entity"><span>unfold_defs</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>`</span><span class="entity"><span>split_conj_thm</span></span><span> </span><span class="entity"><span>unique_mor</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dtor_unfold_unique_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor_unfold_unique_thm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>`</span><span class="entity"><span>split_conj_thm</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>split_conj_prems</span></span><span> </span><span class="entity"><span>n</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>mor_UNIV_thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>iffD2</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>unfold_unique_mor_thm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unfold_dtor_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mor_id_thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>unfold_unique_mor_thms</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unfold_o_dtor_thms</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mor</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mor_comp_thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mor_str_thm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mor_unfold_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>unique</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>unfold_ctor</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>trans</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mor</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>unique</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>unfold_ctor</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>unfold_unique_mor_thms</span></span><span> </span><span class="entity"><span>unfold_dtor_thms</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>timer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>time</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>timer</span></span><span> </span><span class="inner_quoted"><span>"unfold definitions &amp; thms"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_dtors</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_map_of_bnf</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>passiveAs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>passiveAs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>FTs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>,</span></span><span>
        </span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>dtors</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Dss</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>ctor_bind</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>external_bs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>Binding.prefix_name</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctorN</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"_"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctor_def_bind</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>rpair</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span>o</span><span> </span><span>Binding.concealed</span><span> </span><span>o</span><span> </span><span>Thm.def_binding</span><span> </span><span>o</span><span> </span><span class="entity"><span>ctor_bind</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>ctor_spec</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_unfold</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>map_dtors</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>ctor_frees</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctor_def_frees</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy_old</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span>Local_Theory.begin_nested</span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span>Local_Theory.define</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>ctor_bind</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span>NoSyn</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctor_def_bind</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctor_spec</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span>
      </span><span>|&gt;&gt;</span><span> </span><span>apsnd</span><span> </span><span>split_list</span><span> </span><span>o</span><span> </span><span>split_list</span><span>
      </span><span>||&gt;</span><span> </span><span>`</span><span>Local_Theory.end_nested</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.export_morphism</span><span> </span><span class="entity"><span>lthy_old</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_ctors</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Term.subst_atomic_types</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.typ</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>params'</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span>
        </span><span class="entity"><span>ctor_frees</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctors</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_ctors</span></span><span> </span><span class="entity"><span>params'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctor_defs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_obj_eq</span></span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>def</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctor_def_frees</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctor_o_dtor_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>Local_Defs.fold</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span>o</span><span> </span><span>single</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctor_defs</span></span><span> </span><span class="entity"><span>unfold_o_dtor_thms</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dtor_o_ctor_thms</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>dtor</span></span><span> </span><span class="entity"><span>ctor</span></span><span> </span><span class="entity"><span>FT</span></span><span> </span><span class="main"><span>=</span></span><span>
         </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dtor</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctor</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>FT</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>dtors</span></span><span> </span><span class="entity"><span>ctors</span></span><span> </span><span class="entity"><span>FTs</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctor_def</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>unfold</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>map_comp_id</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>map_cong0L</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
            </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_dtor_o_ctor_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ctor_def</span></span><span> </span><span class="entity"><span>unfold</span></span><span> </span><span class="entity"><span>map_comp_id</span></span><span>
              </span><span class="entity"><span>map_cong0L</span></span><span> </span><span class="entity"><span>unfold_o_dtor_thms</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>goals</span></span><span> </span><span class="entity"><span>ctor_defs</span></span><span> </span><span class="entity"><span>dtor_unfold_thms</span></span><span> </span><span class="entity"><span>map_comp_id_thms</span></span><span> </span><span class="entity"><span>map_cong0L_thms</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dtor_ctor_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Fixpoint_Base.html#BNF_Fixpoint_Base.pointfree_idE|fact"><span>pointfree_idE</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dtor_o_ctor_thms</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctor_dtor_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Fixpoint_Base.html#BNF_Fixpoint_Base.pointfree_idE|fact"><span>pointfree_idE</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctor_o_dtor_thms</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bij_dtor_thms</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm1</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm2</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Fixpoint_Base.html#BNF_Fixpoint_Base.o_bij|fact"><span>o_bij</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thm2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctor_o_dtor_thms</span></span><span> </span><span class="entity"><span>dtor_o_ctor_thms</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inj_dtor_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Fun.html#Fun.bij_is_inj|fact"><span>bij_is_inj</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bij_dtor_thms</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>surj_dtor_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Fun.html#Fun.bij_is_surj|fact"><span>bij_is_surj</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bij_dtor_thms</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dtor_nchotomy_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Fun.html#Fun.surjD|fact"><span>surjD</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>surj_dtor_thms</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dtor_inject_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Fun.html#Fun.inj_eq|fact"><span>inj_eq</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>inj_dtor_thms</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dtor_exhaust_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>exE</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dtor_nchotomy_thms</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bij_ctor_thms</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm1</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm2</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Fixpoint_Base.html#BNF_Fixpoint_Base.o_bij|fact"><span>o_bij</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thm2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dtor_o_ctor_thms</span></span><span> </span><span class="entity"><span>ctor_o_dtor_thms</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inj_ctor_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Fun.html#Fun.bij_is_inj|fact"><span>bij_is_inj</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bij_ctor_thms</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>surj_ctor_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Fun.html#Fun.bij_is_surj|fact"><span>bij_is_surj</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bij_ctor_thms</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctor_nchotomy_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Fun.html#Fun.surjD|fact"><span>surjD</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>surj_ctor_thms</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctor_inject_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Fun.html#Fun.inj_eq|fact"><span>inj_eq</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>inj_ctor_thms</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctor_exhaust_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>exE</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctor_nchotomy_thms</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>timer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>time</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>timer</span></span><span> </span><span class="inner_quoted"><span>"ctor definitions &amp; thms"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>Jzs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jzs_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jzs1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jzs2</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phis</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"z"</span></span><span> </span><span class="entity"><span>Ts</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"z'"</span></span><span> </span><span class="entity"><span>Ts</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"z1"</span></span><span> </span><span class="entity"><span>Ts</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"z2"</span></span><span> </span><span class="entity"><span>Ts</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"P"</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="entity"><span>mk_pred2T</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>coinduct_params</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor_coinduct_thm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rels</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Term.subst_atomic_types</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>activeAs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>activeBs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>relsAsBs</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_concl</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>z1</span></span><span> </span><span class="entity"><span>z2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>phi</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z1</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>z2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span>
          </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_concl</span></span><span> </span><span class="entity"><span>phis</span></span><span> </span><span class="entity"><span>Jzs1</span></span><span> </span><span class="entity"><span>Jzs2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rel_prem</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>dtor</span></span><span> </span><span class="entity"><span>rel</span></span><span> </span><span class="entity"><span>Jz</span></span><span> </span><span class="entity"><span>Jz_copy</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>passive_eqs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>phis</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>dtor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Jz</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dtor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Jz_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>list_all_free</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Jz</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jz_copy</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>phi</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Jz</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Jz_copy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_rel_prem</span></span><span> </span><span class="entity"><span>phis</span></span><span> </span><span class="entity"><span>dtors</span></span><span> </span><span class="entity"><span>rels</span></span><span> </span><span class="entity"><span>Jzs</span></span><span> </span><span class="entity"><span>Jzs_copy</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dtor_coinduct_goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dtor_coinduct</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>dtor_coinduct_goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>dtor_coinduct_goal</span></span><span>
            </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_dtor_coinduct_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>raw_coind_thm</span></span><span> </span><span class="entity"><span>bis_rel_thm</span></span><span>
              </span><span class="entity"><span>rel_congs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span>rev</span><span> </span><span class="main"><span>(</span></span><span>Term.add_tfrees</span><span> </span><span class="entity"><span>dtor_coinduct_goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor_coinduct</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>timer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>time</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>timer</span></span><span> </span><span class="inner_quoted"><span>"coinduction"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_dtor_map_DEADID_thm</span></span><span> </span><span class="entity"><span>dtor_inject</span></span><span> </span><span class="entity"><span>map_id0</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>trans</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>dtor_inject</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>id_apply</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_id0</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_dtor_map_unique_DEADID_thm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>funs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>algs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>HOLogic.conjuncts</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.dest_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.concl_of</span><span> </span><span class="entity"><span>dtor_unfold_unique_thm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>map_split</span><span> </span><span class="entity"><span>HOLogic.dest_eq</span></span><span>
          </span><span>||&gt;</span><span>  </span><span>snd</span><span> </span><span>o</span><span> </span><span>strip_comb</span><span> </span><span>o</span><span> </span><span>hd</span><span>
          </span><span>|&gt;</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>apply</span></span><span> 2</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>dest_Var</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_fun_insts</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>ix</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span>Var</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ix</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>theta</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>funs</span></span><span> </span><span>~~</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 2</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_fun_insts</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>funs</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>algs</span></span><span> </span><span>~~</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dtors</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dtor_unfold_dtors</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dtor_unfold_unique_thm</span></span><span> </span><span>OF</span><span>
          </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_trans</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.arg_cong2|fact"><span>arg_cong2</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../../../../Fun.html#Fun.comp|const"><span>(∘)</span></a></span><span>"</span></span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>OF</span></span><span> _ </span><a class="entity_ref" href="../../../../../HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
            </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.trans|fact"><span>trans</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../Fun.html#Fun.o_id|fact"><span>o_id</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>map_id0s</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>split_conj_thm</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_sym</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>infer_instantiate</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>theta</span></span><span> </span><span class="entity"><span>dtor_unfold_unique_thm</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Morphism.thm</span><span> </span><span class="main"><span>(</span></span><span>Local_Theory.target_morphism</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span class="entity"><span>unfold_thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>dtor_unfold_dtors</span></span><span>
        </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span><span class="comment1"><span>(*
thm trans[OF x.dtor_unfold_unique x.dtor_unfold_unique[symmetric,
  OF trans[OF arg_cong2[of _ _ _ _ "(o)", OF pre_x.map_id0 refl] trans[OF id_o o_id[symmetric]]]],
  OF sym]
*)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_dtor_Jrel_DEADID_thm</span></span><span> </span><span class="entity"><span>dtor_inject</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>trans</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>rel_eq_of_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.predicate2_eqD|fact"><span>predicate2_eqD</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor_inject</span></span><span class="main"><span>]</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>JphiTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_pred2T</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span> </span><span class="entity"><span>passiveBs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Jpsi1Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_pred2T</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span> </span><span class="entity"><span>passiveCs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Jpsi2Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_pred2T</span></span><span> </span><span class="entity"><span>passiveCs</span></span><span> </span><span class="entity"><span>passiveBs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prodTsTs'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>HOLogic.mk_prodT</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>Ts'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fstsTsTs'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>fst_const</span></span><span> </span><span class="entity"><span>prodTsTs'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sndsTsTs'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>snd_const</span></span><span> </span><span class="entity"><span>prodTsTs'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>activephiTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_pred2T</span></span><span> </span><span class="entity"><span>activeAs</span></span><span> </span><span class="entity"><span>activeBs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>activeJphiTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_pred2T</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>Ts'</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rels</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_rel_of_bnf</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>passiveAs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>passiveBs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Ts'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Dss</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>Jzs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jz's</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jphis</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>activeJphis</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"z"</span></span><span> </span><span class="entity"><span>Ts</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"y"</span></span><span> </span><span class="entity"><span>Ts'</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"R"</span></span><span> </span><span class="entity"><span>JphiTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"JR"</span></span><span> </span><span class="entity"><span>activeJphiTs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_Jrel_DEADID_coinduct_thm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>mk_xtor_rel_co_induct_thm</span></span><span> </span><span class="entity"><span>Greatest_FP</span></span><span> </span><span class="entity"><span>rels</span></span><span> </span><span class="entity"><span>activeJphis</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.eq_const</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Jphis</span></span><span>
        </span><span class="entity"><span>Jzs</span></span><span> </span><span class="entity"><span>Jz's</span></span><span> </span><span class="entity"><span>dtors</span></span><span> </span><span class="entity"><span>dtor's</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.le_fun_def|fact"><span>le_fun_def</span></a><span> </span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.le_bool_def|fact"><span>le_bool_def</span></a><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.all_simps|fact"><span>all_simps</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>,</span></span><span>2</span><span class="main"><span>)</span></span><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>THEN</span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>allI</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dtor_coinduct_thm</span></span><span> </span><span>OF</span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(*register new codatatypes as BNFs*)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>timer</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jbnfs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dtor_Jmap_o_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor_Jmap_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor_Jmap_unique_thm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor_Jset_thmss'</span></span><span class="main"><span>,</span></span><span>
      </span><span class="entity"><span>dtor_Jrel_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jrel_coinduct_thm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jbnf_notes</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor_Jset_induct_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>timer</span></span><span class="main"><span>,</span></span><span> </span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>DEADID_bnf</span></span><span class="main"><span>,</span></span><span>
        </span><span>map_split</span><span> </span><span class="main"><span>(</span></span><span>`</span><span class="main"><span>(</span></span><span class="entity"><span>mk_pointfree2</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="entity"><span>mk_dtor_map_DEADID_thm</span></span><span> </span><span class="entity"><span>dtor_inject_thms</span></span><span> </span><span class="entity"><span>map_ids</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>mk_dtor_map_unique_DEADID_thm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
        </span><span>map2</span><span> </span><span class="entity"><span>mk_dtor_Jrel_DEADID_thm</span></span><span> </span><span class="entity"><span>dtor_inject_thms</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>mk_Jrel_DEADID_coinduct_thm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span> </span><span class="entity"><span>passiveBs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>gTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>passiveBs</span></span><span> </span><span class="entity"><span>passiveCs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>uTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>Ts'</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>nat</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nat'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Jzs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jzs'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>hrecs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>hrecs'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>lthy</span></span><span>
          </span><span>|&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>~~</span><span class="main"><span>)</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"n"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>HOLogic.natT</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"z"</span></span><span> </span><span class="entity"><span>Ts</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"rec"</span></span><span> </span><span class="entity"><span>hrecTs</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"f"</span></span><span> </span><span class="entity"><span>fTs</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_FTFT's</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>mk_map_of_bnf</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>passiveAs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>passiveBs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Ts'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Dss</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_maps</span></span><span> </span><span class="entity"><span>ATs</span></span><span> </span><span class="entity"><span>BTs</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>mk_T</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_map_of_bnf</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BTs</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_T</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Dss</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_Fmap</span></span><span> </span><span class="entity"><span>mk_const</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>Fmap</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Fmap</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_const</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_map</span></span><span> </span><span class="entity"><span>mk_const</span></span><span> </span><span class="entity"><span>mk_T</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>Ts'</span></span><span> </span><span class="entity"><span>dtors</span></span><span> </span><span class="entity"><span>mk_maps</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>mk_unfold</span></span><span> </span><span class="entity"><span>Ts'</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>dtor</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Fmap</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Fmap</span></span><span> </span><span class="entity"><span>mk_const</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>Fmap</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dtors</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_maps</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>mk_T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_map_id</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_map</span></span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span>I</span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_mapsAB</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_maps</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span> </span><span class="entity"><span>passiveBs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fs_maps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_map_id</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>Ts'</span></span><span> </span><span class="entity"><span>dtors</span></span><span> </span><span class="entity"><span>mk_mapsAB</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_bss</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span>o</span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>B</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>resDs</span></span><span> </span><span class="main"><span>(</span></span><span>TFree</span><span> </span><span class="entity"><span>B</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>b</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>resBs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_bss0</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>col_bind</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_internal_b</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>colN</span></span><span> </span><span>^</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>col_def_bind</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>rpair</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span>o</span><span> </span><span>Thm.def_binding</span><span> </span><span>o</span><span> </span><span class="entity"><span>col_bind</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>col_spec</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="entity"><span>Zero</span></span><span> </span><span class="entity"><span>hrec</span></span><span> </span><span class="entity"><span>hrec'</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_Suc</span></span><span> </span><span class="entity"><span>dtor</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>z'</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>chop</span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_UN</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_UNION</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dtor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_nthN</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>hrec</span></span><span> </span><span class="entity"><span>k</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span>Term.absfree</span><span> </span><span class="entity"><span>z'</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="entity"><span>mk_union</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dtor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Library.foldl1</span><span> </span><span class="entity"><span>mk_union</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="entity"><span>mk_UN</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Suc</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.absdummy</span><span> </span><span class="entity"><span>HOLogic.natT</span></span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span class="entity"><span>hrec'</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_tuple</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_Suc</span></span><span> </span><span class="entity"><span>dtors</span></span><span> </span><span class="entity"><span>FTs_setss</span></span><span> </span><span class="entity"><span>Jzs</span></span><span> </span><span class="entity"><span>Jzs'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>mk_rec_nat</span></span><span> </span><span class="entity"><span>Zero</span></span><span> </span><span class="entity"><span>Suc</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>col_frees</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>col_def_frees</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy_old</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>lthy</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span>Local_Theory.begin_nested</span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Zero</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>hrec</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>hrec'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Local_Theory.define</span><span>
            </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>col_bind</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span>NoSyn</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>col_def_bind</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>col_spec</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="entity"><span>Zero</span></span><span> </span><span class="entity"><span>hrec</span></span><span> </span><span class="entity"><span>hrec'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="entity"><span>ls</span></span><span> </span><span class="entity"><span>Zeros</span></span><span> </span><span class="entity"><span>hrecs</span></span><span> </span><span class="entity"><span>hrecs'</span></span><span>
          </span><span>|&gt;&gt;</span><span> </span><span>apsnd</span><span> </span><span>split_list</span><span> </span><span>o</span><span> </span><span>split_list</span><span>
          </span><span>||&gt;</span><span> </span><span>`</span><span>Local_Theory.end_nested</span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.export_morphism</span><span> </span><span class="entity"><span>lthy_old</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>col_defs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_obj_eq</span></span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>def</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>col_def_frees</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cols</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>Term.dest_Const</span><span> </span><span>o</span><span> </span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>col_frees</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_col</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>nat</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>hrecT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_tupleT</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>colT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.natT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>hrecT</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>mk_nthN</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>cols</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>colT</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>nat</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>col_0ss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_rec_simps</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Greatest_Fixpoint.html#BNF_Greatest_Fixpoint.rec_nat_0_imp|fact"><span>rec_nat_0_imp</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>col_defs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>col_Sucss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_rec_simps</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Greatest_Fixpoint.html#BNF_Greatest_Fixpoint.rec_nat_Suc_imp|fact"><span>rec_nat_Suc_imp</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>col_defs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>col_0ss'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>col_0ss</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>col_Sucss'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>col_Sucss</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_set</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span>Name.uu</span><span class="main"><span>,</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_UNION</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_UNIV</span></span><span> </span><span class="entity"><span>HOLogic.natT</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span class="entity"><span>nat'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_col</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>nat</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>setss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_set</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ls</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Jbnf_consts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 8</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>map_b</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rel_b</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pred_b</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>set_bs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mapx</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="entity"><span>define_bnf_consts</span></span><span> </span><span class="entity"><span>Hardly_Inline</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>user_policy</span></span><span> </span><span class="entity"><span>Note_Some</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span>false</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>deads</span></span><span class="main"><span>)</span></span><span>
              </span><span class="entity"><span>map_b</span></span><span> </span><span class="entity"><span>rel_b</span></span><span> </span><span class="entity"><span>pred_b</span></span><span> </span><span class="entity"><span>set_bs</span></span><span>
              </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>b</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>fold_rev</span><span> </span><span>Term.absfree</span><span> </span><span class="entity"><span>fs'</span></span><span> </span><span class="entity"><span>mapx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sbd</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="main"><span>[</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.undefined|const"><span>undefined</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>bs</span></span><span> </span><span class="entity"><span>map_bs</span></span><span> </span><span class="entity"><span>rel_bs</span></span><span> </span><span class="entity"><span>pred_bs</span></span><span> </span><span class="entity"><span>set_bss</span></span><span> </span><span class="entity"><span>fs_maps</span></span><span> </span><span class="entity"><span>setss</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jconsts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jconst_defs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_Jconsts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>split_list</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>Jbnf_consts</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jsetss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jbds_Ds</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>split_list</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>Jconsts</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Jmap_defs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jset_defss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jbd_defs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jrel_defs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jpred_defs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>split_list</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>Jconst_defs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Jmaps_Ds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_Jt_Ds</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_Jrels_Ds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_Jpreds_Ds</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>split_list</span></span><span> 7</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_Jconsts</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Jrel_unabs_defs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_unabs_def</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_obj_eq</span></span><span> </span><span class="entity"><span>def</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Jrel_defs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Jpred_unabs_defs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_unabs_def</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_obj_eq</span></span><span> </span><span class="entity"><span>def</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Jpred_defs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Jset_defs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>Jset_defss</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_Jmaps</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mk</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mk_Jmaps_Ds</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_Jsetss</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mk</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Jsets</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Jsets</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mk_Jt_Ds</span></span><span> </span><span class="entity"><span>Jsetss</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Jbds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mk</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mk_Jt_Ds</span></span><span> </span><span class="entity"><span>Jbds_Ds</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_Jrels</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mk</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mk_Jrels_Ds</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_Jpreds</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mk</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mk_Jpreds_Ds</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Jmaps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Jmaps</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span> </span><span class="entity"><span>passiveBs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Jsetss_by_range</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jsetss_by_bnf</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>`</span><span class="entity"><span>transpose</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Jsetss</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>timer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>time</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>timer</span></span><span> </span><span class="inner_quoted"><span>"bnf constants for the new datatypes"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>ys</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ys'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nat</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nat'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Jzs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jzs'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jz's</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jzs_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jz's_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>dtor_set_induct_phiss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jphis</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jpsi1s</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jpsi2s</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>activeJphis</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>us</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>Jys</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jys'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Jys_copy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jys'_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ys_copy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ys'_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Kss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>lthy</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"y"</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>~~</span><span class="main"><span>)</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"n"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>HOLogic.natT</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"z"</span></span><span> </span><span class="entity"><span>Ts</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"y"</span></span><span> </span><span class="entity"><span>Ts'</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"z'"</span></span><span> </span><span class="entity"><span>Ts</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"y'"</span></span><span> </span><span class="entity"><span>Ts'</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Freess</span></span><span> </span><span class="inner_quoted"><span>"P"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_pred2T</span></span><span> </span><span class="entity"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span class="main"><span>)</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"R"</span></span><span> </span><span class="entity"><span>JphiTs</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"R"</span></span><span> </span><span class="entity"><span>Jpsi1Ts</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"Q"</span></span><span> </span><span class="entity"><span>Jpsi2Ts</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"JR"</span></span><span> </span><span class="entity"><span>activeJphiTs</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"f"</span></span><span> </span><span class="entity"><span>fTs</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"f"</span></span><span> </span><span class="entity"><span>fTs</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"g"</span></span><span> </span><span class="entity"><span>gTs</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"u"</span></span><span> </span><span class="entity"><span>uTs</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"b"</span></span><span> </span><span class="entity"><span>Ts'</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"b"</span></span><span> </span><span class="entity"><span>Ts'</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"y"</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Freess</span></span><span> </span><span class="inner_quoted"><span>"K"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>AT</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>AT</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ATs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fs_Jmaps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>m</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Jmaps</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fs_copy_Jmaps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>m</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Jmaps</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>gs_Jmaps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>m</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Jmaps</span></span><span> </span><span class="entity"><span>passiveBs</span></span><span> </span><span class="entity"><span>passiveCs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fgs_Jmaps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>m</span></span><span class="main"><span>,</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>gs</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Jmaps</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span> </span><span class="entity"><span>passiveCs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dtor_Jmap_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jmap_thms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>fs_Jmap</span></span><span> </span><span class="entity"><span>map</span></span><span> </span><span class="entity"><span>dtor</span></span><span> </span><span class="entity"><span>dtor'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dtor'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs_Jmap</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs_Jmaps</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>fs_Jmaps</span></span><span> </span><span class="entity"><span>map_FTFT's</span></span><span> </span><span class="entity"><span>dtors</span></span><span> </span><span class="entity"><span>dtor's</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>maps</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>unfold</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>map_comp</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>map_cong0</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>map_arg_cong</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Jmap_defs</span></span><span> </span><span>THEN</span><span>
                     </span><span class="entity"><span>mk_map_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>map_arg_cong</span></span><span> </span><span class="entity"><span>unfold</span></span><span> </span><span class="entity"><span>map_comp</span></span><span> </span><span class="entity"><span>map_cong0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>)</span></span><span>
              </span><span class="entity"><span>goals</span></span><span> </span><span class="entity"><span>dtor_unfold_thms</span></span><span> </span><span class="entity"><span>map_comps</span></span><span> </span><span class="entity"><span>map_cong0s</span></span><span> </span><span class="entity"><span>map_arg_cong_thms</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>map_split</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Fun.html#Fun.comp_eq_dest|fact"><span>comp_eq_dest</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>maps</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dtor_Jmap_unique_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor_Jmap_unique_thm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_prem</span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="entity"><span>map</span></span><span> </span><span class="entity"><span>dtor</span></span><span> </span><span class="entity"><span>dtor'</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dtor'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>us</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_prem</span></span><span> </span><span class="entity"><span>us</span></span><span> </span><span class="entity"><span>map_FTFT's</span></span><span> </span><span class="entity"><span>dtors</span></span><span> </span><span class="entity"><span>dtor's</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span>
                </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>us</span></span><span> </span><span class="entity"><span>fs_Jmaps</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>goal</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>`</span><span class="entity"><span>split_conj_thm</span></span><span> </span><span class="main"><span>(</span></span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>goal</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Jmap_defs</span></span><span> </span><span>THEN</span><span>
                </span><span class="entity"><span>mk_dtor_map_unique_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>dtor_unfold_unique_thm</span></span><span> </span><span class="entity"><span>sym_map_comps</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Jmap_comp0_thms</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span>
              </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fmap</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>gmap</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fgmap</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                 </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>gmap</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fmap</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fgmap</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="entity"><span>fs_Jmaps</span></span><span> </span><span class="entity"><span>gs_Jmaps</span></span><span> </span><span class="entity"><span>fgs_Jmaps</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>split_conj_thm</span></span><span> </span><span class="main"><span>(</span></span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="entity"><span>mk_map_comp0_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Jmap_thms</span></span><span> </span><span class="entity"><span>map_comp0s</span></span><span> </span><span class="entity"><span>dtor_Jmap_unique_thm</span></span><span class="main"><span>)</span></span><span>
              </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>timer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>time</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>timer</span></span><span> </span><span class="inner_quoted"><span>"map functions for the new codatatypes"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Jset_minimal_thms</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_passive_prem</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="entity"><span>dtor</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>K</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>Logic.all</span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_leq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dtor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>K</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_active_prem</span></span><span> </span><span class="entity"><span>dtor</span></span><span> </span><span class="entity"><span>x1</span></span><span> </span><span class="entity"><span>K1</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="entity"><span>x2</span></span><span> </span><span class="entity"><span>K2</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>x1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x2</span></span><span class="main"><span>]</span></span><span>
                </span><span class="main"><span>(</span></span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dtor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_leq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>K2</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>K1</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>premss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Ks</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_passive_prem</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>FTs_setss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dtors</span></span><span> </span><span class="entity"><span>Jzs</span></span><span> </span><span class="entity"><span>Ks</span></span><span> </span><span>@</span><span>
                </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x1</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>K1</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_active_prem</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>x1</span></span><span> </span><span class="entity"><span>K1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>drop</span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Jzs_copy</span></span><span> </span><span class="entity"><span>Ks</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>FTs_setss</span></span><span> </span><span class="entity"><span>dtors</span></span><span> </span><span class="entity"><span>Jzs</span></span><span> </span><span class="entity"><span>Ks</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="entity"><span>ls</span></span><span> </span><span class="entity"><span>Kss</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>col_minimal_thms</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_conjunct</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>K</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_leq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_col</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>nat</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>K</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_concl</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>Ks</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>list_all_free</span></span><span> </span><span class="entity"><span>Jzs</span></span><span>
                  </span><span class="main"><span>(</span></span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_conjunct</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>Ks</span></span><span> </span><span class="entity"><span>Jzs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concls</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_concl</span></span><span> </span><span class="entity"><span>ls</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span> </span><span class="entity"><span>Kss</span></span><span class="main"><span>;</span></span><span>

                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>premss</span></span><span> </span><span class="entity"><span>concls</span></span><span>

                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctss</span></span><span> </span><span class="main"><span>=</span></span><span>
                  </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>o</span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span>Term.absfree</span><span> </span><span class="entity"><span>nat'</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nat</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>concls</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>cts</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>col_0s</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>col_Sucs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
                  </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
                    </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_col_minimal_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>cts</span></span><span> </span><span class="entity"><span>col_0s</span></span><span>
                      </span><span class="entity"><span>col_Sucs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                  </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>)</span></span><span>
                </span><span class="entity"><span>goals</span></span><span> </span><span class="entity"><span>ctss</span></span><span> </span><span class="entity"><span>col_0ss'</span></span><span> </span><span class="entity"><span>col_Sucss'</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_conjunct</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="entity"><span>K</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_leq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>K</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_concl</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>Ks</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_conjunct</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>Ks</span></span><span> </span><span class="entity"><span>Jzs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concls</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_concl</span></span><span> </span><span class="entity"><span>Jsetss_by_range</span></span><span> </span><span class="entity"><span>Kss</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>premss</span></span><span> </span><span class="entity"><span>concls</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>col_minimal</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
                </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Jset_defs</span></span><span> </span><span>THEN</span><span>
                  </span><span class="entity"><span>mk_Jset_minimal_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>col_minimal</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>)</span></span><span>
            </span><span class="entity"><span>goals</span></span><span> </span><span class="entity"><span>col_minimal_thms</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dtor_Jset_incl_thmss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor_set_Jset_incl_thmsss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_set_incl_Jset</span></span><span> </span><span class="entity"><span>dtor</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="entity"><span>Jset</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_leq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dtor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Jset</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_set_Jset_incl_Jset</span></span><span> </span><span class="entity"><span>dtor</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="entity"><span>Jset1</span></span><span> </span><span class="entity"><span>Jset2</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dtor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_leq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Jset1</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Jset2</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_incl_Jset_goalss</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>dtor</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Jsets</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_set_incl_Jset</span></span><span> </span><span class="entity"><span>dtor</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>take</span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Jsets</span></span><span class="main"><span>)</span></span><span>
              </span><span class="entity"><span>dtors</span></span><span> </span><span class="entity"><span>Jzs</span></span><span> </span><span class="entity"><span>FTs_setss</span></span><span> </span><span class="entity"><span>Jsetss_by_bnf</span></span><span class="main"><span>;</span></span><span>

            </span><span class="comment1"><span>(*x(k) : F(i)set(m+k) (dtor(i) y(i)) ==&gt; J(k)set(j) x(k) &lt;= J(i)set(j) y(i)*)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_Jset_incl_Jset_goalsss</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>dtori</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>yi</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Jsetsi</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>xk</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Jsetsk</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_set_Jset_incl_Jset</span></span><span> </span><span class="entity"><span>dtori</span></span><span> </span><span class="entity"><span>xk</span></span><span> </span><span class="entity"><span>yi</span></span><span> </span><span class="entity"><span>set</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Jsetsk</span></span><span> </span><span class="entity"><span>Jsetsi</span></span><span class="main"><span>)</span></span><span>
                </span><span class="entity"><span>Jzs_copy</span></span><span> </span><span class="main"><span>(</span></span><span>drop</span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Jsetss_by_bnf</span></span><span class="main"><span>)</span></span><span>
              </span><span class="entity"><span>dtors</span></span><span> </span><span class="entity"><span>Jzs</span></span><span> </span><span class="entity"><span>FTs_setss</span></span><span> </span><span class="entity"><span>Jsetss_by_bnf</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rec_Sucs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rec_Suc</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Jset_defs</span></span><span> </span><span>THEN</span><span>
                    </span><span class="entity"><span>mk_set_incl_Jset_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>rec_Suc</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>)</span></span><span>
              </span><span class="entity"><span>goals</span></span><span> </span><span class="entity"><span>rec_Sucs</span></span><span class="main"><span>)</span></span><span>
            </span><span class="entity"><span>set_incl_Jset_goalss</span></span><span> </span><span class="entity"><span>col_Sucss</span></span><span class="main"><span>,</span></span><span>
            </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>goalss</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rec_Sucs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rec_Suc</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
                  </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
                    </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Jset_defs</span></span><span> </span><span>THEN</span><span>
                      </span><span class="entity"><span>mk_set_Jset_incl_Jset_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>rec_Suc</span></span><span> </span><span class="entity"><span>k</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                  </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>)</span></span><span>
                </span><span class="entity"><span>goals</span></span><span> </span><span class="entity"><span>rec_Sucs</span></span><span class="main"><span>)</span></span><span>
              </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>goalss</span></span><span class="main"><span>)</span></span><span>
            </span><span class="entity"><span>set_Jset_incl_Jset_goalsss</span></span><span> </span><span class="entity"><span>col_Sucss</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_incl_Jset_thmss'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>dtor_Jset_incl_thmss</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_Jset_incl_Jset_thmsss'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>transpose</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>dtor_set_Jset_incl_thmsss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_Jset_thmss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.set_mp|fact"><span>set_mp</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dtor_Jset_incl_thmss</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_Jset_Jset_thmsss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.set_mp|fact"><span>set_mp</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>dtor_set_Jset_incl_thmsss</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_Jset_thmss'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>set_Jset_thmss</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_Jset_Jset_thmsss'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>transpose</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>set_Jset_Jset_thmsss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dtor_Jset_induct_thms</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>incls</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Greatest_Fixpoint.html#BNF_Greatest_Fixpoint.subset_Collect_iff|fact"><span>subset_Collect_iff</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dtor_Jset_incl_thmss</span></span><span> </span><span>@</span><span>
                </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Greatest_Fixpoint.html#BNF_Greatest_Fixpoint.subset_Collect_iff|fact"><span>subset_Collect_iff</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.subset_refl|fact"><span>subset_refl</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>o</span><span> </span><span>Thm.ctyp_of</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>params'</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_induct_tinst</span></span><span> </span><span class="entity"><span>phis</span></span><span> </span><span class="entity"><span>jsets</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>y'</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>jset</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Jz</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Jz'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span class="entity"><span>Jz'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Collect</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>,</span></span><span> </span><span>snd</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>jset</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Jz</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Jz</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="entity"><span>phis</span></span><span> </span><span class="entity"><span>jsets</span></span><span> </span><span class="entity"><span>Jzs</span></span><span> </span><span class="entity"><span>Jzs'</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>set_minimal</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>set_set_inclss</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>jsets</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>y'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>phis</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>set_minimal</span></span><span>
                </span><span>|&gt;</span><span> </span><span>Thm.instantiate'</span><span> </span><span class="entity"><span>cTs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_induct_tinst</span></span><span> </span><span class="entity"><span>phis</span></span><span> </span><span class="entity"><span>jsets</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>unfold_thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>incls</span></span><span class="main"><span>)</span></span><span> </span><span>OF</span><span>
                </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>ballI</span></span><span> </span><span>@</span><span>
                  </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Greatest_Fixpoint.html#BNF_Greatest_Fixpoint.subset_CollectI|fact"><span>subset_CollectI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_set_inclss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span>|&gt;</span><span> </span><span>singleton</span><span> </span><span class="main"><span>(</span></span><span>Proof_Context.export</span><span> </span><span class="entity"><span>names_lthy</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
              </span><span>|&gt;</span><span> </span><span>rule_by_tactic</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span>ALLGOALS</span><span> </span><span class="main"><span>(</span></span><span>TRY</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span>asm_rl</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="entity"><span>Jset_minimal_thms</span></span><span> </span><span class="entity"><span>set_Jset_incl_Jset_thmsss'</span></span><span> </span><span class="entity"><span>Jsetss_by_range</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>ys'</span></span><span> </span><span class="entity"><span>dtor_set_induct_phiss</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dtor_Jset_thmss'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor_Jset_thmss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_simp_goal</span></span><span> </span><span class="entity"><span>relate</span></span><span> </span><span class="entity"><span>pas_set</span></span><span> </span><span class="entity"><span>act_sets</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>dtor</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>relate</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_union</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pas_set</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dtor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                 </span><span>Library.foldl1</span><span> </span><span class="entity"><span>mk_union</span></span><span>
                   </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>X</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_UNION</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>X</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dtor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>act_sets</span></span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_goals</span></span><span> </span><span class="entity"><span>eq</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Fsets</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span class="entity"><span>mk_simp_goal</span></span><span> </span><span class="entity"><span>eq</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>Fsets</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>drop</span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>Fsets</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>)</span></span><span>
                </span><span class="entity"><span>FTs_setss</span></span><span> </span><span class="entity"><span>dtors</span></span><span> </span><span class="entity"><span>Jzs</span></span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>)</span></span><span>
              </span><span class="entity"><span>ls</span></span><span> </span><span class="entity"><span>Jsetss_by_range</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>le_goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>o</span><span> </span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>mk_goals</span></span><span> </span><span class="main"><span>(</span></span><span>uncurry</span><span> </span><span class="entity"><span>mk_leq</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_le_thmss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>split_conj_thm</span></span><span>
              </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Jset_minimal</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>set_Jsets</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>set_Jset_Jsetss</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                    </span><span class="entity"><span>mk_set_le_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>Jset_minimal</span></span><span> </span><span class="entity"><span>set_Jsets</span></span><span> </span><span class="entity"><span>set_Jset_Jsetss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>)</span></span><span>
              </span><span class="entity"><span>le_goals</span></span><span> </span><span class="entity"><span>Jset_minimal_thms</span></span><span> </span><span class="entity"><span>set_Jset_thmss'</span></span><span> </span><span class="entity"><span>set_Jset_Jset_thmsss'</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ge_goalss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_goals</span></span><span> </span><span class="main"><span>(</span></span><span>uncurry</span><span> </span><span class="entity"><span>mk_leq</span></span><span> </span><span>o</span><span> </span><span>swap</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_ge_thmss</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>set_incl_Jset</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>set_Jset_incl_Jsets</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                    </span><span class="entity"><span>mk_set_ge_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>set_incl_Jset</span></span><span> </span><span class="entity"><span>set_Jset_incl_Jsets</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="entity"><span>ge_goalss</span></span><span> </span><span class="entity"><span>set_incl_Jset_thmss'</span></span><span> </span><span class="entity"><span>set_Jset_incl_Jset_thmsss'</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>le</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ge</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>equalityI</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>le</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ge</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_le_thmss</span></span><span> </span><span class="entity"><span>set_ge_thmss</span></span><span>
            </span><span>|&gt;</span><span> </span><span>`</span><span class="entity"><span>transpose</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>timer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>time</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>timer</span></span><span> </span><span class="inner_quoted"><span>"set functions for the new codatatypes"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>colss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_col</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>nat</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ls</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>colss'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_col</span></span><span> </span><span class="entity"><span>Ts'</span></span><span> </span><span class="entity"><span>nat</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ls</span></span><span> </span><span class="entity"><span>passiveBs</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>col_natural_thmss</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_col_natural</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>map</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>col</span></span><span> </span><span class="entity"><span>col'</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_image</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>col</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>col'</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>cols</span></span><span> </span><span class="entity"><span>cols'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>list_all_free</span></span><span> </span><span class="entity"><span>Jzs</span></span><span> </span><span class="main"><span>(</span></span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span>
              </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_col_natural</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs_Jmaps</span></span><span> </span><span class="entity"><span>Jzs</span></span><span> </span><span class="entity"><span>cols</span></span><span> </span><span class="entity"><span>cols'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>colss</span></span><span> </span><span class="entity"><span>colss'</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctss</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>o</span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span>Term.absfree</span><span> </span><span class="entity"><span>nat'</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nat</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thms</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>cts</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rec_0s</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rec_Sucs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="entity"><span>goal</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_col_natural_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>cts</span></span><span> </span><span class="entity"><span>rec_0s</span></span><span> </span><span class="entity"><span>rec_Sucs</span></span><span>
                    </span><span class="entity"><span>dtor_Jmap_thms</span></span><span> </span><span class="entity"><span>set_mapss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>)</span></span><span>
              </span><span class="entity"><span>goals</span></span><span> </span><span class="entity"><span>ctss</span></span><span> </span><span class="entity"><span>col_0ss'</span></span><span> </span><span class="entity"><span>col_Sucss'</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>split_conj_thm</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_specN</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thms</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>col_bd_thmss</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_col_bd</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>col</span></span><span> </span><span class="entity"><span>bd</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_ordLess</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_card_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>col</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bd</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>bds</span></span><span> </span><span class="entity"><span>cols</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>list_all_free</span></span><span> </span><span class="entity"><span>Jzs</span></span><span> </span><span class="main"><span>(</span></span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span>
              </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_col_bd</span></span><span> </span><span class="entity"><span>Jzs</span></span><span> </span><span class="entity"><span>cols</span></span><span> </span><span class="entity"><span>bds</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>Jbds</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>colss</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>o</span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span>Term.absfree</span><span> </span><span class="entity"><span>nat'</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nat</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_goal</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>sbd</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>colss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thms</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>cts</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rec_0s</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rec_Sucs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="entity"><span>goal</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Jbd_defs</span></span><span> </span><span>THEN</span><span>
                    </span><span class="entity"><span>mk_col_bd_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="entity"><span>cts</span></span><span> </span><span class="entity"><span>rec_0s</span></span><span> </span><span class="entity"><span>rec_Sucs</span></span><span> </span><span class="entity"><span>sbd_regularCard</span></span><span> </span><span class="entity"><span>sbd_Cinfinite</span></span><span> </span><span class="entity"><span>set_sbdss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>)</span></span><span>
              </span><span class="entity"><span>ls</span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="entity"><span>ctss</span></span><span> </span><span class="entity"><span>col_0ss'</span></span><span> </span><span class="entity"><span>col_Sucss'</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>split_conj_thm</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_specN</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thms</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_cong0_thms</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>o</span><span> </span><span>Thm.ctyp_of</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span>o</span><span>
              </span><span>Term.typ_subst_atomic</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>passiveAs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>passiveBs</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>TFree</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>coinduct_params</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_prem</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>g</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>y'</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>mk_Ball</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span class="entity"><span>y'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>g</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_prems</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_prem</span></span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>fs_copy</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>ys'</span></span><span class="main"><span>)</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_map_cong0</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>fmap</span></span><span> </span><span class="entity"><span>gmap</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_prems</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fmap</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>gmap</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_coind_body</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>fmap</span></span><span> </span><span class="entity"><span>gmap</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>y_copy</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>HOLogic.mk_conj</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_Collect</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_prems</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fmap</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>y_copy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>gmap</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_cphi</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z'</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>fmap</span></span><span> </span><span class="entity"><span>gmap</span></span><span> </span><span class="entity"><span>y'</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>y'_copy</span></span><span> </span><span class="entity"><span>y_copy</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>HOLogic.mk_exists</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_coind_body</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>z'</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>fmap</span></span><span> </span><span class="entity"><span>gmap</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>y_copy</span></span><span class="main"><span>)</span></span><span>
              </span><span>|&gt;</span><span> </span><span>Term.absfree</span><span> </span><span class="entity"><span>y'_copy</span></span><span>
              </span><span>|&gt;</span><span> </span><span>Term.absfree</span><span> </span><span class="entity"><span>y'</span></span><span>
              </span><span>|&gt;</span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cphis</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 9</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_cphi</span></span><span>
              </span><span class="entity"><span>Jsetss_by_bnf</span></span><span> </span><span class="entity"><span>Jzs'</span></span><span> </span><span class="entity"><span>Jzs</span></span><span> </span><span class="entity"><span>fs_Jmaps</span></span><span> </span><span class="entity"><span>fs_copy_Jmaps</span></span><span> </span><span class="entity"><span>Jys'</span></span><span> </span><span class="entity"><span>Jys</span></span><span> </span><span class="entity"><span>Jys'_copy</span></span><span> </span><span class="entity"><span>Jys_copy</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>coinduct</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.instantiate'</span><span> </span><span class="entity"><span>cTs</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>SOME</span><span> </span><span class="entity"><span>cphis</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dtor_coinduct_thm</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span>
                </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_map_cong0</span></span><span> </span><span class="entity"><span>Jsetss_by_bnf</span></span><span> </span><span class="entity"><span>Jzs</span></span><span> </span><span class="entity"><span>fs_Jmaps</span></span><span> </span><span class="entity"><span>fs_copy_Jmaps</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
                </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_mcong_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>coinduct</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>map_comps</span></span><span>
                  </span><span class="entity"><span>dtor_Jmap_thms</span></span><span> </span><span class="entity"><span>map_cong0s</span></span><span>
                  </span><span class="entity"><span>set_mapss</span></span><span> </span><span class="entity"><span>set_Jset_thmss</span></span><span> </span><span class="entity"><span>set_Jset_Jset_thmsss</span></span><span> </span><span class="entity"><span>in_rels</span></span><span class="main"><span>)</span></span><span>
              </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>split_conj_thm</span></span><span> </span><span class="entity"><span>thm</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>in_Jrels</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>trans</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>def</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.OO_Grp_alt|fact"><span>OO_Grp_alt</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.predicate2_eqD|fact"><span>predicate2_eqD</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
            </span><span class="entity"><span>Jrel_unabs_defs</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Jrels</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Jrels</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span> </span><span class="entity"><span>passiveBs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Jpreds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Jpreds</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Jrelphis</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rel</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jphis</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Jrels</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>relphis</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rel</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jphis</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Jrelphis</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rels</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Jrelpsi1s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rel</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jpsi1s</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Jrels</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span> </span><span class="entity"><span>passiveCs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Jrelpsi2s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rel</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jpsi2s</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Jrels</span></span><span> </span><span class="entity"><span>passiveCs</span></span><span> </span><span class="entity"><span>passiveBs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Jrelpsi12s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rel</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel</span></span><span class="main"><span>,</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>mk_rel_compp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Jpsi1s</span></span><span> </span><span class="entity"><span>Jpsi2s</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Jrels</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dtor_Jrel_thms</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>Jz</span></span><span> </span><span class="entity"><span>Jz'</span></span><span> </span><span class="entity"><span>dtor</span></span><span> </span><span class="entity"><span>dtor'</span></span><span> </span><span class="entity"><span>Jrelphi</span></span><span> </span><span class="entity"><span>relphi</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Jrelphi</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Jz</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Jz'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>relphi</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dtor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Jz</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dtor'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Jz'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>Jzs</span></span><span> </span><span class="entity"><span>Jz's</span></span><span> </span><span class="entity"><span>dtors</span></span><span> </span><span class="entity"><span>dtor's</span></span><span> </span><span class="entity"><span>Jrelphis</span></span><span> </span><span class="entity"><span>relphis</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 12</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>in_rel</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>map_comp0</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>map_cong0</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>dtor_map</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>dtor_sets</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>dtor_inject</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>dtor_ctor</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>set_map0s</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>dtor_set_incls</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>dtor_set_set_inclss</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
              </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
                </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span class="entity"><span>mk_dtor_rel_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>in_Jrels</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>in_rel</span></span><span> </span><span class="entity"><span>map_comp0</span></span><span> </span><span class="entity"><span>map_cong0</span></span><span> </span><span class="entity"><span>dtor_map</span></span><span> </span><span class="entity"><span>dtor_sets</span></span><span>
                    </span><span class="entity"><span>dtor_inject</span></span><span> </span><span class="entity"><span>dtor_ctor</span></span><span> </span><span class="entity"><span>set_map0s</span></span><span> </span><span class="entity"><span>dtor_set_incls</span></span><span> </span><span class="entity"><span>dtor_set_set_inclss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>)</span></span><span>
            </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="entity"><span>in_rels</span></span><span> </span><span class="entity"><span>map_comps</span></span><span> </span><span class="entity"><span>map_cong0s</span></span><span> </span><span class="entity"><span>dtor_Jmap_thms</span></span><span> </span><span class="entity"><span>dtor_Jset_thmss'</span></span><span>
              </span><span class="entity"><span>dtor_inject_thms</span></span><span> </span><span class="entity"><span>dtor_ctor_thms</span></span><span> </span><span class="entity"><span>set_mapss</span></span><span> </span><span class="entity"><span>dtor_Jset_incl_thmss</span></span><span>
              </span><span class="entity"><span>dtor_set_Jset_incl_thmsss</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>passiveABs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>HOLogic.mk_prodT</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span> </span><span class="entity"><span>passiveBs</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>zip_ranTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>passiveABs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>prodTsTs'</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>allJphis</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Jphis</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>activeJphis</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>zipFTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_FTs</span></span><span> </span><span class="entity"><span>zip_ranTs</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>zipTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>FT</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>T'</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>FT</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>Ts'</span></span><span> </span><span class="entity"><span>zipFTs</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>zip_zTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Ts</span></span><span> </span><span class="entity"><span>passiveABs</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>zips</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>abs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>abs'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>zip_zs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>zip_zs'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>names_lthy</span></span><span>
        </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"zip"</span></span><span> </span><span class="entity"><span>zipTs</span></span><span>
        </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"ab"</span></span><span> </span><span class="entity"><span>passiveABs</span></span><span>
        </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"z"</span></span><span> </span><span class="entity"><span>zip_zTs</span></span><span class="main"><span>;</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Iphi_sets</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.Collect_const</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>HOLogic.mk_case_prod</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>allJphis</span></span><span> </span><span class="entity"><span>zip_ranTs</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>in_phis</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_in</span></span><span> </span><span class="entity"><span>Iphi_sets</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_setss</span></span><span> </span><span class="entity"><span>zip_ranTs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>zipFTs</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fstABs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>fst_const</span></span><span> </span><span class="entity"><span>passiveABs</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>all_fsts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fstABs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fstsTsTs'</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_all_fsts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_map_of_bnf</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>zip_ranTs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>passiveAs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>all_fsts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Dss</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Jmap_fsts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>map</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>T</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fstABs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Jmaps</span></span><span> </span><span class="entity"><span>passiveABs</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>;</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sndABs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>snd_const</span></span><span> </span><span class="entity"><span>passiveABs</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>all_snds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sndABs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>sndsTsTs'</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_all_snds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_map_of_bnf</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>zip_ranTs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>passiveBs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Ts'</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>all_snds</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Dss</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Jmap_snds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>map</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>T</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sndABs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Jmaps</span></span><span> </span><span class="entity"><span>passiveABs</span></span><span> </span><span class="entity"><span>passiveBs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>zip_unfolds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_unfold</span></span><span> </span><span class="entity"><span>zip_zTs</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_case_prod</span></span><span> </span><span class="entity"><span>zips</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>zip_setss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Jsetss</span></span><span> </span><span class="entity"><span>passiveABs</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>transpose</span></span><span class="main"><span>;</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>Jrel_coinduct_tac</span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>CIHs</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_helper_prem</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>in_phi</span></span><span> </span><span class="entity"><span>zip</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>map</span></span><span> </span><span class="entity"><span>map'</span></span><span> </span><span class="entity"><span>dtor</span></span><span> </span><span class="entity"><span>dtor'</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>zipxy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>zip</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>list_all_free</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>]</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>phi</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>zipxy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>in_phi</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>zipxy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>zipxy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>helper_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 9</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_helper_prem</span></span><span>
            </span><span class="entity"><span>activeJphis</span></span><span> </span><span class="entity"><span>in_phis</span></span><span> </span><span class="entity"><span>zips</span></span><span> </span><span class="entity"><span>Jzs</span></span><span> </span><span class="entity"><span>Jz's</span></span><span> </span><span class="entity"><span>map_all_fsts</span></span><span> </span><span class="entity"><span>map_all_snds</span></span><span> </span><span class="entity"><span>dtors</span></span><span> </span><span class="entity"><span>dtor's</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_helper_coind_phi</span></span><span> </span><span class="entity"><span>fst</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>alt</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>map</span></span><span> </span><span class="entity"><span>zip_unfold</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="entity"><span>list_exists_free</span></span><span> </span><span class="main"><span>[</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>fst</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>phi</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>zip_unfold</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>HOLogic.mk_prod</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>coind1_phis</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_helper_coind_phi</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span>
            </span><span class="entity"><span>activeJphis</span></span><span> </span><span class="entity"><span>Jzs</span></span><span> </span><span class="entity"><span>Jzs_copy</span></span><span> </span><span class="entity"><span>Jz's</span></span><span> </span><span class="entity"><span>Jmap_fsts</span></span><span> </span><span class="entity"><span>zip_unfolds</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>coind2_phis</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_helper_coind_phi</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span>
              </span><span class="entity"><span>activeJphis</span></span><span> </span><span class="entity"><span>Jzs</span></span><span> </span><span class="entity"><span>Jz's_copy</span></span><span> </span><span class="entity"><span>Jz's</span></span><span> </span><span class="entity"><span>Jmap_snds</span></span><span> </span><span class="entity"><span>zip_unfolds</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_cts</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>z's</span></span><span> </span><span class="entity"><span>phis</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>z'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span>o</span><span> </span><span>Term.dest_Free</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>z'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>z's</span></span><span> </span><span class="entity"><span>phis</span></span><span> </span><span>@</span><span>
            </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>o</span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>splice</span></span><span> </span><span class="entity"><span>z's</span></span><span> </span><span class="entity"><span>zs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cts1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_cts</span></span><span> </span><span class="entity"><span>Jzs</span></span><span> </span><span class="entity"><span>Jzs_copy</span></span><span> </span><span class="entity"><span>coind1_phis</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cts2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_cts</span></span><span> </span><span class="entity"><span>Jz's</span></span><span> </span><span class="entity"><span>Jz's_copy</span></span><span> </span><span class="entity"><span>coind2_phis</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_helper_coind_concl</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>alt</span></span><span> </span><span class="entity"><span>coind_phi</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>coind_phi</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>helper_coind1_concl</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span>
              </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_helper_coind_concl</span></span><span> </span><span class="entity"><span>Jzs</span></span><span> </span><span class="entity"><span>Jzs_copy</span></span><span> </span><span class="entity"><span>coind1_phis</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>helper_coind2_concl</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span>
              </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_helper_coind_concl</span></span><span> </span><span class="entity"><span>Jz's</span></span><span> </span><span class="entity"><span>Jz's_copy</span></span><span> </span><span class="entity"><span>coind2_phis</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_helper_coind_thms</span></span><span> </span><span class="entity"><span>fst</span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>cts</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>helper_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>helper_prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span class="entity"><span>mk_rel_coinduct_coind_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>fst</span></span><span> </span><span class="entity"><span>m</span></span><span>
                    </span><span class="main"><span>(</span></span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>cts</span></span><span> </span><span class="entity"><span>dtor_coinduct_thm</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>map_comps</span></span><span> </span><span class="entity"><span>map_cong0s</span></span><span>
                    </span><span class="entity"><span>map_arg_cong_thms</span></span><span> </span><span class="entity"><span>set_mapss</span></span><span> </span><span class="entity"><span>dtor_unfold_thms</span></span><span> </span><span class="entity"><span>dtor_Jmap_thms</span></span><span> </span><span class="entity"><span>in_rels</span></span><span class="main"><span>)</span></span><span>
              </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
              </span><span>|&gt;</span><span> </span><span class="entity"><span>split_conj_thm</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>helper_coind1_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_helper_coind_thms</span></span><span> </span><span>true</span><span> </span><span class="entity"><span>helper_coind1_concl</span></span><span> </span><span class="entity"><span>cts1</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>helper_coind2_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_helper_coind_thms</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>helper_coind2_concl</span></span><span> </span><span class="entity"><span>cts2</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_helper_ind_phi</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>ab</span></span><span> </span><span class="entity"><span>fst</span></span><span> </span><span class="entity"><span>snd</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>active_phi</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>zip_unfold</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="entity"><span>list_all_free</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_imp</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>active_phi</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span>
                 </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>zip_unfold</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>HOLogic.mk_prod</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>phi</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fst</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>ab</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>snd</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>ab</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>helper_ind_phiss</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Jphi</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ab</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fst</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>snd</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_helper_ind_phi</span></span><span> </span><span class="entity"><span>Jphi</span></span><span> </span><span class="entity"><span>ab</span></span><span> </span><span class="entity"><span>fst</span></span><span> </span><span class="entity"><span>snd</span></span><span class="main"><span>)</span></span><span>
              </span><span class="entity"><span>zip_zs</span></span><span> </span><span class="entity"><span>activeJphis</span></span><span> </span><span class="entity"><span>Jzs</span></span><span> </span><span class="entity"><span>Jz's</span></span><span> </span><span class="entity"><span>zip_unfolds</span></span><span class="main"><span>)</span></span><span>
            </span><span class="entity"><span>Jphis</span></span><span> </span><span class="entity"><span>abs</span></span><span> </span><span class="entity"><span>fstABs</span></span><span> </span><span class="entity"><span>sndABs</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ab'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>phis</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>z'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span class="entity"><span>ab'</span></span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span class="entity"><span>z'</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="entity"><span>zip_zs'</span></span><span> </span><span class="entity"><span>phis</span></span><span> </span><span>@</span><span>
              </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>o</span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>zip_zs</span></span><span class="main"><span>)</span></span><span>
            </span><span class="entity"><span>abs'</span></span><span> </span><span class="entity"><span>helper_ind_phiss</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_helper_ind_concl</span></span><span> </span><span class="entity"><span>ab'</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>ind_phi</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="entity"><span>mk_Ball</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span class="entity"><span>ab'</span></span><span> </span><span class="entity"><span>ind_phi</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_helper_ind_concls</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ab'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ind_phis</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>zip_sets</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_helper_ind_concl</span></span><span> </span><span class="entity"><span>ab'</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>zip_zs</span></span><span> </span><span class="entity"><span>ind_phis</span></span><span> </span><span class="entity"><span>zip_sets</span></span><span class="main"><span>)</span></span><span>
            </span><span class="entity"><span>abs'</span></span><span> </span><span class="entity"><span>helper_ind_phiss</span></span><span> </span><span class="entity"><span>zip_setss</span></span><span>
            </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>o</span><span> </span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>helper_ind_thmss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
            </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>set_induct</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>cts</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>helper_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
              </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>helper_prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span class="entity"><span>mk_rel_coinduct_ind_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>ks</span></span><span>
                    </span><span class="entity"><span>dtor_unfold_thms</span></span><span> </span><span class="entity"><span>set_mapss</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>(</span></span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>cts</span></span><span> </span><span class="entity"><span>set_induct</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
              </span><span>|&gt;</span><span> </span><span class="entity"><span>split_conj_thm</span></span><span class="main"><span>)</span></span><span>
            </span><span class="entity"><span>mk_helper_ind_concls</span></span><span> </span><span class="entity"><span>ls</span></span><span> </span><span class="entity"><span>dtor_Jset_induct_thms</span></span><span> </span><span class="entity"><span>ctss</span></span><span>
            </span><span>|&gt;</span><span> </span><span class="entity"><span>transpose</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="entity"><span>mk_rel_coinduct_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CIHs</span></span><span> </span><span class="entity"><span>in_rels</span></span><span> </span><span class="entity"><span>in_Jrels</span></span><span>
            </span><span class="entity"><span>helper_ind_thmss</span></span><span> </span><span class="entity"><span>helper_coind1_thms</span></span><span> </span><span class="entity"><span>helper_coind2_thms</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Jrel_coinduct_thm</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>mk_xtor_rel_co_induct_thm</span></span><span> </span><span class="entity"><span>Greatest_FP</span></span><span> </span><span class="entity"><span>rels</span></span><span> </span><span class="entity"><span>activeJphis</span></span><span> </span><span class="entity"><span>Jrels</span></span><span> </span><span class="entity"><span>Jphis</span></span><span> </span><span class="entity"><span>Jzs</span></span><span> </span><span class="entity"><span>Jz's</span></span><span> </span><span class="entity"><span>dtors</span></span><span> </span><span class="entity"><span>dtor's</span></span><span>
          </span><span class="entity"><span>Jrel_coinduct_tac</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>le_Jrel_OO_thm</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_le_Jrel_OO</span></span><span> </span><span class="entity"><span>Jrelpsi1</span></span><span> </span><span class="entity"><span>Jrelpsi2</span></span><span> </span><span class="entity"><span>Jrelpsi12</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>mk_leq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rel_compp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Jrelpsi1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jrelpsi2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Jrelpsi12</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_le_Jrel_OO</span></span><span> </span><span class="entity"><span>Jrelpsi1s</span></span><span> </span><span class="entity"><span>Jrelpsi2s</span></span><span> </span><span class="entity"><span>Jrelpsi12s</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="entity"><span>mk_le_rel_OO_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Jrel_coinduct_thm</span></span><span> </span><span class="entity"><span>dtor_Jrel_thms</span></span><span> </span><span class="entity"><span>le_rel_OOs</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>timer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>time</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>timer</span></span><span> </span><span class="inner_quoted"><span>"helpers for BNF properties"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>close_wit</span></span><span> </span><span class="entity"><span>I</span></span><span> </span><span class="entity"><span>wit</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> </span><span>fold_rev</span><span> </span><span>Term.absfree</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>ys'</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>I</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>wit</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>all_unitTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>replicate</span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>HOLogic.unitT</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unitTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>HOLogic.unitT</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unit_funs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span>Term.absdummy</span><span> </span><span class="entity"><span>HOLogic.unitT</span></span><span> </span><span class="entity"><span>HOLogic.unit</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_map_args</span></span><span> </span><span class="entity"><span>I</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>I</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Term.absdummy</span><span> </span><span class="entity"><span>HOLogic.unitT</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>mk_undefined</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.unitT</span></span><span> </span><span>--&gt;</span><span> </span><span>nth</span><span> </span><span class="entity"><span>passiveAs</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>m</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_nat_wit</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wit</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>passiveI</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>&lt;</span><span> </span><span class="entity"><span>m</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>I</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_map_args</span></span><span> </span><span class="entity"><span>passiveI</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Term.absdummy</span><span> </span><span class="entity"><span>HOLogic.unitT</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>mk_map_of_bnf</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>all_unitTs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>passiveAs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>unitTs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_args</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>unit_funs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>wit</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_dummy_wit</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="entity"><span>I</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_map_args</span></span><span> </span><span class="entity"><span>I</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Term.absdummy</span><span> </span><span class="entity"><span>HOLogic.unitT</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>mk_map_of_bnf</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>all_unitTs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>passiveAs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>unitTs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_args</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>unit_funs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span>
              </span><span class="entity"><span>mk_undefined</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_T_of_bnf</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>all_unitTs</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nat_witss</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_wits_of_bnf</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nwits_of_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ds</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nwits_of_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>HOLogic.unitT</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf</span></span><span>
            </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wit</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_nat_wit</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>wit</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="entity"><span>HOLogic.unit</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>I</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>Dss</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nat_wit_thmss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>~~</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>nat_witss</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>wit_thmss_of_bnf</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>)</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Iss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>nat_witss</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>filter_wits</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wit</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>J</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>&lt;</span><span> </span><span class="entity"><span>m</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>I</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>J</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>J</span></span><span> </span><span>&lt;</span><span> </span><span>length</span><span> </span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wit</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>wit_treess</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map_index</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Is</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span>map_index</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>finish</span></span><span> </span><span class="entity"><span>Iss</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>i</span></span><span>+</span><span class="entity"><span>m</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span>+</span><span class="entity"><span>m</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Is</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Iss</span></span><span>
          </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>minimize_wits</span></span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="entity"><span>filter_wits</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>minimize_wits</span></span><span> </span><span>o</span><span> </span><span>flat</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>coind_wit_argsss</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tree_to_coind_wits</span></span><span> </span><span class="entity"><span>nat_wit_thmss</span></span><span> </span><span>o</span><span> </span><span>snd</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>filter</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>wit_treess</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nonredundant_coind_wit_argsss</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>argsss</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span>nth_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>filter_out</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span>exists</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>xs'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span>snd</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ys'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>,</span></span><span> </span><span>snd</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                  </span><span>eq_pair</span><span> </span><span class="main"><span>(</span></span><span>subset</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>eq_set</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>xs'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ys'</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>xs'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="entity"><span>ys'</span></span><span class="main"><span>)</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>argsss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="entity"><span>argsss</span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>coind_wit_argsss</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>prepare_args</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>I</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>snd</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dummys</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>map_split</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>find_first</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>arg</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>arg</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                  </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wit</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>wit</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_dummy_wit</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>Dss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>bnfs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="entity"><span>ks</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dummys</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>apsnd</span><span> </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>split_list</span><span> </span><span class="entity"><span>args'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_coind_wits</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dummys</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>args</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dummys</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_unfold</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>HOLogic.unit</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>coind_witss</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_coind_wits</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>prepare_args</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>nonredundant_coind_wit_argsss</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>witss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_wits_of_bnf</span></span><span>
          </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nwits_of_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ds</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nwits_of_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>passiveAs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Dss</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctor_witss</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>uncurry</span><span> </span><span class="entity"><span>close_wit</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>tree_to_ctor_wit</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>ctors</span></span><span> </span><span class="entity"><span>witss</span></span><span> </span><span>o</span><span> </span><span>snd</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span>o</span><span>
            </span><span>filter_out</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>wit_treess</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_coind_wit_thms</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dummys</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>wits</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wit_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>y_copy</span></span><span> </span><span class="entity"><span>y'_copy</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_conjunct</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>dummy</span></span><span> </span><span class="entity"><span>wit</span></span><span> </span><span class="main"><span>=</span></span><span>
                  </span><span class="entity"><span>mk_Ball</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span class="entity"><span>y'_copy</span></span><span>
                    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>dummy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>I</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                      </span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wit</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>I</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>y_copy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span>
                        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.False|const"><span>False</span></a><span>›</span></span></span><span class="main"><span>)</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.True|const"><span>True</span></a><span>›</span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span>
                  </span><span class="main"><span>(</span></span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_conjunct</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>Jzs</span></span><span> </span><span class="entity"><span>dummys</span></span><span> </span><span class="entity"><span>wits</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>Jsetss_by_range</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>ys_copy</span></span><span> </span><span class="entity"><span>ys'_copy</span></span><span> </span><span class="entity"><span>ls</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>induct</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
              </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
                </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_coind_wit_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>induct</span></span><span> </span><span class="entity"><span>dtor_unfold_thms</span></span><span>
                  </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>set_mapss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>wit_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>)</span></span><span>
            </span><span class="entity"><span>goals</span></span><span> </span><span class="entity"><span>dtor_Jset_induct_thms</span></span><span>
            </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="entity"><span>split_conj_thm</span></span><span>
            </span><span>|&gt;</span><span> </span><span class="entity"><span>transpose</span></span><span>
            </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map_filter</span><span> </span><span class="main"><span>(</span></span><span>try</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>bspec</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>mp</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>~~</span><span> </span><span class="main"><span>(</span></span><span>map_index</span><span> </span><span>Library.I</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>close_wit</span></span><span> </span><span class="entity"><span>I</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>wits</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>m</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>coind_wit_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>maps</span><span> </span><span class="entity"><span>mk_coind_wit_thms</span></span><span> </span><span class="entity"><span>coind_witss</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>wit_thmss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>all_witss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wit</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>witss</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span>nth_map</span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thms'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wits</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thms</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>thms'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wit</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>wits</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>witss</span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>coind_wit_thms</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>pair</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctor_witss</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>apsnd</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>snd</span><span> </span><span>o</span><span> </span><span class="entity"><span>minimize_wits</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>split_list</span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>timer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>time</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>timer</span></span><span> </span><span class="inner_quoted"><span>"witnesses"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_id0_tacs</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="entity"><span>mk_map_id0_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Jmap_thms</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="entity"><span>thm'</span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>dtor_unfold_unique_thms</span></span><span> </span><span class="entity"><span>unfold_dtor_thms</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_comp0_tacs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Jmap_comp0_thms</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_cong0_tacs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_map_cong0_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>map_cong0_thms</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_map0_tacss</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>col</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Jset_defs</span></span><span> </span><span>THEN</span><span> </span><span class="entity"><span>mk_set_map0_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>col</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>col_natural_thmss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Jbd_card_orders</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Local_Defs.fold</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>def</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>sbd_card_order</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Jbd_defs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Jbd_Cinfinites</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Local_Defs.fold</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>def</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>sbd_Cinfinite</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Jbd_defs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Jbd_regularCards</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Local_Defs.fold</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>def</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>sbd_regularCard</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Jbd_defs</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Jbd_natLeq_ordLess_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Greatest_Fixpoint.html#BNF_Greatest_Fixpoint.natLeq_ordLess_cinfinite&apos;|fact"><span>natLeq_ordLess_cinfinite'</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span class="entity"><span>sbd_Cinfinite'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sbd_card_order'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>def</span></span><span>
        </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Jbd_defs</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_co_tacs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Jbd_card_orders</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_cinf_tacs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>conjunct1</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Jbd_Cinfinites</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_reg_tacs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Jbd_regularCards</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_bd_tacss</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Cinf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Creg</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>col</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Jset_defs</span></span><span> </span><span>THEN</span><span> </span><span class="entity"><span>mk_set_bd_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Cinf</span></span><span> </span><span class="entity"><span>Creg</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="entity"><span>col</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>Jbd_Cinfinites</span></span><span> </span><span class="entity"><span>Jbd_regularCards</span></span><span> </span><span class="entity"><span>Jbd_natLeq_ordLess_thms</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>col_bd_thmss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>le_rel_OO_tacs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>le_Jrel_OO_thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>mk_conjunctN</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_OO_Grp_tacs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Jrel_unabs_defs</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_set_tacs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Jpred_unabs_defs</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tacss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 11</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>zip_axioms</span></span><span> </span><span class="entity"><span>map_id0_tacs</span></span><span> </span><span class="entity"><span>map_comp0_tacs</span></span><span> </span><span class="entity"><span>map_cong0_tacs</span></span><span> </span><span class="entity"><span>set_map0_tacss</span></span><span>
          </span><span class="entity"><span>bd_co_tacs</span></span><span> </span><span class="entity"><span>bd_cinf_tacs</span></span><span> </span><span class="entity"><span>bd_reg_tacs</span></span><span> </span><span class="entity"><span>set_bd_tacss</span></span><span> </span><span class="entity"><span>le_rel_OO_tacs</span></span><span> </span><span class="entity"><span>rel_OO_Grp_tacs</span></span><span> </span><span class="entity"><span>pred_set_tacs</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>wit_tac</span></span><span> </span><span class="entity"><span>thms</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>mk_wit_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>dtor_ctor_thms</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>dtor_Jset_thmss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="entity"><span>wit_thms_of_bnf</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Jbnfs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 7</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>tacs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>map_b</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rel_b</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pred_b</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>set_bs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>wit_thms</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>consts</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="entity"><span>bnf_def</span></span><span> </span><span class="entity"><span>Hardly_Inline</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>user_policy</span></span><span> </span><span class="entity"><span>Note_Some</span></span><span class="main"><span>)</span></span><span> </span><span>false</span><span> </span><span>I</span><span> </span><span class="entity"><span>tacs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>wit_tac</span></span><span> </span><span class="entity"><span>wit_thms</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>deads</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>map_b</span></span><span> </span><span class="entity"><span>rel_b</span></span><span> </span><span class="entity"><span>pred_b</span></span><span> </span><span class="entity"><span>set_bs</span></span><span> </span><span class="entity"><span>consts</span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>tacss</span></span><span> </span><span class="entity"><span>map_bs</span></span><span> </span><span class="entity"><span>rel_bs</span></span><span> </span><span class="entity"><span>pred_bs</span></span><span> </span><span class="entity"><span>set_bss</span></span><span> </span><span class="entity"><span>wit_thmss</span></span><span>
          </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>Binding.empty</span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Jmaps</span></span><span class="main"><span>)</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Jsetss_by_bnf</span></span><span class="main"><span>)</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Jbds</span></span><span class="main"><span>)</span></span><span> </span><span>~~</span><span>
            </span><span class="entity"><span>all_witss</span></span><span class="main"><span>)</span></span><span> </span><span>~~</span><span> </span><span>map</span><span> </span><span>SOME</span><span> </span><span class="entity"><span>Jrels</span></span><span class="main"><span>)</span></span><span> </span><span>~~</span><span> </span><span>map</span><span> </span><span>SOME</span><span> </span><span class="entity"><span>Jpreds</span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>timer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>time</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>timer</span></span><span> </span><span class="inner_quoted"><span>"registered new codatatypes as BNFs"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ls'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>ls</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Jbnf_common_notes</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_dtor_set_inductN</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ls'</span></span><span> </span><span class="entity"><span>dtor_Jset_induct_thms</span></span><span>
          </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thmN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Binding.qualify</span><span> </span><span>true</span><span> </span><span class="main"><span>(</span></span><span>Binding.name_of</span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Binding.name</span><span> </span><span class="entity"><span>thmN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>thms</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Jbnf_notes</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>dtor_mapN</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span>single</span><span> </span><span class="entity"><span>dtor_Jmap_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>dtor_map_uniqueN</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span>single</span><span> </span><span class="entity"><span>dtor_Jmap_unique_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>dtor_relN</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span>single</span><span> </span><span class="entity"><span>dtor_Jrel_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>dtor_set_inclN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor_Jset_incl_thmss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>dtor_set_set_inclN</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span>flat</span><span> </span><span class="entity"><span>dtor_set_Jset_incl_thmsss</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span>
          </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thms</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_dtor_setN</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span>single</span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ls'</span></span><span> </span><span class="entity"><span>dtor_Jset_thmss</span></span><span>
          </span><span>|&gt;</span><span> </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thmN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thmss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thms</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Binding.qualify</span><span> </span><span>true</span><span> </span><span class="main"><span>(</span></span><span>Binding.name_of</span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Binding.name</span><span> </span><span class="entity"><span>thmN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>thms</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="entity"><span>bs</span></span><span> </span><span class="entity"><span>thmss</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>timer</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jbnfs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Jmap_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor_Jmap_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor_Jmap_unique_thm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor_Jset_thmss'</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>dtor_Jrel_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jrel_coinduct_thm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Jbnf_common_notes</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Jbnf_notes</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor_Jset_induct_thms</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>Jphis</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>activephis</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"R"</span></span><span> </span><span class="entity"><span>JphiTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"S"</span></span><span> </span><span class="entity"><span>activephiTs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dtor_unfold_o_Jmap_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_xtor_co_iter_o_map_thms</span></span><span> </span><span class="entity"><span>Greatest_FP</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>m</span></span><span>
      </span><span class="entity"><span>dtor_unfold_unique_thm</span></span><span> </span><span class="entity"><span>dtor_Jmap_o_thms</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_pointfree2</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dtor_unfold_thms</span></span><span class="main"><span>)</span></span><span>
      </span><span class="entity"><span>sym_map_comps</span></span><span> </span><span class="entity"><span>map_cong0s</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rels</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_rel_of_bnf</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>allAs</span></span><span> </span><span class="entity"><span>allBs'</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Dss</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Jrels</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.eq_const</span></span><span> </span><span class="entity"><span>Ts</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rel_of_bnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span> </span><span class="entity"><span>passiveBs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Jbnfs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dtor_unfold_transfer_thms</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>mk_xtor_co_iter_transfer_thms</span></span><span> </span><span class="entity"><span>Greatest_FP</span></span><span> </span><span class="entity"><span>rels</span></span><span> </span><span class="entity"><span>activephis</span></span><span> </span><span class="entity"><span>activephis</span></span><span> </span><span class="entity"><span>Jrels</span></span><span> </span><span class="entity"><span>Jphis</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>mk_unfolds</span></span><span> </span><span class="entity"><span>passiveAs</span></span><span> </span><span class="entity"><span>activeAs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_unfolds</span></span><span> </span><span class="entity"><span>passiveBs</span></span><span> </span><span class="entity"><span>activeBs</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>prems</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_unfold_transfer_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>Jrel_coinduct_thm</span></span><span>
          </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>map_transfer_of_bnf</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dtor_unfold_thms</span></span><span class="main"><span>)</span></span><span>
        </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>timer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>time</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>timer</span></span><span> </span><span class="inner_quoted"><span>"relator coinduction"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_Ts</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>typ_subst_atomic</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>passiveAs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>export</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.term</span><span> </span><span class="main"><span>(</span></span><span>Local_Theory.target_morphism</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>corecs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dtor_corec_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor_corec_unique_thm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor_corec_o_Jmap_thms</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>dtor_corec_transfer_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>derive_xtor_co_recs</span></span><span> </span><span class="entity"><span>Greatest_FP</span></span><span> </span><span class="entity"><span>external_bs</span></span><span> </span><span class="entity"><span>mk_Ts</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Dss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>resDs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnfs</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span> </span><span class="entity"><span>dtors</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span> </span><span class="entity"><span>unfolds</span></span><span class="main"><span>)</span></span><span>
        </span><span class="entity"><span>dtor_unfold_unique_thm</span></span><span> </span><span class="entity"><span>dtor_unfold_thms</span></span><span> </span><span class="entity"><span>dtor_unfold_transfer_thms</span></span><span>
        </span><span class="entity"><span>dtor_Jmap_thms</span></span><span> </span><span class="entity"><span>dtor_Jrel_thms</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>timer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>time</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>timer</span></span><span> </span><span class="inner_quoted"><span>"recursor"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>common_notes</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>dtor_coinductN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>dtor_coinduct_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>dtor_rel_coinductN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Jrel_coinduct_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
      </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thmN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Binding.qualify</span><span> </span><span>true</span><span> </span><span class="main"><span>(</span></span><span>Binding.name_of</span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Binding.name</span><span> </span><span class="entity"><span>thmN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>thms</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>notes</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>ctor_dtorN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctor_dtor_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>ctor_exhaustN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctor_exhaust_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>ctor_injectN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctor_inject_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>dtor_ctorN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor_ctor_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>dtor_exhaustN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor_exhaust_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>dtor_injectN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor_inject_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>dtor_unfoldN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor_unfold_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>dtor_unfold_o_mapN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor_unfold_o_Jmap_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>dtor_unfold_transferN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor_unfold_transfer_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>dtor_unfold_uniqueN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor_unfold_unique_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
      </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>apsnd</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>single</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thmN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thmss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thms</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Binding.qualify</span><span> </span><span>true</span><span> </span><span class="main"><span>(</span></span><span>Binding.name_of</span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Binding.name</span><span> </span><span class="entity"><span>thmN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>thms</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="entity"><span>bs</span></span><span> </span><span class="entity"><span>thmss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lthy'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>internals</span></span><span> </span><span>?</span><span> </span><span>snd</span><span> </span><span>o</span><span> </span><span>Local_Theory.notes</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>common_notes</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>notes</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Jbnf_notes</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fp_res</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>{</span></span><span>Ts</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>,</span></span><span> </span><span>bnfs</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Jbnfs</span></span><span class="main"><span>,</span></span><span> </span><span>pre_bnfs</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bnfs</span></span><span class="main"><span>,</span></span><span> </span><span>absT_infos</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>absT_infos</span></span><span class="main"><span>,</span></span><span>
       </span><span>ctors</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctors</span></span><span class="main"><span>,</span></span><span> </span><span>dtors</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dtors</span></span><span class="main"><span>,</span></span><span> </span><span>xtor_un_folds</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>unfolds</span></span><span class="main"><span>,</span></span><span> </span><span>xtor_co_recs</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>export</span></span><span> </span><span class="entity"><span>corecs</span></span><span class="main"><span>,</span></span><span>
       </span><span>xtor_co_induct</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dtor_coinduct_thm</span></span><span class="main"><span>,</span></span><span> </span><span>dtor_ctors</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dtor_ctor_thms</span></span><span class="main"><span>,</span></span><span> </span><span>ctor_dtors</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctor_dtor_thms</span></span><span class="main"><span>,</span></span><span>
       </span><span>ctor_injects</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctor_inject_thms</span></span><span class="main"><span>,</span></span><span> </span><span>dtor_injects</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dtor_inject_thms</span></span><span class="main"><span>,</span></span><span> </span><span>xtor_maps</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dtor_Jmap_thms</span></span><span class="main"><span>,</span></span><span>
       </span><span>xtor_map_unique</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dtor_Jmap_unique_thm</span></span><span class="main"><span>,</span></span><span> </span><span>xtor_setss</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dtor_Jset_thmss'</span></span><span class="main"><span>,</span></span><span>
       </span><span>xtor_rels</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dtor_Jrel_thms</span></span><span class="main"><span>,</span></span><span> </span><span>xtor_un_fold_thms</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dtor_unfold_thms</span></span><span class="main"><span>,</span></span><span>
       </span><span>xtor_co_rec_thms</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dtor_corec_thms</span></span><span class="main"><span>,</span></span><span> </span><span>xtor_un_fold_unique</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dtor_unfold_unique_thm</span></span><span class="main"><span>,</span></span><span>
       </span><span>xtor_co_rec_unique</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dtor_corec_unique_thm</span></span><span class="main"><span>,</span></span><span>
       </span><span>xtor_un_fold_o_maps</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dtor_unfold_o_Jmap_thms</span></span><span class="main"><span>,</span></span><span>
       </span><span>xtor_co_rec_o_maps</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dtor_corec_o_Jmap_thms</span></span><span class="main"><span>,</span></span><span>
       </span><span>xtor_un_fold_transfers</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dtor_unfold_transfer_thms</span></span><span class="main"><span>,</span></span><span>
       </span><span>xtor_co_rec_transfers</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dtor_corec_transfer_thms</span></span><span class="main"><span>,</span></span><span> </span><span>xtor_rel_co_induct</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Jrel_coinduct_thm</span></span><span class="main"><span>,</span></span><span>
       </span><span>dtor_set_inducts</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dtor_Jset_induct_thms</span></span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>timer</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fp_res</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy'</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Outer_Syntax.local_theory</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">command_keyword</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="keyword1"><span>codatatype</span></span><span>›</span></span></span><span> </span><span class="inner_quoted"><span>"define coinductive datatypes"</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>parse_co_datatype_cmd</span></span><span> </span><span class="entity"><span>Greatest_FP</span></span><span> </span><span class="entity"><span>construct_gfp</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span></pre>
</body>

</html>