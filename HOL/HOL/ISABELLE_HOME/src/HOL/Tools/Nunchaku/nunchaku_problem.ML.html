<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹Tools/Nunchaku/nunchaku_problem.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹Tools/Nunchaku/nunchaku_problem.ML›</h1>
</div>

<pre class="source"><span class="comment1"><span>(*  Title:      HOL/Tools/Nunchaku/nunchaku_problem.ML
    Author:     Jasmin Blanchette, VU Amsterdam
    Copyright   2015, 2016, 2017

Abstract syntax tree for Nunchaku problems.
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>NUNCHAKU_PROBLEM</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>eqtype</span></span></span><span> </span><span class="entity"><span>ident</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>NType</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> ident * ty list

  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>NAtom</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * ty
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NConst</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> ident * ty list * ty
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NAbs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> tm * tm
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NMatch</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> tm * </span><span class="main"><span>(</span></span><span>ident * tm list * tm</span><span class="main"><span>)</span></span><span> list
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NApp</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> tm * tm

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>nun_copy_spec</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>{</span></span><span>abs_ty</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span>
     </span><span>rep_ty</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span>
     </span><span>subset</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
     </span><span>quotient</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
     </span><span>abs</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>,</span></span><span>
     </span><span>rep</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>}</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>nun_ctr_spec</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>{</span></span><span>ctr</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>,</span></span><span>
     </span><span>arg_tys</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span>list</span><span class="main"><span>}</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>nun_co_data_spec</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>{</span></span><span>ty</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span>
     </span><span>ctrs</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>nun_ctr_spec</span></span><span> </span><span>list</span><span class="main"><span>}</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>nun_const_spec</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>{</span></span><span>const</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>,</span></span><span>
     </span><span>props</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span>list</span><span class="main"><span>}</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>nun_consts_spec</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>{</span></span><span>consts</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     </span><span>props</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span>list</span><span class="main"><span>}</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>nun_command</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>NTVal</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> ty * </span><span class="main"><span>(</span></span><span>int option * int option</span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NCopy</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> nun_copy_spec
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NData</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> nun_co_data_spec list
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NCodata</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> nun_co_data_spec list
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NVal</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> tm * ty
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NPred</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> bool * nun_const_spec list
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NCopred</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> nun_const_spec list
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NRec</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> nun_const_spec list
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NSpec</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> nun_consts_spec
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NAxiom</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> tm
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NGoal</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> tm
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NEval</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> tm

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>nun_problem</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>{</span></span><span>commandss</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>nun_command</span></span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     </span><span>sound</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     </span><span>complete</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>}</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>name_pool</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>{</span></span><span>nice_of_ugly</span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span>Symtab.table</span><span class="main"><span>,</span></span><span>
     </span><span>ugly_of_nice</span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span>Symtab.table</span><span class="main"><span>}</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_abstract</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_and</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_arrow</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_asserting</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_assign</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_at</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_axiom</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_bar</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_choice</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_codata</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_colon</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_comma</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_concrete</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_conj</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_copred</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_copy</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_data</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_disj</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_dollar</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_dollar_anon_fun_prefix</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_dot</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_dummy</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_else</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_end</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_equals</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_eval</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_exists</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_false</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_forall</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_goal</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_hash</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_if</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_implies</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_irrelevant</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_lambda</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_lbrace</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_lbracket</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_lparen</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_match</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_mu</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_not</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_partial_quotient</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_pred</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_prop</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_quotient</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_rbrace</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_rbracket</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_rec</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_rparen</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_semicolon</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_spec</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_subset</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_then</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_true</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_type</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_unparsable</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_unique</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_unique_unsafe</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_val</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_wf</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_with</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun__witness_of</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> ident_of_str</span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>ident</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> str_of_ident</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>ident</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> encode_args</span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_const_of_str</span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>ident</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_tconst_of_str</span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>ident</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_free_of_str</span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>ident</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_tfree_of_str</span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>ident</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nun_var_of_str</span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>ident</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> str_of_nun_const</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>ident</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span>list</span><span> * </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> str_of_nun_tconst</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>ident</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span>list</span><span> * </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> str_of_nun_free</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>ident</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> str_of_nun_tfree</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>ident</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> str_of_nun_var</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>ident</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> dummy_ty</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>ty</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> prop_ty</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>ty</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_arrow_ty</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>ty</span></span><span> * </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>ty</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_arrows_ty</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span>list</span><span> * </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>ty</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nabss</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span>list</span><span> * </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>tm</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> napps</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tm</span></span><span> * </span><span class="entity"><span>tm</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>tm</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> ty_of</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>ty</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> safe_ty_of</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>ty</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> fold_map_ty_idents</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> * </span><span>'a</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>ty</span></span><span> * </span><span>'a</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> fold_map_tm_idents</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> * </span><span>'a</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>tm</span></span><span> * </span><span>'a</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> fold_map_nun_command_idents</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> * </span><span>'a</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>nun_command</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="entity"><span>nun_command</span></span><span> * </span><span>'a</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> fold_map_nun_problem_idents</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> * </span><span>'a</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>nun_problem</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="entity"><span>nun_problem</span></span><span> * </span><span>'a</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> allocate_nice</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>name_pool</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> * </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> * </span><span class="entity"><span>name_pool</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rcomb_tms</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>tm</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> abs_tms</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>tm</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> eta_expandN_tm</span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>tm</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> eta_expand_builtin_tm</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>tm</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> str_of_ty</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> str_of_tm</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> str_of_tmty</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nice_nun_problem</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>nun_problem</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>nun_problem</span></span><span> * </span><span class="entity"><span>name_pool</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> str_of_nun_problem</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>nun_problem</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Nunchaku_Problem</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>NUNCHAKU_PROBLEM</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Nunchaku_Util</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>ident</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>string</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>NType</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> ident * ty list</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>NAtom</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * ty
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NConst</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> ident * ty list * ty
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NAbs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> tm * tm
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NMatch</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> tm * </span><span class="main"><span>(</span></span><span>ident * tm list * tm</span><span class="main"><span>)</span></span><span> list
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NApp</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> tm * tm</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>nun_copy_spec</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>abs_ty</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span>
   </span><span>rep_ty</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span>
   </span><span>subset</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
   </span><span>quotient</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
   </span><span>abs</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>,</span></span><span>
   </span><span>rep</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>nun_ctr_spec</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>ctr</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>,</span></span><span>
   </span><span>arg_tys</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span>list</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>nun_co_data_spec</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>ty</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span>
   </span><span>ctrs</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>nun_ctr_spec</span></span><span> </span><span>list</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>nun_const_spec</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>const</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>,</span></span><span>
   </span><span>props</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span>list</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>nun_consts_spec</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>consts</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   </span><span>props</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span>list</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>nun_command</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>NTVal</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> ty * </span><span class="main"><span>(</span></span><span>int option * int option</span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NCopy</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> nun_copy_spec
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NData</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> nun_co_data_spec list
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NCodata</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> nun_co_data_spec list
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NVal</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> tm * ty
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NPred</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> bool * nun_const_spec list
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NCopred</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> nun_const_spec list
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NRec</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> nun_const_spec list
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NSpec</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> nun_consts_spec
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NAxiom</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> tm
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NGoal</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> tm
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NEval</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> tm</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>nun_problem</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>commandss</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>nun_command</span></span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   </span><span>sound</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   </span><span>complete</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>name_pool</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>nice_of_ugly</span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span>Symtab.table</span><span class="main"><span>,</span></span><span>
   </span><span>ugly_of_nice</span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span>Symtab.table</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_abstract</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"abstract"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_and</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"and"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_arrow</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"-&gt;"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_asserting</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"asserting"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_assign</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>":="</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_at</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"@"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_axiom</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"axiom"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_bar</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"|"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_choice</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"choice"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_codata</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"codata"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_colon</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>":"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_comma</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>","</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_concrete</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"concrete"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_conj</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"&amp;&amp;"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_copred</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"copred"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_copy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"copy"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_data</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"data"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_disj</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"||"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_dollar</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"$"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_dollar_anon_fun_prefix</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"$anon_fun_"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_dot</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"."</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_dummy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"_"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_else</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"else"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_end</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"end"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_equals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_eval</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"eval"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_exists</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"exists"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_false</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"false"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_forall</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"forall"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"goal"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_hash</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"#"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_if</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"if"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_implies</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"=&gt;"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_irrelevant</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"?__"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_lambda</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"fun"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_lbrace</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"{"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_lbracket</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"["</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_lparen</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_match</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"match"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_mu</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"mu"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_not</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"~"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_partial_quotient</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"partial_quotient"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_pred</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"pred"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_prop</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"prop"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_quotient</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"quotient"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_rbrace</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"}"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_rbracket</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"]"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_rec</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"rec"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_rparen</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_semicolon</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>";"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_spec</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"spec"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_subset</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"subset"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_then</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"then"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_true</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"true"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_type</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"type"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_unique</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"unique"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_unique_unsafe</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"unique_unsafe"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_unparsable</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"?__unparsable"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_val</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"val"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_wf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"wf"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_with</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"with"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun__witness_of</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"_witness_of"</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_parens</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>enclose</span><span> </span><span class="entity"><span>nun_lparen</span></span><span> </span><span class="entity"><span>nun_rparen</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>nun_parens_if_space</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span>|&gt;</span><span> </span><span>String.isSubstring</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>nun_parens</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>str_of_nun_arg_list</span></span><span> </span><span class="entity"><span>str_of_arg</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>prefix</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>nun_parens_if_space</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>str_of_arg</span></span><span class="main"><span>)</span></span><span> </span><span>#&gt;</span><span> </span><span>space_implode</span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>str_of_nun_and_list</span></span><span> </span><span class="entity"><span>str_of_elem</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>map</span><span> </span><span class="entity"><span>str_of_elem</span></span><span> </span><span>#&gt;</span><span> </span><span>space_implode</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"\n"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nun_and</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>is_nun_const_quantifier</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>nun_forall</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nun_exists</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>is_nun_const_connective</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>nun_conj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nun_disj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nun_implies</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_builtin_arity</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>nun_asserting</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
   </span><span class="main"><span>(</span></span><span class="entity"><span>nun_conj</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
   </span><span class="main"><span>(</span></span><span class="entity"><span>nun_disj</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
   </span><span class="main"><span>(</span></span><span class="entity"><span>nun_equals</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
   </span><span class="main"><span>(</span></span><span class="entity"><span>nun_exists</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
   </span><span class="main"><span>(</span></span><span class="entity"><span>nun_false</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
   </span><span class="main"><span>(</span></span><span class="entity"><span>nun_forall</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
   </span><span class="main"><span>(</span></span><span class="entity"><span>nun_if</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>3</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
   </span><span class="main"><span>(</span></span><span class="entity"><span>nun_implies</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
   </span><span class="main"><span>(</span></span><span class="entity"><span>nun_not</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
   </span><span class="main"><span>(</span></span><span class="entity"><span>nun_true</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>arity_of_nun_builtin</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>AList.lookup</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>nun_builtin_arity</span></span><span> </span><span>#&gt;</span><span> </span><span>the_default</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_const_prefix</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"c."</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_free_prefix</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"f."</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_var_prefix</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"v."</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_tconst_prefix</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"C."</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_tfree_prefix</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"F."</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_custom_id_suffix</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"_"</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ident_of_str</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>I</span><span> </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>ident</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>str_of_ident</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>I</span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>ident</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>encode_args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>enclose</span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span>o</span><span> </span><span>commas</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>decode_args</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>delta</span></span><span> </span><span class="inner_quoted"><span>#"("</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>delta</span></span><span> </span><span class="inner_quoted"><span>#")"</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>~1</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>delta</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dec</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>#"("</span></span><span> </span><span>::</span><span> </span><span class="inner_quoted"><span>#")"</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>cs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>String.implode</span><span> </span><span class="entity"><span>cs</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>dec</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>#"("</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>cs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dec</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="entity"><span>cs</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>dec</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="entity"><span>cs</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>String.implode</span><span> </span><span class="entity"><span>cs</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>dec</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Fail</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"ill-formed arguments in "</span></span><span> </span><span>^</span><span> </span><span>quote</span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>dec</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>#")"</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>cs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>rev</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>String.implode</span><span> </span><span>o</span><span> </span><span>rev</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>String.implode</span><span> </span><span class="entity"><span>cs</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>dec</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>#","</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>cs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dec</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="entity"><span>cs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>dec</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>cs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>arg</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dec</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span> </span><span>+</span><span> </span><span class="entity"><span>delta</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>cs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>arg</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>dec</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>(</span></span><span>String.explode</span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>nun_const_of_str</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>suffix</span><span> </span><span class="entity"><span>nun_custom_id_suffix</span></span><span> </span><span>#&gt;</span><span> </span><span>prefix</span><span> </span><span class="entity"><span>nun_const_prefix</span></span><span> </span><span>#&gt;</span><span> </span><span>prefix</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>encode_args</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>nun_tconst_of_str</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>suffix</span><span> </span><span class="entity"><span>nun_custom_id_suffix</span></span><span> </span><span>#&gt;</span><span> </span><span>prefix</span><span> </span><span class="entity"><span>nun_tconst_prefix</span></span><span> </span><span>#&gt;</span><span> </span><span>prefix</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>encode_args</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_free_of_str</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>suffix</span><span> </span><span class="entity"><span>nun_custom_id_suffix</span></span><span> </span><span>#&gt;</span><span> </span><span>prefix</span><span> </span><span class="entity"><span>nun_free_prefix</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_tfree_of_str</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>suffix</span><span> </span><span class="entity"><span>nun_custom_id_suffix</span></span><span> </span><span>#&gt;</span><span> </span><span>prefix</span><span> </span><span class="entity"><span>nun_tfree_prefix</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nun_var_of_str</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>suffix</span><span> </span><span class="entity"><span>nun_custom_id_suffix</span></span><span> </span><span>#&gt;</span><span> </span><span>prefix</span><span> </span><span class="entity"><span>nun_var_prefix</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>str_of_nun_const</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>decode_args</span></span><span> </span><span>##&gt;</span><span> </span><span>unprefix</span><span> </span><span class="entity"><span>nun_const_prefix</span></span><span> </span><span>##&gt;</span><span> </span><span>unsuffix</span><span> </span><span class="entity"><span>nun_custom_id_suffix</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>str_of_nun_tconst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>decode_args</span></span><span> </span><span>##&gt;</span><span> </span><span>unprefix</span><span> </span><span class="entity"><span>nun_tconst_prefix</span></span><span> </span><span>##&gt;</span><span> </span><span>unsuffix</span><span> </span><span class="entity"><span>nun_custom_id_suffix</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>str_of_nun_free</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>unprefix</span><span> </span><span class="entity"><span>nun_free_prefix</span></span><span> </span><span>#&gt;</span><span> </span><span>unsuffix</span><span> </span><span class="entity"><span>nun_custom_id_suffix</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>str_of_nun_tfree</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>unprefix</span><span> </span><span class="entity"><span>nun_tfree_prefix</span></span><span> </span><span>#&gt;</span><span> </span><span>unsuffix</span><span> </span><span class="entity"><span>nun_custom_id_suffix</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>str_of_nun_var</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>unprefix</span><span> </span><span class="entity"><span>nun_var_prefix</span></span><span> </span><span>#&gt;</span><span> </span><span>unsuffix</span><span> </span><span class="entity"><span>nun_custom_id_suffix</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>index_name</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>s</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>index_name</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>size</span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span>String.substring</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>m</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>j</span></span><span> </span><span>^</span><span> </span><span>String.substring</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>m</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span>-</span><span> </span><span class="entity"><span>m</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dummy_ty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>NType</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nun_dummy</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prop_ty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>NType</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nun_prop</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_arrow_ty</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dom</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ran</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>NType</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nun_arrow</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>dom</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ran</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_arrows_ty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Library.foldr</span><span> </span><span class="entity"><span>mk_arrow_ty</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nabss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Library.foldr</span><span> </span><span class="entity"><span>NAbs</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>napps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Library.foldl</span><span> </span><span class="entity"><span>NApp</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>domain_ty</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NType</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ty</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>domain_ty</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>range_ty</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NType</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ty</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>range_ty</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>domain_tys</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>domain_tys</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>domain_ty</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>domain_tys</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>range_ty</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>ty_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NAtom</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ty</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>ty_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NConst</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ty</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>ty_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NAbs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_arrow_ty</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ty_of</span></span><span> </span><span class="entity"><span>var</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty_of</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>ty_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NMatch</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body1</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ty_of</span></span><span> </span><span class="entity"><span>body1</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>ty_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NApp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>range_ty</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ty_of</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>safe_ty_of</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>try</span><span> </span><span class="entity"><span>ty_of</span></span><span> </span><span>#&gt;</span><span> </span><span>the_default</span><span> </span><span class="entity"><span>dummy_ty</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>strip_nun_binders</span></span><span> </span><span class="entity"><span>binder</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>app</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>NApp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NConst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>NAbs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>id</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>binder</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span class="entity"><span>strip_nun_binders</span></span><span> </span><span class="entity"><span>binder</span></span><span> </span><span class="entity"><span>body</span></span><span>
      </span><span>|&gt;&gt;</span><span> </span><span>cons</span><span> </span><span class="entity"><span>var</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>app</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>strip_nun_binders</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fold_map_option</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=</span></span><span> </span><span>pair</span><span> </span><span>NONE</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fold_map_option</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span>#&gt;&gt;</span><span> </span><span>SOME</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fold_map_ty_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NType</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>id</span></span><span>
    </span><span>##&gt;&gt;</span><span> </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_map_ty_idents</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tys</span></span><span>
    </span><span>#&gt;&gt;</span><span> </span><span class="entity"><span>NType</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fold_map_match_branch_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>id</span></span><span>
    </span><span>##&gt;&gt;</span><span> </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_map_tm_idents</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span>
    </span><span>##&gt;&gt;</span><span> </span><span class="entity"><span>fold_map_tm_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>body</span></span><span>
    </span><span>#&gt;&gt;</span><span> </span><span>Scan.triple1</span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>fold_map_tm_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NAtom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>fold_map_ty_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>ty</span></span><span>
    </span><span>#&gt;&gt;</span><span> </span><span>curry</span><span> </span><span class="entity"><span>NAtom</span></span><span> </span><span class="entity"><span>j</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fold_map_tm_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NConst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>id</span></span><span>
    </span><span>##&gt;&gt;</span><span> </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_map_ty_idents</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tys</span></span><span>
    </span><span>##&gt;&gt;</span><span> </span><span class="entity"><span>fold_map_ty_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>ty</span></span><span>
    </span><span>#&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span>Scan.triple1</span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>NConst</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fold_map_tm_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NAbs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>fold_map_tm_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>var</span></span><span>
    </span><span>##&gt;&gt;</span><span> </span><span class="entity"><span>fold_map_tm_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>body</span></span><span>
    </span><span>#&gt;&gt;</span><span> </span><span class="entity"><span>NAbs</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fold_map_tm_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NMatch</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>obj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>branches</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>fold_map_tm_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>obj</span></span><span>
    </span><span>##&gt;&gt;</span><span> </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_map_match_branch_idents</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>branches</span></span><span>
    </span><span>#&gt;&gt;</span><span> </span><span class="entity"><span>NMatch</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fold_map_tm_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NApp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>arg</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>fold_map_tm_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>const</span></span><span>
    </span><span>##&gt;&gt;</span><span> </span><span class="entity"><span>fold_map_tm_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>arg</span></span><span>
    </span><span>#&gt;&gt;</span><span> </span><span class="entity"><span>NApp</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fold_map_nun_copy_spec_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>abs_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rep_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>subset</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>quotient</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>abs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rep</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>fold_map_ty_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>abs_ty</span></span><span>
  </span><span>##&gt;&gt;</span><span> </span><span class="entity"><span>fold_map_ty_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>rep_ty</span></span><span>
  </span><span>##&gt;&gt;</span><span> </span><span class="entity"><span>fold_map_option</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_map_tm_idents</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>subset</span></span><span>
  </span><span>##&gt;&gt;</span><span> </span><span class="entity"><span>fold_map_option</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_map_tm_idents</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>quotient</span></span><span>
  </span><span>##&gt;&gt;</span><span> </span><span class="entity"><span>fold_map_tm_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>abs</span></span><span>
  </span><span>##&gt;&gt;</span><span> </span><span class="entity"><span>fold_map_tm_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>rep</span></span><span>
  </span><span>#&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>abs_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rep_ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>subset</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>quotient</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>abs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rep</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="main"><span>{</span></span><span>abs_ty</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>abs_ty</span></span><span class="main"><span>,</span></span><span> </span><span>rep_ty</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rep_ty</span></span><span class="main"><span>,</span></span><span> </span><span>subset</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>subset</span></span><span class="main"><span>,</span></span><span> </span><span>quotient</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>quotient</span></span><span class="main"><span>,</span></span><span> </span><span>abs</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>abs</span></span><span class="main"><span>,</span></span><span> </span><span>rep</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rep</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fold_map_nun_ctr_spec_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>ctr</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>arg_tys</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>fold_map_tm_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>ctr</span></span><span>
  </span><span>##&gt;&gt;</span><span> </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_map_ty_idents</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>arg_tys</span></span><span>
  </span><span>#&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctr</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>arg_tys</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>{</span></span><span>ctr</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctr</span></span><span class="main"><span>,</span></span><span> </span><span>arg_tys</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>arg_tys</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fold_map_nun_co_data_spec_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctrs</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>fold_map_ty_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>ty</span></span><span>
  </span><span>##&gt;&gt;</span><span> </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_map_nun_ctr_spec_idents</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctrs</span></span><span>
  </span><span>#&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctrs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>{</span></span><span>ty</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> </span><span>ctrs</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctrs</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fold_map_nun_const_spec_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>props</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>fold_map_tm_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>const</span></span><span>
  </span><span>##&gt;&gt;</span><span> </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_map_tm_idents</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>props</span></span><span>
  </span><span>#&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>props</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>{</span></span><span>const</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span>props</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>props</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fold_map_nun_consts_spec_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>consts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>props</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_map_tm_idents</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>consts</span></span><span>
  </span><span>##&gt;&gt;</span><span> </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_map_tm_idents</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>props</span></span><span>
  </span><span>#&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>consts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>props</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>{</span></span><span>consts</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>consts</span></span><span class="main"><span>,</span></span><span> </span><span>props</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>props</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fold_map_nun_command_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NTVal</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cards</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>fold_map_ty_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>ty</span></span><span>
    </span><span>#&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span>rpair</span><span> </span><span class="entity"><span>cards</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>NTVal</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fold_map_nun_command_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NCopy</span></span><span> </span><span class="entity"><span>spec</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>fold_map_nun_copy_spec_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>spec</span></span><span>
    </span><span>#&gt;&gt;</span><span> </span><span class="entity"><span>NCopy</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fold_map_nun_command_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NData</span></span><span> </span><span class="entity"><span>specs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_map_nun_co_data_spec_idents</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>specs</span></span><span>
    </span><span>#&gt;&gt;</span><span> </span><span class="entity"><span>NData</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fold_map_nun_command_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NCodata</span></span><span> </span><span class="entity"><span>specs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_map_nun_co_data_spec_idents</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>specs</span></span><span>
    </span><span>#&gt;&gt;</span><span> </span><span class="entity"><span>NCodata</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fold_map_nun_command_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NVal</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>fold_map_tm_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>tm</span></span><span>
    </span><span>##&gt;&gt;</span><span> </span><span class="entity"><span>fold_map_ty_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>ty</span></span><span>
    </span><span>#&gt;&gt;</span><span> </span><span class="entity"><span>NVal</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fold_map_nun_command_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NPred</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>wf</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>specs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_map_nun_const_spec_idents</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>specs</span></span><span>
    </span><span>#&gt;&gt;</span><span> </span><span>curry</span><span> </span><span class="entity"><span>NPred</span></span><span> </span><span class="entity"><span>wf</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fold_map_nun_command_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NCopred</span></span><span> </span><span class="entity"><span>specs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_map_nun_const_spec_idents</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>specs</span></span><span>
    </span><span>#&gt;&gt;</span><span> </span><span class="entity"><span>NCopred</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fold_map_nun_command_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NRec</span></span><span> </span><span class="entity"><span>specs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_map_nun_const_spec_idents</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>specs</span></span><span>
    </span><span>#&gt;&gt;</span><span> </span><span class="entity"><span>NRec</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fold_map_nun_command_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NSpec</span></span><span> </span><span class="entity"><span>spec</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>fold_map_nun_consts_spec_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>spec</span></span><span>
    </span><span>#&gt;&gt;</span><span> </span><span class="entity"><span>NSpec</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fold_map_nun_command_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NAxiom</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>fold_map_tm_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>tm</span></span><span>
    </span><span>#&gt;&gt;</span><span> </span><span class="entity"><span>NAxiom</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fold_map_nun_command_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NGoal</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>fold_map_tm_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>tm</span></span><span>
    </span><span>#&gt;&gt;</span><span> </span><span class="entity"><span>NGoal</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fold_map_nun_command_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NEval</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>fold_map_tm_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>tm</span></span><span>
    </span><span>#&gt;&gt;</span><span> </span><span class="entity"><span>NEval</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fold_map_nun_problem_idents</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="entity"><span>commandss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sound</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>complete</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>nun_problem</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_map_nun_command_idents</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>commandss</span></span><span>
  </span><span>#&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>commandss'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>{</span></span><span>commandss</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>commandss'</span></span><span class="main"><span>,</span></span><span> </span><span>sound</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sound</span></span><span class="main"><span>,</span></span><span> </span><span>complete</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>complete</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dest_rassoc_args</span></span><span> </span><span class="entity"><span>oper</span></span><span> </span><span class="entity"><span>arg0</span></span><span> </span><span class="entity"><span>rest</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>rest</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span class="entity"><span>NApp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NApp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oper'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>arg1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rest'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>oper'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>oper</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>arg0</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>dest_rassoc_args</span></span><span> </span><span class="entity"><span>oper</span></span><span> </span><span class="entity"><span>arg1</span></span><span> </span><span class="entity"><span>rest'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>arg0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rest</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>arg0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rest</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rcomb_tms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>arg</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>func</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>NApp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>func</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>arg</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>abs_tms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>NAbs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fresh_var_names_wrt_tm</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>max_var_br</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="entity"><span>max_var</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>body</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>max_var</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NAtom</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>I</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>max_var</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NConst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>max</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>String.isPrefix</span><span> </span><span class="entity"><span>nun_var_prefix</span></span><span> </span><span class="entity"><span>id</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>size</span><span> </span><span class="entity"><span>id</span></span><span> </span><span>&gt;</span><span> </span><span>size</span><span> </span><span class="entity"><span>max</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>id</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>max</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>max_var</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NApp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>func</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>arg</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="entity"><span>max_var</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>func</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>arg</span></span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>max_var</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NAbs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="entity"><span>max_var</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>var</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>max_var</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NMatch</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>obj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>branches</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>max_var</span></span><span> </span><span class="entity"><span>obj</span></span><span> </span><span>#&gt;</span><span> </span><span>fold</span><span> </span><span class="entity"><span>max_var_br</span></span><span> </span><span class="entity"><span>branches</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dummy_name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nun_var_of_str</span></span><span> </span><span>Name.uu</span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>max_name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>max_var</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="entity"><span>dummy_name</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>index_name</span></span><span> </span><span class="entity"><span>max_name</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>eta_expandN_tm</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tm</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>eta_expandN_tm</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>var_names</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fresh_var_names_wrt_tm</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>arg_tys</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>domain_tys</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ty_of</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>id</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>NConst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>var_names</span></span><span> </span><span class="entity"><span>arg_tys</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="entity"><span>abs_tms</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rcomb_tms</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>eta_expand_builtin_tm</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>expand_quant_arg</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NAbs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>NAbs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>expand_quant_arg</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>expand_quant_arg</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NMatch</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>obj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>branches</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>NMatch</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>obj</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>apply</span></span><span> 3</span><span class="main"><span>(</span></span><span>3</span><span class="main"><span>)</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>expand_quant_arg</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>branches</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>expand_quant_arg</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>NApp</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>NAbs</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tm</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>expand_quant_arg</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NApp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>quant</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>arg</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>NApp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>quant</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>eta_expandN_tm</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="entity"><span>arg</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>expand_quant_arg</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>expand</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NApp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>func</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>arg</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>expand</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>expand</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>arg</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>func</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>expand</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>func</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>NConst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>missing</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Int.max</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>arity_of_nun_builtin</span></span><span> </span><span class="entity"><span>id</span></span><span> </span><span>-</span><span> </span><span>length</span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="entity"><span>rcomb_tms</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="entity"><span>func</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>eta_expandN_tm</span></span><span> </span><span class="entity"><span>missing</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>is_nun_const_quantifier</span></span><span> </span><span class="entity"><span>id</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>expand_quant_arg</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>expand</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>func</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>NAtom</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rcomb_tms</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="entity"><span>func</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>expand</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NAbs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rcomb_tms</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NAbs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>expand</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>expand</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NMatch</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>obj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>branches</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>rcomb_tms</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NMatch</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>obj</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>apply</span></span><span> 3</span><span class="main"><span>(</span></span><span>3</span><span class="main"><span>)</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>expand</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>branches</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>expand</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>str_of_ty</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>str_of</span></span><span> </span><span class="entity"><span>maybe_parens</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NType</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>id</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nun_arrow</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>tys</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span class="main"><span>[</span></span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty'</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>maybe_parens</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str_of</span></span><span> </span><span class="entity"><span>nun_parens</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nun_arrow</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str_of</span></span><span> </span><span>I</span><span> </span><span class="entity"><span>ty'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="entity"><span>id</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str_of_nun_arg_list</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str_of</span></span><span> </span><span>I</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tys</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>str_of</span></span><span> </span><span>I</span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str_of_tmty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str_of_tm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_triv_head</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NConst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>arity_of_nun_builtin</span></span><span> </span><span class="entity"><span>id</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_triv_head</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NAtom</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_triv_head</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NApp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>is_triv_head</span></span><span> </span><span class="entity"><span>const</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_triv_head</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NAbs</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_triv_head</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NMatch</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>str_of_at_const</span></span><span> </span><span class="entity"><span>id</span></span><span> </span><span class="entity"><span>tys</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>nun_at</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str_of_ident</span></span><span> </span><span class="entity"><span>id</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str_of_nun_arg_list</span></span><span> </span><span class="entity"><span>str_of_ty</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>str_of_app</span></span><span> </span><span class="entity"><span>ty_opt</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="entity"><span>arg</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ty_opt'</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>try</span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_arrow_ty</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ty_of</span></span><span> </span><span class="entity"><span>arg</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ty_opt</span></span><span>
          </span><span>|&gt;</span><span> </span><span>the_default</span><span> </span><span>NONE</span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>str_of</span></span><span> </span><span class="entity"><span>ty_opt'</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="entity"><span>NAbs</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>nun_parens</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>I</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
        </span><span class="entity"><span>str_of_nun_arg_list</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str_of</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>arg</span></span><span class="main"><span>]</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>str_of_br</span></span><span> </span><span class="entity"><span>ty_opt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nun_bar</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>id</span></span><span> </span><span>^</span><span> </span><span>space_implode</span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>prefix</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>str_of</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span>
      </span><span class="entity"><span>nun_arrow</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str_of</span></span><span> </span><span class="entity"><span>ty_opt</span></span><span> </span><span class="entity"><span>body</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>str_of_tmty</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ty_of</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>str_of</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nun_colon</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str_of_ty</span></span><span> </span><span class="entity"><span>ty</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>str_of</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NAtom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nun_dollar</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>j</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NConst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>str_of_ident</span></span><span> </span><span class="entity"><span>id</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>ty0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NConst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ty0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>str_of_ident</span></span><span> </span><span class="entity"><span>id</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>str_of_at_const</span></span><span> </span><span class="entity"><span>id</span></span><span> </span><span class="entity"><span>tys</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NConst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>str_of_at_const</span></span><span> </span><span class="entity"><span>id</span></span><span> </span><span class="entity"><span>tys</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of</span></span><span> </span><span class="entity"><span>ty_opt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NAbs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>nun_lambda</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>ty_opt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span>SOME</span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>str_of</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>domain_ty</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>nun_parens</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>str_of_tmty</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>var</span></span><span> </span><span>^</span><span>
        </span><span class="entity"><span>nun_dot</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str_of</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="entity"><span>range_ty</span></span><span> </span><span class="entity"><span>ty_opt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>body</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of</span></span><span> </span><span class="entity"><span>ty_opt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NMatch</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>obj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>branches</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>nun_match</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str_of</span></span><span> </span><span>NONE</span><span> </span><span class="entity"><span>obj</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nun_with</span></span><span> </span><span>^</span><span>
        </span><span>space_implode</span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str_of_br</span></span><span> </span><span class="entity"><span>ty_opt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>branches</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nun_end</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of</span></span><span> </span><span class="entity"><span>ty_opt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>app</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>NApp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>func</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>argN</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>func</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>argN</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>NApp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oper</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>NConst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>arg1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>arg2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>id</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nun_asserting</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="entity"><span>str_of</span></span><span> </span><span class="entity"><span>ty_opt</span></span><span> </span><span class="entity"><span>arg1</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nun_asserting</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str_of</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>prop_ty</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>arg2</span></span><span>
            </span><span>|&gt;</span><span> </span><span class="entity"><span>nun_parens</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>id</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nun_equals</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>str_of</span></span><span> </span><span>NONE</span><span> </span><span class="entity"><span>arg1</span></span><span> </span><span>|&gt;</span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_triv_head</span></span><span> </span><span class="entity"><span>arg1</span></span><span class="main"><span>)</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>nun_parens</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>id</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>str_of</span></span><span> </span><span class="main"><span>(</span></span><span>try</span><span> </span><span class="entity"><span>ty_of</span></span><span> </span><span class="entity"><span>arg2</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>arg2</span></span><span> </span><span>|&gt;</span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_triv_head</span></span><span> </span><span class="entity"><span>arg2</span></span><span class="main"><span>)</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>nun_parens</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_nun_const_connective</span></span><span> </span><span class="entity"><span>id</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_rassoc_args</span></span><span> </span><span class="entity"><span>oper</span></span><span> </span><span class="entity"><span>arg1</span></span><span> </span><span class="entity"><span>arg2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span>space_implode</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>id</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>arg</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>str_of</span></span><span> </span><span>NONE</span><span> </span><span class="entity"><span>arg</span></span><span> </span><span>|&gt;</span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_triv_head</span></span><span> </span><span class="entity"><span>arg</span></span><span class="main"><span>)</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>nun_parens</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
            </span><span class="entity"><span>str_of_app</span></span><span> </span><span class="entity"><span>ty_opt</span></span><span> </span><span class="entity"><span>func</span></span><span> </span><span class="entity"><span>argN</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NApp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NApp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NConst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>arg1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>arg2</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>arg3</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>id</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nun_if</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="entity"><span>nun_if</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str_of</span></span><span> </span><span>NONE</span><span> </span><span class="entity"><span>arg1</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nun_then</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str_of</span></span><span> </span><span>NONE</span><span> </span><span class="entity"><span>arg2</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span>
            </span><span class="entity"><span>nun_else</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str_of</span></span><span> </span><span>NONE</span><span> </span><span class="entity"><span>arg3</span></span><span>
            </span><span>|&gt;</span><span> </span><span class="entity"><span>nun_parens</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
            </span><span class="entity"><span>str_of_app</span></span><span> </span><span class="entity"><span>ty_opt</span></span><span> </span><span class="entity"><span>func</span></span><span> </span><span class="entity"><span>argN</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NConst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>NAbs</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_nun_const_quantifier</span></span><span> </span><span class="entity"><span>id</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vars</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>strip_nun_binders</span></span><span> </span><span class="entity"><span>id</span></span><span> </span><span class="entity"><span>app</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="entity"><span>id</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span>space_implode</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nun_parens</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>str_of_tmty</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nun_dot</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span>
              </span><span class="entity"><span>str_of</span></span><span> </span><span>NONE</span><span> </span><span class="entity"><span>body</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
            </span><span class="entity"><span>str_of_app</span></span><span> </span><span class="entity"><span>ty_opt</span></span><span> </span><span class="entity"><span>func</span></span><span> </span><span class="entity"><span>argN</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>str_of_app</span></span><span> </span><span class="entity"><span>ty_opt</span></span><span> </span><span class="entity"><span>func</span></span><span> </span><span class="entity"><span>argN</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>str_of_tmty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str_of</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>empty_name_pool</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>nice_of_ugly</span><span> </span><span class="main"><span>=</span></span><span> </span><span>Symtab.empty</span><span class="main"><span>,</span></span><span> </span><span>ugly_of_nice</span><span> </span><span class="main"><span>=</span></span><span> </span><span>Symtab.empty</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nice_of_ugly_suggestion</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>unascii_of</span></span><span> </span><span>#&gt;</span><span> </span><span>Long_Name.base_name</span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>ascii_of</span></span><span> </span><span>#&gt;</span><span> </span><span>unsuffix</span><span> </span><span class="entity"><span>nun_custom_id_suffix</span></span><span>
  </span><span>#&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span>Char.isAlpha</span><span> </span><span class="main"><span>(</span></span><span>String.sub</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"x"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>allocate_nice</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="entity"><span>nice_of_ugly</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ugly_of_nice</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>name_pool</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ugly</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nice_sugg0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>alloc</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nice_sugg</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>index_name</span></span><span> </span><span class="entity"><span>nice_sugg0</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Symtab.lookup</span><span> </span><span class="entity"><span>ugly_of_nice</span></span><span> </span><span class="entity"><span>nice_sugg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>nice_sugg</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>{</span></span><span>nice_of_ugly</span><span> </span><span class="main"><span>=</span></span><span> </span><span>Symtab.update_new</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ugly</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nice_sugg</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>nice_of_ugly</span></span><span class="main"><span>,</span></span><span>
            </span><span>ugly_of_nice</span><span> </span><span class="main"><span>=</span></span><span> </span><span>Symtab.update_new</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nice_sugg</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ugly</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ugly_of_nice</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>alloc</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>alloc</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>nice_ident</span></span><span> </span><span class="entity"><span>ugly</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pool</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>nice_of_ugly</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>String.isSuffix</span><span> </span><span class="entity"><span>nun_custom_id_suffix</span></span><span> </span><span class="entity"><span>ugly</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Symtab.lookup</span><span> </span><span class="entity"><span>nice_of_ugly</span></span><span> </span><span class="entity"><span>ugly</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>allocate_nice</span></span><span> </span><span class="entity"><span>pool</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ugly</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nice_of_ugly_suggestion</span></span><span> </span><span class="entity"><span>ugly</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>nice</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nice</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pool</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>ugly</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pool</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>nice_nun_problem</span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>fold_map_nun_problem_idents</span></span><span> </span><span class="entity"><span>nice_ident</span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span class="entity"><span>empty_name_pool</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>str_of_tval</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NType</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>str_of_ident</span></span><span> </span><span class="entity"><span>id</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nun_colon</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span>
  </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span>prefix</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nun_type</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nun_arrow</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tys</span></span><span> </span><span class="entity"><span>nun_type</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_triv_subset</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NAbs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>is_triv_subset</span></span><span> </span><span class="entity"><span>body</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_triv_subset</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NConst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nun_true</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_triv_subset</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>str_of_nun_copy_spec</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>abs_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rep_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>subset</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>quotient</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>abs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rep</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>str_of_ty</span></span><span> </span><span class="entity"><span>abs_ty</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nun_assign</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str_of_ty</span></span><span> </span><span class="entity"><span>rep_ty</span></span><span> </span><span>^</span><span>
  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>subset</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_triv_subset</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>"\n  "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nun_subset</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nun_parens_if_space</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str_of_tm</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
  </span><span class="comment1"><span>(* TODO: use nun_quotient when possible *)</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>quotient</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>q</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"\n  "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nun_partial_quotient</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str_of_tm</span></span><span> </span><span class="entity"><span>q</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
  </span><span class="inner_quoted"><span>"\n  "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nun_abstract</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str_of_tm</span></span><span> </span><span class="entity"><span>abs</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"\n  "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nun_concrete</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str_of_tm</span></span><span> </span><span class="entity"><span>rep</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>str_of_nun_ctr_spec</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>ctr</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>arg_tys</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>str_of_tm</span></span><span> </span><span class="entity"><span>ctr</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str_of_nun_arg_list</span></span><span> </span><span class="entity"><span>str_of_ty</span></span><span> </span><span class="entity"><span>arg_tys</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>str_of_nun_co_data_spec</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctrs</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>str_of_ty</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nun_assign</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"\n  "</span></span><span> </span><span>^</span><span>
  </span><span>space_implode</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"\n"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nun_bar</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>str_of_nun_ctr_spec</span></span><span> </span><span class="entity"><span>ctrs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>str_of_nun_const_spec</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>props</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>str_of_tmty</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nun_assign</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"\n  "</span></span><span> </span><span>^</span><span>
  </span><span>space_implode</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nun_semicolon</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"\n  "</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>str_of_tm</span></span><span> </span><span class="entity"><span>props</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>str_of_nun_consts_spec</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>consts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>props</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>space_implode</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nun_and</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"\n     "</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>str_of_tmty</span></span><span> </span><span class="entity"><span>consts</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nun_assign</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"\n  "</span></span><span> </span><span>^</span><span>
  </span><span>space_implode</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nun_semicolon</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"\n  "</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>str_of_tm</span></span><span> </span><span class="entity"><span>props</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>str_of_nun_cards_suffix</span></span><span> </span><span class="main"><span>(</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of_nun_cards_suffix</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>c2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>s1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span>prefix</span><span> </span><span class="inner_quoted"><span>"min_card "</span></span><span> </span><span>o</span><span> </span><span>signed_string_of_int</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>c1</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>s2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span>prefix</span><span> </span><span class="inner_quoted"><span>"max_card "</span></span><span> </span><span>o</span><span> </span><span>signed_string_of_int</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>c2</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span>enclose</span><span> </span><span class="inner_quoted"><span>" ["</span></span><span> </span><span class="inner_quoted"><span>"]"</span></span><span> </span><span class="main"><span>(</span></span><span>space_implode</span><span> </span><span class="inner_quoted"><span>"; "</span></span><span> </span><span class="main"><span>(</span></span><span>map_filter</span><span> </span><span>I</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>s1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>str_of_nun_command</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NTVal</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cards</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>nun_val</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str_of_tval</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str_of_nun_cards_suffix</span></span><span> </span><span class="entity"><span>cards</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of_nun_command</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NCopy</span></span><span> </span><span class="entity"><span>spec</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nun_copy</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str_of_nun_copy_spec</span></span><span> </span><span class="entity"><span>spec</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of_nun_command</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NData</span></span><span> </span><span class="entity"><span>specs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>nun_data</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str_of_nun_and_list</span></span><span> </span><span class="entity"><span>str_of_nun_co_data_spec</span></span><span> </span><span class="entity"><span>specs</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of_nun_command</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NCodata</span></span><span> </span><span class="entity"><span>specs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>nun_codata</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str_of_nun_and_list</span></span><span> </span><span class="entity"><span>str_of_nun_co_data_spec</span></span><span> </span><span class="entity"><span>specs</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of_nun_command</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NVal</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>nun_val</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str_of_tm</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nun_colon</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str_of_ty</span></span><span> </span><span class="entity"><span>ty</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of_nun_command</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NPred</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>wf</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>specs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>nun_pred</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>wf</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>nun_lbracket</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nun_wf</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nun_rbracket</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
    </span><span class="entity"><span>str_of_nun_and_list</span></span><span> </span><span class="entity"><span>str_of_nun_const_spec</span></span><span> </span><span class="entity"><span>specs</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of_nun_command</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NCopred</span></span><span> </span><span class="entity"><span>specs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>nun_copred</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str_of_nun_and_list</span></span><span> </span><span class="entity"><span>str_of_nun_const_spec</span></span><span> </span><span class="entity"><span>specs</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of_nun_command</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NRec</span></span><span> </span><span class="entity"><span>specs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>nun_rec</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str_of_nun_and_list</span></span><span> </span><span class="entity"><span>str_of_nun_const_spec</span></span><span> </span><span class="entity"><span>specs</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of_nun_command</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NSpec</span></span><span> </span><span class="entity"><span>spec</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nun_spec</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str_of_nun_consts_spec</span></span><span> </span><span class="entity"><span>spec</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of_nun_command</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NAxiom</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nun_axiom</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str_of_tm</span></span><span> </span><span class="entity"><span>tm</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of_nun_command</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NGoal</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nun_goal</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str_of_tm</span></span><span> </span><span class="entity"><span>tm</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of_nun_command</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NEval</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nun_hash</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nun_eval</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str_of_tm</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>str_of_nun_problem</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>commandss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sound</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>complete</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>cat_lines</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>suffix</span><span> </span><span class="entity"><span>nun_dot</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>str_of_nun_command</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>commandss</span></span><span>
  </span><span>|&gt;</span><span> </span><span>space_implode</span><span> </span><span class="inner_quoted"><span>"\n\n"</span></span><span> </span><span>|&gt;</span><span> </span><span>suffix</span><span> </span><span class="inner_quoted"><span>"\n"</span></span><span>
  </span><span>|&gt;</span><span> </span><span>prefix</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nun_hash</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>sound</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"sound"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>"unsound"</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"\n"</span></span><span class="main"><span>)</span></span><span>
  </span><span>|&gt;</span><span> </span><span>prefix</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nun_hash</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>complete</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"complete"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>"incomplete"</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"\n"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span></pre>
</body>

</html>