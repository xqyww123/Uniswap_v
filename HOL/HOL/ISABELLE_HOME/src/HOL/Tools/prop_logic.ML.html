<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹Tools/prop_logic.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹Tools/prop_logic.ML›</h1>
</div>

<pre class="source"><span class="comment1"><span>(*  Title:      HOL/Tools/prop_logic.ML
    Author:     Tjark Weber
    Copyright   2004-2009

Formulas of propositional logic.
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>PROP_LOGIC</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>prop_formula</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>True</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>False</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>BoolVar</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int  </span><span class="comment1"><span>(* NOTE: only use indices &gt;= 1 *)</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Not</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> prop_formula
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Or</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> prop_formula * prop_formula
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>And</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> prop_formula * prop_formula

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> SNot</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>prop_formula</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>prop_formula</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> SOr</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>prop_formula</span></span><span> * </span><span class="entity"><span>prop_formula</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>prop_formula</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> SAnd</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>prop_formula</span></span><span> * </span><span class="entity"><span>prop_formula</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>prop_formula</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> simplify</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>prop_formula</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>prop_formula</span></span><span>  </span><span class="comment1"><span>(* eliminates True/False and double-negation *)</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> indices</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>prop_formula</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span>list</span><span>  </span><span class="comment1"><span>(* set of all variable indices *)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> maxidx</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>prop_formula</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span>       </span><span class="comment1"><span>(* maximal variable index *)</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> exists</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>prop_formula</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>prop_formula</span></span><span>  </span><span class="comment1"><span>(* finite disjunction *)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> all</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>prop_formula</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>prop_formula</span></span><span>  </span><span class="comment1"><span>(* finite conjunction *)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> dot_product</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>prop_formula</span></span><span> </span><span>list</span><span> * </span><span class="entity"><span>prop_formula</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>prop_formula</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> is_nnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>prop_formula</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>  </span><span class="comment1"><span>(* returns true iff the formula is in negation normal form *)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> is_cnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>prop_formula</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>  </span><span class="comment1"><span>(* returns true iff the formula is in conjunctive normal form *)</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>prop_formula</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>prop_formula</span></span><span>  </span><span class="comment1"><span>(* negation normal form *)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> cnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>prop_formula</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>prop_formula</span></span><span>  </span><span class="comment1"><span>(* conjunctive normal form *)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> defcnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>prop_formula</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>prop_formula</span></span><span>  </span><span class="comment1"><span>(* definitional cnf *)</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> eval</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>prop_formula</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>  </span><span class="comment1"><span>(* semantics *)</span></span><span>

  </span><span class="comment1"><span>(* propositional representation of HOL terms *)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> prop_formula_of_term</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span>Termtab.table</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>prop_formula</span></span><span> * </span><span>int</span><span> </span><span>Termtab.table</span><span>
  </span><span class="comment1"><span>(* HOL term representation of propositional formulae *)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> term_of_prop_formula</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>prop_formula</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Prop_Logic</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>PROP_LOGIC</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="comment1"><span>(* ------------------------------------------------------------------------- *)</span></span><span>
</span><span class="comment1"><span>(* prop_formula: formulas of propositional logic, built from Boolean         *)</span></span><span>
</span><span class="comment1"><span>(*               variables (referred to by index) and True/False using       *)</span></span><span>
</span><span class="comment1"><span>(*               not/or/and                                                  *)</span></span><span>
</span><span class="comment1"><span>(* ------------------------------------------------------------------------- *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>prop_formula</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>True</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>False</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>BoolVar</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int  </span><span class="comment1"><span>(* NOTE: only use indices &gt;= 1 *)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Not</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> prop_formula
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Or</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> prop_formula * prop_formula
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>And</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> prop_formula * prop_formula</span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(* ------------------------------------------------------------------------- *)</span></span><span>
</span><span class="comment1"><span>(* The following constructor functions make sure that True and False do not  *)</span></span><span>
</span><span class="comment1"><span>(* occur within any of the other connectives (i.e. Not, Or, And), and        *)</span></span><span>
</span><span class="comment1"><span>(* perform double-negation elimination.                                      *)</span></span><span>
</span><span class="comment1"><span>(* ------------------------------------------------------------------------- *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>SNot</span></span><span> </span><span class="entity"><span>True</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>False</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>SNot</span></span><span> </span><span class="entity"><span>False</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>True</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>SNot</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span> </span><span class="entity"><span>fm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fm</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>SNot</span></span><span> </span><span class="entity"><span>fm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Not</span></span><span> </span><span class="entity"><span>fm</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>SOr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>True</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>True</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>SOr</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>True</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>True</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>SOr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>False</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fm</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>SOr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>False</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fm</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>SOr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>SAnd</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>True</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fm</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>SAnd</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>True</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fm</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>SAnd</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>False</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>False</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>SAnd</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>False</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>False</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>SAnd</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(* ------------------------------------------------------------------------- *)</span></span><span>
</span><span class="comment1"><span>(* simplify: eliminates True/False below other connectives, and double-      *)</span></span><span>
</span><span class="comment1"><span>(*      negation                                                             *)</span></span><span>
</span><span class="comment1"><span>(* ------------------------------------------------------------------------- *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>simplify</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span> </span><span class="entity"><span>fm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>SNot</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>simplify</span></span><span> </span><span class="entity"><span>fm</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>simplify</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>SOr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>simplify</span></span><span> </span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>simplify</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>simplify</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>SAnd</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>simplify</span></span><span> </span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>simplify</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>simplify</span></span><span> </span><span class="entity"><span>fm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fm</span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(* ------------------------------------------------------------------------- *)</span></span><span>
</span><span class="comment1"><span>(* indices: collects all indices of Boolean variables that occur in a        *)</span></span><span>
</span><span class="comment1"><span>(*      propositional formula 'fm'; no duplicates                            *)</span></span><span>
</span><span class="comment1"><span>(* ------------------------------------------------------------------------- *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>indices</span></span><span> </span><span class="entity"><span>True</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>indices</span></span><span> </span><span class="entity"><span>False</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>indices</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoolVar</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>i</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>indices</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span> </span><span class="entity"><span>fm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>indices</span></span><span> </span><span class="entity"><span>fm</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>indices</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>union</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>indices</span></span><span> </span><span class="entity"><span>fm1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>indices</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>indices</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>union</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>indices</span></span><span> </span><span class="entity"><span>fm1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>indices</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(* ------------------------------------------------------------------------- *)</span></span><span>
</span><span class="comment1"><span>(* maxidx: computes the maximal variable index occurring in a formula of     *)</span></span><span>
</span><span class="comment1"><span>(*      propositional logic 'fm'; 0 if 'fm' contains no variable             *)</span></span><span>
</span><span class="comment1"><span>(* ------------------------------------------------------------------------- *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>maxidx</span></span><span> </span><span class="entity"><span>True</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>maxidx</span></span><span> </span><span class="entity"><span>False</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>maxidx</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoolVar</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>i</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>maxidx</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span> </span><span class="entity"><span>fm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>maxidx</span></span><span> </span><span class="entity"><span>fm</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>maxidx</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Int.max</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>maxidx</span></span><span> </span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>maxidx</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>maxidx</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Int.max</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>maxidx</span></span><span> </span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>maxidx</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(* ------------------------------------------------------------------------- *)</span></span><span>
</span><span class="comment1"><span>(* exists: computes the disjunction over a list 'xs' of propositional        *)</span></span><span>
</span><span class="comment1"><span>(*      formulas                                                             *)</span></span><span>
</span><span class="comment1"><span>(* ------------------------------------------------------------------------- *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>exists</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Library.foldl</span><span> </span><span class="entity"><span>SOr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>False</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(* ------------------------------------------------------------------------- *)</span></span><span>
</span><span class="comment1"><span>(* all: computes the conjunction over a list 'xs' of propositional formulas  *)</span></span><span>
</span><span class="comment1"><span>(* ------------------------------------------------------------------------- *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>all</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Library.foldl</span><span> </span><span class="entity"><span>SAnd</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>True</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(* ------------------------------------------------------------------------- *)</span></span><span>
</span><span class="comment1"><span>(* dot_product: ([x1,...,xn], [y1,...,yn]) -&gt; x1*y1+...+xn*yn                *)</span></span><span>
</span><span class="comment1"><span>(* ------------------------------------------------------------------------- *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dot_product</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>exists</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>SAnd</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>xs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(* ------------------------------------------------------------------------- *)</span></span><span>
</span><span class="comment1"><span>(* is_nnf: returns 'true' iff the formula is in negation normal form (i.e.,  *)</span></span><span>
</span><span class="comment1"><span>(*         only variables may be negated, but not subformulas).              *)</span></span><span>
</span><span class="comment1"><span>(* ------------------------------------------------------------------------- *)</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_literal</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoolVar</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_literal</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoolVar</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_literal</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>
  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_conj_disj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>is_conj_disj</span></span><span> </span><span class="entity"><span>fm1</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>is_conj_disj</span></span><span> </span><span class="entity"><span>fm2</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_conj_disj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>is_conj_disj</span></span><span> </span><span class="entity"><span>fm1</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>is_conj_disj</span></span><span> </span><span class="entity"><span>fm2</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_conj_disj</span></span><span> </span><span class="entity"><span>fm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>is_literal</span></span><span> </span><span class="entity"><span>fm</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_nnf</span></span><span> </span><span class="entity"><span>True</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_nnf</span></span><span> </span><span class="entity"><span>False</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_nnf</span></span><span> </span><span class="entity"><span>fm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>is_conj_disj</span></span><span> </span><span class="entity"><span>fm</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(* ------------------------------------------------------------------------- *)</span></span><span>
</span><span class="comment1"><span>(* is_cnf: returns 'true' iff the formula is in conjunctive normal form      *)</span></span><span>
</span><span class="comment1"><span>(*         (i.e., a conjunction of disjunctions of literals). 'is_cnf'       *)</span></span><span>
</span><span class="comment1"><span>(*         implies 'is_nnf'.                                                 *)</span></span><span>
</span><span class="comment1"><span>(* ------------------------------------------------------------------------- *)</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_literal</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoolVar</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_literal</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoolVar</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_literal</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>
  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_disj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>is_disj</span></span><span> </span><span class="entity"><span>fm1</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>is_disj</span></span><span> </span><span class="entity"><span>fm2</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_disj</span></span><span> </span><span class="entity"><span>fm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>is_literal</span></span><span> </span><span class="entity"><span>fm</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>is_conj</span></span><span> </span><span class="entity"><span>fm1</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>is_conj</span></span><span> </span><span class="entity"><span>fm2</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_conj</span></span><span> </span><span class="entity"><span>fm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>is_disj</span></span><span> </span><span class="entity"><span>fm</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_cnf</span></span><span> </span><span class="entity"><span>True</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_cnf</span></span><span> </span><span class="entity"><span>False</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_cnf</span></span><span> </span><span class="entity"><span>fm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>is_conj</span></span><span> </span><span class="entity"><span>fm</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(* ------------------------------------------------------------------------- *)</span></span><span>
</span><span class="comment1"><span>(* nnf: computes the negation normal form of a formula 'fm' of propositional *)</span></span><span>
</span><span class="comment1"><span>(*      logic (i.e., only variables may be negated, but not subformulas).    *)</span></span><span>
</span><span class="comment1"><span>(*      Simplification (cf. 'simplify') is performed as well. Not            *)</span></span><span>
</span><span class="comment1"><span>(*      surprisingly, 'is_nnf o nnf' always returns 'true'. 'nnf fm' returns *)</span></span><span>
</span><span class="comment1"><span>(*      'fm' if (and only if) 'is_nnf fm' returns 'true'.                    *)</span></span><span>
</span><span class="comment1"><span>(* ------------------------------------------------------------------------- *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>nnf</span></span><span> </span><span class="entity"><span>fm</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span>
      </span><span class="comment1"><span>(* constants *)</span></span><span>
        </span><span class="entity"><span>nnf_aux</span></span><span> </span><span class="entity"><span>True</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>True</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>nnf_aux</span></span><span> </span><span class="entity"><span>False</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>False</span></span><span>
      </span><span class="comment1"><span>(* variables *)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>nnf_aux</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoolVar</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoolVar</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span>
      </span><span class="comment1"><span>(* 'or' and 'and' as outermost connectives are left untouched *)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>nnf_aux</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span>  </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>SOr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nnf_aux</span></span><span> </span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nnf_aux</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>nnf_aux</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>SAnd</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nnf_aux</span></span><span> </span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nnf_aux</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span>
      </span><span class="comment1"><span>(* 'not' + constant *)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>nnf_aux</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span> </span><span class="entity"><span>True</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>False</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>nnf_aux</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span> </span><span class="entity"><span>False</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>True</span></span><span>
      </span><span class="comment1"><span>(* 'not' + variable *)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>nnf_aux</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoolVar</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Not</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoolVar</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span>
      </span><span class="comment1"><span>(* pushing 'not' inside of 'or'/'and' using de Morgan's laws *)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>nnf_aux</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span>  </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>SAnd</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nnf_aux</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>SNot</span></span><span> </span><span class="entity"><span>fm1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nnf_aux</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>SNot</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>nnf_aux</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>SOr</span></span><span>  </span><span class="main"><span>(</span></span><span class="entity"><span>nnf_aux</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>SNot</span></span><span> </span><span class="entity"><span>fm1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nnf_aux</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>SNot</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="comment1"><span>(* double-negation elimination *)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>nnf_aux</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span> </span><span class="entity"><span>fm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nnf_aux</span></span><span> </span><span class="entity"><span>fm</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_nnf</span></span><span> </span><span class="entity"><span>fm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>fm</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>nnf_aux</span></span><span> </span><span class="entity"><span>fm</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(* ------------------------------------------------------------------------- *)</span></span><span>
</span><span class="comment1"><span>(* cnf: computes the conjunctive normal form (i.e., a conjunction of         *)</span></span><span>
</span><span class="comment1"><span>(*      disjunctions of literals) of a formula 'fm' of propositional logic.  *)</span></span><span>
</span><span class="comment1"><span>(*      Simplification (cf. 'simplify') is performed as well. The result     *)</span></span><span>
</span><span class="comment1"><span>(*      is equivalent to 'fm', but may be exponentially longer. Not          *)</span></span><span>
</span><span class="comment1"><span>(*      surprisingly, 'is_cnf o cnf' always returns 'true'. 'cnf fm' returns *)</span></span><span>
</span><span class="comment1"><span>(*      'fm' if (and only if) 'is_cnf fm' returns 'true'.                    *)</span></span><span>
</span><span class="comment1"><span>(* ------------------------------------------------------------------------- *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>cnf</span></span><span> </span><span class="entity"><span>fm</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="comment1"><span>(* function to push an 'Or' below 'And's, using distributive laws *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>cnf_or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm11</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm12</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cnf_or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm11</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cnf_or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm12</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>cnf_or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm21</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm22</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cnf_or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm21</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cnf_or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm22</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="comment1"><span>(* neither subformula contains 'And' *)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>cnf_or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>cnf_from_nnf</span></span><span> </span><span class="entity"><span>True</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>True</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>cnf_from_nnf</span></span><span> </span><span class="entity"><span>False</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>False</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>cnf_from_nnf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoolVar</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>BoolVar</span></span><span> </span><span class="entity"><span>i</span></span><span>
    </span><span class="comment1"><span>(* 'fm' must be a variable since the formula is in NNF *)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>cnf_from_nnf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span> </span><span class="entity"><span>fm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Not</span></span><span> </span><span class="entity"><span>fm</span></span><span>
    </span><span class="comment1"><span>(* 'Or' may need to be pushed below 'And' *)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>cnf_from_nnf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>cnf_or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cnf_from_nnf</span></span><span> </span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cnf_from_nnf</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span>
    </span><span class="comment1"><span>(* 'And' as outermost connective is left untouched *)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>cnf_from_nnf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cnf_from_nnf</span></span><span> </span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cnf_from_nnf</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_cnf</span></span><span> </span><span class="entity"><span>fm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>fm</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cnf_from_nnf</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>nnf</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fm</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(* ------------------------------------------------------------------------- *)</span></span><span>
</span><span class="comment1"><span>(* defcnf: computes a definitional conjunctive normal form of a formula 'fm' *)</span></span><span>
</span><span class="comment1"><span>(*      of propositional logic. Simplification (cf. 'simplify') is performed *)</span></span><span>
</span><span class="comment1"><span>(*      as well. 'defcnf' may introduce auxiliary Boolean variables to avoid *)</span></span><span>
</span><span class="comment1"><span>(*      an exponential blowup of the formula.  The result is equisatisfiable *)</span></span><span>
</span><span class="comment1"><span>(*      (i.e., satisfiable if and only if 'fm' is satisfiable), but not      *)</span></span><span>
</span><span class="comment1"><span>(*      necessarily equivalent to 'fm'. Not surprisingly, 'is_cnf o defcnf'  *)</span></span><span>
</span><span class="comment1"><span>(*      always returns 'true'. 'defcnf fm' returns 'fm' if (and only if)     *)</span></span><span>
</span><span class="comment1"><span>(*      'is_cnf fm' returns 'true'.                                          *)</span></span><span>
</span><span class="comment1"><span>(* ------------------------------------------------------------------------- *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>defcnf</span></span><span> </span><span class="entity"><span>fm</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_cnf</span></span><span> </span><span class="entity"><span>fm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>fm</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fm'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nnf</span></span><span> </span><span class="entity"><span>fm</span></span><span>
      </span><span class="comment1"><span>(* 'new' specifies the next index that is available to introduce an auxiliary variable *)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>new</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Unsynchronized.ref</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>maxidx</span></span><span> </span><span class="entity"><span>fm'</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>new_idx</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>idx</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>!</span><span class="entity"><span>new</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>new</span></span><span> </span><span>:=</span><span> </span><span class="entity"><span>idx</span></span><span>+</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>idx</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="comment1"><span>(* replaces 'And' by an auxiliary variable (and its definition) *)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>defcnf_or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>And</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>new_idx</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="comment1"><span>(* Note that definitions are in NNF, but not CNF. *)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>BoolVar</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoolVar</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>And</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>defcnf_or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>defs1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>defcnf_or</span></span><span> </span><span class="entity"><span>fm1</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm2'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>defs2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>defcnf_or</span></span><span> </span><span class="entity"><span>fm2</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>defs1</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>defs2</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>defcnf_or</span></span><span> </span><span class="entity"><span>fm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>defcnf_from_nnf</span></span><span> </span><span class="entity"><span>True</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>True</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>defcnf_from_nnf</span></span><span> </span><span class="entity"><span>False</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>False</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>defcnf_from_nnf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoolVar</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>BoolVar</span></span><span> </span><span class="entity"><span>i</span></span><span>
      </span><span class="comment1"><span>(* 'fm' must be a variable since the formula is in NNF *)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>defcnf_from_nnf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span> </span><span class="entity"><span>fm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Not</span></span><span> </span><span class="entity"><span>fm</span></span><span>
      </span><span class="comment1"><span>(* 'Or' may need to be pushed below 'And' *)</span></span><span>
      </span><span class="comment1"><span>(* 'Or' of literal and 'And': use distributivity *)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>defcnf_from_nnf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoolVar</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>defcnf_from_nnf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoolVar</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                 </span><span class="entity"><span>defcnf_from_nnf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoolVar</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>defcnf_from_nnf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoolVar</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>defcnf_from_nnf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoolVar</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                 </span><span class="entity"><span>defcnf_from_nnf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoolVar</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>defcnf_from_nnf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>BoolVar</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>defcnf_from_nnf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>BoolVar</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                 </span><span class="entity"><span>defcnf_from_nnf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>BoolVar</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>defcnf_from_nnf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Not</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoolVar</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>defcnf_from_nnf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Not</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoolVar</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                 </span><span class="entity"><span>defcnf_from_nnf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Not</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoolVar</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="comment1"><span>(* all other cases: turn the formula into a disjunction of literals, *)</span></span><span>
      </span><span class="comment1"><span>(*                  adding definitions as necessary                  *)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>defcnf_from_nnf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>defs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>defcnf_or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cnf_defs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>defcnf_from_nnf</span></span><span> </span><span class="entity"><span>defs</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="entity"><span>all</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>cnf_defs</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="comment1"><span>(* 'And' as outermost connective is left untouched *)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>defcnf_from_nnf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>defcnf_from_nnf</span></span><span> </span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>defcnf_from_nnf</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="entity"><span>defcnf_from_nnf</span></span><span> </span><span class="entity"><span>fm'</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(* ------------------------------------------------------------------------- *)</span></span><span>
</span><span class="comment1"><span>(* eval: given an assignment 'a' of Boolean values to variable indices, the  *)</span></span><span>
</span><span class="comment1"><span>(*      truth value of a propositional formula 'fm' is computed              *)</span></span><span>
</span><span class="comment1"><span>(* ------------------------------------------------------------------------- *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>eval</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>True</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>eval</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>False</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>eval</span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoolVar</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>eval</span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span> </span><span class="entity"><span>fm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>eval</span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="entity"><span>fm</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>eval</span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>eval</span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="entity"><span>fm1</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>eval</span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>eval</span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>eval</span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="entity"><span>fm1</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>eval</span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(* ------------------------------------------------------------------------- *)</span></span><span>
</span><span class="comment1"><span>(* prop_formula_of_term: returns the propositional structure of a HOL term,  *)</span></span><span>
</span><span class="comment1"><span>(*      with subterms replaced by Boolean variables.  Also returns a table   *)</span></span><span>
</span><span class="comment1"><span>(*      of terms and corresponding variables that extends the table that was *)</span></span><span>
</span><span class="comment1"><span>(*      given as an argument.  Usually, you'll just want to use              *)</span></span><span>
</span><span class="comment1"><span>(*      'Termtab.empty' as value for 'table'.                                *)</span></span><span>
</span><span class="comment1"><span>(* ------------------------------------------------------------------------- *)</span></span><span>

</span><span class="comment1"><span>(* Note: The implementation is somewhat optimized; the next index to be used *)</span></span><span>
</span><span class="comment1"><span>(*       is computed only when it is actually needed.  However, when         *)</span></span><span>
</span><span class="comment1"><span>(*       'prop_formula_of_term' is invoked many times, it might be more      *)</span></span><span>
</span><span class="comment1"><span>(*       efficient to pass and return this value as an additional parameter, *)</span></span><span>
</span><span class="comment1"><span>(*       so that it does not have to be recomputed (by folding over the      *)</span></span><span>
</span><span class="comment1"><span>(*       table) for each invocation.                                         *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>prop_formula_of_term</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>next_idx_is_valid</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Unsynchronized.ref</span><span> </span><span>false</span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>next_idx</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Unsynchronized.ref</span><span> </span><span class="inner_numeral"><span>0</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>get_next_idx</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>!</span><span class="entity"><span>next_idx_is_valid</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span>Unsynchronized.inc</span><span> </span><span class="entity"><span>next_idx</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span>
        </span><span class="entity"><span>next_idx</span></span><span> </span><span>:=</span><span> </span><span>Termtab.fold</span><span> </span><span class="main"><span>(</span></span><span>Integer.max</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>;</span></span><span>
        </span><span class="entity"><span>next_idx_is_valid</span></span><span> </span><span>:=</span><span> </span><span>true</span><span class="main"><span>;</span></span><span>
        </span><span>Unsynchronized.inc</span><span> </span><span class="entity"><span>next_idx</span></span><span>
      </span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>aux</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../HOL.html#HOL.True|const"><span>True</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>True</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>table</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>aux</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../HOL.html#HOL.False|const"><span>False</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>False</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>table</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>aux</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../HOL.html#HOL.Not|const"><span>Not</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apfst</span><span> </span><span class="entity"><span>Not</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>aux</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>table</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>aux</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../HOL.html#HOL.disj|const"><span>HOL.disj</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>table1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>aux</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>table</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>table2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>aux</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>table1</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>table2</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>aux</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../HOL.html#HOL.conj|const"><span>HOL.conj</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>table1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>aux</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>table</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>table2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>aux</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>table1</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>table2</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>aux</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Termtab.lookup</span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span>SOME</span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoolVar</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>table</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>get_next_idx</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>BoolVar</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span>Termtab.update</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>table</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>aux</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>table</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(* ------------------------------------------------------------------------- *)</span></span><span>
</span><span class="comment1"><span>(* term_of_prop_formula: returns a HOL term that corresponds to a            *)</span></span><span>
</span><span class="comment1"><span>(*      propositional formula, with Boolean variables replaced by Free's     *)</span></span><span>
</span><span class="comment1"><span>(* ------------------------------------------------------------------------- *)</span></span><span>

</span><span class="comment1"><span>(* Note: A more generic implementation should take another argument of type  *)</span></span><span>
</span><span class="comment1"><span>(*       Term.term Inttab.table (or so) that specifies HOL terms for some    *)</span></span><span>
</span><span class="comment1"><span>(*       Boolean variables in the formula, similar to 'prop_formula_of_term' *)</span></span><span>
</span><span class="comment1"><span>(*       (but the other way round).                                          *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>term_of_prop_formula</span></span><span> </span><span class="entity"><span>True</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../HOL.html#HOL.True|const"><span>True</span></a><span>›</span></span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>term_of_prop_formula</span></span><span> </span><span class="entity"><span>False</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../HOL.html#HOL.False|const"><span>False</span></a><span>›</span></span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>term_of_prop_formula</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BoolVar</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"v"</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>term_of_prop_formula</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span> </span><span class="entity"><span>fm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_not</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>term_of_prop_formula</span></span><span> </span><span class="entity"><span>fm</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>term_of_prop_formula</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>HOLogic.mk_disj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>term_of_prop_formula</span></span><span> </span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>term_of_prop_formula</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>term_of_prop_formula</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>term_of_prop_formula</span></span><span> </span><span class="entity"><span>fm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>term_of_prop_formula</span></span><span> </span><span class="entity"><span>fm2</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span></pre>
</body>

</html>