<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹Tools/Sledgehammer/sledgehammer_proof_methods.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹Tools/Sledgehammer/sledgehammer_proof_methods.ML›</h1>
</div>

<pre class="source"><span class="comment1"><span>(*  Title:      HOL/Tools/Sledgehammer/sledgehammer_proof_methods.ML
    Author:     Jasmin Blanchette, TU Muenchen
    Author:     Steffen Juilf Smolka, TU Muenchen

Reconstructors.
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>SLEDGEHAMMER_PROOF_METHODS</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>stature</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ATP_Problem_Generate.stature</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>SMT_backend</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>SMT_Z3</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>SMT_Verit</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string

  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>proof_method</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Metis_Method</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string option * string option </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Meson_Method</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>SMT_Method</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> SMT_backend </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>SATx_Method</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Blast_Method</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Simp_Method</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Auto_Method</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Fastforce_Method</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Force_Method</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Moura_Method</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Linarith_Method</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Presburger_Method</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Algebra_Method</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>play_outcome</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Played</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> Time.time </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Play_Timed_Out</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> Time.time </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Play_Failed</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>one_line_params</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>string</span><span> * </span><span class="entity"><span>stature</span></span><span class="main"><span>)</span></span><span> </span><span>list</span><span> * </span><span class="main"><span>(</span></span><span class="entity"><span>proof_method</span></span><span> * </span><span class="entity"><span>play_outcome</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> * </span><span>string</span><span> * </span><span>int</span><span> * </span><span>int</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> is_proof_method_direct </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>proof_method</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> string_of_proof_method </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>proof_method</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tac_of_proof_method </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> * </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>proof_method</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> string_of_play_outcome </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>play_outcome</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> play_outcome_ord </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>play_outcome</span></span><span> </span><span>ord</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> one_line_proof_text </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>one_line_params</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Sledgehammer_Proof_Methods</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>SLEDGEHAMMER_PROOF_METHODS</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>ATP_Util</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>ATP_Problem_Generate</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>ATP_Proof_Reconstruct</span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>SMT_backend</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>SMT_Z3</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>SMT_Verit</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>proof_method</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Metis_Method</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string option * string option </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Meson_Method</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>SMT_Method</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> SMT_backend </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>SATx_Method</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Blast_Method</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Simp_Method</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Auto_Method</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Fastforce_Method</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Force_Method</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Moura_Method</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Linarith_Method</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Presburger_Method</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Algebra_Method</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>play_outcome</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Played</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> Time.time </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Play_Timed_Out</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> Time.time </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Play_Failed</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>one_line_params</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>string</span><span> * </span><span class="entity"><span>stature</span></span><span class="main"><span>)</span></span><span> </span><span>list</span><span> * </span><span class="main"><span>(</span></span><span class="entity"><span>proof_method</span></span><span> * </span><span class="entity"><span>play_outcome</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> * </span><span>string</span><span> * </span><span>int</span><span> * </span><span>int</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_proof_method_direct</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Metis_Method</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_proof_method_direct</span></span><span> </span><span class="entity"><span>Meson_Method</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_proof_method_direct</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>SMT_Method</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_proof_method_direct</span></span><span> </span><span class="entity"><span>Simp_Method</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_proof_method_direct</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_proof_method_multi_goal</span></span><span> </span><span class="entity"><span>Auto_Method</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_proof_method_multi_goal</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>maybe_paren</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span>|&gt;</span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span>Symbol_Pos.is_identifier</span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span>?</span><span> </span><span>enclose</span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_of_proof_method</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>meth</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>meth_s</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>meth</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span class="entity"><span>Metis_Method</span></span><span> </span><span class="main"><span>(</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"metis"</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Metis_Method</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>type_enc_opt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lam_trans_opt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="inner_quoted"><span>"metis ("</span></span><span> </span><span>^</span><span> </span><span>commas</span><span> </span><span class="main"><span>(</span></span><span>map_filter</span><span> </span><span>I</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>type_enc_opt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lam_trans_opt</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Meson_Method</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"meson"</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>SMT_Method</span></span><span> </span><span class="entity"><span>SMT_Z3</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"smt (z3)"</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>SMT_Method</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>SMT_Verit</span></span><span> </span><span class="entity"><span>strategy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="inner_quoted"><span>"smt ("</span></span><span> </span><span>^</span><span> </span><span>commas</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"verit"</span></span><span> </span><span>::</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>strategy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"default"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>strategy</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>SATx_Method</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"satx"</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Blast_Method</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"blast"</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Simp_Method</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"simp"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>"simp add:"</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Auto_Method</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"auto"</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Fastforce_Method</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"fastforce"</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Force_Method</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"force"</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Moura_Method</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"moura"</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Linarith_Method</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"linarith"</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Presburger_Method</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"presburger"</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Algebra_Method</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"algebra"</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>maybe_paren</span></span><span> </span><span class="main"><span>(</span></span><span>space_implode</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>meth_s</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tac_of_proof_method</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>local_facts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>global_facts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>meth</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tac_of_metis</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>type_enc_opt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lam_trans_opt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Config.put</span><span> </span><span class="entity"><span>Metis_Tactic.verbose</span></span><span> </span><span>false</span><span>
          </span><span>|&gt;</span><span> </span><span>Config.put</span><span> </span><span class="entity"><span>Metis_Tactic.trace</span></span><span> </span><span>false</span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Metis_Tactic.metis_method</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span>single</span><span> </span><span class="entity"><span>type_enc_opt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lam_trans_opt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>global_facts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>local_facts</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tac_of_smt</span></span><span> </span><span class="entity"><span>SMT_Z3</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>SMT_Solver.smt_tac</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tac_of_smt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>SMT_Verit</span></span><span> </span><span class="entity"><span>strategy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Verit_Strategies.verit_tac_stgy</span></span><span> </span><span class="entity"><span>strategy</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>meth</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span class="entity"><span>Metis_Method</span></span><span> </span><span class="entity"><span>options</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>tac_of_metis</span></span><span> </span><span class="entity"><span>options</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>SMT_Method</span></span><span> </span><span class="entity"><span>backend</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>tac_of_smt</span></span><span> </span><span class="entity"><span>backend</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>local_facts</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>global_facts</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="entity"><span>Method.insert_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>local_facts</span></span><span> </span><span>THEN'</span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>meth</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span class="entity"><span>Meson_Method</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Meson_Tactic.meson_general_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>global_facts</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Simp_Method</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Simplifier.asm_full_simp_tac</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span> </span><span>addsimps</span><span> </span><span class="entity"><span>global_facts</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="entity"><span>Method.insert_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>global_facts</span></span><span> </span><span>THEN'</span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>meth</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span class="entity"><span>SATx_Method</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>SAT.satx_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Blast_Method</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>blast_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Auto_Method</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Clasimp.auto_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Fastforce_Method</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Clasimp.fast_force_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Force_Method</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Clasimp.force_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Moura_Method</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>moura_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Linarith_Method</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Lin_Arith.tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Presburger_Method</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Cooper.tac</span></span><span> </span><span>true</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Algebra_Method</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Groebner.algebra_tac</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_of_play_outcome</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Played</span></span><span> </span><span class="entity"><span>time</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>string_of_ext_time</span></span><span> </span><span class="main"><span>(</span></span><span>false</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_play_outcome</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Play_Timed_Out</span></span><span> </span><span class="entity"><span>time</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>time</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Time.zeroTime</span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>string_of_ext_time</span></span><span> </span><span class="main"><span>(</span></span><span>true</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>", timed out"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_play_outcome</span></span><span> </span><span class="entity"><span>Play_Failed</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"failed"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>play_outcome_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Played</span></span><span> </span><span class="entity"><span>time1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Played</span></span><span> </span><span class="entity"><span>time2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span>int_ord</span><span> </span><span class="main"><span>(</span></span><span>apply2</span><span> </span><span>Time.toMilliseconds</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>time1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>play_outcome_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Played</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>LESS</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>play_outcome_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Played</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>GREATER</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>play_outcome_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Play_Timed_Out</span></span><span> </span><span class="entity"><span>time1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Play_Timed_Out</span></span><span> </span><span class="entity"><span>time2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span>int_ord</span><span> </span><span class="main"><span>(</span></span><span>apply2</span><span> </span><span>Time.toMilliseconds</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>time1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>play_outcome_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Play_Timed_Out</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>LESS</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>play_outcome_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Play_Timed_Out</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>GREATER</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>play_outcome_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Play_Failed</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Play_Failed</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>EQUAL</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>apply_on_subgoal</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"by "</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>apply_on_subgoal</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"apply "</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>apply_on_subgoal</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"prefer "</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>i</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>apply_on_subgoal</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="entity"><span>n</span></span><span>

</span><span class="comment1"><span>(* FIXME *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>proof_method_command</span></span><span> </span><span class="entity"><span>meth</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>used_chaineds</span></span><span> </span><span class="main"><span>_</span></span><span class="comment1"><span>(*num_chained*)</span></span><span> </span><span class="entity"><span>extras</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>indirect_ss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>direct_ss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_proof_method_direct</span></span><span> </span><span class="entity"><span>meth</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>extras</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>extras</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>indirect_ss</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>"using "</span></span><span> </span><span>^</span><span> </span><span>space_implode</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span class="entity"><span>indirect_ss</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
    </span><span class="entity"><span>apply_on_subgoal</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_of_proof_method</span></span><span> </span><span class="entity"><span>direct_ss</span></span><span> </span><span class="entity"><span>meth</span></span><span> </span><span>^</span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_proof_method_multi_goal</span></span><span> </span><span class="entity"><span>meth</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span>&lt;&gt;</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"[1]"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>try_command_line</span></span><span> </span><span class="entity"><span>banner</span></span><span> </span><span class="entity"><span>play</span></span><span> </span><span class="entity"><span>command</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>string_of_play_outcome</span></span><span> </span><span class="entity"><span>play</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>banner</span></span><span> </span><span>^</span><span> </span><span>Active.sendback_markup_command</span><span> </span><span class="entity"><span>command</span></span><span> </span><span>^</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>s</span></span><span> </span><span>&lt;&gt;</span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span>?</span><span> </span><span>enclose</span><span> </span><span class="inner_quoted"><span>" ("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>one_line_proof_text</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>num_chained</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>used_facts</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>meth</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>play</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>banner</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>subgoal</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>subgoal_count</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>chained</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>extra</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>List.partition</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sc</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>sc</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Chained</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>used_facts</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>extra</span></span><span>
    </span><span>|&gt;</span><span> </span><span class="entity"><span>proof_method_command</span></span><span> </span><span class="entity"><span>meth</span></span><span> </span><span class="entity"><span>subgoal</span></span><span> </span><span class="entity"><span>subgoal_count</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>chained</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>num_chained</span></span><span>
    </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>play</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Play_Failed</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>prefix</span><span> </span><span class="inner_quoted"><span>"One-line proof reconstruction failed: "</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>try_command_line</span></span><span> </span><span class="entity"><span>banner</span></span><span> </span><span class="entity"><span>play</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span></pre>
</body>

</html>