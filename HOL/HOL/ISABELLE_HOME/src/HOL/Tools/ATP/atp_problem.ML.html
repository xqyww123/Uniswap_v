<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹Tools/ATP/atp_problem.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹Tools/ATP/atp_problem.ML›</h1>
</div>

<pre class="source"><span class="comment1"><span>(*  Title:      HOL/Tools/ATP/atp_problem.ML
    Author:     Jia Meng, Cambridge University Computer Laboratory and NICTA
    Author:     Jasmin Blanchette, TU Muenchen
    Author:     Martin Desharnais, MPI-INF Saarbruecken

Abstract representation of ATP problems and TPTP syntax.
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>ATP_PROBLEM</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_term</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>ATerm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span> * </span><span>'b</span><span> list</span><span class="main"><span>)</span></span><span> * </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>)</span></span><span> atp_term list </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>AAbs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>'a</span><span> * </span><span>'b</span><span class="main"><span>)</span></span><span> * </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>)</span></span><span> atp_term</span><span class="main"><span>)</span></span><span> * </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>)</span></span><span> atp_term list
  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>atp_quantifier</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>AForall</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>AExists</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>atp_connective</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ANot</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>AAnd</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>AOr</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>AImplies</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>AIff</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_formula</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>ATyQuant</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> atp_quantifier * </span><span class="main"><span>(</span></span><span>'b</span><span> * </span><span>'d</span><span> list</span><span class="main"><span>)</span></span><span> list
        * </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>)</span></span><span> atp_formula </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>AQuant</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> atp_quantifier * </span><span class="main"><span>(</span></span><span>'a</span><span> * </span><span>'b</span><span> option</span><span class="main"><span>)</span></span><span> list
        * </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>)</span></span><span> atp_formula </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>AConn</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> atp_connective * </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>)</span></span><span> atp_formula list </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>AAtom</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>'c</span><span>

  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span>'a</span><span> </span><span class="entity"><span>atp_type</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>AType</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span> * </span><span>'a</span><span> list</span><span class="main"><span>)</span></span><span> * </span><span>'a</span><span> atp_type list </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>AFun</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>'a</span><span> atp_type * </span><span>'a</span><span> atp_type </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>APi</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>'a</span><span> list * </span><span>'a</span><span> atp_type

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>term_order</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>{</span></span><span>is_lpo</span><span> </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     </span><span>gen_weights</span><span> </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     </span><span>gen_prec</span><span> </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     </span><span>gen_simp</span><span> </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>}</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>syntax</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>with_ite</span><span> </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span> </span><span>with_let</span><span> </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>}</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>fool</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Without_FOOL</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>With_FOOL</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> syntax
  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>polymorphism</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Monomorphic</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Polymorphic</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>thf_flavor</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>THF_Lambda_Free</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>THF_Without_Choice</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>THF_With_Choice</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>atp_format</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>CNF</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>CNF_UEQ</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>FOF</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>TFF</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> polymorphism * fool </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>THF</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> polymorphism * syntax * thf_flavor </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>DFG</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> polymorphism

  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>atp_formula_role</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Axiom</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Definition</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Lemma</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Hypothesis</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Conjecture</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Negated_Conjecture</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Plain</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Type_Role</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Unknown</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span>'a</span><span> </span><span class="entity"><span>atp_problem_line</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Class_Decl</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string * </span><span>'a</span><span> * </span><span>'a</span><span> list </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Type_Decl</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string * </span><span>'a</span><span> * int </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Sym_Decl</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string * </span><span>'a</span><span> * </span><span>'a</span><span> atp_type </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Datatype_Decl</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      string * </span><span class="main"><span>(</span></span><span>'a</span><span> * </span><span>'a</span><span> list</span><span class="main"><span>)</span></span><span> list * </span><span>'a</span><span> atp_type * </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'a</span><span> atp_type</span><span class="main"><span>)</span></span><span> atp_term list * bool </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Class_Memb</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string * </span><span class="main"><span>(</span></span><span>'a</span><span> * </span><span>'a</span><span> list</span><span class="main"><span>)</span></span><span> list * </span><span>'a</span><span> atp_type * </span><span>'a</span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Formula</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span>string * string</span><span class="main"><span>)</span></span><span> * atp_formula_role
               * </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'a</span><span> atp_type</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'a</span><span> atp_type</span><span class="main"><span>)</span></span><span> atp_term</span><span class="main"><span>,</span></span><span> </span><span>'a</span><span class="main"><span>)</span></span><span> atp_formula
               * </span><span class="main"><span>(</span></span><span>string</span><span class="main"><span>,</span></span><span> string atp_type</span><span class="main"><span>)</span></span><span> atp_term option
               * </span><span class="main"><span>(</span></span><span>string</span><span class="main"><span>,</span></span><span> string atp_type</span><span class="main"><span>)</span></span><span> atp_term list
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span>'a</span><span> </span><span class="entity"><span>atp_problem</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>'a</span><span> </span><span class="entity"><span>atp_problem_line</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_cnf </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_fof </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_tff </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_thf </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_has_type </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_type_of_types </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_bool_type </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_individual_type </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_fun_type </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_product_type </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_forall </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_ho_forall </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_pi_binder </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_exists </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_ho_exists </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_choice </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_ho_choice </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_hilbert_choice </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_hilbert_the </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_not </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_and </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_not_and </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_or </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_not_or </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_implies </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_if </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_iff </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_not_iff </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_ite </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_let </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_app </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_not_infix </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_equal </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_not_equal </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_old_equal </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_false </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_true </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_lambda </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_empty_list </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>tptp_builtin_desc</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>arity</span><span> </span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span> </span><span>is_predicate</span><span> </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>}</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_builtins </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tptp_builtin_desc</span></span><span> </span><span>Symtab.table</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> dfg_individual_type </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> isabelle_info_prefix </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> isabelle_info </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span class="main"><span>,</span></span><span> </span><span>'a</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_term</span></span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> extract_isabelle_status </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span class="main"><span>,</span></span><span> </span><span>'a</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_term</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span>option</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> extract_isabelle_rank </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span class="main"><span>,</span></span><span> </span><span>'a</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_term</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> inductionN </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> introN </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> inductiveN </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> elimN </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> simpN </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> non_rec_defN </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rec_defN </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rankN </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> minimum_rank </span><span class="main"><span>:</span></span><span> </span><span>int</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> default_rank </span><span class="main"><span>:</span></span><span> </span><span>int</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> default_term_order_weight </span><span class="main"><span>:</span></span><span> </span><span>int</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> is_tptp_equal </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> is_built_in_tptp_symbol </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> is_tptp_variable </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> is_tptp_user_symbol </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> bool_atype </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>string</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_type</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> individual_atype </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>string</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_type</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_anot </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_formula</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_formula</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_aconn </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>atp_connective</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_formula</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_formula</span></span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_formula</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_app </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span class="main"><span>,</span></span><span> </span><span>'a</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_term</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span class="main"><span>,</span></span><span> </span><span>'a</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_term</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span class="main"><span>,</span></span><span> </span><span>'a</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_term</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_apps </span><span class="main"><span>:</span></span><span>  </span><span class="main"><span>(</span></span><span>string</span><span class="main"><span>,</span></span><span> </span><span>'a</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_term</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span class="main"><span>,</span></span><span> </span><span>'a</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_term</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span class="main"><span>,</span></span><span> </span><span>'a</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_term</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_simple_aterm</span><span class="main"><span>:</span></span><span>  </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_term</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> aconn_fold </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span>option</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>bool</span><span> </span><span>option</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'b</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'b</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>atp_connective</span></span><span> * </span><span>'a</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>'b</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'b</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> aconn_map </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span>option</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>bool</span><span> </span><span>option</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>,</span></span><span> </span><span>'e</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_formula</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="entity"><span>atp_connective</span></span><span> * </span><span>'a</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>,</span></span><span> </span><span>'e</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_formula</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> formula_fold </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span>option</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>bool</span><span> </span><span>option</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'c</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'e</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'e</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_formula</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'e</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'e</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> formula_map </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>'c</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'e</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_formula</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'e</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_formula</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> strip_atype </span><span class="main"><span>:</span></span><span> </span><span>'a</span><span> </span><span class="entity"><span>atp_type</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span>list</span><span> * </span><span class="main"><span>(</span></span><span>'a</span><span> </span><span class="entity"><span>atp_type</span></span><span> </span><span>list</span><span> * </span><span>'a</span><span> </span><span class="entity"><span>atp_type</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> is_format_higher_order </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>atp_format</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_string_of_format </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>atp_format</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_string_of_role </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>atp_formula_role</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tptp_string_of_line </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>atp_format</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="entity"><span>atp_problem_line</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> lines_of_atp_problem </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>atp_format</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>unit</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>int</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="entity"><span>atp_problem</span></span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>string</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> ensure_cnf_problem </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>string</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_problem</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>string</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_problem</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> filter_cnf_ueq_problem </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>string</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_problem</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>string</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_problem</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> declared_in_atp_problem </span><span class="main"><span>:</span></span><span> </span><span>'a</span><span> </span><span class="entity"><span>atp_problem</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span> </span><span>list</span><span> * </span><span>'a</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> * </span><span>'a</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nice_atp_problem </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>atp_format</span></span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span>'a</span><span> * </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>string</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_problem_line</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span>'a</span><span> * </span><span>string</span><span> </span><span class="entity"><span>atp_problem_line</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> * </span><span class="main"><span>(</span></span><span>string</span><span> </span><span>Symtab.table</span><span> * </span><span>string</span><span> </span><span>Symtab.table</span><span class="main"><span>)</span></span><span> </span><span>option</span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>ATP_Problem</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>ATP_PROBLEM</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>ATP_Util</span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>parens</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>enclose</span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span>

</span><span class="comment1"><span>(** ATP problem **)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_term</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>ATerm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span> * </span><span>'b</span><span> list</span><span class="main"><span>)</span></span><span> * </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>)</span></span><span> atp_term list </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>AAbs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>'a</span><span> * </span><span>'b</span><span class="main"><span>)</span></span><span> * </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>)</span></span><span> atp_term</span><span class="main"><span>)</span></span><span> * </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>)</span></span><span> atp_term list
</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>atp_quantifier</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>AForall</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>AExists</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>atp_connective</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ANot</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>AAnd</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>AOr</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>AImplies</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>AIff</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_formula</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>ATyQuant</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> atp_quantifier * </span><span class="main"><span>(</span></span><span>'b</span><span> * </span><span>'d</span><span> list</span><span class="main"><span>)</span></span><span> list
      * </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>)</span></span><span> atp_formula </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>AQuant</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> atp_quantifier * </span><span class="main"><span>(</span></span><span>'a</span><span> * </span><span>'b</span><span> option</span><span class="main"><span>)</span></span><span> list
      * </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>)</span></span><span> atp_formula </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>AConn</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> atp_connective * </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>)</span></span><span> atp_formula list </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>AAtom</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>'c</span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span>'a</span><span> </span><span class="entity"><span>atp_type</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>AType</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span> * </span><span>'a</span><span> list</span><span class="main"><span>)</span></span><span> * </span><span>'a</span><span> atp_type list </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>AFun</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>'a</span><span> atp_type * </span><span>'a</span><span> atp_type </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>APi</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>'a</span><span> list * </span><span>'a</span><span> atp_type

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>term_order</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>is_lpo</span><span> </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   </span><span>gen_weights</span><span> </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   </span><span>gen_prec</span><span> </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   </span><span>gen_simp</span><span> </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>}</span></span><span>


</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>syntax</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>with_ite</span><span> </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span> </span><span>with_let</span><span> </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>}</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>fool</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Without_FOOL</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>With_FOOL</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> syntax
</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>polymorphism</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Monomorphic</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Polymorphic</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>thf_flavor</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>THF_Lambda_Free</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>THF_Without_Choice</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>THF_With_Choice</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>atp_format</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>CNF</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>CNF_UEQ</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>FOF</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>TFF</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> polymorphism * fool </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>THF</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> polymorphism * syntax * thf_flavor </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>DFG</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> polymorphism

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>atp_formula_role</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Axiom</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Definition</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Lemma</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Hypothesis</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Conjecture</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Negated_Conjecture</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Plain</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Type_Role</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Unknown</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span>'a</span><span> </span><span class="entity"><span>atp_problem_line</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Class_Decl</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string * </span><span>'a</span><span> * </span><span>'a</span><span> list </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Type_Decl</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string * </span><span>'a</span><span> * int </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Sym_Decl</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string * </span><span>'a</span><span> * </span><span>'a</span><span> atp_type </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Datatype_Decl</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    string * </span><span class="main"><span>(</span></span><span>'a</span><span> * </span><span>'a</span><span> list</span><span class="main"><span>)</span></span><span> list * </span><span>'a</span><span> atp_type * </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'a</span><span> atp_type</span><span class="main"><span>)</span></span><span> atp_term list * bool </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Class_Memb</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string * </span><span class="main"><span>(</span></span><span>'a</span><span> * </span><span>'a</span><span> list</span><span class="main"><span>)</span></span><span> list * </span><span>'a</span><span> atp_type * </span><span>'a</span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Formula</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span>string * string</span><span class="main"><span>)</span></span><span> * atp_formula_role
             * </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'a</span><span> atp_type</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'a</span><span> atp_type</span><span class="main"><span>)</span></span><span> atp_term</span><span class="main"><span>,</span></span><span> </span><span>'a</span><span class="main"><span>)</span></span><span> atp_formula
             * </span><span class="main"><span>(</span></span><span>string</span><span class="main"><span>,</span></span><span> string atp_type</span><span class="main"><span>)</span></span><span> atp_term option
             * </span><span class="main"><span>(</span></span><span>string</span><span class="main"><span>,</span></span><span> string atp_type</span><span class="main"><span>)</span></span><span> atp_term list
</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span>'a</span><span> </span><span class="entity"><span>atp_problem</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>'a</span><span> </span><span class="entity"><span>atp_problem_line</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span>

</span><span class="comment1"><span>(* official TPTP syntax *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_cnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"cnf"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_fof</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"fof"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_tff</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"tff"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_thf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"thf"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_has_type</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>":"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_type_of_types</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"$tType"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_bool_type</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"$o"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_individual_type</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"$i"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_fun_type</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"&gt;"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_product_type</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"*"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_forall</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"!"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_ho_forall</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"!!"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_pi_binder</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"!&gt;"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_exists</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"?"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_ho_exists</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"??"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_choice</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"@+"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_ho_choice</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"@@+"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_not</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"~"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_and</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"&amp;"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_not_and</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"~&amp;"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_or</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"|"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_not_or</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"~|"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_implies</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"=&gt;"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_if</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"&lt;="</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_iff</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"&lt;=&gt;"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_not_iff</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"&lt;~&gt;"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_ite</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"$ite"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_let</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"$let"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_app</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"@"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_hilbert_choice</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"@+"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_hilbert_the</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"@-"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_not_infix</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"!"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_equal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_not_equal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_not_infix</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>tptp_equal</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_old_equal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"equal"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_false</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"$false"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_true</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"$true"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_lambda</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"^"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_empty_list</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"[]"</span></span><span>

</span><span class="comment1"><span>(* A predicate has return type $o (i.e. bool) *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>tptp_builtin_desc</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>arity</span><span> </span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span> </span><span>is_predicate</span><span> </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>}</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_builtins</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>make_builtin</span></span><span> </span><span class="entity"><span>arity</span></span><span> </span><span class="entity"><span>is_predicate</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>{</span></span><span>arity</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>arity</span></span><span class="main"><span>,</span></span><span> </span><span>is_predicate</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>is_predicate</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>make_builtin</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>tptp_false</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tptp_true</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span>
    </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>make_builtin</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>tptp_not</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tptp_ho_forall</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tptp_ho_exists</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span>
    </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>make_builtin</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>tptp_and</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tptp_or</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tptp_implies</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tptp_if</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tptp_iff</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tptp_not_iff</span></span><span class="main"><span>,</span></span><span>
      </span><span class="entity"><span>tptp_equal</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tptp_old_equal</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span>
    </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>make_builtin</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>tptp_let</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span>
    </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>make_builtin</span></span><span> </span><span class="inner_numeral"><span>3</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>tptp_ite</span></span><span class="main"><span>]</span></span><span>
    </span><span>|&gt;</span><span> </span><span>Symtab.make</span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dfg_individual_type</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"iii"</span></span><span> </span><span class="comment1"><span>(* cannot clash *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>isabelle_info_prefix</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"isabelle_"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inductionN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"induction"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>introN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"intro"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inductiveN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"inductive"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>elimN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"elim"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>simpN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"simp"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>non_rec_defN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"non_rec_def"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rec_defN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"rec_def"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rankN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"rank"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>minimum_rank</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>default_rank</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1000</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>default_term_order_weight</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>

</span><span class="comment1"><span>(* Currently, only SPASS 3.8ds and (to a lesser extent) Metis can process Isabelle
   metainformation. *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>isabelle_info</span></span><span> </span><span class="entity"><span>generate_info</span></span><span> </span><span class="entity"><span>status</span></span><span> </span><span class="entity"><span>rank</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>generate_info</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
    </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>rank</span></span><span> </span><span>&lt;&gt;</span><span> </span><span class="entity"><span>default_rank</span></span><span>
          </span><span>?</span><span> </span><span>cons</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>isabelle_info_prefix</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>rankN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                         </span><span class="main"><span>[</span></span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>string_of_int</span><span> </span><span class="entity"><span>rank</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
       </span><span>|&gt;</span><span> </span><span class="entity"><span>status</span></span><span> </span><span>&lt;&gt;</span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span>?</span><span> </span><span>cons</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>isabelle_info_prefix</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>status</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
    </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>extract_isabelle_status</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span>try</span><span> </span><span class="main"><span>(</span></span><span>unprefix</span><span> </span><span class="entity"><span>isabelle_info_prefix</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>s</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>extract_isabelle_status</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>extract_isabelle_rank</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tms</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>List.last</span><span> </span><span class="entity"><span>tms</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
       </span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>rank</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>the</span><span> </span><span class="main"><span>(</span></span><span>Int.fromString</span><span> </span><span class="entity"><span>rank</span></span><span class="main"><span>)</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>default_rank</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>extract_isabelle_rank</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>default_rank</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_tptp_equal</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_equal</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_old_equal</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_built_in_tptp_symbol</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_old_equal</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span>Char.isAlpha</span><span> </span><span class="main"><span>(</span></span><span>String.sub</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_tptp_variable</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span>&lt;&gt;</span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>Char.isUpper</span><span> </span><span class="main"><span>(</span></span><span>String.sub</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>is_tptp_user_symbol</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>not</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_tptp_variable</span></span><span> </span><span>orf</span><span> </span><span class="entity"><span>is_built_in_tptp_symbol</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bool_atype</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>AType</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>`</span><span>I</span><span> </span><span class="entity"><span>tptp_bool_type</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>individual_atype</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>AType</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>`</span><span>I</span><span> </span><span class="entity"><span>tptp_individual_type</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>raw_polarities_of_conn</span></span><span> </span><span class="entity"><span>ANot</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>false</span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>raw_polarities_of_conn</span></span><span> </span><span class="entity"><span>AAnd</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>true</span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span>true</span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>raw_polarities_of_conn</span></span><span> </span><span class="entity"><span>AOr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>true</span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span>true</span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>raw_polarities_of_conn</span></span><span> </span><span class="entity"><span>AImplies</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>false</span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span>true</span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>raw_polarities_of_conn</span></span><span> </span><span class="entity"><span>AIff</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>polarities_of_conn</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=</span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>polarities_of_conn</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>raw_polarities_of_conn</span></span><span> </span><span>#&gt;</span><span> </span><span>not</span><span> </span><span class="entity"><span>pos</span></span><span> </span><span>?</span><span> </span><span>apply2</span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span>not</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_anot</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AConn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ANot</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>phi</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>phi</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_anot</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>AConn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ANot</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>phi</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_aconn</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="entity"><span>phi1</span></span><span> </span><span class="entity"><span>phi2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>AConn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>phi1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_app</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>tptp_app</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_apps</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_app</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>f</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_simple_aterm</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>aconn_fold</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ANot</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>phi</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span>not</span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>phi</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>aconn_fold</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AImplies</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>phi1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span>not</span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>phi1</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="entity"><span>phi2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>aconn_fold</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AAnd</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phis</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>phis</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>aconn_fold</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AOr</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phis</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>phis</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>aconn_fold</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phis</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>phis</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>aconn_map</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ANot</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>phi</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>AConn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ANot</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span>not</span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>aconn_map</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AImplies</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>phi1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>AConn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AImplies</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span>not</span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>phi1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="entity"><span>phi2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>aconn_map</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AAnd</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phis</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>AConn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AAnd</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>phis</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>aconn_map</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AOr</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phis</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>AConn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AOr</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>phis</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>aconn_map</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phis</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>AConn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>phis</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>formula_fold</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fld</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AQuant</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fld</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="entity"><span>phi</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fld</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATyQuant</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fld</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="entity"><span>phi</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fld</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AConn</span></span><span> </span><span class="entity"><span>conn</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>aconn_fold</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="entity"><span>fld</span></span><span> </span><span class="entity"><span>conn</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fld</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AAtom</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="entity"><span>tm</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>fld</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>formula_map</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AQuant</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>q</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>AQuant</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>q</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>formula_map</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>formula_map</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATyQuant</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>q</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ATyQuant</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>q</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>formula_map</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>formula_map</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AConn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phis</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>AConn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>formula_map</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>phis</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>formula_map</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AAtom</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>AAtom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>strip_api</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>APi</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tys</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>strip_api</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span>|&gt;&gt;</span><span> </span><span>append</span><span> </span><span class="entity"><span>tys</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>strip_api</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>strip_afun</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AFun</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ty1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>strip_afun</span></span><span> </span><span class="entity"><span>ty2</span></span><span> </span><span>|&gt;&gt;</span><span> </span><span>cons</span><span> </span><span class="entity"><span>ty1</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>strip_afun</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>strip_atype</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>strip_api</span></span><span> </span><span>||&gt;</span><span> </span><span class="entity"><span>strip_afun</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_function_atype</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>snd</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>strip_atype</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>&lt;&gt;</span><span> </span><span class="entity"><span>AType</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>tptp_bool_type</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_predicate_atype</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_function_atype</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_nontrivial_predicate_atype</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AType</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_nontrivial_predicate_atype</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>is_predicate_atype</span></span><span> </span><span class="entity"><span>ty</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_format_higher_order</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>THF</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_format_higher_order</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_format_higher_order_with_choice</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>THF</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>THF_With_Choice</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_format_higher_order_with_choice</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_format_typed</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TFF</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_format_typed</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>THF</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_format_typed</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>DFG</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_format_typed</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_format_with_fool</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>THF</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_format_with_fool</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TFF</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>With_FOOL</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_format_with_fool</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tptp_string_of_role</span></span><span> </span><span class="entity"><span>Axiom</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"axiom"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tptp_string_of_role</span></span><span> </span><span class="entity"><span>Definition</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"definition"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tptp_string_of_role</span></span><span> </span><span class="entity"><span>Lemma</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"lemma"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tptp_string_of_role</span></span><span> </span><span class="entity"><span>Hypothesis</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"hypothesis"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tptp_string_of_role</span></span><span> </span><span class="entity"><span>Conjecture</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"conjecture"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tptp_string_of_role</span></span><span> </span><span class="entity"><span>Negated_Conjecture</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"negated_conjecture"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tptp_string_of_role</span></span><span> </span><span class="entity"><span>Plain</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"plain"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tptp_string_of_role</span></span><span> </span><span class="entity"><span>Type_Role</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"type"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tptp_string_of_role</span></span><span> </span><span class="entity"><span>Unknown</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"unknown"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tptp_string_of_app</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>func</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>func</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tptp_string_of_app</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="entity"><span>func</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_format_higher_order</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span class="inner_quoted"><span>"("</span></span><span> </span><span>^</span><span> </span><span>space_implode</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>tptp_app</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>func</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span class="entity"><span>func</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span>^</span><span> </span><span>commas</span><span> </span><span class="entity"><span>args</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>uncurry_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>APi</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tys</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>APi</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tys</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>uncurry_type</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>uncurry_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ty</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>AFun</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ty1</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>AType</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>uncurry_type</span></span><span> </span><span class="entity"><span>ty2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
       </span><span class="entity"><span>AFun</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ty'</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>AType</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
       </span><span class="entity"><span>AFun</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AType</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>tptp_product_type</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
         </span><span class="entity"><span>ty1</span></span><span> </span><span>::</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_product_type</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>tys</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ty'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>uncurry_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ty</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>AType</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ty</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>uncurry_type</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Fail</span><span> </span><span class="inner_quoted"><span>"unexpected higher-order type in first-order format"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>suffix_type_of_types</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>suffix</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>tptp_has_type</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>tptp_type_of_types</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>str_of_type</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dfg</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="entity"><span>DFG</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>true</span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AType</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>dfg</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_individual_type</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>dfg_individual_type</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>s</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>rhs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AType</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_fun_type</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ty1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty2</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tys</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>rhs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AFun</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ty1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tys</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_product_type</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
              </span><span class="entity"><span>ss</span></span><span> </span><span>|&gt;</span><span> </span><span>space_implode</span><span>
                        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>dfg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>", "</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>tptp_product_type</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span class="main"><span>)</span></span><span>
                 </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>not</span><span> </span><span class="entity"><span>dfg</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>length</span><span> </span><span class="entity"><span>ss</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>parens</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
              </span><span class="entity"><span>tptp_string_of_app</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>ss</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>rhs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AFun</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ty1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>ty1</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>dfg</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>parens</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>dfg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>tptp_fun_type</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str</span></span><span> </span><span>true</span><span> </span><span class="entity"><span>ty2</span></span><span>
        </span><span>|&gt;</span><span> </span><span>not</span><span> </span><span class="entity"><span>rhs</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>parens</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>APi</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>dfg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
          </span><span class="inner_quoted"><span>"["</span></span><span> </span><span>^</span><span> </span><span>commas</span><span> </span><span class="entity"><span>ss</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"], "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str</span></span><span> </span><span>true</span><span> </span><span class="entity"><span>ty</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
          </span><span class="entity"><span>tptp_pi_binder</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span>^</span><span> </span><span>commas</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>suffix_type_of_types</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"]: "</span></span><span> </span><span>^</span><span>
          </span><span class="entity"><span>str</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>ty</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span>true</span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_of_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>format</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>THF</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>str_of_type</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="entity"><span>ty</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_type</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>str_of_type</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>uncurry_type</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tptp_string_of_quantifier</span></span><span> </span><span class="entity"><span>AForall</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_forall</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tptp_string_of_quantifier</span></span><span> </span><span class="entity"><span>AExists</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_exists</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tptp_string_of_connective</span></span><span> </span><span class="entity"><span>ANot</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_not</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tptp_string_of_connective</span></span><span> </span><span class="entity"><span>AAnd</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_and</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tptp_string_of_connective</span></span><span> </span><span class="entity"><span>AOr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_or</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tptp_string_of_connective</span></span><span> </span><span class="entity"><span>AImplies</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_implies</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tptp_string_of_connective</span></span><span> </span><span class="entity"><span>AIff</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_iff</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_of_bound_var</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>s</span></span><span> </span><span>^</span><span>
  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_format_typed</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
     </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>tptp_has_type</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span>
     </span><span class="main"><span>(</span></span><span class="entity"><span>ty</span></span><span> </span><span>|&gt;</span><span> </span><span>the_default</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AType</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>tptp_individual_type</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>string_of_type</span></span><span> </span><span class="entity"><span>format</span></span><span class="main"><span>)</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
     </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tptp_string_of_term</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span>|&gt;</span><span> </span><span>Symtab.defined</span><span> </span><span class="entity"><span>tptp_builtins</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>parens</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tptp_string_of_term</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>of_type</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>string_of_type</span></span><span> </span><span class="entity"><span>format</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>of_term</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_string_of_term</span></span><span> </span><span class="entity"><span>format</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>app0</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>types</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>tptp_string_of_app</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span>|&gt;</span><span> </span><span>Symtab.defined</span><span> </span><span class="entity"><span>tptp_builtins</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>parens</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>of_type</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>is_format_higher_order</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>parens</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>types</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="entity"><span>of_term</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>app</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>app0</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>tys</span></span><span> </span><span class="entity"><span>ts</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_empty_list</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="comment1"><span>(* used for lists in the optional "source" field of a derivation *)</span></span><span>
        </span><span class="inner_quoted"><span>"["</span></span><span> </span><span>^</span><span> </span><span>commas</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>of_term</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"]"</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_tptp_equal</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span>space_implode</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>tptp_equal</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>of_term</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_format_higher_order</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>is_format_with_fool</span></span><span> </span><span class="entity"><span>format</span></span><span class="main"><span>)</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>parens</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_ho_forall</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_ho_exists</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span class="main"><span>[</span></span><span class="entity"><span>AAbs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="comment1"><span>(* Use syntactic sugar "!" and "?" instead of "!!" and "??" whenever possible, to work
             around LEO-II, Leo-III, and Satallax parser limitation. *)</span></span><span>
          </span><span class="entity"><span>tptp_string_of_formula</span></span><span> </span><span class="entity"><span>format</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>AQuant</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_ho_forall</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>AForall</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>AExists</span></span><span class="main"><span>,</span></span><span>
                      </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>s'</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>AAtom</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>app</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_let</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span class="entity"><span>t1</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>AAbs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>declaration</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>s'</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" : "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>of_type</span></span><span> </span><span class="entity"><span>ty</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>definition</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>s'</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" := "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>of_term</span></span><span> </span><span class="entity"><span>t1</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>usage</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>of_term</span></span><span> </span><span class="entity"><span>tm</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>is_format_higher_order</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
              </span><span class="entity"><span>app0</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>declaration</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>", "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>definition</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>", "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>usage</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>ts</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
              </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tptp_let</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" is special syntax and more than two arguments is only \
                \supported in higher order"</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tptp_let</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" is special syntax and must have at least two arguments"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_ite</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span class="entity"><span>t1</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>t2</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>t3</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>is_format_higher_order</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="entity"><span>app0</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>of_term</span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>", "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>of_term</span></span><span> </span><span class="entity"><span>t2</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>", "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>of_term</span></span><span> </span><span class="entity"><span>t3</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>ts</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
            </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tptp_ite</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" is special syntax and more than three arguments is only supported \
              \in higher order"</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tptp_ite</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" is special syntax and must have at least three arguments"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_choice</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>AAbs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="comment1"><span>(* There is code in "ATP_Problem_Generate" to ensure that "Eps" is always applied to an
             abstraction. *)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>is_format_higher_order_with_choice</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>declaration</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>s'</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" : "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>of_type</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="entity"><span>app0</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"("</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>tptp_choice</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>declaration</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"]: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>of_term</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>args</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
            </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tptp_choice</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" is only supported in higher order"</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tptp_choice</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" must be followed by a lambda abstraction"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span>Symtab.lookup</span><span> </span><span class="entity"><span>tptp_builtins</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="main"><span>{</span></span><span>arity</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span>is_predicate</span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="comment1"><span>(* generate e.g. "~ t" instead of "~ @ t". *)</span></span><span>
          </span><span class="entity"><span>s</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>of_term</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>parens</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>parens</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="main"><span>{</span></span><span>arity</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span>is_predicate</span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="comment1"><span>(* generate e.g. "t1 &amp; t2" instead of "&amp; @ t1 @ t2". *)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>of_term</span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>parens</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>s</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>of_term</span></span><span> </span><span class="entity"><span>t2</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>parens</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>parens</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>app</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tptp_string_of_term</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>format</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>THF</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AAbs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>tptp_string_of_app</span></span><span> </span><span class="entity"><span>format</span></span><span>
        </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"(^["</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>s</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" : "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_of_type</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"]: "</span></span><span> </span><span>^</span><span>
         </span><span class="entity"><span>tptp_string_of_term</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tptp_string_of_term</span></span><span> </span><span class="entity"><span>format</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tptp_string_of_term</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Fail</span><span> </span><span class="inner_quoted"><span>"unexpected term in first-order format"</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>tptp_string_of_formula</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATyQuant</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>q</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>tptp_string_of_quantifier</span></span><span> </span><span class="entity"><span>q</span></span><span> </span><span>^</span><span>
    </span><span class="inner_quoted"><span>"["</span></span><span> </span><span>^</span><span>
    </span><span>commas</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>suffix_type_of_types</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>string_of_type</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
    </span><span class="inner_quoted"><span>"]: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>tptp_string_of_formula</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="entity"><span>phi</span></span><span>
    </span><span>|&gt;</span><span> </span><span class="entity"><span>parens</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tptp_string_of_formula</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AQuant</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>q</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>tptp_string_of_quantifier</span></span><span> </span><span class="entity"><span>q</span></span><span> </span><span>^</span><span>
    </span><span class="inner_quoted"><span>"["</span></span><span> </span><span>^</span><span> </span><span>commas</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>string_of_bound_var</span></span><span> </span><span class="entity"><span>format</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"]: "</span></span><span> </span><span>^</span><span>
    </span><span class="entity"><span>tptp_string_of_formula</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="entity"><span>phi</span></span><span>
    </span><span>|&gt;</span><span> </span><span class="entity"><span>parens</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tptp_string_of_formula</span></span><span> </span><span class="entity"><span>format</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>AConn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ANot</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>AAtom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"="</span></span><span> </span><span class="comment1"><span>(* tptp_equal *)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span>space_implode</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>tptp_not_equal</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tptp_string_of_term</span></span><span> </span><span class="entity"><span>format</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span>
    </span><span>|&gt;</span><span> </span><span class="entity"><span>is_format_higher_order</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>parens</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tptp_string_of_formula</span></span><span> </span><span class="entity"><span>format</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>AConn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ANot</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>AAtom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"equal"</span></span><span> </span><span class="comment1"><span>(* tptp_old_equal *)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span>space_implode</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>tptp_not_equal</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tptp_string_of_term</span></span><span> </span><span class="entity"><span>format</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span>
    </span><span>|&gt;</span><span> </span><span class="entity"><span>is_format_higher_order</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>parens</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tptp_string_of_formula</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AConn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>phi</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>tptp_string_of_connective</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tptp_string_of_formula</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>parens</span></span><span class="main"><span>)</span></span><span>
    </span><span>|&gt;</span><span> </span><span class="entity"><span>parens</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tptp_string_of_formula</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AConn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phis</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span>space_implode</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>tptp_string_of_connective</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tptp_string_of_formula</span></span><span> </span><span class="entity"><span>format</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>phis</span></span><span class="main"><span>)</span></span><span>
    </span><span>|&gt;</span><span> </span><span class="entity"><span>parens</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tptp_string_of_formula</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AAtom</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_string_of_term</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="entity"><span>tm</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tptp_string_of_format</span></span><span> </span><span class="entity"><span>CNF</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_cnf</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tptp_string_of_format</span></span><span> </span><span class="entity"><span>CNF_UEQ</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_cnf</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tptp_string_of_format</span></span><span> </span><span class="entity"><span>FOF</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_fof</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tptp_string_of_format</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TFF</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_tff</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tptp_string_of_format</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>THF</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_thf</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tptp_string_of_format</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>DFG</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Fail</span><span> </span><span class="inner_quoted"><span>"non-TPTP format"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>atype_of_types</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>AType</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>tptp_type_of_types</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>nary_type_decl_type</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>funpow</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>AFun</span></span><span> </span><span class="entity"><span>atype_of_types</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atype_of_types</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>maybe_alt</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>maybe_alt</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>" % "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>s</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tptp_string_of_line</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Decl</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ident</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ary</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>tptp_string_of_line</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Sym_Decl</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ident</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nary_type_decl_type</span></span><span> </span><span class="entity"><span>ary</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tptp_string_of_line</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Sym_Decl</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ident</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>tptp_string_of_format</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>ident</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>", type,\n    "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>sym</span></span><span> </span><span>^</span><span>
    </span><span class="inner_quoted"><span>" : "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_of_type</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>").\n"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tptp_string_of_line</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Formula</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>ident</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>kind</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>source</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>info</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>tptp_string_of_format</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>ident</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>", "</span></span><span> </span><span>^</span><span>
    </span><span class="entity"><span>tptp_string_of_role</span></span><span> </span><span class="entity"><span>kind</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"\n    ("</span></span><span> </span><span>^</span><span>
    </span><span class="entity"><span>tptp_string_of_formula</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span>^</span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>source</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span>SOME</span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>", "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>tptp_string_of_term</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="entity"><span>tm</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>info</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>", []"</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>info</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tms</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>", ["</span></span><span> </span><span>^</span><span> </span><span>commas</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tptp_string_of_term</span></span><span> </span><span class="entity"><span>format</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tms</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"]"</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
    </span><span class="inner_quoted"><span>")."</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>maybe_alt</span></span><span> </span><span class="entity"><span>alt</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"\n"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tptp_lines</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>heading</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lines</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
           </span><span class="inner_quoted"><span>"\n% "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>heading</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" ("</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>lines</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")\n"</span></span><span> </span><span>::</span><span>
           </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tptp_string_of_line</span></span><span> </span><span class="entity"><span>format</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lines</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>arity_of_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>APi</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tys</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>arity_of_type</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span>|&gt;&gt;</span><span> </span><span>Integer.add</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AFun</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>arity_of_type</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span>||&gt;</span><span> </span><span>Integer.add</span><span> </span><span class="inner_numeral"><span>1</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>arity_of_type</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_of_arity</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>n</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_arity</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>m</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>m</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"+"</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>n</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dfg_class_inter</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>space_implode</span><span> </span><span class="inner_quoted"><span>" &amp; "</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dfg_string_of_term</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>s</span></span><span> </span><span>^</span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>tys</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>"&lt;"</span></span><span> </span><span>^</span><span> </span><span>commas</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>string_of_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>DFG</span></span><span> </span><span class="entity"><span>Polymorphic</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"&gt;"</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>tms</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span>^</span><span> </span><span>commas</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>dfg_string_of_term</span></span><span> </span><span class="entity"><span>tms</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>dfg_string_of_term</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Fail</span><span> </span><span class="inner_quoted"><span>"unexpected atom in first-order format"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dfg_string_of_formula</span></span><span> </span><span class="entity"><span>poly</span></span><span> </span><span class="entity"><span>gen_simp</span></span><span> </span><span class="entity"><span>info</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>str_of_typ</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>string_of_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>DFG</span></span><span> </span><span class="entity"><span>poly</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>str_of_bound_typ</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>str_of_typ</span></span><span> </span><span class="entity"><span>ty</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of_bound_typ</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cls</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>str_of_typ</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" : "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>dfg_class_inter</span></span><span> </span><span class="entity"><span>cls</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>suffix_tag</span></span><span> </span><span class="entity"><span>top_level</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>top_level</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>extract_isabelle_status</span></span><span> </span><span class="entity"><span>info</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span>SOME</span><span> </span><span class="entity"><span>s'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>s'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>non_rec_defN</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>":lt"</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>simpN</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>s'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rec_defN</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>gen_simp</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>":lr"</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>s</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="entity"><span>s</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>str_of_atom</span></span><span> </span><span class="entity"><span>top_level</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>s'</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_tptp_equal</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"equal"</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>suffix_tag</span></span><span> </span><span class="entity"><span>top_level</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_true</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"true"</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_false</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"false"</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>s</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>dfg_string_of_term</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of_atom</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Fail</span><span> </span><span class="inner_quoted"><span>"unexpected atom in first-order format"</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>str_of_quant</span></span><span> </span><span class="entity"><span>AForall</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"forall"</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of_quant</span></span><span> </span><span class="entity"><span>AExists</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"exists"</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>str_of_conn</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>ANot</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"not"</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of_conn</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>AAnd</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"and"</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of_conn</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>AOr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"or"</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of_conn</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>AImplies</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"implies"</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of_conn</span></span><span> </span><span class="entity"><span>top_level</span></span><span> </span><span class="entity"><span>AIff</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"equiv"</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>suffix_tag</span></span><span> </span><span class="entity"><span>top_level</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>str_of_formula</span></span><span> </span><span class="entity"><span>top_level</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATyQuant</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>q</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>str_of_quant</span></span><span> </span><span class="entity"><span>q</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"_sorts(["</span></span><span> </span><span>^</span><span> </span><span>commas</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>str_of_bound_typ</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"], "</span></span><span> </span><span>^</span><span>
        </span><span class="entity"><span>str_of_formula</span></span><span> </span><span class="entity"><span>top_level</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of_formula</span></span><span> </span><span class="entity"><span>top_level</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AQuant</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>q</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>str_of_quant</span></span><span> </span><span class="entity"><span>q</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"(["</span></span><span> </span><span>^</span><span>
        </span><span>commas</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>string_of_bound_var</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>DFG</span></span><span> </span><span class="entity"><span>poly</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"], "</span></span><span> </span><span>^</span><span>
        </span><span class="entity"><span>str_of_formula</span></span><span> </span><span class="entity"><span>top_level</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of_formula</span></span><span> </span><span class="entity"><span>top_level</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AConn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phis</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>str_of_conn</span></span><span> </span><span class="entity"><span>top_level</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span>^</span><span>
        </span><span>commas</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str_of_formula</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>phis</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of_formula</span></span><span> </span><span class="entity"><span>top_level</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AAtom</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>str_of_atom</span></span><span> </span><span class="entity"><span>top_level</span></span><span> </span><span class="entity"><span>tm</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>str_of_formula</span></span><span> </span><span>true</span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>maybe_enclose</span></span><span> </span><span class="entity"><span>bef</span></span><span> </span><span class="entity"><span>aft</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"% "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>bef</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>aft</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>maybe_enclose</span></span><span> </span><span class="entity"><span>bef</span></span><span> </span><span class="entity"><span>aft</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bef</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>s</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>aft</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dfg_lines</span></span><span> </span><span class="entity"><span>poly</span></span><span> </span><span class="entity"><span>ord_info</span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="comment1"><span>(* hardcoded settings *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>is_lpo</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>gen_weights</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>gen_prec</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>gen_simp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>typ</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>string_of_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>DFG</span></span><span> </span><span class="entity"><span>poly</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>term</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dfg_string_of_term</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>spair</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>s</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>", "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>s'</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tm_ary</span></span><span> </span><span class="entity"><span>sym</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>spair</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>string_of_arity</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>arity_of_type</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>ty_ary</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ty</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>ty_ary</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>ty</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>", "</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fun_typ</span></span><span> </span><span class="entity"><span>sym</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"function("</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>sym</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>", "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>typ</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")."</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pred_typ</span></span><span> </span><span class="entity"><span>sym</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ty_vars</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tys</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>strip_atype</span></span><span> </span><span class="entity"><span>ty</span></span><span>
          </span><span>|&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"["</span></span><span> </span><span>^</span><span> </span><span>commas</span><span> </span><span class="entity"><span>xs</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"]"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="inner_quoted"><span>"predicate("</span></span><span> </span><span>^</span><span> </span><span>commas</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ty_vars</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="entity"><span>typ</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")."</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>bound_tvar</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ty</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>bound_tvar</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cls</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" : "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>dfg_class_inter</span></span><span> </span><span class="entity"><span>cls</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>binder_typ</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span>^</span><span> </span><span>commas</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>bound_tvar</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"], "</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
      </span><span class="entity"><span>typ</span></span><span> </span><span class="entity"><span>ty</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>sort_decl</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="entity"><span>cl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"sort("</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>binder_typ</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>", "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>cl</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")."</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>datatype_decl</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="entity"><span>tms</span></span><span> </span><span class="entity"><span>exhaust</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="inner_quoted"><span>"datatype("</span></span><span> </span><span>^</span><span> </span><span>commas</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>binder_typ</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span>::</span><span> </span><span>map</span><span> </span><span class="entity"><span>term</span></span><span> </span><span class="entity"><span>tms</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>exhaust</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"..."</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
      </span><span class="inner_quoted"><span>")."</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>subclass_of</span></span><span> </span><span class="entity"><span>sub</span></span><span> </span><span class="entity"><span>super</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"subclass("</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>sub</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>", "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>super</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")."</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>formula</span></span><span> </span><span class="entity"><span>pred</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Formula</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>ident</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>kind</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>info</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>pred</span></span><span> </span><span class="entity"><span>kind</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rank</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>extract_isabelle_rank</span></span><span> </span><span class="entity"><span>info</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="inner_quoted"><span>"formula("</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>dfg_string_of_formula</span></span><span> </span><span class="entity"><span>poly</span></span><span> </span><span class="entity"><span>gen_simp</span></span><span> </span><span class="entity"><span>info</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>", "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>ident</span></span><span> </span><span>^</span><span>
            </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>rank</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>default_rank</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>", "</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>rank</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
            </span><span class="inner_quoted"><span>")."</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>maybe_alt</span></span><span> </span><span class="entity"><span>alt</span></span><span>
            </span><span>|&gt;</span><span> </span><span>SOME</span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
          </span><span>NONE</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>formula</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>filt</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map_filter</span><span> </span><span class="entity"><span>f</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>filter_out</span><span> </span><span>null</span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>func_aries</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>filt</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Sym_Decl</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_function_atype</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm_ary</span></span><span> </span><span class="entity"><span>sym</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>NONE</span><span>
             </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>flat</span><span> </span><span>|&gt;</span><span> </span><span>commas</span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>maybe_enclose</span></span><span> </span><span class="inner_quoted"><span>"functions ["</span></span><span> </span><span class="inner_quoted"><span>"]."</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_aries</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>filt</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Sym_Decl</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_predicate_atype</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm_ary</span></span><span> </span><span class="entity"><span>sym</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>NONE</span><span>
             </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>flat</span><span> </span><span>|&gt;</span><span> </span><span>commas</span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>maybe_enclose</span></span><span> </span><span class="inner_quoted"><span>"predicates ["</span></span><span> </span><span class="inner_quoted"><span>"]."</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sorts</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>filt</span></span><span> </span><span class="main"><span>(</span></span><span>try</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Type_Decl</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ary</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>ty_ary</span></span><span> </span><span class="entity"><span>ary</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span>
      </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><span class="entity"><span>ty_ary</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="entity"><span>dfg_individual_type</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>
      </span><span>|&gt;</span><span> </span><span>flat</span><span> </span><span>|&gt;</span><span> </span><span>commas</span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>maybe_enclose</span></span><span> </span><span class="inner_quoted"><span>"sorts ["</span></span><span> </span><span class="inner_quoted"><span>"]."</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>classes</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>filt</span></span><span> </span><span class="main"><span>(</span></span><span>try</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Class_Decl</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cl</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>cl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>flat</span><span> </span><span>|&gt;</span><span> </span><span>commas</span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>maybe_enclose</span></span><span> </span><span class="inner_quoted"><span>"classes ["</span></span><span> </span><span class="inner_quoted"><span>"]."</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ord_info</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>gen_weights</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>gen_prec</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>ord_info</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>do_term_order_weights</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>gen_weights</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>ord_info</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>spair</span></span><span> </span><span>o</span><span> </span><span>apsnd</span><span> </span><span>string_of_int</span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>commas</span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>maybe_enclose</span></span><span> </span><span class="inner_quoted"><span>"weights ["</span></span><span> </span><span class="inner_quoted"><span>"]."</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>syms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>func_aries</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pred_aries</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>do_term_order_weights</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sorts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>classes</span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>func_decls</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>filt</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Sym_Decl</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_function_atype</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fun_typ</span></span><span> </span><span class="entity"><span>sym</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>NONE</span><span>
             </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>flat</span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_decls</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>filt</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Sym_Decl</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_nontrivial_predicate_atype</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pred_typ</span></span><span> </span><span class="entity"><span>sym</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>NONE</span><span>
             </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>flat</span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>datatype_decls</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>filt</span></span><span> </span><span class="main"><span>(</span></span><span>try</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Datatype_Decl</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>exhaust</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>datatype_decl</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="entity"><span>tms</span></span><span> </span><span class="entity"><span>exhaust</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>flat</span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sort_decls</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>filt</span></span><span> </span><span class="main"><span>(</span></span><span>try</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Class_Memb</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cl</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>sort_decl</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="entity"><span>cl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>flat</span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>subclass_decls</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>filt</span></span><span> </span><span class="main"><span>(</span></span><span>try</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Class_Decl</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>supers</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                    </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>subclass_of</span></span><span> </span><span class="entity"><span>sub</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>supers</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>flat</span><span> </span><span>|&gt;</span><span> </span><span>flat</span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>decls</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>func_decls</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pred_decls</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>datatype_decls</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>sort_decls</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>subclass_decls</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>axioms</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>filt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>formula</span></span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>&lt;&gt;</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Conjecture</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>separate</span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>""</span></span><span class="main"><span>]</span></span><span> </span><span>|&gt;</span><span> </span><span>flat</span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>conjs</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>filt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>formula</span></span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Conjecture</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>separate</span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>""</span></span><span class="main"><span>]</span></span><span> </span><span>|&gt;</span><span> </span><span>flat</span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>settings</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_lpo</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"set_flag(Ordering, 1)."</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>gen_prec</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
         </span><span class="main"><span>[</span></span><span class="entity"><span>ord_info</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span>fst</span><span> </span><span>|&gt;</span><span> </span><span>rev</span><span> </span><span>|&gt;</span><span> </span><span>commas</span><span>
                   </span><span>|&gt;</span><span> </span><span class="entity"><span>maybe_enclose</span></span><span> </span><span class="inner_quoted"><span>"set_precedence("</span></span><span> </span><span class="inner_quoted"><span>")."</span></span><span class="main"><span>]</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
         </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>list_of</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>list_of</span></span><span> </span><span class="entity"><span>heading</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="inner_quoted"><span>"list_of_"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>heading</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>".\n"</span></span><span> </span><span>::</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>suffix</span><span> </span><span class="inner_quoted"><span>"\n"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span>@</span><span>
        </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"end_of_list.\n\n"</span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="inner_quoted"><span>"\nbegin_problem(isabelle).\n\n"</span></span><span> </span><span>::</span><span>
    </span><span class="entity"><span>list_of</span></span><span> </span><span class="inner_quoted"><span>"descriptions"</span></span><span>
            </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"name({**})."</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"author({**})."</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"status(unknown)."</span></span><span class="main"><span>,</span></span><span>
             </span><span class="inner_quoted"><span>"description({**})."</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span>
    </span><span class="entity"><span>list_of</span></span><span> </span><span class="inner_quoted"><span>"symbols"</span></span><span> </span><span class="entity"><span>syms</span></span><span> </span><span>@</span><span>
    </span><span class="entity"><span>list_of</span></span><span> </span><span class="inner_quoted"><span>"declarations"</span></span><span> </span><span class="entity"><span>decls</span></span><span> </span><span>@</span><span>
    </span><span class="entity"><span>list_of</span></span><span> </span><span class="inner_quoted"><span>"formulae(axioms)"</span></span><span> </span><span class="entity"><span>axioms</span></span><span> </span><span>@</span><span>
    </span><span class="entity"><span>list_of</span></span><span> </span><span class="inner_quoted"><span>"formulae(conjectures)"</span></span><span> </span><span class="entity"><span>conjs</span></span><span> </span><span>@</span><span>
    </span><span class="entity"><span>list_of</span></span><span> </span><span class="inner_quoted"><span>"settings(SPASS)"</span></span><span> </span><span class="entity"><span>settings</span></span><span> </span><span>@</span><span>
    </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"end_problem.\n"</span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>lines_of_atp_problem</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="entity"><span>ord_info</span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="inner_quoted"><span>"% This file was generated by Isabelle (most likely Sledgehammer)\n\
  \% "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>timestamp</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"\n"</span></span><span> </span><span>::</span><span>
  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
     </span><span class="entity"><span>DFG</span></span><span> </span><span class="entity"><span>poly</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>dfg_lines</span></span><span> </span><span class="entity"><span>poly</span></span><span> </span><span class="entity"><span>ord_info</span></span><span>
   </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>tptp_lines</span></span><span> </span><span class="entity"><span>format</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>problem</span></span><span>


</span><span class="comment1"><span>(** CNF (Metis) and CNF UEQ (Waldmeister) **)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_line_negated</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Formula</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>AConn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ANot</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_line_negated</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_line_cnf_ueq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Formula</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>AAtom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>is_tptp_equal</span></span><span> </span><span class="entity"><span>s</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_line_cnf_ueq</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>open_conjecture_term</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_tptp_variable</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span> </span><span>|&gt;</span><span> </span><span>Name.desymbolize</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>false</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s'</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tms</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="entity"><span>open_conjecture_term</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>open_conjecture_term</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Fail</span><span> </span><span class="inner_quoted"><span>"unexpected higher-order term"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>open_formula</span></span><span> </span><span class="entity"><span>conj</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="comment1"><span>(* We are conveniently assuming that all bound variable names are
       distinct, which should be the case for the formulas we generate. *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>opn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pos</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>SOME</span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AQuant</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AForall</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>opn</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="entity"><span>phi</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>opn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pos</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>SOME</span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AQuant</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AExists</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>opn</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="entity"><span>phi</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>opn</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AConn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ANot</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>phi</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_anot</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>opn</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span>not</span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>opn</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AConn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>phi1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pos1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pos2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>polarities_of_conn</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="entity"><span>AConn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>opn</span></span><span> </span><span class="entity"><span>pos1</span></span><span> </span><span class="entity"><span>phi1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>opn</span></span><span> </span><span class="entity"><span>pos2</span></span><span> </span><span class="entity"><span>phi2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>opn</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AAtom</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>AAtom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>conj</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>open_conjecture_term</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>opn</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>phi</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>opn</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>not</span><span> </span><span class="entity"><span>conj</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>open_formula_line</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Formula</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ident</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>kind</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>source</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>info</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Formula</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ident</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>kind</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>open_formula</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>kind</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Conjecture</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>source</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>info</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>open_formula_line</span></span><span> </span><span class="entity"><span>line</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>line</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>negate_conjecture_line</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Formula</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ident</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Conjecture</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>source</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>info</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Formula</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ident</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Hypothesis</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_anot</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>source</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>info</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>negate_conjecture_line</span></span><span> </span><span class="entity"><span>line</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>line</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>exception</span></span></span><span> </span><span class="entity"><span>CLAUSIFY</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>unit</span><span>

</span><span class="comment1"><span>(* This "clausification" only expands syntactic sugar, such as "phi =&gt; psi" to
   "~ phi | psi" and "phi &lt;=&gt; psi" to "~ phi | psi" and "~ psi | phi". We don't
   attempt to distribute conjunctions over disjunctions. *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>clausify_formula</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>phi</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>AAtom</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>phi</span></span><span> </span><span>|&gt;</span><span> </span><span>not</span><span> </span><span class="entity"><span>pos</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>mk_anot</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>clausify_formula</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AConn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ANot</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>phi</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>clausify_formula</span></span><span> </span><span class="main"><span>(</span></span><span>not</span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>phi</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>clausify_formula</span></span><span> </span><span>true</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AConn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AOr</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>phi1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>phi1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi2</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>apply2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>clausify_formula</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span>
                 </span><span>|&gt;</span><span> </span><span>uncurry</span><span> </span><span class="main"><span>(</span></span><span>map_product</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_aconn</span></span><span> </span><span class="entity"><span>AOr</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>clausify_formula</span></span><span> </span><span>false</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AConn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AAnd</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>phi1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>phi1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi2</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>apply2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>clausify_formula</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span>
                 </span><span>|&gt;</span><span> </span><span>uncurry</span><span> </span><span class="main"><span>(</span></span><span>map_product</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_aconn</span></span><span> </span><span class="entity"><span>AOr</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>clausify_formula</span></span><span> </span><span>true</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AConn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AImplies</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>phi1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>clausify_formula</span></span><span> </span><span>true</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AConn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AOr</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mk_anot</span></span><span> </span><span class="entity"><span>phi1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>clausify_formula</span></span><span> </span><span>true</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AConn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AIff</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phis</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>clausify_formula</span></span><span> </span><span>true</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AConn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AImplies</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phis</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span>
    </span><span class="entity"><span>clausify_formula</span></span><span> </span><span>true</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AConn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AImplies</span></span><span class="main"><span>,</span></span><span> </span><span>rev</span><span> </span><span class="entity"><span>phis</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>clausify_formula</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>CLAUSIFY</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>clausify_formula_line</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Formula</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>ident</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>kind</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>source</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>info</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phis</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span>|&gt;</span><span> </span><span>try</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>clausify_formula</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>these</span><span> </span><span>|&gt;</span><span> </span><span>`</span><span>length</span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
               </span><span class="entity"><span>Formula</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>ident</span></span><span> </span><span>^</span><span> </span><span>replicate_string</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"x"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>kind</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>source</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>info</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
           </span><span class="entity"><span>phis</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>clausify_formula_line</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>ensure_cnf_line</span></span><span> </span><span class="entity"><span>line</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>line</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>open_formula_line</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>negate_conjecture_line</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>clausify_formula_line</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>ensure_cnf_problem</span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>apsnd</span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="entity"><span>ensure_cnf_line</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>filter_cnf_ueq_problem</span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>problem</span></span><span>
  </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>apsnd</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>open_formula_line</span></span><span> </span><span>#&gt;</span><span> </span><span>filter</span><span> </span><span class="entity"><span>is_line_cnf_ueq</span></span><span>
                 </span><span>#&gt;</span><span> </span><span>map</span><span> </span><span class="entity"><span>negate_conjecture_line</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
           </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lines</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span>|&gt;</span><span> </span><span>maps</span><span> </span><span>snd</span><span>
           </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>conjs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lines</span></span><span> </span><span>|&gt;</span><span> </span><span>filter</span><span> </span><span class="entity"><span>is_line_negated</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>length</span><span> </span><span class="entity"><span>conjs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>conjs</span></span><span> </span><span>&lt;&gt;</span><span> </span><span class="entity"><span>lines</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>


</span><span class="comment1"><span>(** Symbol declarations **)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>add_declared_in_line</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Decl</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cl</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>cons</span><span> </span><span class="entity"><span>cl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>add_declared_in_line</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Decl</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>apsnd</span><span> </span><span class="main"><span>(</span></span><span>cons</span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>add_declared_in_line</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Sym_Decl</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apsnd</span><span> </span><span class="main"><span>(</span></span><span>cons</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>add_declared_in_line</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>I</span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>declared_in_atp_problem</span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>fold</span><span> </span><span class="entity"><span>add_declared_in_line</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

</span><span class="comment1"><span>(** Nice names **)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>no_qualifiers</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>skip</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>skip</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>#"."</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>cs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>skip</span></span><span> </span><span class="entity"><span>cs</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>skip</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>cs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Char.isAlphaNum</span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>skip</span></span><span> </span><span class="entity"><span>cs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>keep</span></span><span> </span><span class="entity"><span>cs</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>keep</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>keep</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>#"."</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>cs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>skip</span></span><span> </span><span class="entity"><span>cs</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>keep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>cs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>keep</span></span><span> </span><span class="entity"><span>cs</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>String.explode</span><span> </span><span>#&gt;</span><span> </span><span>rev</span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>keep</span></span><span> </span><span>#&gt;</span><span> </span><span>rev</span><span> </span><span>#&gt;</span><span> </span><span>String.implode</span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="comment1"><span>(* Long names can slow down the ATPs. *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>max_readable_name_size</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>20</span></span><span>

</span><span class="comment1"><span>(* "equal" is reserved by some ATPs. "op" is also reserved, to avoid the
   unreadable "op_1", "op_2", etc., in the problem files. "eq" is reserved to
   ensure that "HOL.eq" is correctly mapped to equality (not clear whether this
   is still necessary). *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>reserved_nice_names</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>tptp_old_equal</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"op"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"eq"</span></span><span class="main"><span>]</span></span><span>

</span><span class="comment1"><span>(* hack to get the same hashing across Mirabelle runs (see "mirabelle.pl") *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>cleanup_mirabelle_name</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mirabelle_infix</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"_Mirabelle_"</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>random_suffix_len</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>10</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Substring.position</span><span> </span><span class="entity"><span>mirabelle_infix</span></span><span> </span><span class="main"><span>(</span></span><span>Substring.full</span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Substring.isEmpty</span><span> </span><span class="entity"><span>s2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span class="entity"><span>s</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span>Substring.string</span><span> </span><span class="entity"><span>s1</span></span><span> </span><span>^</span><span>
      </span><span>Substring.string</span><span> </span><span class="main"><span>(</span></span><span>Substring.triml</span><span> </span><span class="main"><span>(</span></span><span>size</span><span> </span><span class="entity"><span>mirabelle_infix</span></span><span> </span><span>+</span><span> </span><span class="entity"><span>random_suffix_len</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>s2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>readable_name</span></span><span> </span><span class="entity"><span>protect</span></span><span> </span><span class="entity"><span>full_name</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>full_name</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
     </span><span class="entity"><span>s</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
     </span><span class="entity"><span>s</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>no_qualifiers</span></span><span>
       </span><span>|&gt;</span><span> </span><span class="entity"><span>unquote_tvar</span></span><span>
       </span><span>|&gt;</span><span> </span><span>Name.desymbolize</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Char.isUpper</span><span> </span><span class="main"><span>(</span></span><span>String.sub</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>full_name</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
       </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>size</span><span> </span><span class="entity"><span>s</span></span><span> </span><span>&gt;</span><span> </span><span class="entity"><span>max_readable_name_size</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                </span><span>String.substring</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_readable_name_size</span></span><span> </span><span>div</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>4</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
                </span><span>string_of_int</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>hash_string</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cleanup_mirabelle_name</span></span><span> </span><span class="entity"><span>full_name</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
                </span><span>String.extract</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span>size</span><span> </span><span class="entity"><span>s</span></span><span> </span><span>-</span><span> </span><span class="entity"><span>max_readable_name_size</span></span><span> </span><span>div</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>4</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span>
       </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>reserved_nice_names</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>full_name</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span>|&gt;</span><span> </span><span class="entity"><span>protect</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>nice_name</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>full_name</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>full_name</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>nice_name</span></span><span> </span><span class="entity"><span>protect</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>full_name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>desired_name</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>the_pool</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_built_in_tptp_symbol</span></span><span> </span><span class="entity"><span>full_name</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>full_name</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>the_pool</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Symtab.lookup</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>the_pool</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>full_name</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span>SOME</span><span> </span><span class="entity"><span>nice_name</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nice_name</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>the_pool</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nice_prefix</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>readable_name</span></span><span> </span><span class="entity"><span>protect</span></span><span> </span><span class="entity"><span>full_name</span></span><span> </span><span class="entity"><span>desired_name</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>add</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nice_name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nice_prefix</span></span><span> </span><span>^</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Symtab.lookup</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="entity"><span>the_pool</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>nice_name</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                </span><span>SOME</span><span> </span><span class="entity"><span>full_name'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>full_name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>full_name'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nice_name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>the_pool</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>add</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>nice_name</span></span><span class="main"><span>,</span></span><span>
                 </span><span class="main"><span>(</span></span><span>Symtab.update_new</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>full_name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nice_name</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>the_pool</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>Symtab.update_new</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nice_name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>full_name</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="entity"><span>the_pool</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>add</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>|&gt;</span><span> </span><span>apsnd</span><span> </span><span>SOME</span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>avoid_clash_with_dfg_keywords</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>String.size</span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span>&lt;</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>String.sub</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>String.sub</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span>
       </span><span>String.isSubstring</span><span> </span><span class="inner_quoted"><span>"_"</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span class="entity"><span>s</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_tptp_variable</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span class="entity"><span>s</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"_"</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span>String.substring</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
      </span><span>String.str</span><span> </span><span class="main"><span>(</span></span><span>Char.toUpper</span><span> </span><span class="main"><span>(</span></span><span>String.sub</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>nice_atp_problem</span></span><span> </span><span class="entity"><span>readable_names</span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>empty_pool</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>readable_names</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Symtab.empty</span><span class="main"><span>,</span></span><span> </span><span>Symtab.empty</span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>NONE</span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>avoid_clash</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>format</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span class="entity"><span>DFG</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>avoid_clash_with_dfg_keywords</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>I</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nice_name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nice_name</span></span><span> </span><span class="entity"><span>avoid_clash</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>nice_bound_tvars</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nice_name</span></span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span>
      </span><span>##&gt;&gt;</span><span> </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span>fold_map</span><span> </span><span class="entity"><span>nice_name</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span>
      </span><span>#&gt;&gt;</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>~~</span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>nice_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AType</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>clss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>nice_name</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span>##&gt;&gt;</span><span> </span><span>fold_map</span><span> </span><span class="entity"><span>nice_name</span></span><span> </span><span class="entity"><span>clss</span></span><span> </span><span>##&gt;&gt;</span><span> </span><span>fold_map</span><span> </span><span class="entity"><span>nice_type</span></span><span> </span><span class="entity"><span>tys</span></span><span> </span><span>#&gt;&gt;</span><span> </span><span class="entity"><span>AType</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>nice_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AFun</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ty1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nice_type</span></span><span> </span><span class="entity"><span>ty1</span></span><span> </span><span>##&gt;&gt;</span><span> </span><span class="entity"><span>nice_type</span></span><span> </span><span class="entity"><span>ty2</span></span><span> </span><span>#&gt;&gt;</span><span> </span><span class="entity"><span>AFun</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>nice_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>APi</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_map</span><span> </span><span class="entity"><span>nice_name</span></span><span> </span><span class="entity"><span>names</span></span><span> </span><span>##&gt;&gt;</span><span> </span><span class="entity"><span>nice_type</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span>#&gt;&gt;</span><span> </span><span class="entity"><span>APi</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>nice_term</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>nice_name</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span>##&gt;&gt;</span><span> </span><span>fold_map</span><span> </span><span class="entity"><span>nice_type</span></span><span> </span><span class="entity"><span>tys</span></span><span> </span><span>##&gt;&gt;</span><span> </span><span>fold_map</span><span> </span><span class="entity"><span>nice_term</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span>#&gt;&gt;</span><span> </span><span class="entity"><span>ATerm</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>nice_term</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AAbs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>nice_name</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span>##&gt;&gt;</span><span> </span><span class="entity"><span>nice_type</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span>##&gt;&gt;</span><span> </span><span class="entity"><span>nice_term</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span>##&gt;&gt;</span><span> </span><span>fold_map</span><span> </span><span class="entity"><span>nice_term</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span>#&gt;&gt;</span><span> </span><span class="entity"><span>AAbs</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>nice_formula</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATyQuant</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>q</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nice_type</span></span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span>
        </span><span>##&gt;&gt;</span><span> </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span>fold_map</span><span> </span><span class="entity"><span>nice_name</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span>
        </span><span>##&gt;&gt;</span><span> </span><span class="entity"><span>nice_formula</span></span><span> </span><span class="entity"><span>phi</span></span><span>
        </span><span>#&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>tys</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cls</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>ATyQuant</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>q</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>cls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>nice_formula</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AQuant</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>q</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nice_name</span></span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span>
        </span><span>##&gt;&gt;</span><span> </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>pair</span><span> </span><span>NONE</span><span>
                        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>nice_type</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span>#&gt;&gt;</span><span> </span><span>SOME</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span>
        </span><span>##&gt;&gt;</span><span> </span><span class="entity"><span>nice_formula</span></span><span> </span><span class="entity"><span>phi</span></span><span>
        </span><span>#&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>ss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>AQuant</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>q</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>nice_formula</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AConn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phis</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span>fold_map</span><span> </span><span class="entity"><span>nice_formula</span></span><span> </span><span class="entity"><span>phis</span></span><span> </span><span>#&gt;&gt;</span><span> </span><span>curry</span><span> </span><span class="entity"><span>AConn</span></span><span> </span><span class="entity"><span>c</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>nice_formula</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AAtom</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nice_term</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span>#&gt;&gt;</span><span> </span><span class="entity"><span>AAtom</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>nice_line</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Decl</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ident</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cl</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cls</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>nice_name</span></span><span> </span><span class="entity"><span>cl</span></span><span> </span><span>##&gt;&gt;</span><span> </span><span>fold_map</span><span> </span><span class="entity"><span>nice_name</span></span><span> </span><span class="entity"><span>cls</span></span><span>
        </span><span>#&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cl</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cls</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Class_Decl</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ident</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cl</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cls</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>nice_line</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Decl</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ident</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ary</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>nice_name</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span>#&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Type_Decl</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ident</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ary</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>nice_line</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Sym_Decl</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ident</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>nice_name</span></span><span> </span><span class="entity"><span>sym</span></span><span> </span><span>##&gt;&gt;</span><span> </span><span class="entity"><span>nice_type</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span>#&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Sym_Decl</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ident</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>nice_line</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Datatype_Decl</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ident</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>exhaust</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>nice_bound_tvars</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span>##&gt;&gt;</span><span> </span><span class="entity"><span>nice_type</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span>##&gt;&gt;</span><span> </span><span>fold_map</span><span> </span><span class="entity"><span>nice_term</span></span><span> </span><span class="entity"><span>tms</span></span><span>
        </span><span>#&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Datatype_Decl</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ident</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>exhaust</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>nice_line</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Memb</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ident</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>nice_bound_tvars</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span>##&gt;&gt;</span><span> </span><span class="entity"><span>nice_type</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span>##&gt;&gt;</span><span> </span><span class="entity"><span>nice_name</span></span><span> </span><span class="entity"><span>cl</span></span><span>
        </span><span>#&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cl</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Class_Memb</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ident</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>nice_line</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Formula</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ident</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>kind</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>source</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>info</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>nice_formula</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span>#&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Formula</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ident</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>kind</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>source</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>info</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>nice_problem</span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>heading</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lines</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>fold_map</span><span> </span><span class="entity"><span>nice_line</span></span><span> </span><span class="entity"><span>lines</span></span><span> </span><span>#&gt;&gt;</span><span> </span><span>pair</span><span> </span><span class="entity"><span>heading</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>problem</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>nice_problem</span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span class="entity"><span>empty_pool</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span></pre>
</body>

</html>