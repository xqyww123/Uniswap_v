<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹Tools/ATP/atp_proof_redirect.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹Tools/ATP/atp_proof_redirect.ML›</h1>
</div>

<pre class="source"><span class="comment1"><span>(*  Title:      HOL/Tools/ATP/atp_proof_redirect.ML
    Author:     Jasmin Blanchette, TU Muenchen

Transformation of a proof by contradiction into a direct proof.
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>ATP_ATOM</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>key</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> ord </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>key</span></span><span> </span><span>ord</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> string_of </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>key</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>ATP_PROOF_REDIRECT</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>atom</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> Atom_Graph </span><span class="main"><span>:</span></span><span> </span><span>GRAPH</span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>refute_sequent</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>atom</span></span><span> </span><span>list</span><span> * </span><span class="entity"><span>atom</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>refute_graph</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>unit</span><span> </span><span>Atom_Graph.T</span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>clause</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>atom</span></span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>direct_sequent</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>atom</span></span><span> * </span><span class="main"><span>(</span></span><span class="entity"><span>atom</span></span><span> </span><span>list</span><span> * </span><span class="entity"><span>clause</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>direct_graph</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>unit</span><span> </span><span>Atom_Graph.T</span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>rich_sequent</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>atom</span></span><span> * </span><span class="main"><span>(</span></span><span class="entity"><span>clause</span></span><span> </span><span>list</span><span> * </span><span class="entity"><span>clause</span></span><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>direct_inference</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Have</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rich_sequent </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Cases</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span>clause * direct_inference list</span><span class="main"><span>)</span></span><span> list

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>direct_proof</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>direct_inference</span></span><span> </span><span>list</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> make_refute_graph </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>atom</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>atom</span></span><span> </span><span>list</span><span> * </span><span class="entity"><span>atom</span></span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>refute_graph</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> axioms_of_refute_graph </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>refute_graph</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>atom</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>atom</span></span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tainted_atoms_of_refute_graph </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>refute_graph</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>atom</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>atom</span></span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> sequents_of_refute_graph </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>refute_graph</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>refute_sequent</span></span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> string_of_refute_graph </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>refute_graph</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> redirect_sequent </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>atom</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>atom</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>refute_sequent</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>direct_sequent</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> direct_graph </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>direct_sequent</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>direct_graph</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> redirect_graph </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>atom</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>atom</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>atom</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>refute_graph</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>direct_proof</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> succedent_of_cases </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>clause</span></span><span> * </span><span class="entity"><span>direct_inference</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>clause</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> string_of_direct_proof </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>direct_proof</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>functor</span></span></span><span> </span><span class="entity"><span>ATP_Proof_Redirect</span></span><span class="main"><span>(</span></span><span>Atom </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>ATP_ATOM</span></span><span class="main"><span>)</span></span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>ATP_PROOF_REDIRECT</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>atom</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Atom.key</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Atom_Graph</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Graph</span><span class="main"><span>(</span></span><span class="entity"><span>Atom</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>refute_sequent</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>atom</span></span><span> </span><span>list</span><span> * </span><span class="entity"><span>atom</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>refute_graph</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>unit</span><span> </span><span>Atom_Graph.T</span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>clause</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>atom</span></span><span> </span><span>list</span><span>
</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>direct_sequent</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>atom</span></span><span> * </span><span class="main"><span>(</span></span><span class="entity"><span>atom</span></span><span> </span><span>list</span><span> * </span><span class="entity"><span>clause</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>direct_graph</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>unit</span><span> </span><span>Atom_Graph.T</span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>rich_sequent</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>atom</span></span><span> * </span><span class="main"><span>(</span></span><span class="entity"><span>clause</span></span><span> </span><span>list</span><span> * </span><span class="entity"><span>clause</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>direct_inference</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Have</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rich_sequent </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Cases</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span>clause * direct_inference list</span><span class="main"><span>)</span></span><span> list

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>direct_proof</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>direct_inference</span></span><span> </span><span>list</span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>atom_eq</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>is_equal</span><span> </span><span>o</span><span> </span><span class="entity"><span>Atom.ord</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>clause_ord</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>dict_ord</span><span> </span><span class="entity"><span>Atom.ord</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>direct_sequent_ord</span></span><span> </span><span class="entity"><span>seqp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>prod_ord</span><span> </span><span class="entity"><span>clause_ord</span></span><span> </span><span class="entity"><span>clause_ord</span></span><span> </span><span class="main"><span>(</span></span><span>apply2</span><span> </span><span>snd</span><span> </span><span class="entity"><span>seqp</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>direct_sequent_eq</span></span><span> </span><span class="entity"><span>seqp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>is_equal</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>direct_sequent_ord</span></span><span> </span><span class="entity"><span>seqp</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>make_refute_graph</span></span><span> </span><span class="entity"><span>bot</span></span><span> </span><span class="entity"><span>infers</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>add_edge</span></span><span> </span><span class="entity"><span>to</span></span><span> </span><span class="entity"><span>from</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Atom_Graph.default_node</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>from</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span>#&gt;</span><span> </span><span>Atom_Graph.add_edge_acyclic</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>from</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>to</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>add_infer</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>froms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>to</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Atom_Graph.default_node</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>to</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span>#&gt;</span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>add_edge</span></span><span> </span><span class="entity"><span>to</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>froms</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>graph</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="entity"><span>add_infer</span></span><span> </span><span class="entity"><span>infers</span></span><span> </span><span>Atom_Graph.empty</span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>reachable</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Atom_Graph.all_preds</span><span> </span><span class="entity"><span>graph</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>bot</span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>graph</span></span><span> </span><span>|&gt;</span><span> </span><span>Atom_Graph.restrict</span><span> </span><span class="main"><span>(</span></span><span>member</span><span> </span><span class="main"><span>(</span></span><span>is_equal</span><span> </span><span>o</span><span> </span><span class="entity"><span>Atom.ord</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>reachable</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>axioms_of_refute_graph</span></span><span> </span><span class="entity"><span>refute_graph</span></span><span> </span><span class="entity"><span>conjs</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>subtract</span><span> </span><span class="entity"><span>atom_eq</span></span><span> </span><span class="entity"><span>conjs</span></span><span> </span><span class="main"><span>(</span></span><span>Atom_Graph.minimals</span><span> </span><span class="entity"><span>refute_graph</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tainted_atoms_of_refute_graph</span></span><span> </span><span class="entity"><span>refute_graph</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Atom_Graph.all_succs</span><span> </span><span class="entity"><span>refute_graph</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>sequents_of_refute_graph</span></span><span> </span><span class="entity"><span>refute_graph</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Atom_Graph.keys</span><span> </span><span class="entity"><span>refute_graph</span></span><span>
  </span><span>|&gt;</span><span> </span><span>filter_out</span><span> </span><span class="main"><span>(</span></span><span>Atom_Graph.is_minimal</span><span> </span><span class="entity"><span>refute_graph</span></span><span class="main"><span>)</span></span><span>
  </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>`</span><span class="main"><span>(</span></span><span>Atom_Graph.immediate_preds</span><span> </span><span class="entity"><span>refute_graph</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>string_of_context</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>Atom.string_of</span></span><span> </span><span>#&gt;</span><span> </span><span>space_implode</span><span> </span><span class="inner_quoted"><span>", "</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_of_sequent</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>gamma</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>string_of_context</span></span><span> </span><span class="entity"><span>gamma</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" ⊢ "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>Atom.string_of</span></span><span> </span><span class="entity"><span>c</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_of_refute_graph</span></span><span> </span><span class="entity"><span>refute_graph</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>refute_graph</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>sequents_of_refute_graph</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="entity"><span>string_of_sequent</span></span><span> </span><span>|&gt;</span><span> </span><span>cat_lines</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>redirect_sequent</span></span><span> </span><span class="entity"><span>tainted</span></span><span> </span><span class="entity"><span>bot</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>gamma</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>member</span><span> </span><span class="entity"><span>atom_eq</span></span><span> </span><span class="entity"><span>tainted</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
     </span><span class="entity"><span>gamma</span></span><span> </span><span>|&gt;</span><span> </span><span>List.partition</span><span> </span><span class="main"><span>(</span></span><span>not</span><span> </span><span>o</span><span> </span><span>member</span><span> </span><span class="entity"><span>atom_eq</span></span><span> </span><span class="entity"><span>tainted</span></span><span class="main"><span>)</span></span><span>
           </span><span>|&gt;&gt;</span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>atom_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bot</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>?</span><span> </span><span>cons</span><span> </span><span class="entity"><span>c</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
     </span><span class="main"><span>(</span></span><span class="entity"><span>gamma</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>c</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>direct_graph</span></span><span> </span><span class="entity"><span>seqs</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>add_edge</span></span><span> </span><span class="entity"><span>from</span></span><span> </span><span class="entity"><span>to</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Atom_Graph.default_node</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>from</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span>#&gt;</span><span> </span><span>Atom_Graph.default_node</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>to</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span>#&gt;</span><span> </span><span>Atom_Graph.add_edge_acyclic</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>from</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>to</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>add_seq</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>gamma</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>add_edge</span></span><span> </span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>gamma</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>fold</span><span> </span><span class="entity"><span>add_seq</span></span><span> </span><span class="entity"><span>seqs</span></span><span> </span><span>Atom_Graph.empty</span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>disj</span></span><span> </span><span class="entity"><span>cs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>union</span><span> </span><span class="entity"><span>atom_eq</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>cs</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span>|&gt;</span><span> </span><span>sort</span><span> </span><span class="entity"><span>Atom.ord</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>succedent_of_inference</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Have</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>c</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>succedent_of_inference</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Cases</span></span><span> </span><span class="entity"><span>cases</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>succedent_of_cases</span></span><span> </span><span class="entity"><span>cases</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>succedent_of_case</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>c</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>succedent_of_case</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>infs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>succedent_of_inference</span></span><span> </span><span class="main"><span>(</span></span><span>List.last</span><span> </span><span class="entity"><span>infs</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>succedent_of_cases</span></span><span> </span><span class="entity"><span>cases</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>disj</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>succedent_of_case</span></span><span> </span><span class="entity"><span>cases</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>descendants</span></span><span> </span><span class="entity"><span>direct_graph</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>these</span><span> </span><span>o</span><span> </span><span>try</span><span> </span><span class="main"><span>(</span></span><span>Atom_Graph.all_succs</span><span> </span><span class="entity"><span>direct_graph</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>single</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>zones_of</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>zones_of</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bs</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>bss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>subtract</span><span> </span><span class="entity"><span>atom_eq</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bs</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>zones_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bss</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>bs</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>redirect_graph</span></span><span> </span><span class="entity"><span>axioms</span></span><span> </span><span class="entity"><span>tainted</span></span><span> </span><span class="entity"><span>bot</span></span><span> </span><span class="entity"><span>refute_graph</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>seqs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>redirect_sequent</span></span><span> </span><span class="entity"><span>tainted</span></span><span> </span><span class="entity"><span>bot</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sequents_of_refute_graph</span></span><span> </span><span class="entity"><span>refute_graph</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>direct_graph</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>direct_graph</span></span><span> </span><span class="entity"><span>seqs</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>redirect</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="entity"><span>proved</span></span><span> </span><span class="entity"><span>seqs</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>seqs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>length</span><span> </span><span class="entity"><span>c</span></span><span> </span><span>&lt;</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>proved</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>proved</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>provable</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>gamma</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>subset</span><span> </span><span class="entity"><span>atom_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>gamma</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>proved</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>seqs</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>horn_provable</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>true</span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>provable</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>seq</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>gamma</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>horn_provable</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>provable</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
              </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Fail</span><span> </span><span class="inner_quoted"><span>"ill-formed refutation graph"</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>next</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>next</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="entity"><span>Have</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>single</span><span> </span><span class="entity"><span>gamma</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span>
          </span><span class="entity"><span>redirect</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="entity"><span>proved</span></span><span> </span><span class="main"><span>(</span></span><span>filter</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="main"><span>(</span></span><span>not</span><span> </span><span>o</span><span> </span><span class="entity"><span>direct_sequent_eq</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>seq</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>seqs</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>subsequents</span></span><span> </span><span class="entity"><span>seqs</span></span><span> </span><span class="entity"><span>zone</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>gamma</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>subset</span><span> </span><span class="entity"><span>atom_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>gamma</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>zone</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>proved</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>seqs</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>zones</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>zones_of</span></span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>descendants</span></span><span> </span><span class="entity"><span>direct_graph</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>subseqss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>subsequents</span></span><span> </span><span class="entity"><span>seqs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>zones</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>seqs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>subtract</span><span> </span><span class="entity"><span>direct_sequent_eq</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>subseqss</span></span><span> </span><span class="entity"><span>seqs</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cases</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>subseqs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>l</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>redirect</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>l</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>proved</span></span><span> </span><span class="entity"><span>subseqs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="entity"><span>subseqss</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="entity"><span>Cases</span></span><span> </span><span class="entity"><span>cases</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>redirect</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>succedent_of_cases</span></span><span> </span><span class="entity"><span>cases</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>proved</span></span><span> </span><span class="entity"><span>seqs</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>redirect</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>axioms</span></span><span> </span><span class="entity"><span>seqs</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>indent</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>indent</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"  "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>indent</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_of_clause</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"⊥"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_clause</span></span><span> </span><span class="entity"><span>ls</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>space_implode</span><span> </span><span class="inner_quoted"><span>" ∨ "</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>Atom.string_of</span></span><span> </span><span class="entity"><span>ls</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_of_rich_sequent</span></span><span> </span><span class="entity"><span>ch</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>cs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>commas</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>string_of_clause</span></span><span> </span><span class="entity"><span>cs</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>ch</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_of_clause</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span>^</span><span>
  </span><span class="inner_quoted"><span>" (* "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>Atom.string_of</span></span><span> </span><span class="entity"><span>id</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" *)"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_of_case</span></span><span> </span><span class="entity"><span>depth</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>proof</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>indent</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>depth</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_of_clause</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"]"</span></span><span>
  </span><span>|&gt;</span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span>null</span><span> </span><span class="entity"><span>proof</span></span><span class="main"><span>)</span></span><span> </span><span>?</span><span> </span><span>suffix</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"\n"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_of_subproof</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>depth</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>proof</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>string_of_inference</span></span><span> </span><span class="entity"><span>depth</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Have</span></span><span> </span><span class="entity"><span>seq</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>indent</span></span><span> </span><span class="entity"><span>depth</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_of_rich_sequent</span></span><span> </span><span class="inner_quoted"><span>"▹"</span></span><span> </span><span class="entity"><span>seq</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_inference</span></span><span> </span><span class="entity"><span>depth</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Cases</span></span><span> </span><span class="entity"><span>cases</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>indent</span></span><span> </span><span class="entity"><span>depth</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"[\n"</span></span><span> </span><span>^</span><span>
    </span><span>space_implode</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"\n"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>indent</span></span><span> </span><span class="entity"><span>depth</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"|\n"</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>string_of_case</span></span><span> </span><span class="entity"><span>depth</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>cases</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"\n"</span></span><span> </span><span>^</span><span>
    </span><span class="entity"><span>indent</span></span><span> </span><span class="entity"><span>depth</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"]"</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>string_of_subproof</span></span><span> </span><span class="entity"><span>depth</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>cat_lines</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>string_of_inference</span></span><span> </span><span class="entity"><span>depth</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>string_of_direct_proof</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>string_of_subproof</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span></pre>
</body>

</html>