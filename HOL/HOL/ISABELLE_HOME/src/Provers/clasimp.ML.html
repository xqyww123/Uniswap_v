<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹~~/src/Provers/clasimp.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹~~/src/Provers/clasimp.ML›</h1>
</div>

<pre class="source"><span class="comment1"><span>(*  Title:      Provers/clasimp.ML
    Author:     David von Oheimb, TU Muenchen

Combination of classical reasoner and simplifier (depends on
splitter.ML, classical.ML, blast.ML).
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>CLASIMP_DATA</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> Splitter</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>SPLITTER</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> Classical</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>CLASSICAL</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> Blast</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>BLAST</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> notE</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> iffD1</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> iffD2</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>CLASIMP</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> addSss</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> addss</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> clarsimp_tac</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_auto_tac</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> auto_tac</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> force_tac</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> fast_force_tac</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> slow_simp_tac</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> best_simp_tac</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> iff_add</span><span class="main"><span>:</span></span><span> </span><span>attribute</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> iff_add'</span><span class="main"><span>:</span></span><span> </span><span>attribute</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> iff_del</span><span class="main"><span>:</span></span><span> </span><span>attribute</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> iff_modifiers</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Method.modifier</span></span><span> </span><span>parser</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> clasimp_modifiers</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Method.modifier</span></span><span> </span><span>parser</span><span> </span><span>list</span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>functor</span></span></span><span> </span><span class="entity"><span>Clasimp</span></span><span class="main"><span>(</span></span><span>Data</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>CLASIMP_DATA</span></span><span class="main"><span>)</span></span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>CLASIMP</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Splitter</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Data.Splitter</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Classical</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Data.Classical</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Blast</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Data.Blast</span></span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(* simp as classical wrapper *)</span></span><span>

</span><span class="comment1"><span>(* FIXME !? *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>clasimp</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>CHANGED</span><span> </span><span>o</span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(*Add a simpset to the claset!*)</span></span><span>
</span><span class="comment1"><span>(*Caution: only one simpset added can be added by each of addSss and addss*)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>addSss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>clasimp</span></span><span> </span><span class="entity"><span>Classical.addSafter</span></span><span> </span><span class="inner_quoted"><span>"safe_asm_full_simp_tac"</span></span><span> </span><span class="entity"><span>Simplifier.safe_asm_full_simp_tac</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>addss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>clasimp</span></span><span> </span><span class="entity"><span>Classical.addbefore</span></span><span> </span><span class="inner_quoted"><span>"asm_full_simp_tac"</span></span><span> </span><span class="entity"><span>Simplifier.asm_full_simp_tac</span></span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(* iffs: addition of rules to simpsets and clasets simultaneously *)</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>

</span><span class="comment1"><span>(*Takes (possibly conditional) theorems of the form A&lt;-&gt;B to
        the Safe Intr     rule B==&gt;A and
        the Safe Destruct rule A==&gt;B.
  Also ~A goes to the Safe Elim rule A ==&gt; ?R
  Failing other cases, A is added as a Safe Intr rule*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>add_iff</span></span><span> </span><span class="entity"><span>safe</span></span><span> </span><span class="entity"><span>unsafe</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Thm.declaration_attribute</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>th</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.nprems_of</span><span> </span><span class="entity"><span>th</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>elim</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>intro</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>safe</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>unsafe</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>zero_rotate</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>zero_var_indexes</span><span> </span><span>o</span><span> </span><span>rotate_prems</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>decls</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>intro</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>zero_rotate</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>th</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>Data.iffD2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
         </span><span class="main"><span>(</span></span><span class="entity"><span>elim</span></span><span class="main"><span>,</span></span><span> </span><span>Tactic.make_elim</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>zero_rotate</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>th</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>Data.iffD1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
        </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>THM</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>elim</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>zero_rotate</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>th</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>Data.notE</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
        </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>THM</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>intro</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>th</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>uncurry</span><span> </span><span>Thm.attribute_declaration</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>decls</span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>del_iff</span></span><span> </span><span class="entity"><span>del</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.declaration_attribute</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>th</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>zero_rotate</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>zero_var_indexes</span><span> </span><span>o</span><span> </span><span>rotate_prems</span><span> </span><span class="main"><span>(</span></span><span>Thm.nprems_of</span><span> </span><span class="entity"><span>th</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rls</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>[</span></span><span class="entity"><span>zero_rotate</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>th</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>Data.iffD2</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Tactic.make_elim</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>zero_rotate</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>th</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>Data.iffD1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
        </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>THM</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>zero_rotate</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>th</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>Data.notE</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
        </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>THM</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>th</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>Thm.attribute_declaration</span><span> </span><span class="entity"><span>del</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rls</span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>iff_add</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Thm.declaration_attribute</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>th</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span>Thm.attribute_declaration</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>add_iff</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>Classical.safe_elim</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Classical.safe_intro</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>Classical.unsafe_elim</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Classical.unsafe_intro</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>th</span></span><span>
    </span><span>#&gt;</span><span> </span><span>Thm.attribute_declaration</span><span> </span><span class="entity"><span>Simplifier.simp_add</span></span><span> </span><span class="entity"><span>th</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>iff_add'</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>add_iff</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>Context_Rules.elim_query</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Context_Rules.intro_query</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>Context_Rules.elim_query</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Context_Rules.intro_query</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>iff_del</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Thm.declaration_attribute</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>th</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span>Thm.attribute_declaration</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>del_iff</span></span><span> </span><span class="entity"><span>Classical.rule_del</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>th</span></span><span> </span><span>#&gt;</span><span>
    </span><span>Thm.attribute_declaration</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>del_iff</span></span><span> </span><span class="entity"><span>Context_Rules.rule_del</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>th</span></span><span> </span><span>#&gt;</span><span>
    </span><span>Thm.attribute_declaration</span><span> </span><span class="entity"><span>Simplifier.simp_del</span></span><span> </span><span class="entity"><span>th</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(* tactics *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>clarsimp_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Simplifier.safe_asm_full_simp_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>THEN_ALL_NEW</span><span>
  </span><span class="entity"><span>Classical.clarify_tac</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>addSss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(* auto_tac *)</span></span><span>

</span><span class="comment1"><span>(* a variant of depth_tac that avoids interference of the simplifier
   with dup_step_tac when they are combined by auto_tac *)</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>slow_step_tac'</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Classical.appWrappers</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>Classical.instp_step_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>APPEND'</span><span> </span><span class="entity"><span>Classical.unsafe_step_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>nodup_depth_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>SELECT_GOAL</span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>Classical.safe_steps_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>THEN_ELSE</span><span>
      </span><span class="main"><span>(</span></span><span>DEPTH_SOLVE</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nodup_depth_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>Classical.inst0_step_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>APPEND</span><span> </span><span>COND</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>no_tac</span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>slow_step_tac'</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>THEN</span><span> </span><span>DEPTH_SOLVE</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nodup_depth_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>m</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>st</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(*Designed to be idempotent, except if Blast.depth_tac instantiates variables
  in some of the subgoals*)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_auto_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>main_tac</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>Blast.depth_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>m</span></span><span>  </span><span class="comment1"><span>(* fast but can't use wrappers *)</span></span><span>
      </span><span>ORELSE'</span><span>
      </span><span class="main"><span>(</span></span><span>CHANGED</span><span> </span><span>o</span><span> </span><span class="entity"><span>nodup_depth_tac</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>addss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>  </span><span class="comment1"><span>(* slower but more general *)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>PARALLEL_ALLGOALS</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Simplifier.asm_full_simp_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span>
    </span><span>TRY</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Classical.safe_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span>
    </span><span>REPEAT_DETERM</span><span> </span><span class="main"><span>(</span></span><span>FIRSTGOAL</span><span> </span><span class="entity"><span>main_tac</span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span>
    </span><span>TRY</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Classical.safe_tac</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>addSss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span>
    </span><span>prune_params_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>auto_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_auto_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="inner_numeral"><span>4</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(* force_tac *)</span></span><span>

</span><span class="comment1"><span>(* aimed to solve the given subgoal totally, using whatever tools possible *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>force_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>addss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>SELECT_GOAL</span><span>
     </span><span class="main"><span>(</span></span><span class="entity"><span>Classical.clarify_tac</span></span><span> </span><span class="entity"><span>ctxt'</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>THEN</span><span>
      </span><span>IF_UNSOLVED</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Simplifier.asm_full_simp_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span>
      </span><span>ALLGOALS</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Classical.first_best_tac</span></span><span> </span><span class="entity"><span>ctxt'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(* basic combinations *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fast_force_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Classical.fast_tac</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>addss</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>slow_simp_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Classical.slow_tac</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>addss</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>best_simp_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Classical.best_tac</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>addss</span></span><span class="main"><span>;</span></span><span>



</span><span class="comment1"><span>(** concrete syntax **)</span></span><span>

</span><span class="comment1"><span>(* attributes *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Theory.setup</span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>Attrib.setup</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="entity_def" id="HOL.iff|attribute"><span>iff</span></span><span>›</span></span></span><span>
      </span><span class="main"><span>(</span></span><span>Scan.lift</span><span>
        </span><span class="main"><span>(</span></span><span>Args.del</span><span> </span><span>&gt;&gt;</span><span> </span><span>K</span><span> </span><span class="entity"><span>iff_del</span></span><span> </span><span>||</span><span>
          </span><span>Scan.option</span><span> </span><span>Args.add</span><span> </span><span>--</span><span> </span><span>Args.query</span><span> </span><span>&gt;&gt;</span><span> </span><span>K</span><span> </span><span class="entity"><span>iff_add'</span></span><span> </span><span>||</span><span>
          </span><span>Scan.option</span><span> </span><span>Args.add</span><span> </span><span>&gt;&gt;</span><span> </span><span>K</span><span> </span><span class="entity"><span>iff_add</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="inner_quoted"><span>"declaration of Simplifier / Classical rules"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(* method modifiers *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>iffN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"iff"</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>iff_modifiers</span></span><span> </span><span class="main"><span>=</span></span><span>
 </span><span class="main"><span>[</span></span><span>Args.$$$</span><span> </span><span class="entity"><span>iffN</span></span><span> </span><span>--</span><span> </span><span>Scan.option</span><span> </span><span>Args.add</span><span> </span><span>--</span><span> </span><span>Args.colon</span><span> </span><span>&gt;&gt;</span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Method.modifier</span></span><span> </span><span class="entity"><span>iff_add</span></span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
  </span><span>Args.$$$</span><span> </span><span class="entity"><span>iffN</span></span><span> </span><span>--</span><span> </span><span>Scan.option</span><span> </span><span>Args.add</span><span> </span><span>--</span><span> </span><span>Args.query_colon</span><span> </span><span>&gt;&gt;</span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Method.modifier</span></span><span> </span><span class="entity"><span>iff_add'</span></span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
  </span><span>Args.$$$</span><span> </span><span class="entity"><span>iffN</span></span><span> </span><span>--</span><span> </span><span>Args.del</span><span> </span><span>--</span><span> </span><span>Args.colon</span><span> </span><span>&gt;&gt;</span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Method.modifier</span></span><span> </span><span class="entity"><span>iff_del</span></span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>clasimp_modifiers</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Simplifier.simp_modifiers</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Splitter.split_modifiers</span></span><span> </span><span>@</span><span>
  </span><span class="entity"><span>Classical.cla_modifiers</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>iff_modifiers</span></span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(* methods *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>clasimp_method'</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Method.sections</span></span><span> </span><span class="entity"><span>clasimp_modifiers</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>SIMPLE_METHOD'</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>tac</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>auto_method</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Scan.lift</span><span> </span><span class="main"><span>(</span></span><span>Scan.option</span><span> </span><span class="main"><span>(</span></span><span>Parse.nat</span><span> </span><span>--</span><span> </span><span>Parse.nat</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>--|</span><span>
    </span><span class="entity"><span>Method.sections</span></span><span> </span><span class="entity"><span>clasimp_modifiers</span></span><span> </span><span>&gt;&gt;</span><span>
  </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>SIMPLE_METHOD</span></span><span> </span><span>o</span><span> </span><span>CHANGED_PROP</span><span> </span><span>o</span><span> </span><span class="entity"><span>auto_tac</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>m</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>SIMPLE_METHOD</span></span><span> </span><span class="main"><span>(</span></span><span>CHANGED_PROP</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_auto_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Theory.setup</span><span>
   </span><span class="main"><span>(</span></span><span class="entity"><span>Method.setup</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="entity_def" id="HOL.fastforce|method"><span>fastforce</span></span><span>›</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>clasimp_method'</span></span><span> </span><span class="entity"><span>fast_force_tac</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"combined fast and simp"</span></span><span> </span><span>#&gt;</span><span>
    </span><span class="entity"><span>Method.setup</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="entity_def" id="HOL.slowsimp|method"><span>slowsimp</span></span><span>›</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>clasimp_method'</span></span><span> </span><span class="entity"><span>slow_simp_tac</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"combined slow and simp"</span></span><span> </span><span>#&gt;</span><span>
    </span><span class="entity"><span>Method.setup</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="entity_def" id="HOL.bestsimp|method"><span>bestsimp</span></span><span>›</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>clasimp_method'</span></span><span> </span><span class="entity"><span>best_simp_tac</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"combined best and simp"</span></span><span> </span><span>#&gt;</span><span>
    </span><span class="entity"><span>Method.setup</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="entity_def" id="HOL.force|method"><span>force</span></span><span>›</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>clasimp_method'</span></span><span> </span><span class="entity"><span>force_tac</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"force"</span></span><span> </span><span>#&gt;</span><span>
    </span><span class="entity"><span>Method.setup</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="entity_def" id="HOL.auto|method"><span>auto</span></span><span>›</span></span></span><span> </span><span class="entity"><span>auto_method</span></span><span> </span><span class="inner_quoted"><span>"auto"</span></span><span> </span><span>#&gt;</span><span>
    </span><span class="entity"><span>Method.setup</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="entity_def" id="HOL.clarsimp|method"><span>clarsimp</span></span><span>›</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>clasimp_method'</span></span><span> </span><span class="main"><span>(</span></span><span>CHANGED_PROP</span><span> </span><span>oo</span><span> </span><span class="entity"><span>clarsimp_tac</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="inner_quoted"><span>"clarify simplified goal"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span></pre>
</body>

</html>