<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹~~/src/Tools/Argo/argo_expr.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹~~/src/Tools/Argo/argo_expr.ML›</h1>
</div>

<pre class="source"><span class="comment1"><span>(*  Title:      Tools/Argo/argo_expr.ML
    Author:     Sascha Boehme

The input language of the Argo solver.
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>ARGO_EXPR</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="comment1"><span>(* data types *)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>typ</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Bool</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Real</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Func</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> typ * typ </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Type</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string
  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>kind</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>True</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>False</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Not</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Imp</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Iff</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Ite</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Eq</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>App</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Con</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string * typ </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Le</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Lt</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Num</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> Rat.rat </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Neg</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Add</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Sub</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Mul</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Div</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Min</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Max</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Abs</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> kind * expr list

  </span><span class="comment1"><span>(* indices, equalities, orders *)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> int_of_kind</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>kind</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> con_ord</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span class="entity"><span>typ</span></span><span class="main"><span>)</span></span><span> </span><span>ord</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> eq_kind</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>kind</span></span><span> * </span><span class="entity"><span>kind</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> kind_ord</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>kind</span></span><span> </span><span>ord</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> eq_expr</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>expr</span></span><span> * </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> expr_ord</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span>ord</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> dual_expr</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>

  </span><span class="comment1"><span>(* constructors *)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> kind_of_string</span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>kind</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> true_expr</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>expr</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> false_expr</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>expr</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_not</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_and</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_and2</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_or</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_or2</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_imp</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_iff</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_ite</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_eq</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_app</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_con</span><span class="main"><span>:</span></span><span> </span><span>string</span><span> * </span><span class="entity"><span>typ</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_le</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_lt</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_num</span><span class="main"><span>:</span></span><span> </span><span>Rat.rat</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_neg</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_add</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_add2</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_sub</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_mul</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_div</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_min</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_max</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_abs</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>expr</span></span><span>

  </span><span class="comment1"><span>(* type checking *)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>exception</span></span></span><span> TYPE </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="entity"><span>expr</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>exception</span></span></span><span> EXPR </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="entity"><span>expr</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> type_of</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>typ</span></span><span> </span><span class="comment1"><span>(* raises EXPR *)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> check</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span> </span><span class="comment1"><span>(* raises TYPE and EXPR *)</span></span><span>

  </span><span class="comment1"><span>(* testers *)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> is_nary</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>kind</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>

  </span><span class="comment1"><span>(* string representations *)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> string_of_kind</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>kind</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Argo_Expr</span></span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>ARGO_EXPR</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="comment1"><span>(* data types *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>typ</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Bool</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Real</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Func</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> typ * typ </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Type</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>kind</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>True</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>False</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Not</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Imp</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Iff</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Ite</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Eq</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>App</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Con</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string * typ </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Le</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Lt</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Num</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> Rat.rat </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Neg</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Add</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Sub</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Mul</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Div</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Min</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Max</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Abs</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>expr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> kind * expr list


</span><span class="comment1"><span>(* indices, equalities, orders *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>int_of_type</span></span><span> </span><span class="entity"><span>Bool</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>int_of_type</span></span><span> </span><span class="entity"><span>Real</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>int_of_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Func</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>int_of_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>3</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>int_of_kind</span></span><span> </span><span class="entity"><span>True</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>int_of_kind</span></span><span> </span><span class="entity"><span>False</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>int_of_kind</span></span><span> </span><span class="entity"><span>Not</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>int_of_kind</span></span><span> </span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>3</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>int_of_kind</span></span><span> </span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>4</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>int_of_kind</span></span><span> </span><span class="entity"><span>Imp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>5</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>int_of_kind</span></span><span> </span><span class="entity"><span>Iff</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>6</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>int_of_kind</span></span><span> </span><span class="entity"><span>Ite</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>7</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>int_of_kind</span></span><span> </span><span class="entity"><span>Eq</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>8</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>int_of_kind</span></span><span> </span><span class="entity"><span>App</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>9</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>int_of_kind</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Con</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>10</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>int_of_kind</span></span><span> </span><span class="entity"><span>Le</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>11</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>int_of_kind</span></span><span> </span><span class="entity"><span>Lt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>12</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>int_of_kind</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Num</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>13</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>int_of_kind</span></span><span> </span><span class="entity"><span>Neg</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>14</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>int_of_kind</span></span><span> </span><span class="entity"><span>Add</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>15</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>int_of_kind</span></span><span> </span><span class="entity"><span>Sub</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>16</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>int_of_kind</span></span><span> </span><span class="entity"><span>Mul</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>17</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>int_of_kind</span></span><span> </span><span class="entity"><span>Div</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>18</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>int_of_kind</span></span><span> </span><span class="entity"><span>Min</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>19</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>int_of_kind</span></span><span> </span><span class="entity"><span>Max</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>20</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>int_of_kind</span></span><span> </span><span class="entity"><span>Abs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>21</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>eq_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Bool</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Bool</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>eq_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Real</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Real</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>eq_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Func</span></span><span> </span><span class="entity"><span>tys1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Func</span></span><span> </span><span class="entity"><span>tys2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>eq_pair</span><span> </span><span class="entity"><span>eq_type</span></span><span> </span><span class="entity"><span>eq_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tys1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>eq_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type</span></span><span> </span><span class="entity"><span>n1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Type</span></span><span> </span><span class="entity"><span>n2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>n2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>eq_type</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>type_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Bool</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Bool</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>EQUAL</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Real</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Real</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>EQUAL</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type</span></span><span> </span><span class="entity"><span>n1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Type</span></span><span> </span><span class="entity"><span>n2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fast_string_ord</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>n2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Func</span></span><span> </span><span class="entity"><span>tys1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Func</span></span><span> </span><span class="entity"><span>tys2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>prod_ord</span><span> </span><span class="entity"><span>type_ord</span></span><span> </span><span class="entity"><span>type_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tys1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ty1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>int_ord</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>int_of_type</span></span><span> </span><span class="entity"><span>ty1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>int_of_type</span></span><span> </span><span class="entity"><span>ty2</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>eq_con</span></span><span> </span><span class="entity"><span>cp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>eq_pair</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>eq_type</span></span><span> </span><span class="entity"><span>cp</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>con_ord</span></span><span> </span><span class="entity"><span>cp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>prod_ord</span><span> </span><span>fast_string_ord</span><span> </span><span class="entity"><span>type_ord</span></span><span> </span><span class="entity"><span>cp</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>eq_kind</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Con</span></span><span> </span><span class="entity"><span>c1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Con</span></span><span> </span><span class="entity"><span>c2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>eq_con</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>c2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>eq_kind</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Num</span></span><span> </span><span class="entity"><span>n1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Num</span></span><span> </span><span class="entity"><span>n2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>n1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>n2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>eq_kind</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>k2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>k2</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>kind_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Con</span></span><span> </span><span class="entity"><span>c1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Con</span></span><span> </span><span class="entity"><span>c2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>con_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>c2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>kind_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Num</span></span><span> </span><span class="entity"><span>n1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Num</span></span><span> </span><span class="entity"><span>n2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Rat.ord</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>n2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>kind_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>k2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>int_ord</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>int_of_kind</span></span><span> </span><span class="entity"><span>k1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>int_of_kind</span></span><span> </span><span class="entity"><span>k2</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>eq_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="entity"><span>e1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="entity"><span>e2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>eq_pair</span><span> </span><span class="entity"><span>eq_kind</span></span><span> </span><span class="main"><span>(</span></span><span>eq_list</span><span> </span><span class="entity"><span>eq_expr</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>e1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>e2</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>expr_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="entity"><span>e1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="entity"><span>e2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>prod_ord</span><span> </span><span class="entity"><span>kind_ord</span></span><span> </span><span class="main"><span>(</span></span><span>list_ord</span><span> </span><span class="entity"><span>expr_ord</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>e1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>e2</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dual_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>e1</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>e2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>eq_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>e1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>e2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>dual_expr</span></span><span> </span><span class="entity"><span>e1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>e2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>eq_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>e1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>e2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>dual_expr</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>


</span><span class="comment1"><span>(* constructors *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>string_kinds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span>
  </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"true"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>True</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"false"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>False</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"not"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Not</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"and"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>And</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"or"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Or</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"imp"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Imp</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
  </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"iff"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Iff</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"ite"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ite</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"eq"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Eq</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"app"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>App</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"le"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Le</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"lt"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Lt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"neg"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Neg</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
  </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"add"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Add</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"sub"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Sub</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"mul"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Mul</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"div"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Div</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"min"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Min</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"max"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Max</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"abs"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Abs</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>kind_of_string</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>the</span><span> </span><span>o</span><span> </span><span>Symtab.lookup</span><span> </span><span class="main"><span>(</span></span><span>Symtab.make</span><span> </span><span class="entity"><span>string_kinds</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>true_expr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>True</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>false_expr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>False</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_not</span></span><span> </span><span class="entity"><span>e</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>e</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_and</span></span><span> </span><span class="entity"><span>es</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>And</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>es</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_and2</span></span><span> </span><span class="entity"><span>e1</span></span><span> </span><span class="entity"><span>e2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_and</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>e1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>e2</span></span><span class="main"><span>]</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_or</span></span><span> </span><span class="entity"><span>es</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>es</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_or2</span></span><span> </span><span class="entity"><span>e1</span></span><span> </span><span class="entity"><span>e2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_or</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>e1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>e2</span></span><span class="main"><span>]</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_imp</span></span><span> </span><span class="entity"><span>e1</span></span><span> </span><span class="entity"><span>e2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Imp</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>e1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>e2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_iff</span></span><span> </span><span class="entity"><span>e1</span></span><span> </span><span class="entity"><span>e2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Iff</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>e1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>e2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_ite</span></span><span> </span><span class="entity"><span>e1</span></span><span> </span><span class="entity"><span>e2</span></span><span> </span><span class="entity"><span>e3</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ite</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>e1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>e2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>e3</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>e1</span></span><span> </span><span class="entity"><span>e2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Eq</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>e1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>e2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_app</span></span><span> </span><span class="entity"><span>e1</span></span><span> </span><span class="entity"><span>e2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>App</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>e1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>e2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_con</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Con</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_le</span></span><span> </span><span class="entity"><span>e1</span></span><span> </span><span class="entity"><span>e2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Le</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>e1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>e2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_lt</span></span><span> </span><span class="entity"><span>e1</span></span><span> </span><span class="entity"><span>e2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Lt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>e1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>e2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_num</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Num</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_neg</span></span><span> </span><span class="entity"><span>e</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Neg</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>e</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_add</span></span><span> </span><span class="entity"><span>es</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Add</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>es</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_add2</span></span><span> </span><span class="entity"><span>e1</span></span><span> </span><span class="entity"><span>e2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_add</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>e1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>e2</span></span><span class="main"><span>]</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_sub</span></span><span> </span><span class="entity"><span>e1</span></span><span> </span><span class="entity"><span>e2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Sub</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>e1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>e2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_mul</span></span><span> </span><span class="entity"><span>e1</span></span><span> </span><span class="entity"><span>e2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Mul</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>e1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>e2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_div</span></span><span> </span><span class="entity"><span>e1</span></span><span> </span><span class="entity"><span>e2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Div</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>e1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>e2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_min</span></span><span> </span><span class="entity"><span>e1</span></span><span> </span><span class="entity"><span>e2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Min</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>e1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>e2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_max</span></span><span> </span><span class="entity"><span>e1</span></span><span> </span><span class="entity"><span>e2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Max</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>e1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>e2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_abs</span></span><span> </span><span class="entity"><span>e</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Abs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>e</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>


</span><span class="comment1"><span>(* type checking *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>exception</span></span></span><span> </span><span class="entity"><span>TYPE</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="entity"><span>expr</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>exception</span></span></span><span> </span><span class="entity"><span>EXPR</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="entity"><span>expr</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dest_func_type</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Func</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tys</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>dest_func_type</span></span><span> </span><span class="entity"><span>e</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>TYPE</span></span><span> </span><span class="entity"><span>e</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>True</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Bool</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>False</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Bool</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Bool</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>And</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Bool</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Bool</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Imp</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Bool</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Iff</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Bool</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ite</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>e</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="entity"><span>e</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Eq</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Bool</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>App</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>e</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>snd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dest_func_type</span></span><span> </span><span class="entity"><span>e</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>type_of</span></span><span> </span><span class="entity"><span>e</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Con</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ty</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Le</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Bool</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Lt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Bool</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Num</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Real</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Neg</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Real</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Add</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Real</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Sub</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Real</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Mul</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Real</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Div</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Real</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Min</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Real</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Max</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Real</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Abs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Real</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="entity"><span>e</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>EXPR</span></span><span> </span><span class="entity"><span>e</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>all_type</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>es</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>forall</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>eq_type</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>type_of</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>es</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>all_bool</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>all_type</span></span><span> </span><span class="entity"><span>Bool</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>all_real</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>all_type</span></span><span> </span><span class="entity"><span>Real</span></span><span>

</span><span class="comment1"><span>(*
  Types as well as proper arities are checked.
  Exception TYPE is raised for invalid types.
  Exception EXPR is raised for invalid expressions and invalid arities.
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>check</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>e</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>es</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>forall</span><span> </span><span class="entity"><span>check</span></span><span> </span><span class="entity"><span>es</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>raw_check</span></span><span> </span><span class="entity"><span>e</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>TYPE</span></span><span> </span><span class="entity"><span>e</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>raw_check</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>True</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>raw_check</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>False</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>raw_check</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>e</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Not</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>all_bool</span></span><span> </span><span class="entity"><span>e</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>raw_check</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>e</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>And</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>all_bool</span></span><span> </span><span class="entity"><span>e</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>raw_check</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>e</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Or</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>all_bool</span></span><span> </span><span class="entity"><span>e</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>raw_check</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>e</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Imp</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>all_bool</span></span><span> </span><span class="entity"><span>e</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>raw_check</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>e</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Iff</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>all_bool</span></span><span> </span><span class="entity"><span>e</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>raw_check</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ite</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>e1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>e2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>e3</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ty1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="entity"><span>e1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>ty2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="entity"><span>e2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>ty3</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="entity"><span>e3</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>eq_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ty1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Bool</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>eq_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ty2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty3</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>raw_check</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Eq</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>e1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>e2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ty1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="entity"><span>e1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>ty2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="entity"><span>e2</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>eq_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ty1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty2</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>eq_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ty1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Bool</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>raw_check</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>App</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>e1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>e2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>eq_type</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dest_func_type</span></span><span> </span><span class="entity"><span>e1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>type_of</span></span><span> </span><span class="entity"><span>e1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>type_of</span></span><span> </span><span class="entity"><span>e2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>raw_check</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Con</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>raw_check</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Num</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>raw_check</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>e</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Le</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>all_real</span></span><span> </span><span class="entity"><span>e</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>raw_check</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>e</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Lt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>all_real</span></span><span> </span><span class="entity"><span>e</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>raw_check</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>e</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Neg</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>all_real</span></span><span> </span><span class="entity"><span>e</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>raw_check</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>e</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Add</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>all_real</span></span><span> </span><span class="entity"><span>e</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>raw_check</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>e</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Sub</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>all_real</span></span><span> </span><span class="entity"><span>e</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>raw_check</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>e</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Mul</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>all_real</span></span><span> </span><span class="entity"><span>e</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>raw_check</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>e</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Div</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>all_real</span></span><span> </span><span class="entity"><span>e</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>raw_check</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>e</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Min</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>all_real</span></span><span> </span><span class="entity"><span>e</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>raw_check</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>e</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Max</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>all_real</span></span><span> </span><span class="entity"><span>e</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>raw_check</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>e</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Abs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>all_real</span></span><span> </span><span class="entity"><span>e</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>raw_check</span></span><span> </span><span class="entity"><span>e</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>EXPR</span></span><span> </span><span class="entity"><span>e</span></span><span>


</span><span class="comment1"><span>(* testers *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_nary</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>And</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Or</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Add</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>k</span></span><span>


</span><span class="comment1"><span>(* string representations *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>kind_strings</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>swap</span><span> </span><span class="entity"><span>string_kinds</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_of_kind</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Con</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>n</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_kind</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Num</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Rat.string_of_rat</span><span> </span><span class="entity"><span>n</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_kind</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>the</span><span> </span><span class="main"><span>(</span></span><span>AList.lookup</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>kind_strings</span></span><span> </span><span class="entity"><span>k</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Argo_Exprtab</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Table</span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>key</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Argo_Expr.expr</span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ord</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Argo_Expr.expr_ord</span></span><span class="main"><span>)</span></span><span>
</span></pre>
</body>

</html>