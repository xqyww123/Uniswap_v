<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹Code/code_ml.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹Code/code_ml.ML›</h1>
</div>

<pre class="source"><span class="comment1"><span>(*  Title:      Tools/Code/code_ml.ML
    Author:     Florian Haftmann, TU Muenchen

Serializer for SML and OCaml.
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>CODE_ML</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> target_SML</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> target_OCaml</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Code_ML</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>CODE_ML</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Basic_Code_Symbol</span><span class="main"><span>;</span></span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Basic_Code_Thingol</span><span class="main"><span>;</span></span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Code_Printer</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>infixr</span></span></span><span> </span><span class="inner_numeral"><span>5</span></span><span> @@</span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>infixr</span></span></span><span> </span><span class="inner_numeral"><span>5</span></span><span> @|</span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(** generic **)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>target_SML</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"SML"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>target_OCaml</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"OCaml"</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>ml_binding</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>ML_Function</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string * </span><span class="main"><span>(</span></span><span>typscheme * </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>iterm list * iterm</span><span class="main"><span>)</span></span><span> * </span><span class="main"><span>(</span></span><span>thm option * bool</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> list</span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>ML_Instance</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span>string * class</span><span class="main"><span>)</span></span><span> * </span><span class="main"><span>{</span></span><span> class</span><span class="main"><span>:</span></span><span> class</span><span class="main"><span>,</span></span><span> tyco</span><span class="main"><span>:</span></span><span> string</span><span class="main"><span>,</span></span><span> vs</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>vname * sort</span><span class="main"><span>)</span></span><span> list</span><span class="main"><span>,</span></span><span>
        superinsts</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>class * dict list list</span><span class="main"><span>)</span></span><span> list</span><span class="main"><span>,</span></span><span>
        inst_params</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>string * </span><span class="main"><span>(</span></span><span>const * int</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> * </span><span class="main"><span>(</span></span><span>thm * bool</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> list</span><span class="main"><span>,</span></span><span>
        superinst_params</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>string * </span><span class="main"><span>(</span></span><span>const * int</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> * </span><span class="main"><span>(</span></span><span>thm * bool</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> list </span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>ml_stmt</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>ML_Exc</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string * </span><span class="main"><span>(</span></span><span>typscheme * int</span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>ML_Val</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> ml_binding
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>ML_Funs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span>Code_Namespace.export * ml_binding</span><span class="main"><span>)</span></span><span> list * Code_Symbol.T list
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>ML_Datas</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span>string * </span><span class="main"><span>(</span></span><span>vname list * </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>string * vname list</span><span class="main"><span>)</span></span><span> * itype list</span><span class="main"><span>)</span></span><span> list</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> list
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>ML_Class</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string * </span><span class="main"><span>(</span></span><span>vname * </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>class * class</span><span class="main"><span>)</span></span><span> list * </span><span class="main"><span>(</span></span><span>string * itype</span><span class="main"><span>)</span></span><span> list</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_product</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_product</span></span><span> </span><span class="entity"><span>print</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_product</span></span><span> </span><span class="entity"><span>print</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>o</span><span> </span><span class="entity"><span>enum</span></span><span> </span><span class="inner_quoted"><span>" *"</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>print</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tuplify</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tuplify</span></span><span> </span><span class="entity"><span>print</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tuplify</span></span><span> </span><span class="entity"><span>print</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>enum</span></span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print</span></span><span> </span><span class="entity"><span>NOBR</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(** SML serializer **)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_sml_char</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"\\"</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"\\092"</span></span><span> </span><span class="comment1"><span>(*produce strings suitable for both SML as well as Isabelle/ML*)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Symbol.is_ascii</span><span> </span><span class="entity"><span>c</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>ML_Syntax.print_symbol_char</span><span> </span><span class="entity"><span>c</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"non-ASCII byte in SML string literal"</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>print_sml_string</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>quote</span><span> </span><span>o</span><span> </span><span>translate_string</span><span> </span><span class="entity"><span>print_sml_char</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_sml_stmt</span></span><span> </span><span class="entity"><span>tyco_syntax</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>reserved</span></span><span> </span><span class="entity"><span>is_constr</span></span><span> </span><span class="entity"><span>deresolve</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>deresolve_const</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deresolve</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Constant</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>deresolve_classrel</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deresolve</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Class_Relation</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>deresolve_inst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deresolve</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Class_Instance</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_tyco_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sym</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_tyco_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ty</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>BR</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_tyco_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>enum</span></span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>BR</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>`%%</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>tyco_syntax</span></span><span> </span><span class="entity"><span>tyco</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>print_tyco_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>print</span></span><span> </span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ITyVar</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"'"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_dicttyp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_tyco_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Class</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ty</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_typscheme_prefix</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>enum</span></span><span> </span><span class="inner_quoted"><span>" -&gt;"</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span>
      </span><span class="main"><span>(</span></span><span>map_filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sort</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>print_product</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>class</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>print_dicttyp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ITyVar</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sort</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>@|</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_typscheme</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_typscheme_prefix</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_dicttypscheme</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>class_ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_typscheme_prefix</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_dicttyp</span></span><span> </span><span class="entity"><span>class_ty</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_classrels</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>brackify</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>ps</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_classrels</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>classrel</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>brackify</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_classrel</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>classrel</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>brackify</span></span><span> </span><span class="entity"><span>BR</span></span><span> </span><span class="entity"><span>ps</span></span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_classrels</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>classrels</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>brackify</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>enum</span></span><span> </span><span class="inner_quoted"><span>" o"</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_classrel</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>classrels</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>brackify</span></span><span> </span><span class="entity"><span>BR</span></span><span> </span><span class="entity"><span>ps</span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_dict</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Dict</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>classrels</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>print_classrels</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>classrels</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_plain_dict</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>print_plain_dict</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Dict_Const</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_inst</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>inst</span></span><span> </span><span>::</span><span>
            </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Instance</span></span><span> </span><span class="entity"><span>inst</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"()"</span></span><span class="main"><span>]</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>map_filter</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_dicts</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>BR</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_plain_dict</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Dict_Var</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>var</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>index</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>length</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>length</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Name.enforce_case</span><span> </span><span>true</span><span> </span><span class="entity"><span>var</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"_"</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>Name.enforce_case</span><span> </span><span>true</span><span> </span><span class="entity"><span>var</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>index</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"_"</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>print_dicts</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tuplify</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_dict</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>print_dict_args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map_filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sort</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>print_dicts</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>BR</span></span><span>
      </span><span class="main"><span>(</span></span><span>map_index</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Dict</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
         </span><span class="entity"><span>Dict_Var</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span>var</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span>index</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span>length</span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>sort</span></span><span class="main"><span>,</span></span><span> </span><span>class</span><span> </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>sort</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span>unique</span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span> </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sort</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>IConst</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>print_app</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>IVar</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"_"</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>IVar</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lookup_var</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span class="entity"><span>`$</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>Code_Thingol.unfold_const_app</span></span><span> </span><span class="entity"><span>t</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>app</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>print_app</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>app</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>brackify</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>BR</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>`|=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>binds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Code_Thingol.unfold_pat_abs</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_abs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pat</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>print_bind</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>pat</span></span><span>
              </span><span>#&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"fn"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"=&gt;"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vars'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_map</span><span> </span><span class="entity"><span>print_abs</span></span><span> </span><span class="entity"><span>binds</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>brackets</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ps</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ICase</span></span><span> </span><span class="entity"><span>case_expr</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>Code_Thingol.unfold_const_app</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>primitive</span><span> </span><span class="entity"><span>case_expr</span></span><span class="main"><span>)</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>app</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span> </span><span>sym</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>is_none</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>)</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>print_case</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>case_expr</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>print_app</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>app</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>print_case</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>case_expr</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>print_app_expr</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>app</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span>dicts</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dss</span></span><span class="main"><span>,</span></span><span> </span><span>dom</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dom</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_constr</span></span><span> </span><span class="entity"><span>sym</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>dom</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span>&lt;</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>length</span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>k</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sym</span></span><span>
            </span><span>::</span><span> </span><span>the_list</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tuplify</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>BR</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>BR</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.eta_expand</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="entity"><span>app</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>sym</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sym</span></span><span> </span><span class="entity"><span>@@</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"()"</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sym</span></span><span> </span><span>::</span><span> </span><span>map_filter</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_dicts</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>BR</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dss</span></span><span>
        </span><span>@</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>BR</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>print_app</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_print_app</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_app_expr</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>print_bind</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_print_bind</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>print_case</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span>clauses</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>concat</span></span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="entity"><span>str</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"raise"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"Fail"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"\"empty case\""</span></span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_case</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>case_expr</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span> </span><span>clauses</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>binds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Code_Thingol.unfold_let</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ICase</span></span><span> </span><span class="entity"><span>case_expr</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_match</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>pat</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>vars</span></span><span>
              </span><span>|&gt;</span><span> </span><span class="entity"><span>print_bind</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>pat</span></span><span>
              </span><span>|&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>semicolon</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"val"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vars'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_map</span><span> </span><span class="entity"><span>print_match</span></span><span> </span><span class="entity"><span>binds</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Pretty.chunks</span><span> </span><span class="main"><span>[</span></span><span>
              </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"let"</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.fbrk</span><span class="main"><span>,</span></span><span> </span><span>Pretty.chunks</span><span> </span><span class="entity"><span>ps</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
              </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"in"</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.fbrk</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"end"</span></span><span>
            </span><span class="main"><span>]</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_case</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span>term</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span>typ</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> </span><span>clauses</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>clause</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>clauses</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_select</span></span><span> </span><span class="entity"><span>delim</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pat</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vars'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_bind</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>pat</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>delim</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"=&gt;"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>]</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>brackets</span></span><span> </span><span class="main"><span>(</span></span><span>
              </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"case"</span></span><span>
              </span><span>::</span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>t</span></span><span>
              </span><span>::</span><span> </span><span class="entity"><span>print_select</span></span><span> </span><span class="inner_quoted"><span>"of"</span></span><span> </span><span class="entity"><span>clause</span></span><span>
              </span><span>::</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_select</span></span><span> </span><span class="inner_quoted"><span>"|"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>clauses</span></span><span>
            </span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_val_decl</span></span><span> </span><span class="entity"><span>print_typscheme</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>typscheme</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>concat</span></span><span>
      </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"val"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deresolve</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>":"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_typscheme</span></span><span> </span><span class="entity"><span>typscheme</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_datatype_decl</span></span><span> </span><span class="entity"><span>definer</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cos</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_co</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>co</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deresolve_const</span></span><span> </span><span class="entity"><span>co</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_co</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>co</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deresolve_const</span></span><span> </span><span class="entity"><span>co</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"of"</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>enum</span></span><span> </span><span class="inner_quoted"><span>" *"</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_typ</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>INFX</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>definer</span></span><span>
          </span><span>::</span><span> </span><span class="entity"><span>print_tyco_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>ITyVar</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span>
          </span><span>::</span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span>
          </span><span>::</span><span> </span><span>separate</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"|"</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>print_co</span></span><span> </span><span class="entity"><span>cos</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_def</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>needs_typ</span></span><span> </span><span class="entity"><span>definer</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>ML_Function</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs_ty</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>eq</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>eqs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_eqn</span></span><span> </span><span class="entity"><span>definer</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>some_thm</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>reserved</span></span><span>
                  </span><span>|&gt;</span><span> </span><span class="entity"><span>intro_base_names_for</span></span><span> </span><span class="main"><span>(</span></span><span>is_none</span><span> </span><span>o</span><span> </span><span class="entity"><span>const_syntax</span></span><span class="main"><span>)</span></span><span>
                       </span><span class="entity"><span>deresolve</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span>
                  </span><span>|&gt;</span><span> </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="main"><span>(</span></span><span>build</span><span> </span><span class="main"><span>(</span></span><span>fold</span><span> </span><span class="entity"><span>Code_Thingol.add_varnames</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prolog</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>needs_typ</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                  </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>definer</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_const</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>":"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>]</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>concat</span></span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="entity"><span>str</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>definer</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>deresolve_const</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>(</span></span><span>
                  </span><span class="entity"><span>prolog</span></span><span>
                  </span><span>::</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"()"</span></span><span class="main"><span>]</span></span><span>
                      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>print_dict_args</span></span><span> </span><span class="entity"><span>vs</span></span><span>
                        </span><span>@</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>BR</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span>
                  </span><span>@</span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span>
                  </span><span class="entity"><span>@@</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>t</span></span><span>
                </span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>shift</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>I</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
              </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Pretty.block</span><span> </span><span>o</span><span> </span><span>single</span><span> </span><span>o</span><span> </span><span>Pretty.block</span><span> </span><span>o</span><span> </span><span>single</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>pair</span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>print_val_decl</span></span><span> </span><span class="entity"><span>print_typscheme</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vs_ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Pretty.block</span><span> </span><span>o</span><span> </span><span>Pretty.fbreaks</span><span> </span><span>o</span><span> </span><span class="entity"><span>shift</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
              </span><span class="entity"><span>print_eqn</span></span><span> </span><span class="entity"><span>definer</span></span><span> </span><span class="entity"><span>eq</span></span><span>
              </span><span>::</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_eqn</span></span><span> </span><span class="inner_quoted"><span>"|"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>eqs</span></span><span>
            </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_def</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>definer</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>ML_Instance</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>superinsts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>inst_params</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_super_instance</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>super_class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span>Long_Name.base_name</span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_classrel</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>super_class</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>print_dict</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Dict</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Dict_Const</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>super_class</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_classparam_instance</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>classparam</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span>Long_Name.base_name</span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_const</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>classparam</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>print_app</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>reserved</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>pair</span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>print_val_decl</span></span><span> </span><span class="entity"><span>print_dicttypscheme</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Instance</span></span><span> </span><span class="entity"><span>inst</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>`%%</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ITyVar</span></span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>(</span></span><span>
              </span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>definer</span></span><span>
              </span><span>::</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_inst</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>inst</span></span><span>
              </span><span>::</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Instance</span></span><span> </span><span class="entity"><span>inst</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"()"</span></span><span class="main"><span>]</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>print_dict_args</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span>
              </span><span>@</span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span>
              </span><span>::</span><span> </span><span class="entity"><span>enum</span></span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span class="inner_quoted"><span>"{"</span></span><span> </span><span class="inner_quoted"><span>"}"</span></span><span>
                </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>print_super_instance</span></span><span> </span><span class="entity"><span>superinsts</span></span><span>
                  </span><span>@</span><span> </span><span>map</span><span> </span><span class="entity"><span>print_classparam_instance</span></span><span> </span><span class="entity"><span>inst_params</span></span><span class="main"><span>)</span></span><span>
              </span><span>::</span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>":"</span></span><span>
              </span><span class="entity"><span>@@</span></span><span> </span><span class="entity"><span>print_dicttyp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>`%%</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ITyVar</span></span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ML_Exc</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>pair</span><span>
          </span><span class="main"><span>[</span></span><span class="entity"><span>print_val_decl</span></span><span> </span><span class="entity"><span>print_typscheme</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vs_ty</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
          </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>semicolon</span></span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="entity"><span>str</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
            </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"val"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>"fun"</span></span><span class="main"><span>)</span></span><span>
            </span><span>::</span><span> </span><span class="entity"><span>deresolve_const</span></span><span> </span><span class="entity"><span>const</span></span><span>
            </span><span>::</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="inner_quoted"><span>"_"</span></span><span>
            </span><span>@</span><span> </span><span class="inner_quoted"><span>"="</span></span><span>
            </span><span>::</span><span> </span><span class="inner_quoted"><span>"raise"</span></span><span>
            </span><span>::</span><span> </span><span class="inner_quoted"><span>"Fail"</span></span><span>
            </span><span class="entity"><span>@@</span></span><span> </span><span class="entity"><span>print_sml_string</span></span><span> </span><span class="entity"><span>const</span></span><span>
          </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ML_Val</span></span><span> </span><span class="entity"><span>binding</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sig_p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_def</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span>true</span><span> </span><span class="inner_quoted"><span>"val"</span></span><span> </span><span class="entity"><span>binding</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>pair</span><span>
            </span><span class="main"><span>[</span></span><span class="entity"><span>sig_p</span></span><span class="main"><span>]</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>semicolon</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ML_Funs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>binding</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>exports_bindings</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pseudo_funs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>print_def'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_def</span></span><span> </span><span class="main"><span>(</span></span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pseudo_funs</span></span><span class="main"><span>)</span></span><span> </span><span>false</span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_pseudo_fun</span></span><span> </span><span class="entity"><span>sym</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span>
                </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"val"</span></span><span class="main"><span>,</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span class="main"><span>,</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"();"</span></span><span>
              </span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sig_ps</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>apsnd</span><span> </span><span>split_last</span><span> </span><span>o</span><span> </span><span>split_list</span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>print_def'</span></span><span> </span><span class="inner_quoted"><span>"fun"</span></span><span> </span><span class="entity"><span>binding</span></span><span> </span><span>::</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_def'</span></span><span> </span><span class="inner_quoted"><span>"and"</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>exports_bindings</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pseudo_ps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>print_pseudo_fun</span></span><span> </span><span class="entity"><span>pseudo_funs</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>pair</span><span>
            </span><span class="main"><span>(</span></span><span>map_filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>Code_Namespace.not_private</span></span><span> </span><span class="entity"><span>export</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span> </span><span>::</span><span> </span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>exports_bindings</span></span><span class="main"><span>)</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>sig_ps</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span>Pretty.chunks</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ps</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>semicolon</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>pseudo_ps</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ML_Datas</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ty_p</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_tyco_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>ITyVar</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>pair</span><span>
            </span><span class="main"><span>[</span></span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"type"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty_p</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>semicolon</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"datatype"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty_p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"EMPTY__"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="entity"><span>export</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ML_Datas</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>data</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>datas</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> 
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>decl_ps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_datatype_decl</span></span><span> </span><span class="inner_quoted"><span>"datatype"</span></span><span> </span><span class="entity"><span>data</span></span><span>
              </span><span>::</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_datatype_decl</span></span><span> </span><span class="inner_quoted"><span>"and"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>datas</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>split_last</span><span> </span><span class="entity"><span>decl_ps</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>pair</span><span>
            </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>Code_Namespace.is_public</span></span><span> </span><span class="entity"><span>export</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>decl_ps</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"type"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_tyco_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>ITyVar</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>data</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>datas</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span>Pretty.chunks</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>@|</span></span><span> </span><span class="entity"><span>semicolon</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="entity"><span>export</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ML_Class</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>classrels</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>classparams</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_field</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>":"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_proj</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>semicolon</span></span><span>
              </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"val"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"#"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>":"</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>@|</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_super_class_decl</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>classrel</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>super_class</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>print_val_decl</span></span><span> </span><span class="entity"><span>print_dicttypscheme</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Relation</span></span><span> </span><span class="entity"><span>classrel</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>class</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>super_class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ITyVar</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_super_class_field</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>classrel</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>super_class</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>print_field</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deresolve_classrel</span></span><span> </span><span class="entity"><span>classrel</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_dicttyp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>super_class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ITyVar</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_super_class_proj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>classrel</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>super_class</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>print_proj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deresolve_classrel</span></span><span> </span><span class="entity"><span>classrel</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>print_dicttypscheme</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>class</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>super_class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ITyVar</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_classparam_decl</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>classparam</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>print_val_decl</span></span><span> </span><span class="entity"><span>print_typscheme</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>classparam</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>class</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_classparam_field</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>classparam</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>print_field</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deresolve_const</span></span><span> </span><span class="entity"><span>classparam</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_classparam_proj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>classparam</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>print_proj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deresolve_const</span></span><span> </span><span class="entity"><span>classparam</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>print_typscheme</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>class</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>pair</span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"type"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_dicttyp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ITyVar</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
              </span><span>::</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>Code_Namespace.is_public</span></span><span> </span><span class="entity"><span>export</span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>map</span><span> </span><span class="entity"><span>print_super_class_decl</span></span><span> </span><span class="entity"><span>classrels</span></span><span>
                   </span><span>@</span><span> </span><span>map</span><span> </span><span class="entity"><span>print_classparam_decl</span></span><span> </span><span class="entity"><span>classparams</span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span>Pretty.chunks</span><span> </span><span class="main"><span>(</span></span><span>
              </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span>
                </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"type"</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>print_dicttyp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ITyVar</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>enum</span></span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span class="inner_quoted"><span>"{"</span></span><span> </span><span class="inner_quoted"><span>"};"</span></span><span> </span><span class="main"><span>(</span></span><span>
                  </span><span>map</span><span> </span><span class="entity"><span>print_super_class_field</span></span><span> </span><span class="entity"><span>classrels</span></span><span>
                  </span><span>@</span><span> </span><span>map</span><span> </span><span class="entity"><span>print_classparam_field</span></span><span> </span><span class="entity"><span>classparams</span></span><span>
                </span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>]</span></span><span>
              </span><span>::</span><span> </span><span>map</span><span> </span><span class="entity"><span>print_super_class_proj</span></span><span> </span><span class="entity"><span>classrels</span></span><span>
              </span><span>@</span><span> </span><span>map</span><span> </span><span class="entity"><span>print_classparam_proj</span></span><span> </span><span class="entity"><span>classparams</span></span><span>
            </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_sml_module</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="entity"><span>decls</span></span><span> </span><span class="entity"><span>body</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Pretty.chunks2</span><span> </span><span class="main"><span>(</span></span><span>
    </span><span>Pretty.chunks</span><span> </span><span class="main"><span>[</span></span><span>
      </span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"structure "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>name</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" : sig"</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>indent</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span>o</span><span> </span><span>Pretty.chunks</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>decls</span></span><span class="main"><span>,</span></span><span>
      </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"end = struct"</span></span><span>
    </span><span class="main"><span>]</span></span><span>
    </span><span>::</span><span> </span><span class="entity"><span>body</span></span><span>
    </span><span class="entity"><span>@|</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"end; (*struct "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>name</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"*)"</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>literals_sml</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Literals</span></span><span> </span><span class="main"><span>{</span></span><span>
  </span><span>literal_string</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_sml_string</span></span><span class="main"><span>,</span></span><span>
  </span><span>literal_numeral</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>k</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" : IntInf.int)"</span></span><span class="main"><span>,</span></span><span>
  </span><span>literal_list</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>enum</span></span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span class="inner_quoted"><span>"]"</span></span><span class="main"><span>,</span></span><span>
  </span><span>infix_cons</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>7</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"::"</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(** OCaml serializer **)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>print_ocaml_string</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>chr</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>replicate_string</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>3</span></span><span> </span><span>-</span><span> </span><span>length</span><span> </span><span class="main"><span>(</span></span><span>raw_explode</span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"0"</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="inner_quoted"><span>"\\"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>ys</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>char</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>ord</span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>&gt;=</span><span> </span><span class="inner_numeral"><span>128</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"non-ASCII byte in OCaml string literal"</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>&lt;</span><span> </span><span class="inner_numeral"><span>32</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>34</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>39</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>92</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>126</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>chr</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>c</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>quote</span><span> </span><span>o</span><span> </span><span>translate_string</span><span> </span><span class="entity"><span>char</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_ocaml_stmt</span></span><span> </span><span class="entity"><span>tyco_syntax</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>reserved</span></span><span> </span><span class="entity"><span>is_constr</span></span><span> </span><span class="entity"><span>deresolve</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>deresolve_const</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deresolve</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Constant</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>deresolve_classrel</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deresolve</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Class_Relation</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>deresolve_inst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deresolve</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Class_Instance</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_tyco_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sym</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_tyco_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ty</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>BR</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_tyco_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>enum</span></span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>BR</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>`%%</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>tyco_syntax</span></span><span> </span><span class="entity"><span>tyco</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>print_tyco_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>print</span></span><span> </span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ITyVar</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"'"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_dicttyp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_tyco_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Class</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ty</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_typscheme_prefix</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>enum</span></span><span> </span><span class="inner_quoted"><span>" -&gt;"</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span>
      </span><span class="main"><span>(</span></span><span>map_filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sort</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>print_product</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>class</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>print_dicttyp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ITyVar</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sort</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>@|</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_typscheme</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_typscheme_prefix</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_dicttypscheme</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>class_ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_typscheme_prefix</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_dicttyp</span></span><span> </span><span class="entity"><span>class_ty</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>print_classrels</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>classrel</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"."</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_classrel</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>classrel</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_dict</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Dict</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>classrels</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>print_plain_dict</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>x</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>print_classrels</span></span><span> </span><span class="entity"><span>classrels</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>print_plain_dict</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Dict_Const</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>brackify</span></span><span> </span><span class="entity"><span>BR</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_inst</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>inst</span></span><span> </span><span>::</span><span>
            </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Instance</span></span><span> </span><span class="entity"><span>inst</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"()"</span></span><span class="main"><span>]</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>map_filter</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_dicts</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>BR</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_plain_dict</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Dict_Var</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>var</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>index</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>length</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>length</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"_"</span></span><span> </span><span>^</span><span> </span><span>Name.enforce_case</span><span> </span><span>true</span><span> </span><span class="entity"><span>var</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>"_"</span></span><span> </span><span>^</span><span> </span><span>Name.enforce_case</span><span> </span><span>true</span><span> </span><span class="entity"><span>var</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>index</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>print_dicts</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tuplify</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_dict</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>print_dict_args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map_filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sort</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>print_dicts</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>BR</span></span><span>
      </span><span class="main"><span>(</span></span><span>map_index</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Dict</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
         </span><span class="entity"><span>Dict_Var</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span>var</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span>index</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span>length</span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>sort</span></span><span class="main"><span>,</span></span><span> </span><span>class</span><span> </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>sort</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span>unique</span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span> </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sort</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>IConst</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>print_app</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>IVar</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"_"</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>IVar</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lookup_var</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span class="entity"><span>`$</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>Code_Thingol.unfold_const_app</span></span><span> </span><span class="entity"><span>t</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>app</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>print_app</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>app</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>brackify</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>BR</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>`|=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>binds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Code_Thingol.unfold_pat_abs</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vars'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_bind</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>BR</span></span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>binds</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>brackets</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"fun"</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ps</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"-&gt;"</span></span><span> </span><span class="entity"><span>@@</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ICase</span></span><span> </span><span class="entity"><span>case_expr</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>Code_Thingol.unfold_const_app</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>primitive</span><span> </span><span class="entity"><span>case_expr</span></span><span class="main"><span>)</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>app</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span> </span><span>sym</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>is_none</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>)</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>print_case</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>case_expr</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>print_app</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>app</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>print_case</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>case_expr</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>print_app_expr</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>app</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span>dicts</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dss</span></span><span class="main"><span>,</span></span><span> </span><span>dom</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dom</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_constr</span></span><span> </span><span class="entity"><span>sym</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>dom</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>length</span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>k</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sym</span></span><span>
            </span><span>::</span><span> </span><span>the_list</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tuplify</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>BR</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>BR</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.eta_expand</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="entity"><span>app</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>sym</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sym</span></span><span> </span><span class="entity"><span>@@</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"()"</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sym</span></span><span> </span><span>::</span><span> </span><span>map_filter</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_dicts</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>BR</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dss</span></span><span>
        </span><span>@</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>BR</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>print_app</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_print_app</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_app_expr</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>print_bind</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_print_bind</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>print_case</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span>clauses</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>concat</span></span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="entity"><span>str</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"failwith"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"\"empty case\""</span></span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_case</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>case_expr</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span> </span><span>clauses</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>binds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Code_Thingol.unfold_let</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ICase</span></span><span> </span><span class="entity"><span>case_expr</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_let</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>pat</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>vars</span></span><span>
              </span><span>|&gt;</span><span> </span><span class="entity"><span>print_bind</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>pat</span></span><span>
              </span><span>|&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>concat</span></span><span>
                  </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"let"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"in"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vars'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_map</span><span> </span><span class="entity"><span>print_let</span></span><span> </span><span class="entity"><span>binds</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>brackets</span></span><span> </span><span class="main"><span>[</span></span><span>Pretty.chunks</span><span> </span><span class="entity"><span>ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>]</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_case</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span>term</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span>typ</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> </span><span>clauses</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>clause</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>clauses</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_select</span></span><span> </span><span class="entity"><span>delim</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pat</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vars'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_bind</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>pat</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>delim</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"-&gt;"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>brackets</span></span><span> </span><span class="main"><span>(</span></span><span>
              </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"match"</span></span><span>
              </span><span>::</span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>t</span></span><span>
              </span><span>::</span><span> </span><span class="entity"><span>print_select</span></span><span> </span><span class="inner_quoted"><span>"with"</span></span><span> </span><span class="entity"><span>clause</span></span><span>
              </span><span>::</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_select</span></span><span> </span><span class="inner_quoted"><span>"|"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>clauses</span></span><span>
            </span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_val_decl</span></span><span> </span><span class="entity"><span>print_typscheme</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>typscheme</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>concat</span></span><span>
      </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"val"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deresolve</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>":"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_typscheme</span></span><span> </span><span class="entity"><span>typscheme</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_datatype_decl</span></span><span> </span><span class="entity"><span>definer</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cos</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_co</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>co</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deresolve_const</span></span><span> </span><span class="entity"><span>co</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_co</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>co</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deresolve_const</span></span><span> </span><span class="entity"><span>co</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"of"</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>enum</span></span><span> </span><span class="inner_quoted"><span>" *"</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_typ</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>INFX</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>definer</span></span><span>
          </span><span>::</span><span> </span><span class="entity"><span>print_tyco_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>ITyVar</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span>
          </span><span>::</span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span>
          </span><span>::</span><span> </span><span>separate</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"|"</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>print_co</span></span><span> </span><span class="entity"><span>cos</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_def</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>needs_typ</span></span><span> </span><span class="entity"><span>definer</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>ML_Function</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs_ty</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>eqs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_eqn</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>some_thm</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>reserved</span></span><span>
                  </span><span>|&gt;</span><span> </span><span class="entity"><span>intro_base_names_for</span></span><span> </span><span class="main"><span>(</span></span><span>is_none</span><span> </span><span>o</span><span> </span><span class="entity"><span>const_syntax</span></span><span class="main"><span>)</span></span><span>
                      </span><span class="entity"><span>deresolve</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span>
                  </span><span>|&gt;</span><span> </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="main"><span>(</span></span><span>build</span><span> </span><span class="main"><span>(</span></span><span>fold</span><span> </span><span class="entity"><span>Code_Thingol.add_varnames</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span>
                </span><span class="main"><span>(</span></span><span>Pretty.block</span><span> </span><span>o</span><span> </span><span class="entity"><span>commas</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"-&gt;"</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>t</span></span><span>
              </span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_eqns</span></span><span> </span><span class="entity"><span>is_pseudo</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>some_thm</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>reserved</span></span><span>
                      </span><span>|&gt;</span><span> </span><span class="entity"><span>intro_base_names_for</span></span><span> </span><span class="main"><span>(</span></span><span>is_none</span><span> </span><span>o</span><span> </span><span class="entity"><span>const_syntax</span></span><span class="main"><span>)</span></span><span>
                          </span><span class="entity"><span>deresolve</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span>
                      </span><span>|&gt;</span><span> </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="main"><span>(</span></span><span>build</span><span> </span><span class="main"><span>(</span></span><span>fold</span><span> </span><span class="entity"><span>Code_Thingol.add_varnames</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                    </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>(</span></span><span>
                      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_pseudo</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"()"</span></span><span class="main"><span>]</span></span><span>
                        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>BR</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span>
                      </span><span>@</span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span>
                      </span><span class="entity"><span>@@</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>t</span></span><span>
                    </span><span class="main"><span>)</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_eqns</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>eq</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>eqs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
                  </span><span>Pretty.block</span><span> </span><span class="main"><span>(</span></span><span>
                    </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span>
                    </span><span>::</span><span> </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span>
                    </span><span>::</span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"function"</span></span><span>
                    </span><span>::</span><span> </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span>
                    </span><span>::</span><span> </span><span class="entity"><span>print_eqn</span></span><span> </span><span class="entity"><span>eq</span></span><span>
                    </span><span>::</span><span> </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span>append</span><span> </span><span class="main"><span>[</span></span><span>Pretty.fbrk</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"|"</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>]</span></span><span>
                          </span><span>o</span><span> </span><span>single</span><span> </span><span>o</span><span> </span><span class="entity"><span>print_eqn</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>eqs</span></span><span>
                  </span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_eqns</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>eqs</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>eq</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>eqs'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>reserved</span></span><span>
                      </span><span>|&gt;</span><span> </span><span class="entity"><span>intro_base_names_for</span></span><span> </span><span class="main"><span>(</span></span><span>is_none</span><span> </span><span>o</span><span> </span><span class="entity"><span>const_syntax</span></span><span class="main"><span>)</span></span><span>
                           </span><span class="entity"><span>deresolve</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>eqs</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dummy_parms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>aux_params</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>eqs</span></span><span class="main"><span>;</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                    </span><span>Pretty.block</span><span> </span><span class="main"><span>(</span></span><span>
                      </span><span>Pretty.breaks</span><span> </span><span class="entity"><span>dummy_parms</span></span><span>
                      </span><span>@</span><span> </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span>
                      </span><span>::</span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span>
                      </span><span>::</span><span> </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span>
                      </span><span>::</span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"match"</span></span><span>
                      </span><span>::</span><span> </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span>
                      </span><span>::</span><span> </span><span class="main"><span>(</span></span><span>Pretty.block</span><span> </span><span>o</span><span> </span><span class="entity"><span>commas</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dummy_parms</span></span><span>
                      </span><span>::</span><span> </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span>
                      </span><span>::</span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"with"</span></span><span>
                      </span><span>::</span><span> </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span>
                      </span><span>::</span><span> </span><span class="entity"><span>print_eqn</span></span><span> </span><span class="entity"><span>eq</span></span><span>
                      </span><span>::</span><span> </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span>append</span><span> </span><span class="main"><span>[</span></span><span>Pretty.fbrk</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"|"</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>]</span></span><span>
                           </span><span>o</span><span> </span><span>single</span><span> </span><span>o</span><span> </span><span class="entity"><span>print_eqn</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>eqs'</span></span><span>
                    </span><span class="main"><span>)</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prolog</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>needs_typ</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
              </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>definer</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_const</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>":"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>]</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>concat</span></span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="entity"><span>str</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>definer</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>deresolve_const</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>pair</span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>print_val_decl</span></span><span> </span><span class="entity"><span>print_typscheme</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vs_ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>(</span></span><span>
              </span><span class="entity"><span>prolog</span></span><span>
              </span><span>::</span><span> </span><span class="entity"><span>print_dict_args</span></span><span> </span><span class="entity"><span>vs</span></span><span>
              </span><span class="entity"><span>@|</span></span><span> </span><span class="entity"><span>print_eqns</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>eqs</span></span><span>
            </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_def</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>definer</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>ML_Instance</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>superinsts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>inst_params</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_super_instance</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>super_class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_classrel</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>super_class</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>print_dict</span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Dict</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Dict_Const</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>super_class</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_classparam_instance</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>classparam</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_const</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>classparam</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>print_app</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>reserved</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>pair</span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>print_val_decl</span></span><span> </span><span class="entity"><span>print_dicttypscheme</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Instance</span></span><span> </span><span class="entity"><span>inst</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>`%%</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ITyVar</span></span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>(</span></span><span>
              </span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>definer</span></span><span>
              </span><span>::</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_inst</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>inst</span></span><span>
              </span><span>::</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_pseudo_fun</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Instance</span></span><span> </span><span class="entity"><span>inst</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"()"</span></span><span class="main"><span>]</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>print_dict_args</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span>
              </span><span>@</span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span>
              </span><span class="entity"><span>@@</span></span><span> </span><span class="entity"><span>brackets</span></span><span> </span><span class="main"><span>[</span></span><span>
                </span><span class="entity"><span>enum_default</span></span><span> </span><span class="inner_quoted"><span>"()"</span></span><span> </span><span class="inner_quoted"><span>";"</span></span><span> </span><span class="inner_quoted"><span>"{"</span></span><span> </span><span class="inner_quoted"><span>"}"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>print_super_instance</span></span><span> </span><span class="entity"><span>superinsts</span></span><span>
                  </span><span>@</span><span> </span><span>map</span><span> </span><span class="entity"><span>print_classparam_instance</span></span><span> </span><span class="entity"><span>inst_params</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>":"</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>print_dicttyp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>`%%</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ITyVar</span></span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>]</span></span><span>
            </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
     </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ML_Exc</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>pair</span><span>
          </span><span class="main"><span>[</span></span><span class="entity"><span>print_val_decl</span></span><span> </span><span class="entity"><span>print_typscheme</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vs_ty</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
          </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>doublesemicolon</span></span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="entity"><span>str</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
            </span><span class="inner_quoted"><span>"let"</span></span><span>
            </span><span>::</span><span> </span><span class="entity"><span>deresolve_const</span></span><span> </span><span class="entity"><span>const</span></span><span>
            </span><span>::</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="inner_quoted"><span>"_"</span></span><span>
            </span><span>@</span><span> </span><span class="inner_quoted"><span>"="</span></span><span>
            </span><span>::</span><span> </span><span class="inner_quoted"><span>"failwith"</span></span><span>
            </span><span class="entity"><span>@@</span></span><span> </span><span class="entity"><span>print_ocaml_string</span></span><span> </span><span class="entity"><span>const</span></span><span>
          </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ML_Val</span></span><span> </span><span class="entity"><span>binding</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sig_p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_def</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span>true</span><span> </span><span class="inner_quoted"><span>"let"</span></span><span> </span><span class="entity"><span>binding</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>pair</span><span>
            </span><span class="main"><span>[</span></span><span class="entity"><span>sig_p</span></span><span class="main"><span>]</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>doublesemicolon</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ML_Funs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>binding</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>exports_bindings</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pseudo_funs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>print_def'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_def</span></span><span> </span><span class="main"><span>(</span></span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pseudo_funs</span></span><span class="main"><span>)</span></span><span> </span><span>false</span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_pseudo_fun</span></span><span> </span><span class="entity"><span>sym</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span>
                </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"let"</span></span><span class="main"><span>,</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span class="main"><span>,</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"();;"</span></span><span>
              </span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sig_ps</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>apsnd</span><span> </span><span>split_last</span><span> </span><span>o</span><span> </span><span>split_list</span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>print_def'</span></span><span> </span><span class="inner_quoted"><span>"let rec"</span></span><span> </span><span class="entity"><span>binding</span></span><span> </span><span>::</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_def'</span></span><span> </span><span class="inner_quoted"><span>"and"</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>exports_bindings</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pseudo_ps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>print_pseudo_fun</span></span><span> </span><span class="entity"><span>pseudo_funs</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>pair</span><span>
            </span><span class="main"><span>(</span></span><span>map_filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>Code_Namespace.not_private</span></span><span> </span><span class="entity"><span>export</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span> </span><span>::</span><span> </span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>exports_bindings</span></span><span class="main"><span>)</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>sig_ps</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span>Pretty.chunks</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ps</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>doublesemicolon</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>pseudo_ps</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ML_Datas</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ty_p</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_tyco_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>ITyVar</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>pair</span><span>
            </span><span class="main"><span>[</span></span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"type"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty_p</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>doublesemicolon</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"type"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty_p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"EMPTY__"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="entity"><span>export</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ML_Datas</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>data</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>datas</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> 
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>decl_ps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_datatype_decl</span></span><span> </span><span class="inner_quoted"><span>"type"</span></span><span> </span><span class="entity"><span>data</span></span><span>
              </span><span>::</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_datatype_decl</span></span><span> </span><span class="inner_quoted"><span>"and"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>datas</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>split_last</span><span> </span><span class="entity"><span>decl_ps</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>pair</span><span>
            </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>Code_Namespace.is_public</span></span><span> </span><span class="entity"><span>export</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>decl_ps</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"type"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_tyco_expr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>ITyVar</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>data</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>datas</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span>Pretty.chunks</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>@|</span></span><span> </span><span class="entity"><span>doublesemicolon</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="entity"><span>export</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ML_Class</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>classrels</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>classparams</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_field</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>":"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_super_class_field</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>classrel</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>super_class</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>print_field</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deresolve_classrel</span></span><span> </span><span class="entity"><span>classrel</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_dicttyp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>super_class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ITyVar</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_classparam_decl</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>classparam</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>print_val_decl</span></span><span> </span><span class="entity"><span>print_typscheme</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>classparam</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>class</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_classparam_field</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>classparam</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>print_field</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deresolve_const</span></span><span> </span><span class="entity"><span>classparam</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"_"</span></span><span> </span><span>^</span><span> </span><span>Name.enforce_case</span><span> </span><span>true</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_classparam_proj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>classparam</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>concat</span></span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="entity"><span>str</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"let"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>deresolve_const</span></span><span> </span><span class="entity"><span>classparam</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>w</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"."</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>deresolve_const</span></span><span> </span><span class="entity"><span>classparam</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>";;"</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>type_decl_p</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span>
                </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"type"</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>print_dicttyp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ITyVar</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>enum_default</span></span><span> </span><span class="inner_quoted"><span>"unit"</span></span><span> </span><span class="inner_quoted"><span>";"</span></span><span> </span><span class="inner_quoted"><span>"{"</span></span><span> </span><span class="inner_quoted"><span>"}"</span></span><span> </span><span class="main"><span>(</span></span><span>
                  </span><span>map</span><span> </span><span class="entity"><span>print_super_class_field</span></span><span> </span><span class="entity"><span>classrels</span></span><span>
                  </span><span>@</span><span> </span><span>map</span><span> </span><span class="entity"><span>print_classparam_field</span></span><span> </span><span class="entity"><span>classparams</span></span><span>
                </span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>pair</span><span>
           </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>Code_Namespace.is_public</span></span><span> </span><span class="entity"><span>export</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>type_decl_p</span></span><span> </span><span>::</span><span> </span><span>map</span><span> </span><span class="entity"><span>print_classparam_decl</span></span><span> </span><span class="entity"><span>classparams</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>classrels</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>classparams</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>type_decl_p</span></span><span class="main"><span>]</span></span><span> </span><span class="comment1"><span>(*work around weakness in export calculation*)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"type"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_dicttyp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ITyVar</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span>Pretty.chunks</span><span> </span><span class="main"><span>(</span></span><span>
              </span><span class="entity"><span>doublesemicolon</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>type_decl_p</span></span><span class="main"><span>]</span></span><span>
              </span><span>::</span><span> </span><span>map</span><span> </span><span class="entity"><span>print_classparam_proj</span></span><span> </span><span class="entity"><span>classparams</span></span><span>
            </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_ocaml_module</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="entity"><span>decls</span></span><span> </span><span class="entity"><span>body</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Pretty.chunks2</span><span> </span><span class="main"><span>(</span></span><span>
    </span><span>Pretty.chunks</span><span> </span><span class="main"><span>[</span></span><span>
      </span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"module "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>name</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" : sig"</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>indent</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span>o</span><span> </span><span>Pretty.chunks</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>decls</span></span><span class="main"><span>,</span></span><span>
      </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"end = struct"</span></span><span>
    </span><span class="main"><span>]</span></span><span>
    </span><span>::</span><span> </span><span class="entity"><span>body</span></span><span>
    </span><span class="entity"><span>@|</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"end;; (*struct "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>name</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"*)"</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>literals_ocaml</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>numeral_ocaml</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span>&lt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"(Z.neg "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>numeral_ocaml</span></span><span> </span><span class="main"><span>(</span></span><span>~</span><span> </span><span class="entity"><span>k</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span>&lt;=</span><span> </span><span class="inner_numeral"><span>1073741823</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"(Z.of_int "</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>k</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>"(Z.of_string "</span></span><span> </span><span>^</span><span> </span><span>quote</span><span> </span><span class="main"><span>(</span></span><span>string_of_int</span><span> </span><span class="entity"><span>k</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>Literals</span></span><span> </span><span class="main"><span>{</span></span><span>
  </span><span>literal_string</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_ocaml_string</span></span><span class="main"><span>,</span></span><span>
  </span><span>literal_numeral</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>numeral_ocaml</span></span><span class="main"><span>,</span></span><span>
  </span><span>literal_list</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>enum</span></span><span> </span><span class="inner_quoted"><span>";"</span></span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span class="inner_quoted"><span>"]"</span></span><span class="main"><span>,</span></span><span>
  </span><span>infix_cons</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>6</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"::"</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>}</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>



</span><span class="comment1"><span>(** SML/OCaml generic part **)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>ml_program_of_program</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>module_name</span></span><span> </span><span class="entity"><span>reserved</span></span><span> </span><span class="entity"><span>identifiers</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>namify_const</span></span><span> </span><span class="entity"><span>upper</span></span><span> </span><span class="entity"><span>base</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nsp_const</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nsp_type</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>base'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nsp_const'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Name.variant</span><span> </span><span class="main"><span>(</span></span><span>Name.enforce_case</span><span> </span><span class="entity"><span>upper</span></span><span> </span><span class="entity"><span>base</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>nsp_const</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>base'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nsp_const'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nsp_type</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>namify_type</span></span><span> </span><span class="entity"><span>base</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nsp_const</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nsp_type</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>base'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nsp_type'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Name.variant</span><span> </span><span class="main"><span>(</span></span><span>Name.enforce_case</span><span> </span><span>false</span><span> </span><span class="entity"><span>base</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>nsp_type</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>base'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nsp_const</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nsp_type'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Fun</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>namify_const</span></span><span> </span><span>false</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Datatype</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>namify_type</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Datatypecons</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>namify_const</span></span><span> </span><span>true</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Class</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>namify_type</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Classrel</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>namify_const</span></span><span> </span><span>false</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Classparam</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>namify_const</span></span><span> </span><span>false</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Classinst</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>namify_const</span></span><span> </span><span>false</span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>ml_binding_of_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Fun</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>tysm</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>raw_eqs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>filter</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>raw_eqs</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>eqs'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>some_sym</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="main"><span>(</span></span><span>filter_out</span><span> </span><span class="main"><span>(</span></span><span>null</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>eqs</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>some_thm</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="main"><span>(</span></span><span>not</span><span> </span><span>o</span><span> </span><span>null</span><span> </span><span>o</span><span> </span><span>fst</span><span> </span><span>o</span><span> </span><span class="entity"><span>Code_Thingol.unfold_fun</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ty</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>IVar</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="inner_quoted"><span>"x"</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>`$</span></span><span> </span><span class="entity"><span>IVar</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="inner_quoted"><span>"x"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>some_thm</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>eqs</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.add_constsyms</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>eqs</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>eqs</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ML_Function</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tysm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>eqs'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>some_sym</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>ml_binding_of_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>Class_Instance</span></span><span> </span><span class="entity"><span>inst</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Classinst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>stmt</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ML_Instance</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>stmt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>forall</span><span> </span><span class="main"><span>(</span></span><span>null</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>ml_binding_of_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Binding block containing illegal statement: "</span></span><span> </span><span>^</span><span> 
            </span><span class="entity"><span>Code_Symbol.quote</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>modify_fun</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>stmt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>export'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>binding</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>some_value_sym</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ml_binding_of_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>stmt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ml_stmt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>binding</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="entity"><span>ML_Function</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="entity"><span>ML_Exc</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="main"><span>(</span></span><span>length</span><span> </span><span>o</span><span> </span><span>filter_out</span><span> </span><span class="main"><span>(</span></span><span>null</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span>+</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span>o</span><span> </span><span>fst</span><span> </span><span>o</span><span> </span><span class="entity"><span>Code_Thingol.unfold_fun</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>some_value_sym</span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>ML_Funs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>export'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>binding</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>ML_Funs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>binding</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>sym</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>ML_Val</span></span><span> </span><span class="entity"><span>binding</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ml_stmt</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>modify_funs</span></span><span> </span><span class="entity"><span>stmts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>single</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Namespace.Opaque</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ML_Funs</span></span><span> </span><span class="main"><span>(</span></span><span>map_split</span><span> </span><span class="entity"><span>ml_binding_of_stmt</span></span><span> </span><span class="entity"><span>stmts</span></span><span> </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>apsnd</span><span> </span><span>o</span><span> </span><span>map_filter</span><span> </span><span>o</span><span> </span><span>Option.map</span><span class="main"><span>)</span></span><span> </span><span>fst</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>modify_datatypes</span></span><span> </span><span class="entity"><span>stmts</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>datas</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map_filter</span><span>
          </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Datatype</span></span><span> </span><span class="entity"><span>stmt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>stmt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>stmts</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>datas</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="comment1"><span>(*for abstract types wrt. code_reflect*)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>datas</span></span><span>
          </span><span>|&gt;</span><span> </span><span>split_list</span><span>
          </span><span>|&gt;</span><span> </span><span>apfst</span><span> </span><span class="entity"><span>Code_Namespace.join_exports</span></span><span>
          </span><span>|&gt;</span><span> </span><span>apsnd</span><span> </span><span class="entity"><span>ML_Datas</span></span><span>
          </span><span>|&gt;</span><span> </span><span>SOME</span><span>
          </span><span>|&gt;</span><span> </span><span>single</span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>modify_class</span></span><span> </span><span class="entity"><span>stmts</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>the_single</span><span> </span><span class="main"><span>(</span></span><span>map_filter</span><span>
        </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Class</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Class</span></span><span> </span><span class="entity"><span>stmt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>stmt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>stmts</span></span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>apsnd</span><span> </span><span class="entity"><span>ML_Class</span></span><span>
      </span><span>|&gt;</span><span> </span><span>SOME</span><span>
      </span><span>|&gt;</span><span> </span><span>single</span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>modify_stmts</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>stmt</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>stmt'</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>Code_Thingol.Fun</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>Code_Thingol.is_case</span></span><span> </span><span class="entity"><span>stmt'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>modify_fun</span></span><span> </span><span class="entity"><span>stmt</span></span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>modify_stmts</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>stmts</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Fun</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>modify_funs</span></span><span> </span><span class="main"><span>(</span></span><span>filter_out</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.is_case</span></span><span> </span><span>o</span><span> </span><span>snd</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>stmts</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>modify_stmts</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>stmts</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Datatypecons</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>modify_datatypes</span></span><span> </span><span class="entity"><span>stmts</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>modify_stmts</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>stmts</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Datatype</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>modify_datatypes</span></span><span> </span><span class="entity"><span>stmts</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>modify_stmts</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>stmts</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Class</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>modify_class</span></span><span> </span><span class="entity"><span>stmts</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>modify_stmts</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>stmts</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Classrel</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>modify_class</span></span><span> </span><span class="entity"><span>stmts</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>modify_stmts</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>stmts</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Classparam</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>modify_class</span></span><span> </span><span class="entity"><span>stmts</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>modify_stmts</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>stmt</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Classinst</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>[</span></span><span class="entity"><span>modify_fun</span></span><span> </span><span class="entity"><span>stmt</span></span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>modify_stmts</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>stmts</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Classinst</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>modify_funs</span></span><span> </span><span class="entity"><span>stmts</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>modify_stmts</span></span><span> </span><span class="entity"><span>stmts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Illegal mutual dependencies: "</span></span><span> </span><span>^</span><span>
          </span><span class="main"><span>(</span></span><span>Library.commas</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Symbol.quote</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>stmts</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>Code_Namespace.hierarchical_program</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>{</span></span><span>
      </span><span>module_name</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>module_name</span></span><span class="main"><span>,</span></span><span> </span><span>reserved</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>,</span></span><span> </span><span>identifiers</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>identifiers</span></span><span class="main"><span>,</span></span><span>
      </span><span>empty_nsp</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>reserved</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>namify_module</span><span> </span><span class="main"><span>=</span></span><span> </span><span>pair</span><span class="main"><span>,</span></span><span> </span><span>namify_stmt</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span class="main"><span>,</span></span><span>
      </span><span>cyclic_modules</span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>,</span></span><span> </span><span>class_transitive</span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span class="main"><span>,</span></span><span>
      </span><span>class_relation_public</span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span class="main"><span>,</span></span><span> </span><span>empty_data</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span>memorize_data</span><span> </span><span class="main"><span>=</span></span><span> </span><span>K</span><span> </span><span>I</span><span class="main"><span>,</span></span><span> </span><span>modify_stmts</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>modify_stmts</span></span><span> </span><span class="main"><span>}</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>serialize_ml</span></span><span> </span><span class="entity"><span>print_ml_module</span></span><span> </span><span class="entity"><span>print_ml_stmt</span></span><span> </span><span class="entity"><span>ml_extension</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
    </span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>module_name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>reserved_syms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>identifiers</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>includes</span></span><span class="main"><span>,</span></span><span>
      </span><span class="entity"><span>class_syntax</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tyco_syntax</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="main"><span>}</span></span><span> </span><span class="entity"><span>program</span></span><span> </span><span class="entity"><span>exports</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>

    </span><span class="comment1"><span>(* build program *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>deresolver</span></span><span class="main"><span>,</span></span><span> </span><span>hierarchical_program</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ml_program</span></span><span> </span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>ml_program_of_program</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>module_name</span></span><span> </span><span class="main"><span>(</span></span><span>Name.make_context</span><span> </span><span class="entity"><span>reserved_syms</span></span><span class="main"><span>)</span></span><span>
        </span><span class="entity"><span>identifiers</span></span><span> </span><span class="entity"><span>exports</span></span><span> </span><span class="entity"><span>program</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* print statements *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="entity"><span>prefix_fragments</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>stmt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_ml_stmt</span></span><span>
      </span><span class="entity"><span>tyco_syntax</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>make_vars</span></span><span> </span><span class="entity"><span>reserved_syms</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.is_constr</span></span><span> </span><span class="entity"><span>program</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deresolver</span></span><span> </span><span class="entity"><span>prefix_fragments</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>export</span></span><span> </span><span class="entity"><span>stmt</span></span><span>
      </span><span>|&gt;</span><span> </span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>decl</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>Code_Namespace.not_private</span></span><span> </span><span class="entity"><span>export</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>decl</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* print modules *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_module</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>base</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>raw_decls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>split_list</span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>decls</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>maps</span><span> </span><span>these</span><span> </span><span class="entity"><span>raw_decls</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_ml_module</span></span><span> </span><span class="entity"><span>base</span></span><span> </span><span class="entity"><span>decls</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* serialization *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Pretty.chunks2</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>snd</span><span> </span><span class="entity"><span>includes</span></span><span>
      </span><span>@</span><span> </span><span>map</span><span> </span><span>snd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Namespace.print_hierarchical</span></span><span> </span><span class="main"><span>{</span></span><span>
        </span><span>print_module</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_module</span></span><span class="main"><span>,</span></span><span> </span><span>print_stmt</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_stmt</span></span><span class="main"><span>,</span></span><span>
        </span><span>lift_markup</span><span> </span><span class="main"><span>=</span></span><span> </span><span>apsnd</span><span> </span><span class="main"><span>}</span></span><span> </span><span class="entity"><span>ml_program</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Target.Singleton</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ml_extension</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>try</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deresolver</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>serializer_sml</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Code_Target.serializer</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Code_Target.parse_args</span></span><span> </span><span class="main"><span>(</span></span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>#&gt;</span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>serialize_ml</span></span><span> </span><span class="entity"><span>print_sml_module</span></span><span> </span><span class="entity"><span>print_sml_stmt</span></span><span> </span><span class="inner_quoted"><span>"ML"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>serializer_ocaml</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Code_Target.serializer</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Code_Target.parse_args</span></span><span> </span><span class="main"><span>(</span></span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>#&gt;</span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>serialize_ml</span></span><span> </span><span class="entity"><span>print_ocaml_module</span></span><span> </span><span class="entity"><span>print_ocaml_stmt</span></span><span> </span><span class="inner_quoted"><span>"ocaml"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(** Isar setup **)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fun_syntax</span></span><span> </span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ty1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty2</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>brackify_infix</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span>
    </span><span class="entity"><span>print_typ</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>INFX</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ty1</span></span><span class="main"><span>,</span></span><span>
    </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"-&gt;"</span></span><span class="main"><span>,</span></span><span>
    </span><span class="entity"><span>print_typ</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>INFX</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ty2</span></span><span>
  </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Theory.setup</span><span>
  </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Target.add_language</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>target_SML</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>{</span></span><span>serializer</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>serializer_sml</span></span><span class="main"><span>,</span></span><span> </span><span>literals</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>literals_sml</span></span><span class="main"><span>,</span></span><span>
      </span><span>check</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>env_var</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span>
        </span><span>make_destination</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span>+</span><span> </span><span>Path.explode</span><span> </span><span class="inner_quoted"><span>"ROOT.ML"</span></span><span class="main"><span>,</span></span><span>
        </span><span>make_command</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="inner_quoted"><span>"isabelle process -e 'datatype ref = datatype Unsynchronized.ref' -f 'ROOT.ML' -l Pure"</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span>
      </span><span>evaluation_args</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>
  </span><span>#&gt;</span><span> </span><span class="entity"><span>Code_Target.add_language</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>target_OCaml</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>{</span></span><span>serializer</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>serializer_ocaml</span></span><span class="main"><span>,</span></span><span> </span><span>literals</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>literals_ocaml</span></span><span class="main"><span>,</span></span><span>
      </span><span>check</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>env_var</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"ISABELLE_OCAMLFIND"</span></span><span class="main"><span>,</span></span><span>
        </span><span>make_destination</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span>+</span><span> </span><span>Path.explode</span><span> </span><span class="inner_quoted"><span>"ROOT.ml"</span></span><span>
          </span><span class="comment1"><span>(*extension demanded by OCaml compiler*)</span></span><span class="main"><span>,</span></span><span>
        </span><span>make_command</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="inner_quoted"><span>"\"$ISABELLE_OCAMLFIND\" ocamlopt -w pu -package zarith -linkpkg ROOT.ml &lt;/dev/null"</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span>
      </span><span>evaluation_args</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>
  </span><span>#&gt;</span><span> </span><span class="entity"><span>Code_Target.set_printings</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"fun"</span></span><span class="main"><span>,</span></span><span>
    </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>target_SML</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fun_syntax</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>target_OCaml</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fun_syntax</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span>#&gt;</span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Target.add_reserved</span></span><span> </span><span class="entity"><span>target_SML</span></span><span class="main"><span>)</span></span><span> </span><span>ML_Syntax.reserved_names</span><span>
  </span><span>#&gt;</span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Target.add_reserved</span></span><span> </span><span class="entity"><span>target_SML</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span>
      </span><span class="inner_quoted"><span>"ref"</span></span><span class="main"><span>,</span></span><span> </span><span class="comment1"><span>(*rebinding is illegal*)</span></span><span>
      </span><span class="inner_quoted"><span>"o"</span></span><span class="main"><span>,</span></span><span> </span><span class="comment1"><span>(*dictionary projections use it already*)</span></span><span>
      </span><span class="inner_quoted"><span>"nil"</span></span><span class="main"><span>,</span></span><span> </span><span class="comment1"><span>(*predefined constructor*)</span></span><span>
      </span><span class="inner_quoted"><span>"Fail"</span></span><span class="main"><span>,</span></span><span>
      </span><span class="inner_quoted"><span>"div"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"mod"</span></span><span class="main"><span>,</span></span><span> </span><span class="comment1"><span>(*standard infixes*)</span></span><span>
      </span><span class="inner_quoted"><span>"IntInf"</span></span><span class="main"><span>]</span></span><span>
  </span><span>#&gt;</span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Target.add_reserved</span></span><span> </span><span class="entity"><span>target_OCaml</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span>
      </span><span class="inner_quoted"><span>"and"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"as"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"assert"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"begin"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"class"</span></span><span class="main"><span>,</span></span><span>
      </span><span class="inner_quoted"><span>"constraint"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"do"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"done"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"downto"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"else"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"end"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"exception"</span></span><span class="main"><span>,</span></span><span>
      </span><span class="inner_quoted"><span>"external"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"false"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"for"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"fun"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"function"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"functor"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"if"</span></span><span class="main"><span>,</span></span><span>
      </span><span class="inner_quoted"><span>"in"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"include"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"inherit"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"initializer"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"lazy"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"let"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"match"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"method"</span></span><span class="main"><span>,</span></span><span>
      </span><span class="inner_quoted"><span>"module"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"mutable"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"new"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"object"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"of"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"open"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"or"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"private"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"rec"</span></span><span class="main"><span>,</span></span><span>
      </span><span class="inner_quoted"><span>"sig"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"struct"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"then"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"to"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"true"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"try"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"type"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"val"</span></span><span class="main"><span>,</span></span><span>
      </span><span class="inner_quoted"><span>"virtual"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"when"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"while"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"with"</span></span><span>
    </span><span class="main"><span>]</span></span><span>
  </span><span>#&gt;</span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Target.add_reserved</span></span><span> </span><span class="entity"><span>target_OCaml</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"failwith"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"mod"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"Z"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span> </span><span class="comment1"><span>(*struct*)</span></span><span>
</span></pre>
</body>

</html>