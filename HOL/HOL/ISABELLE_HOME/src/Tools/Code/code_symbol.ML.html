<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹Code/code_symbol.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹Code/code_symbol.ML›</h1>
</div>

<pre class="source"><span class="comment1"><span>(*  Title:      Tools/Code/code_symbol.ML
    Author:     Florian Haftmann, TU Muenchen

Data related to symbols in programs: constants, type constructors, classes,
class relations, class instances, modules.
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>BASIC_CODE_SYMBOL</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>,</span></span><span> </span><span>'e</span><span class="main"><span>,</span></span><span> </span><span>'f</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>attr</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Constant</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>'a</span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>'b</span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Type_Class</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>'c</span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Class_Relation</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>'d</span><span>  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Class_Instance</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>'e</span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Module</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>'f</span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>CODE_SYMBOL</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>include</span></span></span><span> </span><span class="entity"><span>BASIC_CODE_SYMBOL</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span class="main"><span>,</span></span><span> </span><span>string</span><span class="main"><span>,</span></span><span> </span><span>class</span><span class="main"><span>,</span></span><span> </span><span>class</span><span> * </span><span>class</span><span class="main"><span>,</span></span><span> </span><span>string</span><span> * </span><span>class</span><span class="main"><span>,</span></span><span> </span><span>string</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>attr</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> Table</span><span class="main"><span>:</span></span><span> </span><span>TABLE</span><span>
  </span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> Graph</span><span class="main"><span>:</span></span><span> </span><span>GRAPH</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> default_base</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> default_prefix</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> quote</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> marker</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> value</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>T</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> is_value</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> map_attr</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'g</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'b</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'h</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'c</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'i</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'d</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'j</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'e</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'k</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'f</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'l</span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>,</span></span><span> </span><span>'e</span><span class="main"><span>,</span></span><span> </span><span>'f</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>attr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'g</span><span class="main"><span>,</span></span><span> </span><span>'h</span><span class="main"><span>,</span></span><span> </span><span>'i</span><span class="main"><span>,</span></span><span> </span><span>'j</span><span class="main"><span>,</span></span><span> </span><span>'k</span><span class="main"><span>,</span></span><span> </span><span>'l</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>attr</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> maps_attr</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'g</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'b</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'h</span><span> </span><span>list</span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'c</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'i</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'d</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'j</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'e</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'k</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'f</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'l</span><span> </span><span>list</span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>,</span></span><span> </span><span>'e</span><span class="main"><span>,</span></span><span> </span><span>'f</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>attr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'g</span><span class="main"><span>,</span></span><span> </span><span>'h</span><span class="main"><span>,</span></span><span> </span><span>'i</span><span class="main"><span>,</span></span><span> </span><span>'j</span><span class="main"><span>,</span></span><span> </span><span>'k</span><span class="main"><span>,</span></span><span> </span><span>'l</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>attr</span></span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> maps_attr'</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'m</span><span> * </span><span>'g</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'b</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'m</span><span> * </span><span>'h</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'c</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'m</span><span> * </span><span>'i</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'d</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'m</span><span> * </span><span>'j</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'e</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'m</span><span> * </span><span>'k</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'f</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'m</span><span> * </span><span>'l</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>,</span></span><span> </span><span>'e</span><span class="main"><span>,</span></span><span> </span><span>'f</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>attr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'m</span><span> * </span><span class="main"><span>(</span></span><span>'g</span><span class="main"><span>,</span></span><span> </span><span>'h</span><span class="main"><span>,</span></span><span> </span><span>'i</span><span class="main"><span>,</span></span><span> </span><span>'j</span><span class="main"><span>,</span></span><span> </span><span>'k</span><span class="main"><span>,</span></span><span> </span><span>'l</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>attr</span></span><span class="main"><span>)</span></span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>,</span></span><span> </span><span>'e</span><span class="main"><span>,</span></span><span> </span><span>'f</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>data</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> empty_data</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>,</span></span><span> </span><span>'e</span><span class="main"><span>,</span></span><span> </span><span>'f</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>data</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> merge_data</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>,</span></span><span> </span><span>'e</span><span class="main"><span>,</span></span><span> </span><span>'f</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>data</span></span><span> * </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>,</span></span><span> </span><span>'e</span><span class="main"><span>,</span></span><span> </span><span>'f</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>data</span></span><span>
    </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>,</span></span><span> </span><span>'e</span><span class="main"><span>,</span></span><span> </span><span>'f</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>data</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> set_data</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>'a</span><span> </span><span>option</span><span class="main"><span>,</span></span><span> </span><span>string</span><span> * </span><span>'b</span><span> </span><span>option</span><span class="main"><span>,</span></span><span> </span><span>string</span><span> * </span><span>'c</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span>class</span><span> * </span><span>class</span><span class="main"><span>)</span></span><span> * </span><span>'d</span><span> </span><span>option</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>class</span><span class="main"><span>)</span></span><span> * </span><span>'e</span><span> </span><span>option</span><span class="main"><span>,</span></span><span> </span><span>string</span><span> * </span><span>'f</span><span> </span><span>option</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>attr</span></span><span>
    </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>,</span></span><span> </span><span>'e</span><span class="main"><span>,</span></span><span> </span><span>'f</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>data</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>,</span></span><span> </span><span>'e</span><span class="main"><span>,</span></span><span> </span><span>'f</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>data</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> lookup_constant_data</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>,</span></span><span> </span><span>'e</span><span class="main"><span>,</span></span><span> </span><span>'f</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>data</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span>option</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> lookup_type_constructor_data</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>,</span></span><span> </span><span>'e</span><span class="main"><span>,</span></span><span> </span><span>'f</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>data</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'b</span><span> </span><span>option</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> lookup_type_class_data</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>,</span></span><span> </span><span>'e</span><span class="main"><span>,</span></span><span> </span><span>'f</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>data</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>class</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'c</span><span> </span><span>option</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> lookup_class_relation_data</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>,</span></span><span> </span><span>'e</span><span class="main"><span>,</span></span><span> </span><span>'f</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>data</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>class</span><span> * </span><span>class</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'d</span><span> </span><span>option</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> lookup_class_instance_data</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>,</span></span><span> </span><span>'e</span><span class="main"><span>,</span></span><span> </span><span>'f</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>data</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> * </span><span>class</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'e</span><span> </span><span>option</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> lookup_module_data</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>,</span></span><span> </span><span>'e</span><span class="main"><span>,</span></span><span> </span><span>'f</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>data</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'f</span><span> </span><span>option</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> lookup</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'a</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>data</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>'a</span><span> </span><span>option</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> symbols_of</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>,</span></span><span> </span><span>'e</span><span class="main"><span>,</span></span><span> </span><span>'f</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>data</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> dest_module_data</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>,</span></span><span> </span><span>'e</span><span class="main"><span>,</span></span><span> </span><span>'f</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>data</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>'f</span><span class="main"><span>)</span></span><span> </span><span>list</span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Code_Symbol</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>CODE_SYMBOL</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="comment1"><span>(* data for symbols *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>,</span></span><span> </span><span>'e</span><span class="main"><span>,</span></span><span> </span><span>'f</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>attr</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Constant</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>'a</span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>'b</span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Type_Class</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>'c</span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Class_Relation</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>'d</span><span>  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Class_Instance</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>'e</span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Module</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>'f</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span class="main"><span>,</span></span><span> </span><span>string</span><span class="main"><span>,</span></span><span> </span><span>class</span><span class="main"><span>,</span></span><span> </span><span>string</span><span> * </span><span>class</span><span class="main"><span>,</span></span><span> </span><span>class</span><span> * </span><span>class</span><span class="main"><span>,</span></span><span> </span><span>string</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>attr</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>symbol_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>c1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>c2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fast_string_ord</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>c2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>symbol_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Constant</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>GREATER</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>symbol_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Constant</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>LESS</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>symbol_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="entity"><span>tyco1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="entity"><span>tyco2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fast_string_ord</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyco1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tyco2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>symbol_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>GREATER</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>symbol_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>LESS</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>symbol_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Class</span></span><span> </span><span class="entity"><span>class1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Type_Class</span></span><span> </span><span class="entity"><span>class2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fast_string_ord</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>class1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>class2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>symbol_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Class</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>GREATER</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>symbol_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Type_Class</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>LESS</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>symbol_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Relation</span></span><span> </span><span class="entity"><span>classrel1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Class_Relation</span></span><span> </span><span class="entity"><span>classrel2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>prod_ord</span><span> </span><span>fast_string_ord</span><span> </span><span>fast_string_ord</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>classrel1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>classrel2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>symbol_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Relation</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>GREATER</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>symbol_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Class_Relation</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>LESS</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>symbol_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Instance</span></span><span> </span><span class="entity"><span>inst1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Class_Instance</span></span><span> </span><span class="entity"><span>inst2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>prod_ord</span><span> </span><span>fast_string_ord</span><span> </span><span>fast_string_ord</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>inst2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>symbol_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Instance</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>GREATER</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>symbol_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Class_Instance</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>LESS</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>symbol_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Module</span></span><span> </span><span class="entity"><span>name1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Module</span></span><span> </span><span class="entity"><span>name2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fast_string_ord</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>name2</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Table</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Table</span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>key</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ord</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>symbol_ord</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Graph</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Graph</span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>key</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ord</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>symbol_ord</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>base</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Name.desymbolize</span><span> </span><span>NONE</span><span> </span><span>o</span><span> </span><span>Long_Name.base_name</span><span class="main"><span>;</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>base_rel</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>base</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"_"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>base</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>default_base</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Constant</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"value"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>default_base</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>base</span></span><span> </span><span class="entity"><span>c</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>default_base</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>base</span></span><span> </span><span class="entity"><span>tyco</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>default_base</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Class</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>base</span></span><span> </span><span class="entity"><span>class</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>default_base</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Relation</span></span><span> </span><span class="entity"><span>classrel</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>base_rel</span></span><span> </span><span class="entity"><span>classrel</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>default_base</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Instance</span></span><span> </span><span class="entity"><span>inst</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>base_rel</span></span><span> </span><span class="entity"><span>inst</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thyname_of_type</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Name_Space.the_entry_theory_name</span><span> </span><span>o</span><span> </span><span>Sign.type_space</span><span class="main"><span>;</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thyname_of_class</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Name_Space.the_entry_theory_name</span><span> </span><span>o</span><span> </span><span>Sign.class_space</span><span class="main"><span>;</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>thyname_of_instance</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.thynames_of_arity</span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>inst</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"No such instance: "</span></span><span> </span><span>^</span><span> </span><span>quote</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>inst</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" :: "</span></span><span> </span><span>^</span><span>  </span><span>snd</span><span> </span><span class="entity"><span>inst</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>thyname</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thyname</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>thyname_of_const</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>Axclass.class_of_param</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>c</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>class</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thyname_of_class</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>class</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>Code.get_type_of_constr_or_abstr</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>c</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thyname_of_type</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>tyco</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Name_Space.the_entry_theory_name</span><span> </span><span class="main"><span>(</span></span><span>Sign.const_space</span><span> </span><span class="entity"><span>thy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>prefix</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Constant</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Code"</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>prefix</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thyname_of_const</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>c</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>prefix</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thyname_of_type</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>tyco</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>prefix</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Class</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thyname_of_class</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>class</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>prefix</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Relation</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thyname_of_class</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>class</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>prefix</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Instance</span></span><span> </span><span class="entity"><span>inst</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thyname_of_instance</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>inst</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>default_prefix</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prefix</span></span><span> </span><span class="main"><span>(</span></span><span>Proof_Context.theory_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>value</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Constant</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_value</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Constant</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_value</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>quote</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Library.quote</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code.string_of_const</span></span><span> </span><span class="main"><span>(</span></span><span>Proof_Context.theory_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>quote</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="inner_quoted"><span>"type "</span></span><span> </span><span>^</span><span> </span><span>Library.quote</span><span> </span><span class="main"><span>(</span></span><span>Proof_Context.markup_type</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>quote</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Class</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="inner_quoted"><span>"class "</span></span><span> </span><span>^</span><span> </span><span>Library.quote</span><span> </span><span class="main"><span>(</span></span><span>Proof_Context.markup_class</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>quote</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Relation</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sub</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>super</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Library.quote</span><span> </span><span class="main"><span>(</span></span><span>Proof_Context.markup_class</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>sub</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" &lt; "</span></span><span> </span><span>^</span><span>
      </span><span>Library.quote</span><span> </span><span class="main"><span>(</span></span><span>Proof_Context.markup_class</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>super</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>quote</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Instance</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Library.quote</span><span> </span><span class="main"><span>(</span></span><span>Proof_Context.markup_type</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" :: "</span></span><span> </span><span>^</span><span>
      </span><span>Library.quote</span><span> </span><span class="main"><span>(</span></span><span>Proof_Context.markup_class</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>marker</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"CONST "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>c</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>marker</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"TYPE "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>tyco</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>marker</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Class</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"CLASS "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>class</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>marker</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Relation</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sub</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>super</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"CLASSREL "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>sub</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" &lt; "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>super</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>marker</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Instance</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"INSTANCE "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" :: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_attr</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>class</span></span><span> </span><span class="entity"><span>classrel</span></span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="entity"><span>module</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Constant</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>map_attr</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>class</span></span><span> </span><span class="entity"><span>classrel</span></span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="entity"><span>module</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>map_attr</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>class</span></span><span> </span><span class="entity"><span>classrel</span></span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="entity"><span>module</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Class</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Type_Class</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>class</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>map_attr</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>class</span></span><span> </span><span class="entity"><span>classrel</span></span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="entity"><span>module</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Relation</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Class_Relation</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>classrel</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>map_attr</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>class</span></span><span> </span><span class="entity"><span>classrel</span></span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="entity"><span>module</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Instance</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Class_Instance</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>map_attr</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>class</span></span><span> </span><span class="entity"><span>classrel</span></span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="entity"><span>module</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Module</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Module</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>module</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>maps_attr</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>class</span></span><span> </span><span class="entity"><span>classrel</span></span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="entity"><span>module</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>Constant</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>maps_attr</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>class</span></span><span> </span><span class="entity"><span>classrel</span></span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="entity"><span>module</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>maps_attr</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>class</span></span><span> </span><span class="entity"><span>classrel</span></span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="entity"><span>module</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Class</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>Type_Class</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>class</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>maps_attr</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>class</span></span><span> </span><span class="entity"><span>classrel</span></span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="entity"><span>module</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Relation</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>Class_Relation</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>classrel</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>maps_attr</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>class</span></span><span> </span><span class="entity"><span>classrel</span></span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="entity"><span>module</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Instance</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>Class_Instance</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>maps_attr</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>class</span></span><span> </span><span class="entity"><span>classrel</span></span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="entity"><span>module</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Module</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>Module</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>module</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>maps_attr'</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>class</span></span><span> </span><span class="entity"><span>classrel</span></span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="entity"><span>module</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>o</span><span> </span><span>apsnd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Constant</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>maps_attr'</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>class</span></span><span> </span><span class="entity"><span>classrel</span></span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="entity"><span>module</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>o</span><span> </span><span>apsnd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>maps_attr'</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>class</span></span><span> </span><span class="entity"><span>classrel</span></span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="entity"><span>module</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Class</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>o</span><span> </span><span>apsnd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Type_Class</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>class</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>maps_attr'</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>class</span></span><span> </span><span class="entity"><span>classrel</span></span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="entity"><span>module</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Relation</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>o</span><span> </span><span>apsnd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Class_Relation</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>classrel</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>maps_attr'</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>class</span></span><span> </span><span class="entity"><span>classrel</span></span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="entity"><span>module</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Instance</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>o</span><span> </span><span>apsnd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Class_Instance</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>maps_attr'</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>class</span></span><span> </span><span class="entity"><span>classrel</span></span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="entity"><span>module</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Module</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>o</span><span> </span><span>apsnd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Module</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>module</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> </span><span>'b</span><span class="main"><span>,</span></span><span> </span><span>'c</span><span class="main"><span>,</span></span><span> </span><span>'d</span><span class="main"><span>,</span></span><span> </span><span>'e</span><span class="main"><span>,</span></span><span> </span><span>'f</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>data</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Data</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>{</span></span><span> constant</span><span class="main"><span>:</span></span><span> </span><span>'a</span><span> Symtab.table</span><span class="main"><span>,</span></span><span> type_constructor</span><span class="main"><span>:</span></span><span> </span><span>'b</span><span> Symtab.table</span><span class="main"><span>,</span></span><span>
    type_class</span><span class="main"><span>:</span></span><span> </span><span>'c</span><span> Symtab.table</span><span class="main"><span>,</span></span><span> class_relation</span><span class="main"><span>:</span></span><span> </span><span>'d</span><span> Symreltab.table</span><span class="main"><span>,</span></span><span> class_instance</span><span class="main"><span>:</span></span><span> </span><span>'e</span><span> Symreltab.table</span><span class="main"><span>,</span></span><span>
    module</span><span class="main"><span>:</span></span><span> </span><span>'f</span><span> Symtab.table </span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>make_data</span></span><span> </span><span class="entity"><span>constant</span></span><span> </span><span class="entity"><span>type_constructor</span></span><span> </span><span class="entity"><span>type_class</span></span><span> </span><span class="entity"><span>class_relation</span></span><span> </span><span class="entity"><span>class_instance</span></span><span> </span><span class="entity"><span>module</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Data</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span>constant</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>constant</span></span><span class="main"><span>,</span></span><span> </span><span>type_constructor</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>type_constructor</span></span><span class="main"><span>,</span></span><span>
    </span><span>type_class</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>type_class</span></span><span class="main"><span>,</span></span><span> </span><span>class_relation</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>class_relation</span></span><span class="main"><span>,</span></span><span> </span><span>class_instance</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>class_instance</span></span><span class="main"><span>,</span></span><span> </span><span>module</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>module</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dest_data</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Data</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_data</span></span><span> </span><span class="entity"><span>map_constant</span></span><span> </span><span class="entity"><span>map_type_constructor</span></span><span> </span><span class="entity"><span>map_type_class</span></span><span> </span><span class="entity"><span>map_class_relation</span></span><span> </span><span class="entity"><span>map_class_instance</span></span><span> </span><span class="entity"><span>map_module</span></span><span>
  </span><span class="main"><span>(</span></span><span class="entity"><span>Data</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>constant</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>type_constructor</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>type_class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>class_relation</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>class_instance</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>module</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Data</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span>constant</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_constant</span></span><span> </span><span class="entity"><span>constant</span></span><span class="main"><span>,</span></span><span> </span><span>type_constructor</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_type_constructor</span></span><span> </span><span class="entity"><span>type_constructor</span></span><span class="main"><span>,</span></span><span>
      </span><span>type_class</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_type_class</span></span><span> </span><span class="entity"><span>type_class</span></span><span class="main"><span>,</span></span><span> </span><span>class_relation</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_class_relation</span></span><span> </span><span class="entity"><span>class_relation</span></span><span class="main"><span>,</span></span><span>
        </span><span>class_instance</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_class_instance</span></span><span> </span><span class="entity"><span>class_instance</span></span><span class="main"><span>,</span></span><span> </span><span>module</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_module</span></span><span> </span><span class="entity"><span>module</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>empty_data</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Data</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span>constant</span><span> </span><span class="main"><span>=</span></span><span> </span><span>Symtab.empty</span><span class="main"><span>,</span></span><span> </span><span>type_constructor</span><span> </span><span class="main"><span>=</span></span><span> </span><span>Symtab.empty</span><span class="main"><span>,</span></span><span>
  </span><span>type_class</span><span> </span><span class="main"><span>=</span></span><span> </span><span>Symtab.empty</span><span class="main"><span>,</span></span><span> </span><span>class_relation</span><span> </span><span class="main"><span>=</span></span><span> </span><span>Symreltab.empty</span><span class="main"><span>,</span></span><span> </span><span>class_instance</span><span> </span><span class="main"><span>=</span></span><span> </span><span>Symreltab.empty</span><span class="main"><span>,</span></span><span> </span><span>module</span><span> </span><span class="main"><span>=</span></span><span> </span><span>Symtab.empty</span><span> </span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>merge_data</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Data</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span>constant</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>constant1</span></span><span class="main"><span>,</span></span><span> </span><span>type_constructor</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>type_constructor1</span></span><span class="main"><span>,</span></span><span>
    </span><span>type_class</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>type_class1</span></span><span class="main"><span>,</span></span><span> </span><span>class_instance</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>class_instance1</span></span><span class="main"><span>,</span></span><span> </span><span>class_relation</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>class_relation1</span></span><span class="main"><span>,</span></span><span> </span><span>module</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>module1</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>Data</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span>constant</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>constant2</span></span><span class="main"><span>,</span></span><span> </span><span>type_constructor</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>type_constructor2</span></span><span class="main"><span>,</span></span><span>
    </span><span>type_class</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>type_class2</span></span><span class="main"><span>,</span></span><span> </span><span>class_instance</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>class_instance2</span></span><span class="main"><span>,</span></span><span> </span><span>class_relation</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>class_relation2</span></span><span class="main"><span>,</span></span><span> </span><span>module</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>module2</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>make_data</span></span><span> </span><span class="main"><span>(</span></span><span>Symtab.join</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>constant1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>constant2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>(</span></span><span>Symtab.join</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>type_constructor1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>type_constructor2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>(</span></span><span>Symtab.join</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>type_class1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>type_class2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>(</span></span><span>Symreltab.join</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>class_relation1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>class_relation2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>(</span></span><span>Symreltab.join</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>class_instance1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>class_instance2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>(</span></span><span>Symtab.join</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>module1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>module2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="comment1"><span>(*prefer later entries: K snd*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>set_sym</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Symtab.delete_safe</span><span> </span><span class="entity"><span>sym</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>set_sym</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Symtab.update</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>set_symrel</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>symrel</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Symreltab.delete_safe</span><span> </span><span class="entity"><span>symrel</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>set_symrel</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>symrel</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Symreltab.update</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>symrel</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>set_data</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_data</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set_sym</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>set_data</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_data</span></span><span> </span><span>I</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set_sym</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>set_data</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Class</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_data</span></span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set_sym</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>set_data</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Relation</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_data</span></span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set_symrel</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>I</span><span> </span><span>I</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>set_data</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Instance</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_data</span></span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set_symrel</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>I</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>set_data</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Module</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_data</span></span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set_sym</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>lookup_constant_data</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>Symtab.lookup</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>constant</span><span> </span><span>o</span><span> </span><span class="entity"><span>dest_data</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>lookup_type_constructor_data</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>Symtab.lookup</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>type_constructor</span><span> </span><span>o</span><span> </span><span class="entity"><span>dest_data</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>lookup_type_class_data</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>Symtab.lookup</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>type_class</span><span> </span><span>o</span><span> </span><span class="entity"><span>dest_data</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>lookup_class_relation_data</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>Symreltab.lookup</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>class_relation</span><span> </span><span>o</span><span> </span><span class="entity"><span>dest_data</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>lookup_class_instance_data</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>Symreltab.lookup</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>class_instance</span><span> </span><span>o</span><span> </span><span class="entity"><span>dest_data</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>lookup_module_data</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>Symtab.lookup</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>module</span><span> </span><span>o</span><span> </span><span class="entity"><span>dest_data</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>lookup</span></span><span> </span><span class="entity"><span>data</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lookup_constant_data</span></span><span> </span><span class="entity"><span>data</span></span><span> </span><span class="entity"><span>x</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>lookup</span></span><span> </span><span class="entity"><span>data</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lookup_type_constructor_data</span></span><span> </span><span class="entity"><span>data</span></span><span> </span><span class="entity"><span>x</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>lookup</span></span><span> </span><span class="entity"><span>data</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Class</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lookup_type_class_data</span></span><span> </span><span class="entity"><span>data</span></span><span> </span><span class="entity"><span>x</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>lookup</span></span><span> </span><span class="entity"><span>data</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Relation</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lookup_class_relation_data</span></span><span> </span><span class="entity"><span>data</span></span><span> </span><span class="entity"><span>x</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>lookup</span></span><span> </span><span class="entity"><span>data</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Instance</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lookup_class_instance_data</span></span><span> </span><span class="entity"><span>data</span></span><span> </span><span class="entity"><span>x</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>lookup</span></span><span> </span><span class="entity"><span>data</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Module</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lookup_module_data</span></span><span> </span><span class="entity"><span>data</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>symbols_of</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>Constant</span></span><span> </span><span>o</span><span> </span><span>Symtab.keys</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>constant</span><span> </span><span>o</span><span> </span><span class="entity"><span>dest_data</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>
  </span><span>@</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>Type_Constructor</span></span><span> </span><span>o</span><span> </span><span>Symtab.keys</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>type_constructor</span><span> </span><span>o</span><span> </span><span class="entity"><span>dest_data</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>
  </span><span>@</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>Type_Class</span></span><span> </span><span>o</span><span> </span><span>Symtab.keys</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>type_class</span><span> </span><span>o</span><span> </span><span class="entity"><span>dest_data</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>
  </span><span>@</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>Class_Relation</span></span><span> </span><span>o</span><span> </span><span>Symreltab.keys</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>class_relation</span><span> </span><span>o</span><span> </span><span class="entity"><span>dest_data</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>
  </span><span>@</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>Class_Instance</span></span><span> </span><span>o</span><span> </span><span>Symreltab.keys</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>class_instance</span><span> </span><span>o</span><span> </span><span class="entity"><span>dest_data</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>
  </span><span>@</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>Module</span></span><span> </span><span>o</span><span> </span><span>Symtab.keys</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>module</span><span> </span><span>o</span><span> </span><span class="entity"><span>dest_data</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dest_module_data</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>Symtab.dest</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>module</span><span> </span><span>o</span><span> </span><span class="entity"><span>dest_data</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>


</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Basic_Code_Symbol</span></span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>BASIC_CODE_SYMBOL</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Code_Symbol</span><span class="main"><span>;</span></span><span>
</span></pre>
</body>

</html>