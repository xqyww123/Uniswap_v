<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹Code/code_haskell.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹Code/code_haskell.ML›</h1>
</div>

<pre class="source"><span class="comment1"><span>(*  Title:      Tools/Code/code_haskell.ML
    Author:     Florian Haftmann, TU Muenchen

Serializer for Haskell.
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>CODE_HASKELL</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> language_params</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> target</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> print_numeral</span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Code_Haskell</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>CODE_HASKELL</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>target</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Haskell"</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>language_extensions</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"EmptyDataDecls"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"RankNTypes"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"ScopedTypeVariables"</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>language_pragma</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="inner_quoted"><span>"{-# LANGUAGE "</span></span><span> </span><span>^</span><span> </span><span>commas</span><span> </span><span class="entity"><span>language_extensions</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" #-}"</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>language_params</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>space_implode</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>prefix</span><span> </span><span class="inner_quoted"><span>"-X"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>language_extensions</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Basic_Code_Symbol</span><span class="main"><span>;</span></span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Basic_Code_Thingol</span><span class="main"><span>;</span></span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Code_Printer</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>infixr</span></span></span><span> </span><span class="inner_numeral"><span>5</span></span><span> @@</span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>infixr</span></span></span><span> </span><span class="inner_numeral"><span>5</span></span><span> @|</span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(** Haskell serializer **)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>print_haskell_string</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>quote</span><span> </span><span>o</span><span> </span><span>translate_string</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Symbol.is_ascii</span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>GHC.print_codepoint</span></span><span> </span><span class="main"><span>(</span></span><span>ord</span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"non-ASCII byte in Haskell string literal"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_haskell_stmt</span></span><span> </span><span class="entity"><span>class_syntax</span></span><span> </span><span class="entity"><span>tyco_syntax</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span>
    </span><span class="entity"><span>reserved</span></span><span> </span><span class="entity"><span>deresolve</span></span><span> </span><span class="entity"><span>deriving_show</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>deresolve_const</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deresolve</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Constant</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>deresolve_tyco</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deresolve</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Type_Constructor</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>deresolve_class</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deresolve</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Type_Class</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>class_name</span></span><span> </span><span class="entity"><span>class</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>class_syntax</span></span><span> </span><span class="entity"><span>class</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>deresolve_class</span></span><span> </span><span class="entity"><span>class</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>class</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_typcontext</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sort</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>pair</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sort</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>constraints</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>enum</span></span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>class_name</span></span><span> </span><span class="entity"><span>class</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>lookup_var</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>constraints</span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>@@</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>" =&gt; "</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_typforall</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>vs</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>vnames</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"forall "</span></span><span> </span><span>::</span><span> </span><span>Pretty.breaks</span><span>
          </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>lookup_var</span></span><span> </span><span class="entity"><span>tyvars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vnames</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"."</span></span><span> </span><span class="entity"><span>@@</span></span><span> </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_tyco_expr</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>brackify</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span>::</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>BR</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>`%%</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>tyco_syntax</span></span><span> </span><span class="entity"><span>tyco</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>print_tyco_expr</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deresolve_tyco</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>print</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ITyVar</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>lookup_var</span></span><span> </span><span class="entity"><span>tyvars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_typdecl</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>print_tyco_expr</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>ITyVar</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_typscheme</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Pretty.block</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_typforall</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>print_typcontext</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>@|</span></span><span> </span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>IConst</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>print_app</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t1</span></span><span> </span><span class="entity"><span>`$</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>Code_Thingol.unfold_const_app</span></span><span> </span><span class="entity"><span>t</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>app</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>print_app</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>app</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="entity"><span>brackify</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>[</span></span><span>
                  </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>BR</span></span><span> </span><span class="entity"><span>t2</span></span><span>
                </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>IVar</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"_"</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>IVar</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>lookup_var</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>v</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>`|=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>binds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Code_Thingol.unfold_pat_abs</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vars'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_bind</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>BR</span></span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>binds</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>brackets</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"\\"</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ps</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"-&gt;"</span></span><span> </span><span class="entity"><span>@@</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ICase</span></span><span> </span><span class="entity"><span>case_expr</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>Code_Thingol.unfold_const_app</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>primitive</span><span> </span><span class="entity"><span>case_expr</span></span><span class="main"><span>)</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>app</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span> </span><span>sym</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>is_none</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>)</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>print_case</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>case_expr</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>print_app</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>app</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>print_case</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>case_expr</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>print_app_expr</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>annotation</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>printed_const</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>annotation</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span>SOME</span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>brackets</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"::"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>]</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sym</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> 
        </span><span class="entity"><span>printed_const</span></span><span> </span><span>::</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>BR</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>print_app</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_print_app</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_app_expr</span></span><span> </span><span class="entity"><span>tyvars</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>print_bind</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_print_bind</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>p</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>print_case</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span>clauses</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>brackify</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span>o</span><span> </span><span>Pretty.breaks</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="entity"><span>str</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"error"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"\"empty case\""</span></span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_case</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>case_expr</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span> </span><span>clauses</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>IVar</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Code_Thingol.unfold_let_no_pat</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ICase</span></span><span> </span><span class="entity"><span>case_expr</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_assignment</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>some_v</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>vars</span></span><span>
              </span><span>|&gt;</span><span> </span><span class="entity"><span>print_bind</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>BR</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>IVar</span></span><span> </span><span class="entity"><span>some_v</span></span><span class="main"><span>)</span></span><span>
              </span><span>|&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>semicolon</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vars'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_map</span><span> </span><span class="entity"><span>print_assignment</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>brackify_block</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"let {"</span></span><span class="main"><span>)</span></span><span>
            </span><span class="entity"><span>ps</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"}"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"in"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_case</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span>term</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span>typ</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> </span><span>clauses</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>clauses</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_select</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pat</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vars'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_bind</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>pat</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>semicolon</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"-&gt;"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Pretty.block_enclose</span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"(case"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"of"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"{"</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"})"</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>print_select</span></span><span> </span><span class="entity"><span>clauses</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Fun</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>raw_eqs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_err</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>semicolon</span></span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="entity"><span>str</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
                </span><span class="entity"><span>deresolve_const</span></span><span> </span><span class="entity"><span>const</span></span><span>
                </span><span>::</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="inner_quoted"><span>"_"</span></span><span>
                </span><span>@</span><span> </span><span class="inner_quoted"><span>"="</span></span><span>
                </span><span>::</span><span> </span><span class="inner_quoted"><span>"error"</span></span><span>
                </span><span class="entity"><span>@@</span></span><span> </span><span class="entity"><span>print_haskell_string</span></span><span> </span><span class="entity"><span>const</span></span><span>
              </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_eqn</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>some_thm</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>reserved</span></span><span>
                  </span><span>|&gt;</span><span> </span><span class="entity"><span>intro_base_names_for</span></span><span> </span><span class="main"><span>(</span></span><span>is_none</span><span> </span><span>o</span><span> </span><span class="entity"><span>const_syntax</span></span><span class="main"><span>)</span></span><span>
                      </span><span class="entity"><span>deresolve</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span>
                  </span><span>|&gt;</span><span> </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="main"><span>(</span></span><span>build</span><span> </span><span class="main"><span>(</span></span><span>fold</span><span> </span><span class="entity"><span>Code_Thingol.add_varnames</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span class="entity"><span>semicolon</span></span><span> </span><span class="main"><span>(</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_const</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>const</span></span><span>
                  </span><span>::</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>BR</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts</span></span><span>
                  </span><span>@</span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span>
                  </span><span class="entity"><span>@@</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>t</span></span><span>
                </span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Pretty.chunks</span><span> </span><span class="main"><span>(</span></span><span>
              </span><span class="entity"><span>semicolon</span></span><span> </span><span class="main"><span>[</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span>suffix</span><span> </span><span class="inner_quoted"><span>" ::"</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_const</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>print_typscheme</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>]</span></span><span>
              </span><span>::</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>filter</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>raw_eqs</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>print_err</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>length</span><span> </span><span>o</span><span> </span><span>fst</span><span> </span><span>o</span><span> </span><span class="entity"><span>Code_Thingol.unfold_fun</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
                </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>print_eqn</span></span><span> </span><span class="entity"><span>eqs</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Datatype</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>semicolon</span></span><span> </span><span class="main"><span>[</span></span><span>
              </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"data"</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>print_typdecl</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deresolve_tyco</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>]</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Datatype</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>co</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ty</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>semicolon</span></span><span> </span><span class="main"><span>(</span></span><span>
              </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"newtype"</span></span><span>
              </span><span>::</span><span> </span><span class="entity"><span>print_typdecl</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deresolve_tyco</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span>
              </span><span>::</span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span>
              </span><span>::</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_const</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>co</span></span><span>
              </span><span>::</span><span> </span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>BR</span></span><span> </span><span class="entity"><span>ty</span></span><span>
              </span><span>::</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>deriving_show</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"deriving (Prelude.Read, Prelude.Show)"</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Datatype</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>co</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>cos</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_co</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>co</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>(</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_const</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>co</span></span><span>
                </span><span>::</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>BR</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tys</span></span><span>
              </span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>semicolon</span></span><span> </span><span class="main"><span>(</span></span><span>
              </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"data"</span></span><span>
              </span><span>::</span><span> </span><span class="entity"><span>print_typdecl</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deresolve_tyco</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span>
              </span><span>::</span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span>
              </span><span>::</span><span> </span><span class="entity"><span>print_co</span></span><span> </span><span class="entity"><span>co</span></span><span>
              </span><span>::</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"| "</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>print_co</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>cos</span></span><span>
              </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>deriving_show</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"deriving (Prelude.Read, Prelude.Show)"</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Class</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Class</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>classrels</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>classparams</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>v</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_classparam</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>classparam</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>semicolon</span></span><span> </span><span class="main"><span>[</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_const</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>classparam</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"::"</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>ty</span></span><span>
              </span><span class="main"><span>]</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Pretty.block_enclose</span><span> </span><span class="main"><span>(</span></span><span>
              </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span>
                </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"class "</span></span><span class="main"><span>,</span></span><span>
                </span><span>Pretty.block</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_typcontext</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span>snd</span><span> </span><span class="entity"><span>classrels</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deresolve_class</span></span><span> </span><span class="entity"><span>class</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>lookup_var</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>" where {"</span></span><span>
              </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"};"</span></span><span>
            </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>print_classparam</span></span><span> </span><span class="entity"><span>classparams</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Classinst</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>inst_params</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_classparam_instance</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>classparam</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>classparam</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>semicolon</span></span><span> </span><span class="main"><span>[</span></span><span>
                    </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span>Long_Name.base_name</span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_const</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>classparam</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>print_app</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>reserved</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>]</span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Printer.Plain_printer</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>semicolon</span></span><span> </span><span class="main"><span>[</span></span><span>
                    </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span>Long_Name.base_name</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>print_app</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>reserved</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>]</span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Printer.Complex_printer</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>{</span></span><span> </span><span>sym</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dom</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>;</span></span><span>
                    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rhs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span>o</span><span> </span><span>map</span><span class="main"><span>)</span></span><span> </span><span>fst</span><span>
                      </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.unfold_abs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.eta_expand</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="main"><span>(</span></span><span>is_some</span><span> </span><span>o</span><span> </span><span class="entity"><span>const_syntax</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>c</span></span><span>
                      </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>NONE</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>o</span><span> </span><span>Long_Name.base_name</span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_const</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>;</span></span><span>
                    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>reserved</span></span><span>
                      </span><span>|&gt;</span><span> </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="main"><span>(</span></span><span>map_filter</span><span> </span><span>I</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>IConst</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span>sym</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>classparam</span></span><span class="main"><span>,</span></span><span> </span><span>typargs</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                      </span><span>dicts</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>dom</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dom</span></span><span class="main"><span>,</span></span><span> </span><span>annotation</span><span> </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>}</span></span><span> </span><span class="entity"><span>`$$</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>IVar</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>;</span></span><span>
                      </span><span class="comment1"><span>(*dictionaries are not relevant at this late stage,
                        and these consts never need type annotations for disambiguation *)</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                    </span><span class="entity"><span>semicolon</span></span><span> </span><span class="main"><span>[</span></span><span>
                      </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>lhs</span></span><span class="main"><span>,</span></span><span>
                      </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span class="main"><span>,</span></span><span>
                      </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>rhs</span></span><span>
                    </span><span class="main"><span>]</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Pretty.block_enclose</span><span> </span><span class="main"><span>(</span></span><span>
              </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span>
                </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"instance "</span></span><span class="main"><span>,</span></span><span>
                </span><span>Pretty.block</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_typcontext</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>class_name</span></span><span> </span><span class="entity"><span>class</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>BR</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>`%%</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ITyVar</span></span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>" where {"</span></span><span>
              </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"};"</span></span><span>
            </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>print_classparam_instance</span></span><span> </span><span class="entity"><span>inst_params</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>haskell_program_of_program</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>module_prefix</span></span><span> </span><span class="entity"><span>module_name</span></span><span> </span><span class="entity"><span>reserved</span></span><span> </span><span class="entity"><span>identifiers</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>namify_fun</span></span><span> </span><span class="entity"><span>upper</span></span><span> </span><span class="entity"><span>base</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nsp_fun</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nsp_typ</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>base'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nsp_fun'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Name.variant</span><span> </span><span class="main"><span>(</span></span><span>Name.enforce_case</span><span> </span><span class="entity"><span>upper</span></span><span> </span><span class="entity"><span>base</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>nsp_fun</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>base'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nsp_fun'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nsp_typ</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>namify_typ</span></span><span> </span><span class="entity"><span>base</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nsp_fun</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nsp_typ</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>base'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nsp_typ'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Name.variant</span><span> </span><span class="main"><span>(</span></span><span>Name.enforce_case</span><span> </span><span>true</span><span> </span><span class="entity"><span>base</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>nsp_typ</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>base'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nsp_fun</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nsp_typ'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Fun</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>pair</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Fun</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>namify_fun</span></span><span> </span><span>false</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Datatype</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>namify_typ</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Datatypecons</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>namify_fun</span></span><span> </span><span>true</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Class</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>namify_typ</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Classrel</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>pair</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Classparam</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>namify_fun</span></span><span> </span><span>false</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Classinst</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>pair</span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>select_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Fun</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>select_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Fun</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>select_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Datatype</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>select_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Datatypecons</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>select_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Class</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>select_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Classrel</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>select_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Classparam</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>select_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Classinst</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>Code_Namespace.flat_program</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span class="main"><span>{</span></span><span> </span><span>module_prefix</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>module_prefix</span></span><span class="main"><span>,</span></span><span> </span><span>module_name</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>module_name</span></span><span class="main"><span>,</span></span><span> </span><span>reserved</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>,</span></span><span>
        </span><span>identifiers</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>identifiers</span></span><span class="main"><span>,</span></span><span> </span><span>empty_nsp</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>reserved</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>namify_stmt</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span class="main"><span>,</span></span><span>
        </span><span>modify_stmt</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>stmt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>select_stmt</span></span><span> </span><span class="entity"><span>stmt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>stmt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>}</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prelude_import_operators</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span>
  </span><span class="inner_quoted"><span>"=="</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"/="</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"&lt;"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"&lt;="</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"&gt;="</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"&gt;"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"+"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"-"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"*"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"/"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"**"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"&gt;&gt;="</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"&gt;&gt;"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"=&lt;&lt;"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"&amp;&amp;"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"||"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"^"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"^^"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"."</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"$"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"$!"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"++"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"!!"</span></span><span>
</span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prelude_import_unqualified</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span>
  </span><span class="inner_quoted"><span>"Eq"</span></span><span class="main"><span>,</span></span><span>
  </span><span class="inner_quoted"><span>"error"</span></span><span class="main"><span>,</span></span><span>
  </span><span class="inner_quoted"><span>"id"</span></span><span class="main"><span>,</span></span><span>
  </span><span class="inner_quoted"><span>"return"</span></span><span class="main"><span>,</span></span><span>
  </span><span class="inner_quoted"><span>"not"</span></span><span class="main"><span>,</span></span><span>
  </span><span class="inner_quoted"><span>"fst"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"snd"</span></span><span class="main"><span>,</span></span><span>
  </span><span class="inner_quoted"><span>"map"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"filter"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"concat"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"concatMap"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"reverse"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"zip"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"null"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"takeWhile"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"dropWhile"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"all"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"any"</span></span><span class="main"><span>,</span></span><span>
  </span><span class="inner_quoted"><span>"Integer"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"negate"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"abs"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"divMod"</span></span><span class="main"><span>,</span></span><span>
  </span><span class="inner_quoted"><span>"String"</span></span><span>
</span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prelude_import_unqualified_constr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span>
  </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Bool"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"True"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"False"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
  </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Maybe"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"Nothing"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"Just"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>serialize_haskell</span></span><span> </span><span class="entity"><span>module_prefix</span></span><span> </span><span class="entity"><span>string_classes</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>module_name</span></span><span class="main"><span>,</span></span><span>
    </span><span class="entity"><span>reserved_syms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>identifiers</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>includes</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>class_syntax</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tyco_syntax</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="main"><span>}</span></span><span> </span><span class="entity"><span>program</span></span><span> </span><span class="entity"><span>exports</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>

    </span><span class="comment1"><span>(* build program *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>reserved</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>insert</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>includes</span></span><span> </span><span class="entity"><span>reserved_syms</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>deresolver</span></span><span class="main"><span>,</span></span><span> </span><span>flat_program</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>haskell_program</span></span><span> </span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>haskell_program_of_program</span></span><span>
      </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>module_prefix</span></span><span> </span><span class="entity"><span>module_name</span></span><span> </span><span class="main"><span>(</span></span><span>Name.make_context</span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>identifiers</span></span><span> </span><span class="entity"><span>exports</span></span><span> </span><span class="entity"><span>program</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* print statements *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>deriving_show</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>deriv</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="inner_quoted"><span>"fun"</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>deriv</span></span><span> </span><span class="entity"><span>tycos</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tycos</span></span><span> </span><span class="entity"><span>tyco</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>try</span><span> </span><span class="main"><span>(</span></span><span>Code_Symbol.Graph.get_node</span><span> </span><span class="entity"><span>program</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>)</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Datatype</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>forall</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deriv'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>tycos</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span>snd</span><span> </span><span class="entity"><span>cs</span></span><span class="main"><span>)</span></span><span>
                 </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>true</span><span>
        </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>deriv'</span></span><span> </span><span class="entity"><span>tycos</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>`%%</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deriv</span></span><span> </span><span class="entity"><span>tycos</span></span><span> </span><span class="entity"><span>tyco</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>forall</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deriv'</span></span><span> </span><span class="entity"><span>tycos</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tys</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>deriv'</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ITyVar</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>deriv</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="entity"><span>deresolve</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_haskell_stmt</span></span><span>
      </span><span class="entity"><span>class_syntax</span></span><span> </span><span class="entity"><span>tyco_syntax</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>make_vars</span></span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>)</span></span><span>
      </span><span class="entity"><span>deresolve</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>string_classes</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>deriving_show</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>K</span><span> </span><span>false</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* print modules *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>module_names</span></span><span> </span><span class="entity"><span>module_name</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>split_last</span><span> </span><span class="main"><span>(</span></span><span>Long_Name.explode</span><span> </span><span class="entity"><span>module_name</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>x</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>".hs"</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_module_frame</span></span><span> </span><span class="entity"><span>module_name</span></span><span> </span><span class="entity"><span>header</span></span><span> </span><span class="entity"><span>exports</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>module_names</span></span><span> </span><span class="entity"><span>module_name</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.chunks2</span><span> </span><span class="main"><span>(</span></span><span>
        </span><span class="entity"><span>header</span></span><span>
        </span><span>@</span><span> </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"module"</span></span><span class="main"><span>,</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>exports</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span>SOME</span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>module_name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>enclose</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>commas</span></span><span> </span><span class="entity"><span>ps</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>module_name</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"where {"</span></span><span>
        </span><span class="main"><span>]</span></span><span>
        </span><span>::</span><span> </span><span class="entity"><span>ps</span></span><span>
        </span><span class="entity"><span>@|</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"}"</span></span><span>
      </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_qualified_import</span></span><span> </span><span class="entity"><span>module_name</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>semicolon</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"import qualified"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>module_name</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>import_common_ps</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>enclose</span></span><span> </span><span class="inner_quoted"><span>"import Prelude ("</span></span><span> </span><span class="inner_quoted"><span>");"</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>commas</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>str</span></span><span>
        </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Library.enclose</span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prelude_import_operators</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>prelude_import_unqualified</span></span><span class="main"><span>)</span></span><span>
          </span><span>@</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>constrs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>enclose</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"("</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>commas</span></span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="entity"><span>str</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>constrs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prelude_import_unqualified_constr</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span>::</span><span> </span><span class="entity"><span>print_qualified_import</span></span><span> </span><span class="inner_quoted"><span>"Prelude"</span></span><span>
      </span><span>::</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_qualified_import</span></span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>includes</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_module</span></span><span> </span><span class="entity"><span>module_name</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>gr</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>imports</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>deresolve</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deresolver</span></span><span> </span><span class="entity"><span>module_name</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>deresolve_import</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span>o</span><span> </span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>deresolve_import_attached</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span>o</span><span> </span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span>suffix</span><span> </span><span class="inner_quoted"><span>"(..)"</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_import</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Fun</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deresolve_import</span></span><span> </span><span class="entity"><span>sym</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_import</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Namespace.Public</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Datatype</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deresolve_import_attached</span></span><span> </span><span class="entity"><span>sym</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_import</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Namespace.Opaque</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Datatype</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deresolve_import</span></span><span> </span><span class="entity"><span>sym</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_import</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Namespace.Public</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Class</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deresolve_import_attached</span></span><span> </span><span class="entity"><span>sym</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_import</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Namespace.Opaque</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Class</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deresolve_import</span></span><span> </span><span class="entity"><span>sym</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_import</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Classinst</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>import_ps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>import_common_ps</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_qualified_import</span></span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>imports</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_stmt'</span></span><span> </span><span class="entity"><span>sym</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Code_Symbol.Graph.get_node</span><span> </span><span class="entity"><span>gr</span></span><span> </span><span class="entity"><span>sym</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>NONE</span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>stmt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>Code_Namespace.not_private</span></span><span> </span><span class="entity"><span>export</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>print_import</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>stmt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>markup_stmt</span></span><span> </span><span class="entity"><span>sym</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_stmt</span></span><span> </span><span class="entity"><span>deresolve</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>stmt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>export_ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body_ps</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span>o</span><span> </span><span>rev</span><span> </span><span>o</span><span> </span><span>Code_Symbol.Graph.strong_conn</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>gr</span></span><span>
          </span><span>|&gt;</span><span> </span><span>map_filter</span><span> </span><span class="entity"><span>print_stmt'</span></span><span>
          </span><span>|&gt;</span><span> </span><span>split_list</span><span>
          </span><span>|&gt;</span><span> </span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>map_filter</span><span> </span><span>I</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>print_module_frame</span></span><span> </span><span class="entity"><span>module_name</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>language_pragma</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>export_ps</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>import_ps</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span>Pretty.chunks</span><span> </span><span class="entity"><span>import_ps</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>body_ps</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Target.Hierarchy</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>module_name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>content</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>module_name</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>".hs"</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>content</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>includes</span></span><span>
      </span><span>@</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>module_name</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>print_module</span></span><span> </span><span class="entity"><span>module_name</span></span><span> </span><span class="main"><span>(</span></span><span>Graph.get_node</span><span> </span><span class="entity"><span>haskell_program</span></span><span> </span><span class="entity"><span>module_name</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>flat</span><span> </span><span>o</span><span> </span><span>rev</span><span> </span><span>o</span><span> </span><span>Graph.strong_conn</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>haskell_program</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>try</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deresolver</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>serializer</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Code_Target.serializer</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Code_Target.parse_args</span></span><span> </span><span class="main"><span>(</span></span><span>Scan.optional</span><span> </span><span class="main"><span>(</span></span><span>Args.$$$</span><span> </span><span class="inner_quoted"><span>"root"</span></span><span> </span><span>--</span><span> </span><span>Args.colon</span><span> </span><span>|--</span><span> </span><span>Args.name</span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span>
    </span><span>--</span><span> </span><span>Scan.optional</span><span> </span><span class="main"><span>(</span></span><span>Args.$$$</span><span> </span><span class="inner_quoted"><span>"string_classes"</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>K</span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span>false</span><span>
    </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>module_prefix</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>string_classes</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="entity"><span>serialize_haskell</span></span><span> </span><span class="entity"><span>module_prefix</span></span><span> </span><span class="entity"><span>string_classes</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_numeral</span></span><span> </span><span class="entity"><span>typ</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Library.enclose</span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>" :: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>typ</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>signed_string_of_int</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>literals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Literals</span></span><span> </span><span class="main"><span>{</span></span><span>
  </span><span>literal_string</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_haskell_string</span></span><span class="main"><span>,</span></span><span>
  </span><span>literal_numeral</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_numeral</span></span><span> </span><span class="inner_quoted"><span>"Integer"</span></span><span class="main"><span>,</span></span><span>
  </span><span>literal_list</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>enum</span></span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span class="inner_quoted"><span>"]"</span></span><span class="main"><span>,</span></span><span>
  </span><span>infix_cons</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>5</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>":"</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(** optional monad syntax **)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pretty_haskell_monad</span></span><span> </span><span class="entity"><span>c_bind</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dest_bind</span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span class="entity"><span>t2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>Code_Thingol.split_pat_abs</span></span><span> </span><span class="entity"><span>t2</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>pat</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>pat</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>NONE</span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dest_monad</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>IConst</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span>sym</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span> </span><span class="entity"><span>`$</span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span class="entity"><span>`$</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>c_bind</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>dest_bind</span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span class="entity"><span>t2</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>NONE</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>dest_monad</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>Code_Thingol.split_let_no_pat</span></span><span> </span><span class="entity"><span>t</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>some_v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tbind</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>IVar</span></span><span> </span><span class="entity"><span>some_v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tbind</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>NONE</span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>implode_monad</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Code_Thingol.unfoldr</span></span><span> </span><span class="entity"><span>dest_monad</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_monad</span></span><span> </span><span class="entity"><span>print_bind</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="main"><span>(</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>semicolon</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_monad</span></span><span> </span><span class="entity"><span>print_bind</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>bind</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>vars</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>print_bind</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>bind</span></span><span>
          </span><span>|&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>semicolon</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"&lt;-"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_monad</span></span><span> </span><span class="entity"><span>print_bind</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>bind</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>vars</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>print_bind</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>bind</span></span><span>
          </span><span>|&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>semicolon</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"let"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"{"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"}"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pretty</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t2</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>dest_bind</span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span class="entity"><span>t2</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bind</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>binds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t''</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>implode_monad</span></span><span> </span><span class="entity"><span>t'</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vars'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_monad</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>gen_print_bind</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="entity"><span>print_term</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>print_term</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>bind</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>binds</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="entity"><span>brackify_block</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"do { "</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>@|</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>t''</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>" }"</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>brackify_infix</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>L</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fxy</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>INFX</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>L</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"&gt;&gt;="</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>INFX</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pretty</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>add_monad</span></span><span> </span><span class="entity"><span>target'</span></span><span> </span><span class="entity"><span>raw_c_bind</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>c_bind</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Code.read_const</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>raw_c_bind</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>target</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>target'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span class="entity"><span>thy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>Code_Target.set_printings</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Constant</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c_bind</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>target</span></span><span class="main"><span>,</span></span><span>
        </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Printer.complex_const_syntax</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pretty_haskell_monad</span></span><span> </span><span class="entity"><span>c_bind</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"Only Haskell target allows for monad syntax"</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(** Isar setup **)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Theory.setup</span><span>
  </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Target.add_language</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>target</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>{</span></span><span>serializer</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>serializer</span></span><span class="main"><span>,</span></span><span> </span><span>literals</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>literals</span></span><span class="main"><span>,</span></span><span>
      </span><span>check</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span>env_var</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"ISABELLE_GHC"</span></span><span class="main"><span>,</span></span><span> </span><span>make_destination</span><span> </span><span class="main"><span>=</span></span><span> </span><span>I</span><span class="main"><span>,</span></span><span>
        </span><span>make_command</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>module_name</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="inner_quoted"><span>"\"$ISABELLE_GHC\" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>language_params</span></span><span>  </span><span>^</span><span> </span><span class="inner_quoted"><span>" -odir build -hidir build -stubdir build -e \"\" "</span></span><span> </span><span>^</span><span>
            </span><span class="entity"><span>module_name</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>".hs"</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span>
      </span><span>evaluation_args</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>
  </span><span>#&gt;</span><span> </span><span class="entity"><span>Code_Target.set_printings</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"fun"</span></span><span class="main"><span>,</span></span><span>
    </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>target</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>print_typ</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ty1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty2</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="entity"><span>brackify_infix</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span>
        </span><span class="entity"><span>print_typ</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>INFX</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ty1</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"-&gt;"</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>print_typ</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>INFX</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ty2</span></span><span>
      </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span>#&gt;</span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Target.add_reserved</span></span><span> </span><span class="entity"><span>target</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span>
      </span><span class="inner_quoted"><span>"hiding"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"deriving"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"where"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"case"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"of"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"infix"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"infixl"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"infixr"</span></span><span class="main"><span>,</span></span><span>
      </span><span class="inner_quoted"><span>"import"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"default"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"forall"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"let"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"in"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"class"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"qualified"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"data"</span></span><span class="main"><span>,</span></span><span>
      </span><span class="inner_quoted"><span>"newtype"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"instance"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"if"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"then"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"else"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"type"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"as"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"do"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"module"</span></span><span>
    </span><span class="main"><span>]</span></span><span>
  </span><span>#&gt;</span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Target.add_reserved</span></span><span> </span><span class="entity"><span>target</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prelude_import_unqualified</span></span><span>
  </span><span>#&gt;</span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Target.add_reserved</span></span><span> </span><span class="entity"><span>target</span></span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prelude_import_unqualified_constr</span></span><span>
  </span><span>#&gt;</span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Target.add_reserved</span></span><span> </span><span class="entity"><span>target</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prelude_import_unqualified_constr</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Outer_Syntax.command</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">command_keyword</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="keyword1"><span>code_monad</span></span><span>›</span></span></span><span> </span><span class="inner_quoted"><span>"define code syntax for monads"</span></span><span>
    </span><span class="main"><span>(</span></span><span>Parse.term</span><span> </span><span>--</span><span> </span><span>Parse.name</span><span> </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>raw_bind</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>target</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="entity"><span>Toplevel.theory</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>add_monad</span></span><span> </span><span class="entity"><span>target</span></span><span> </span><span class="entity"><span>raw_bind</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span> </span><span class="comment1"><span>(*struct*)</span></span><span>
</span></pre>
</body>

</html>